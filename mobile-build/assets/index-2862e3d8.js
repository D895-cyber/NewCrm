var qr=Object.defineProperty;var Gr=(s,t,a)=>t in s?qr(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var Qs=(s,t,a)=>(Gr(s,typeof t!="symbol"?t+"":t,a),a);import{j as e,P as qe,S as Fa,c as Yr,a as Kt,b as La,u as xs,A as Jr,d as Ze,e as Fs,h as Zr,f as Xr,R as Qr,F as el,D as sl,C as tl,g as Wt,i as al,k as rl,l as ll,m as At,n as nl,o as il,p as cl,q as ol,r as dl,s as ml,T as xl,t as hl,v as ul,O as pl,w as gl,L as jl,x as bl,y as vl,z as fl,B as yl}from"./ui-e1f20b50.js";import{a as qt,r as n,R as Gt}from"./vendor-db496f33.js";import{c as Oa,R as Ls,B as Yt,C as nt,X as it,Y as ct,T as Os,a as Js,P as Jt,b as Zt,d as Xt,L as Nl,e as Dt,f as da,A as kl,g as ma}from"./charts-bcd97ba2.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&l(h)}).observe(document,{childList:!0,subtree:!0});function a(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(i){if(i.ep)return;i.ep=!0;const o=a(i);fetch(i.href,o)}})();var Rt={},xa=qt;Rt.createRoot=xa.createRoot,Rt.hydrateRoot=xa.hydrateRoot;/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var wl={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sl=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),ue=(s,t)=>{const a=n.forwardRef(({color:l="currentColor",size:i=24,strokeWidth:o=2,absoluteStrokeWidth:h,className:c="",children:j,...P},v)=>n.createElement("svg",{ref:v,...wl,width:i,height:i,stroke:l,strokeWidth:h?Number(o)*24/Number(i):o,className:["lucide",`lucide-${Sl(s)}`,c].join(" "),...P},[...t.map(([x,S])=>n.createElement(x,S)),...Array.isArray(j)?j:[j]]));return a.displayName=`${s}`,a};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=ue("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=ue("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=ue("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cl=ue("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pl=ue("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=ue("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=ue("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Al=ue("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dl=ue("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=ue("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=ue("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=ue("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rl=ue("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=ue("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=ue("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=ue("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=ue("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=ue("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=ue("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=ue("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const El=ue("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=ue("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tl=ue("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ml=ue("Clock3",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16.5 12",key:"1aq6pp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=ue("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=ue("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Il=ue("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fl=ue("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=ue("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=ue("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ll=ue("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=ue("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=ue("FileImage",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["circle",{cx:"10",cy:"13",r:"2",key:"6v46hv"}],["path",{d:"m20 17-1.09-1.09a2 2 0 0 0-2.82 0L10 22",key:"17vly1"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=ue("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=ue("FileUp",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=ue("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=ue("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=ue("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ol=ue("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $l=ue("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vl=ue("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=ue("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ul=ue("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=ue("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=ue("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bl=ue("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=ue("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zl=ue("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=ue("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=ue("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=ue("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=ue("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _l=ue("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=ue("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hl=ue("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=ue("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=ue("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kl=ue("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wl=ue("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=ue("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=ue("Projector",[["path",{d:"M5 7 3 5",key:"1yys58"}],["path",{d:"M9 6V3",key:"1ptz9u"}],["path",{d:"m13 7 2-2",key:"1w3vmq"}],["circle",{cx:"9",cy:"13",r:"3",key:"1mma13"}],["path",{d:"M11.83 12H20a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2.17",key:"2frwzc"}],["path",{d:"M16 16h2",key:"dnq2od"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=ue("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=ue("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ql=ue("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gl=ue("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=ue("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=ue("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=ue("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=ue("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=ue("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=ue("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yl=ue("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=ue("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=ue("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jl=ue("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=ue("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=ue("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=ue("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=ue("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=ue("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=ue("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=ue("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=ue("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=ue("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=ue("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ka=ue("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);var Zl="Separator",wa="horizontal",Xl=["horizontal","vertical"],Ha=n.forwardRef((s,t)=>{const{decorative:a,orientation:l=wa,...i}=s,o=Ql(l)?l:wa,c=a?{role:"none"}:{"aria-orientation":o==="vertical"?o:void 0,role:"separator"};return e.jsx(qe.div,{"data-orientation":o,...c,...i,ref:t})});Ha.displayName=Zl;function Ql(s){return Xl.includes(s)}var en=Ha;const aa="-",sn=s=>{const t=an(s),{conflictingClassGroups:a,conflictingClassGroupModifiers:l}=s;return{getClassGroupId:h=>{const c=h.split(aa);return c[0]===""&&c.length!==1&&c.shift(),Ka(c,t)||tn(h)},getConflictingClassGroupIds:(h,c)=>{const j=a[h]||[];return c&&l[h]?[...j,...l[h]]:j}}},Ka=(s,t)=>{var h;if(s.length===0)return t.classGroupId;const a=s[0],l=t.nextPart.get(a),i=l?Ka(s.slice(1),l):void 0;if(i)return i;if(t.validators.length===0)return;const o=s.join(aa);return(h=t.validators.find(({validator:c})=>c(o)))==null?void 0:h.classGroupId},Sa=/^\[(.+)\]$/,tn=s=>{if(Sa.test(s)){const t=Sa.exec(s)[1],a=t==null?void 0:t.substring(0,t.indexOf(":"));if(a)return"arbitrary.."+a}},an=s=>{const{theme:t,prefix:a}=s,l={nextPart:new Map,validators:[]};return ln(Object.entries(s.classGroups),a).forEach(([o,h])=>{$t(h,l,o,t)}),l},$t=(s,t,a,l)=>{s.forEach(i=>{if(typeof i=="string"){const o=i===""?t:Ca(t,i);o.classGroupId=a;return}if(typeof i=="function"){if(rn(i)){$t(i(l),t,a,l);return}t.validators.push({validator:i,classGroupId:a});return}Object.entries(i).forEach(([o,h])=>{$t(h,Ca(t,o),a,l)})})},Ca=(s,t)=>{let a=s;return t.split(aa).forEach(l=>{a.nextPart.has(l)||a.nextPart.set(l,{nextPart:new Map,validators:[]}),a=a.nextPart.get(l)}),a},rn=s=>s.isThemeGetter,ln=(s,t)=>t?s.map(([a,l])=>{const i=l.map(o=>typeof o=="string"?t+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(([h,c])=>[t+h,c])):o);return[a,i]}):s,nn=s=>{if(s<1)return{get:()=>{},set:()=>{}};let t=0,a=new Map,l=new Map;const i=(o,h)=>{a.set(o,h),t++,t>s&&(t=0,l=a,a=new Map)};return{get(o){let h=a.get(o);if(h!==void 0)return h;if((h=l.get(o))!==void 0)return i(o,h),h},set(o,h){a.has(o)?a.set(o,h):i(o,h)}}},Wa="!",cn=s=>{const{separator:t,experimentalParseClassName:a}=s,l=t.length===1,i=t[0],o=t.length,h=c=>{const j=[];let P=0,v=0,x;for(let b=0;b<c.length;b++){let N=c[b];if(P===0){if(N===i&&(l||c.slice(b,b+o)===t)){j.push(c.slice(v,b)),v=b+o;continue}if(N==="/"){x=b;continue}}N==="["?P++:N==="]"&&P--}const S=j.length===0?c:c.substring(v),E=S.startsWith(Wa),V=E?S.substring(1):S,_=x&&x>v?x-v:void 0;return{modifiers:j,hasImportantModifier:E,baseClassName:V,maybePostfixModifierPosition:_}};return a?c=>a({className:c,parseClassName:h}):h},on=s=>{if(s.length<=1)return s;const t=[];let a=[];return s.forEach(l=>{l[0]==="["?(t.push(...a.sort(),l),a=[]):a.push(l)}),t.push(...a.sort()),t},dn=s=>({cache:nn(s.cacheSize),parseClassName:cn(s),...sn(s)}),mn=/\s+/,xn=(s,t)=>{const{parseClassName:a,getClassGroupId:l,getConflictingClassGroupIds:i}=t,o=[],h=s.trim().split(mn);let c="";for(let j=h.length-1;j>=0;j-=1){const P=h[j],{modifiers:v,hasImportantModifier:x,baseClassName:S,maybePostfixModifierPosition:E}=a(P);let V=!!E,_=l(V?S.substring(0,E):S);if(!_){if(!V){c=P+(c.length>0?" "+c:c);continue}if(_=l(S),!_){c=P+(c.length>0?" "+c:c);continue}V=!1}const b=on(v).join(":"),N=x?b+Wa:b,y=N+_;if(o.includes(y))continue;o.push(y);const A=i(_,V);for(let u=0;u<A.length;++u){const $=A[u];o.push(N+$)}c=P+(c.length>0?" "+c:c)}return c};function hn(){let s=0,t,a,l="";for(;s<arguments.length;)(t=arguments[s++])&&(a=qa(t))&&(l&&(l+=" "),l+=a);return l}const qa=s=>{if(typeof s=="string")return s;let t,a="";for(let l=0;l<s.length;l++)s[l]&&(t=qa(s[l]))&&(a&&(a+=" "),a+=t);return a};function un(s,...t){let a,l,i,o=h;function h(j){const P=t.reduce((v,x)=>x(v),s());return a=dn(P),l=a.cache.get,i=a.cache.set,o=c,c(j)}function c(j){const P=l(j);if(P)return P;const v=xn(j,a);return i(j,v),v}return function(){return o(hn.apply(null,arguments))}}const _e=s=>{const t=a=>a[s]||[];return t.isThemeGetter=!0,t},Ga=/^\[(?:([a-z-]+):)?(.+)\]$/i,pn=/^\d+\/\d+$/,gn=new Set(["px","full","screen"]),jn=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,bn=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,vn=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,fn=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,yn=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Ps=s=>Gs(s)||gn.has(s)||pn.test(s),Ts=s=>Zs(s,"length",Dn),Gs=s=>!!s&&!Number.isNaN(Number(s)),Ct=s=>Zs(s,"number",Gs),et=s=>!!s&&Number.isInteger(Number(s)),Nn=s=>s.endsWith("%")&&Gs(s.slice(0,-1)),De=s=>Ga.test(s),Ms=s=>jn.test(s),kn=new Set(["length","size","percentage"]),wn=s=>Zs(s,kn,Ya),Sn=s=>Zs(s,"position",Ya),Cn=new Set(["image","url"]),Pn=s=>Zs(s,Cn,En),An=s=>Zs(s,"",Rn),st=()=>!0,Zs=(s,t,a)=>{const l=Ga.exec(s);return l?l[1]?typeof t=="string"?l[1]===t:t.has(l[1]):a(l[2]):!1},Dn=s=>bn.test(s)&&!vn.test(s),Ya=()=>!1,Rn=s=>fn.test(s),En=s=>yn.test(s),Tn=()=>{const s=_e("colors"),t=_e("spacing"),a=_e("blur"),l=_e("brightness"),i=_e("borderColor"),o=_e("borderRadius"),h=_e("borderSpacing"),c=_e("borderWidth"),j=_e("contrast"),P=_e("grayscale"),v=_e("hueRotate"),x=_e("invert"),S=_e("gap"),E=_e("gradientColorStops"),V=_e("gradientColorStopPositions"),_=_e("inset"),b=_e("margin"),N=_e("opacity"),y=_e("padding"),A=_e("saturate"),u=_e("scale"),$=_e("sepia"),z=_e("skew"),re=_e("space"),K=_e("translate"),ne=()=>["auto","contain","none"],Y=()=>["auto","hidden","clip","visible","scroll"],O=()=>["auto",De,t],R=()=>[De,t],F=()=>["",Ps,Ts],J=()=>["auto",Gs,De],T=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],w=()=>["solid","dashed","dotted","double","none"],g=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],p=()=>["start","end","center","between","around","evenly","stretch"],M=()=>["","0",De],m=()=>["auto","avoid","all","avoid-page","page","left","right","column"],d=()=>[Gs,De];return{cacheSize:500,separator:":",theme:{colors:[st],spacing:[Ps,Ts],blur:["none","",Ms,De],brightness:d(),borderColor:[s],borderRadius:["none","","full",Ms,De],borderSpacing:R(),borderWidth:F(),contrast:d(),grayscale:M(),hueRotate:d(),invert:M(),gap:R(),gradientColorStops:[s],gradientColorStopPositions:[Nn,Ts],inset:O(),margin:O(),opacity:d(),padding:R(),saturate:d(),scale:d(),sepia:M(),skew:d(),space:R(),translate:R()},classGroups:{aspect:[{aspect:["auto","square","video",De]}],container:["container"],columns:[{columns:[Ms]}],"break-after":[{"break-after":m()}],"break-before":[{"break-before":m()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...T(),De]}],overflow:[{overflow:Y()}],"overflow-x":[{"overflow-x":Y()}],"overflow-y":[{"overflow-y":Y()}],overscroll:[{overscroll:ne()}],"overscroll-x":[{"overscroll-x":ne()}],"overscroll-y":[{"overscroll-y":ne()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[_]}],"inset-x":[{"inset-x":[_]}],"inset-y":[{"inset-y":[_]}],start:[{start:[_]}],end:[{end:[_]}],top:[{top:[_]}],right:[{right:[_]}],bottom:[{bottom:[_]}],left:[{left:[_]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",et,De]}],basis:[{basis:O()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",De]}],grow:[{grow:M()}],shrink:[{shrink:M()}],order:[{order:["first","last","none",et,De]}],"grid-cols":[{"grid-cols":[st]}],"col-start-end":[{col:["auto",{span:["full",et,De]},De]}],"col-start":[{"col-start":J()}],"col-end":[{"col-end":J()}],"grid-rows":[{"grid-rows":[st]}],"row-start-end":[{row:["auto",{span:[et,De]},De]}],"row-start":[{"row-start":J()}],"row-end":[{"row-end":J()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",De]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",De]}],gap:[{gap:[S]}],"gap-x":[{"gap-x":[S]}],"gap-y":[{"gap-y":[S]}],"justify-content":[{justify:["normal",...p()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...p(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...p(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[y]}],px:[{px:[y]}],py:[{py:[y]}],ps:[{ps:[y]}],pe:[{pe:[y]}],pt:[{pt:[y]}],pr:[{pr:[y]}],pb:[{pb:[y]}],pl:[{pl:[y]}],m:[{m:[b]}],mx:[{mx:[b]}],my:[{my:[b]}],ms:[{ms:[b]}],me:[{me:[b]}],mt:[{mt:[b]}],mr:[{mr:[b]}],mb:[{mb:[b]}],ml:[{ml:[b]}],"space-x":[{"space-x":[re]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[re]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",De,t]}],"min-w":[{"min-w":[De,t,"min","max","fit"]}],"max-w":[{"max-w":[De,t,"none","full","min","max","fit","prose",{screen:[Ms]},Ms]}],h:[{h:[De,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[De,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[De,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[De,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Ms,Ts]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Ct]}],"font-family":[{font:[st]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",De]}],"line-clamp":[{"line-clamp":["none",Gs,Ct]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Ps,De]}],"list-image":[{"list-image":["none",De]}],"list-style-type":[{list:["none","disc","decimal",De]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[s]}],"placeholder-opacity":[{"placeholder-opacity":[N]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[s]}],"text-opacity":[{"text-opacity":[N]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...w(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Ps,Ts]}],"underline-offset":[{"underline-offset":["auto",Ps,De]}],"text-decoration-color":[{decoration:[s]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:R()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",De]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",De]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[N]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...T(),Sn]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",wn]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Pn]}],"bg-color":[{bg:[s]}],"gradient-from-pos":[{from:[V]}],"gradient-via-pos":[{via:[V]}],"gradient-to-pos":[{to:[V]}],"gradient-from":[{from:[E]}],"gradient-via":[{via:[E]}],"gradient-to":[{to:[E]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[N]}],"border-style":[{border:[...w(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[N]}],"divide-style":[{divide:w()}],"border-color":[{border:[i]}],"border-color-x":[{"border-x":[i]}],"border-color-y":[{"border-y":[i]}],"border-color-s":[{"border-s":[i]}],"border-color-e":[{"border-e":[i]}],"border-color-t":[{"border-t":[i]}],"border-color-r":[{"border-r":[i]}],"border-color-b":[{"border-b":[i]}],"border-color-l":[{"border-l":[i]}],"divide-color":[{divide:[i]}],"outline-style":[{outline:["",...w()]}],"outline-offset":[{"outline-offset":[Ps,De]}],"outline-w":[{outline:[Ps,Ts]}],"outline-color":[{outline:[s]}],"ring-w":[{ring:F()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[s]}],"ring-opacity":[{"ring-opacity":[N]}],"ring-offset-w":[{"ring-offset":[Ps,Ts]}],"ring-offset-color":[{"ring-offset":[s]}],shadow:[{shadow:["","inner","none",Ms,An]}],"shadow-color":[{shadow:[st]}],opacity:[{opacity:[N]}],"mix-blend":[{"mix-blend":[...g(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":g()}],filter:[{filter:["","none"]}],blur:[{blur:[a]}],brightness:[{brightness:[l]}],contrast:[{contrast:[j]}],"drop-shadow":[{"drop-shadow":["","none",Ms,De]}],grayscale:[{grayscale:[P]}],"hue-rotate":[{"hue-rotate":[v]}],invert:[{invert:[x]}],saturate:[{saturate:[A]}],sepia:[{sepia:[$]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[a]}],"backdrop-brightness":[{"backdrop-brightness":[l]}],"backdrop-contrast":[{"backdrop-contrast":[j]}],"backdrop-grayscale":[{"backdrop-grayscale":[P]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[v]}],"backdrop-invert":[{"backdrop-invert":[x]}],"backdrop-opacity":[{"backdrop-opacity":[N]}],"backdrop-saturate":[{"backdrop-saturate":[A]}],"backdrop-sepia":[{"backdrop-sepia":[$]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[h]}],"border-spacing-x":[{"border-spacing-x":[h]}],"border-spacing-y":[{"border-spacing-y":[h]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",De]}],duration:[{duration:d()}],ease:[{ease:["linear","in","out","in-out",De]}],delay:[{delay:d()}],animate:[{animate:["none","spin","ping","pulse","bounce",De]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[u]}],"scale-x":[{"scale-x":[u]}],"scale-y":[{"scale-y":[u]}],rotate:[{rotate:[et,De]}],"translate-x":[{"translate-x":[K]}],"translate-y":[{"translate-y":[K]}],"skew-x":[{"skew-x":[z]}],"skew-y":[{"skew-y":[z]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",De]}],accent:[{accent:["auto",s]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",De]}],"caret-color":[{caret:[s]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":R()}],"scroll-mx":[{"scroll-mx":R()}],"scroll-my":[{"scroll-my":R()}],"scroll-ms":[{"scroll-ms":R()}],"scroll-me":[{"scroll-me":R()}],"scroll-mt":[{"scroll-mt":R()}],"scroll-mr":[{"scroll-mr":R()}],"scroll-mb":[{"scroll-mb":R()}],"scroll-ml":[{"scroll-ml":R()}],"scroll-p":[{"scroll-p":R()}],"scroll-px":[{"scroll-px":R()}],"scroll-py":[{"scroll-py":R()}],"scroll-ps":[{"scroll-ps":R()}],"scroll-pe":[{"scroll-pe":R()}],"scroll-pt":[{"scroll-pt":R()}],"scroll-pr":[{"scroll-pr":R()}],"scroll-pb":[{"scroll-pb":R()}],"scroll-pl":[{"scroll-pl":R()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",De]}],fill:[{fill:[s,"none"]}],"stroke-w":[{stroke:[Ps,Ts,Ct]}],stroke:[{stroke:[s,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Mn=un(Tn);function Le(...s){return Mn(Oa(s))}function Ge({className:s,orientation:t="horizontal",decorative:a=!0,...l}){return e.jsx(en,{"data-slot":"separator-root",decorative:a,orientation:t,className:Le("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",s),...l})}const Pa=s=>typeof s=="boolean"?`${s}`:s===0?"0":s,Aa=Oa,ra=(s,t)=>a=>{var l;if((t==null?void 0:t.variants)==null)return Aa(s,a==null?void 0:a.class,a==null?void 0:a.className);const{variants:i,defaultVariants:o}=t,h=Object.keys(i).map(P=>{const v=a==null?void 0:a[P],x=o==null?void 0:o[P];if(v===null)return null;const S=Pa(v)||Pa(x);return i[P][S]}),c=a&&Object.entries(a).reduce((P,v)=>{let[x,S]=v;return S===void 0||(P[x]=S),P},{}),j=t==null||(l=t.compoundVariants)===null||l===void 0?void 0:l.reduce((P,v)=>{let{class:x,className:S,...E}=v;return Object.entries(E).every(V=>{let[_,b]=V;return Array.isArray(b)?b.includes({...o,...c}[_]):{...o,...c}[_]===b})?[...P,x,S]:P},[]);return Aa(s,h,j,a==null?void 0:a.class,a==null?void 0:a.className)},In=ra("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}});function q({className:s,variant:t,size:a,asChild:l=!1,...i}){const o=l?Fa:"button";return e.jsx(o,{"data-slot":"button",className:Le(In({variant:t,size:a,className:s})),...i})}function Fn({notifications:s,onDismiss:t,onDismissAll:a}){const[l,i]=n.useState(!1),[o,h]=n.useState(new Set),c=s.filter(j=>!o.has(j.id));return c.length===0?null:e.jsx("div",{className:"absolute top-0 left-0 right-0 z-50 bg-dark-bg border-b border-dark-color shadow-lg",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Qt,{className:"w-5 h-5 text-orange-400"}),e.jsxs("span",{className:"text-dark-primary font-medium",children:[c.length," Warranty Alert",c.length!==1?"s":""]})]}),e.jsxs(q,{onClick:()=>i(!l),className:"text-sm text-dark-secondary hover:text-dark-primary",variant:"ghost",children:[l?"Hide":"Show"," Details"]})]}),c.length>1&&e.jsx(q,{onClick:a,className:"text-sm text-dark-secondary hover:text-dark-primary",variant:"ghost",children:"Dismiss All"})]}),l&&e.jsx("div",{className:"mt-3 space-y-2 max-h-64 overflow-y-auto",children:c.map(j=>e.jsxs("div",{className:`p-3 rounded-lg border flex items-center justify-between ${j.type==="warning"?"bg-orange-900/20 border-orange-500/30 text-orange-300":"bg-red-900/20 border-red-500/30 text-red-300"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:j.message})]}),e.jsx(q,{onClick:()=>t(j.id),className:"text-dark-secondary hover:text-dark-primary ml-2",variant:"ghost",size:"sm",children:e.jsx(Ke,{className:"w-4 h-4"})})]},j.id))})]})})}const Da={api:{baseUrl:"http://localhost:4000/api",timeout:3e4},app:{name:"Projector Warranty Management",version:"1.0.0"},defaults:{pageSize:20,maxSearchResults:100},features:{realTimeUpdates:!0,exportFeatures:!0,advancedSearch:!0}},Ln=()=>{var t,a,l;if(typeof window<"u"){const i=window.location.hostname;if(i!=="localhost"&&i!=="127.0.0.1")return`http://${i}:4000/api`}const s=[typeof window<"u"?(t=window.ENV)==null?void 0:t.API_URL:null,typeof globalThis<"u"?(l=(a=globalThis.process)==null?void 0:a.env)==null?void 0:l.REACT_APP_API_URL:null,Da.api.baseUrl];for(const i of s)if(i&&typeof i=="string")return i;return Da.api.baseUrl},Ks=()=>{try{return typeof window<"u"?window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1":!1}catch{return!0}};class On{constructor(){Qs(this,"baseUrl");Qs(this,"headers");this.baseUrl=Ln(),this.headers={"Content-Type":"application/json"},Ks()&&console.log("API Client initialized with base URL:",this.baseUrl)}setAuthToken(t){this.headers.Authorization=`Bearer ${t}`}clearAuthToken(){delete this.headers.Authorization}async request(t,a={}){try{const l=`${this.baseUrl}${t}`,i=typeof FormData<"u"&&a.body instanceof FormData;Ks()&&console.log(`API ${a.method||"GET"} request to:`,l,i?"(multipart)":"");const o={...this.headers,...a.headers};i&&o["Content-Type"]&&delete o["Content-Type"];const h=await fetch(l,{...a,headers:o});if(!h.ok){const P=(await h.json().catch(()=>({}))).error||`HTTP error! status: ${h.status}`;throw Ks()&&console.error(`API error for ${t}:`,P),new Error(P)}const c=await h.json();return Ks()&&console.log(`API response for ${t}:`,c),c}catch(l){throw console.error(`API ${a.method||"GET"} error for ${t}:`,l),l}}async get(t){return this.request(t,{method:"GET"})}async post(t,a){const l=typeof FormData<"u"&&a instanceof FormData;return this.request(t,{method:"POST",body:l?a:JSON.stringify(a)})}async put(t,a){const l=typeof FormData<"u"&&a instanceof FormData;return this.request(t,{method:"PUT",body:l?a:JSON.stringify(a)})}async patch(t,a){const l=typeof FormData<"u"&&a instanceof FormData;return this.request(t,{method:"PATCH",body:l?a:JSON.stringify(a)})}async delete(t){return this.request(t,{method:"DELETE"})}async initializeDatabase(){return this.post("/settings/initialize",{})}async clearAllData(){return this.post("/clear-all-data",{})}async healthCheck(){return this.get("/health")}async login(t,a){return this.post("/auth/login",{username:t,password:a})}async register(t){return this.post("/auth/register",t)}async getProfile(){return this.get("/auth/profile")}async updateProfile(t){return this.put("/auth/profile",t)}async changePassword(t,a){return this.put("/auth/change-password",{currentPassword:t,newPassword:a})}async logout(){return this.post("/auth/logout",{})}async getAllFSEs(){return this.get("/fse")}async createFSE(t){return this.post("/fse",t)}async updateFSE(t,a){return this.put(`/fse/${encodeURIComponent(t)}`,a)}async deleteFSE(t){return this.delete(`/fse/${encodeURIComponent(t)}`)}async getFSEsByStatus(t){return this.get(`/fse/status/${encodeURIComponent(t)}`)}async getFSEsByTerritory(t){return this.get(`/fse/territory/${encodeURIComponent(t)}`)}async searchFSEs(t){return this.get(`/fse/search/${encodeURIComponent(t)}`)}async getSiteStats(){return await this.get("/sites/stats/overview")}async getFSEStats(){return this.get("/fse/stats/overview")}async getAllSites(){return this.get("/sites")}async getSite(t){return this.get(`/sites/${encodeURIComponent(t)}`)}async createSite(t){return this.post("/sites",t)}async updateSite(t,a){return this.put(`/sites/${encodeURIComponent(t)}`,a)}async deleteSite(t){return this.delete(`/sites/${encodeURIComponent(t)}`)}async getAllProjectors(){return this.get("/projectors")}async getProjector(t){return this.get(`/projectors/${encodeURIComponent(t)}`)}async createProjector(t){return this.post("/projectors",t)}async updateProjector(t,a){return this.put(`/projectors/${encodeURIComponent(t)}`,a)}async deleteProjector(t){return this.delete(`/projectors/${encodeURIComponent(t)}`)}async getAllServices(){return this.get("/services")}async getServices(){return await this.get("/services")}async getService(t){return this.get(`/services/${encodeURIComponent(t)}`)}async createService(t){return this.post("/services",t)}async updateService(t,a){return this.put(`/services/${encodeURIComponent(t)}`,a)}async deleteService(t){return this.delete(`/services/${encodeURIComponent(t)}`)}async getAllPurchaseOrders(){return this.get("/purchase-orders")}async getPurchaseOrder(t){return this.get(`/purchase-orders/${encodeURIComponent(t)}`)}async createPurchaseOrder(t){return this.post("/purchase-orders",t)}async updatePurchaseOrder(t,a){return this.put(`/purchase-orders/${encodeURIComponent(t)}`,a)}async deletePurchaseOrder(t){return this.delete(`/purchase-orders/${encodeURIComponent(t)}`)}async getAllRMA(){console.log("API Client: Getting all RMA data");const t=await this.get("/rma");return console.log("API Client: Received RMA data:",t.length,"items"),console.log("API Client: First RMA:",t[0]),t}async getRMA(t){return this.get(`/rma/${encodeURIComponent(t)}`)}async createRMA(t){return this.post("/rma",t)}async updateRMA(t,a){return console.log("API Client: Updating RMA with ID:",t),console.log("API Client: Updates data:",a),this.put(`/rma/${encodeURIComponent(t)}`,a)}async deleteRMA(t){return this.delete(`/rma/${encodeURIComponent(t)}`)}async getRMAHistoryByProjector(t){return this.get(`/rma/projector/${encodeURIComponent(t)}`)}async getAllServiceVisits(){return this.get("/service-visits")}async getServiceVisit(t){return this.get(`/service-visits/${encodeURIComponent(t)}`)}async createServiceVisit(t){return this.post("/service-visits",t)}async updateServiceVisit(t,a){return this.put(`/service-visits/${encodeURIComponent(t)}`,a)}async deleteServiceVisit(t){return this.delete(`/service-visits/${encodeURIComponent(t)}`)}async getServiceVisitsByFSE(t){return this.get(`/service-visits/fse/${encodeURIComponent(t)}`)}async getServiceVisitsBySite(t){return this.get(`/service-visits/site/${encodeURIComponent(t)}`)}async getServiceVisitsByProjector(t){return this.get(`/service-visits/projector/${encodeURIComponent(t)}`)}async getServiceVisitsByStatus(t){return this.get(`/service-visits/status/${encodeURIComponent(t)}`)}async getServiceVisitsByDateRange(t,a){return this.get(`/service-visits/date-range/${encodeURIComponent(t)}/${encodeURIComponent(a)}`)}async getServiceVisitStats(){return this.get("/service-visits/stats/overview")}async uploadServiceVisitPhotos(t,a){return console.log("API Client: Uploading photos (legacy) to visit:",t),this.post(`/service-visits/${encodeURIComponent(t)}/photos`,a)}async uploadServiceVisitPhotosAutomated(t,a,l="Other"){return console.log("API Client: Uploading photos (automated) to visit:",t,"with category:",l),a.append("category",l),this.post(`/service-visits/${encodeURIComponent(t)}/photos/automated`,a)}async getServiceVisitPhotos(t){return this.get(`/service-visits/${encodeURIComponent(t)}/photos`)}async getCloudStats(){return this.get("/service-visits/cloud-stats")}async getAllServiceReports(){const t={...this.headers};delete this.headers.Authorization;try{return await this.get("/service-reports")}finally{this.headers=t}}async getFSEServiceReports(){const t={...this.headers};delete this.headers.Authorization;try{return await this.get("/service-reports")}finally{this.headers=t}}async getCompletedServiceVisits(){const t={...this.headers};delete this.headers.Authorization;try{return(await this.get("/service-visits")).filter(i=>i.status==="Completed")}finally{this.headers=t}}async getServiceReport(t){return this.get(`/service-reports/${encodeURIComponent(t)}`)}async createServiceReport(t){return this.post("/service-reports",t)}async updateServiceReport(t,a){return this.put(`/service-reports/${encodeURIComponent(t)}`,a)}async deleteServiceReport(t){return this.delete(`/service-reports/${encodeURIComponent(t)}`)}async getServiceReportsByProjector(t){return this.get(`/service-reports/projector/${encodeURIComponent(t)}`)}async getServiceReportsByEngineer(t){return this.get(`/service-reports/engineer/${encodeURIComponent(t)}`)}async getServiceReportsBySite(t){return this.get(`/service-reports/site/${encodeURIComponent(t)}`)}async getServiceReportsByVisit(t){return this.get(`/service-reports/visit/${encodeURIComponent(t)}`)}async getServiceReportsByDateRange(t,a){return this.get(`/service-reports/date-range/${encodeURIComponent(t)}/${encodeURIComponent(a)}`)}async getServiceReportDashboardStats(){const t={...this.headers};delete this.headers.Authorization;try{return await this.get("/service-reports/stats/dashboard")}finally{this.headers=t}}async getFSEAnalytics(){return this.get("/service-reports/analytics/fse")}async getDetailedServiceReports(t=50,a=0){return this.get(`/service-reports/analytics/detailed?limit=${t}&skip=${a}`)}async createAMCContract(t){return this.post("/amc-contracts",t)}async getAllAMCContracts(){return this.get("/amc-contracts")}async getAMCContract(t){return this.get(`/amc-contracts/${encodeURIComponent(t)}`)}async updateAMCContract(t,a){return this.put(`/amc-contracts/${encodeURIComponent(t)}`,a)}async deleteAMCContract(t){return this.delete(`/amc-contracts/${encodeURIComponent(t)}`)}async getAMCContractsByProjector(t){return this.get(`/amc-contracts/projector/${encodeURIComponent(t)}`)}async getAMCContractsByStatus(t){return this.get(`/amc-contracts/status/${encodeURIComponent(t)}`)}async getAMCContractsByFSE(t){return this.get(`/amc-contracts/fse/${encodeURIComponent(t)}`)}async getAMCContractsExpiringSoon(t){return this.get(`/amc-contracts/expiring/${t}`)}async getOverdueAMCServices(){return this.get("/amc-contracts/overdue/services")}async getAMCDashboardStats(){return this.get("/amc-contracts/stats/dashboard")}async updateAMCServiceStatus(t,a,l){return this.put(`/amc-contracts/${encodeURIComponent(t)}/service/${a}/status`,l)}async renewAMCContract(t,a){return this.post(`/amc-contracts/${encodeURIComponent(t)}/renew`,{renewalPeriod:a})}async getRecommendedSpares(t){const a=new URLSearchParams;t!=null&&t.status&&a.set("status",t.status),t!=null&&t.siteId&&a.set("siteId",t.siteId),t!=null&&t.projectorSerial&&a.set("projectorSerial",t.projectorSerial);const l=a.toString();return this.get(`/service-reports/recommended-spares${l?`?${l}`:""}`)}async updateRecommendedSpare(t,a){return this.put(`/recommended-spares/${encodeURIComponent(t)}`,a)}async createRecommendedSpare(t){return this.post("/recommended-spares",t)}async getAllSpareParts(){return this.get("/spare-parts")}async getSparePart(t){return this.get(`/spare-parts/${encodeURIComponent(t)}`)}async createSparePart(t){return this.post("/spare-parts",t)}async updateSparePart(t,a){return this.put(`/spare-parts/${encodeURIComponent(t)}`,a)}async deleteSparePart(t){return this.delete(`/spare-parts/${encodeURIComponent(t)}`)}async getSparePartsByCategory(t){return this.get(`/spare-parts/category/${encodeURIComponent(t)}`)}async getSparePartsByStatus(t){return this.get(`/spare-parts/status/${encodeURIComponent(t)}`)}async getLowStockSpareParts(){return this.get("/spare-parts/alerts/low-stock")}async searchSpareParts(t){return this.get(`/spare-parts/search/${encodeURIComponent(t)}`)}async updateSparePartStock(t,a){return this.patch(`/spare-parts/${encodeURIComponent(t)}/stock`,{stockQuantity:a})}getBaseUrl(){return this.baseUrl}}const ie=new On;class $n{constructor(){Qs(this,"cache",new Map);Qs(this,"defaultTTL",5*60*1e3)}set(t,a,l=this.defaultTTL){this.cache.set(t,{data:a,timestamp:Date.now(),ttl:l})}get(t){const a=this.cache.get(t);return a?Date.now()-a.timestamp>a.ttl?(this.cache.delete(t),null):a.data:null}has(t){return this.get(t)!==null}clear(){this.cache.clear()}invalidate(t){for(const a of this.cache.keys())a.includes(t)&&this.cache.delete(a)}delete(t){this.cache.delete(t)}}const ys=new $n,Ja=n.createContext(void 0),Us=()=>{const s=n.useContext(Ja);if(!s)throw new Error("useData must be used within a DataProvider");return s},ht=({children:s})=>{const[t,a]=n.useState([]),[l,i]=n.useState([]),[o,h]=n.useState([]),[c,j]=n.useState([]),[P,v]=n.useState([]),[x,S]=n.useState([]),[E,V]=n.useState([]),[_,b]=n.useState([]),[N,y]=n.useState(!1);n.useEffect(()=>{console.log("RMA state updated:",E.length,"items"),E.length>0&&console.log("Current RMA statuses:",E.map(g=>({rmaNumber:g.rmaNumber,status:g.status})))},[E]);const[A,u]=n.useState(null),$=n.useMemo(()=>{const g=new Date,p=new Date(g);p.setDate(g.getDate()-g.getDay()),p.setHours(0,0,0,0);const M=new Date(p);M.setDate(p.getDate()+6),M.setHours(23,59,59,999),console.log("Week calculation debug:"),console.log("Current date:",g.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})),console.log("Current day of week (0=Sunday):",g.getDay()),console.log("Start of week:",p.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})),console.log("End of week:",M.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}));const m=c.filter(L=>L.status==="Pending").length,d=new Date;d.setHours(0,0,0,0);const ee=[...o.filter(L=>{const Q=new Date(L.date);return Q>=p&&Q<=M||Q>=d}),...x.filter(L=>{const Q=new Date(L.scheduledDate);return(Q>=p&&Q<=M||Q>=d)&&L.status==="Scheduled"})].length;console.log("Dashboard calculation debug:"),console.log("Current date:",g.toISOString()),console.log("Start of week:",p.toISOString()),console.log("End of week:",M.toISOString()),console.log("Total services:",o.length),console.log("Total service visits:",x.length),o.length===0&&x.length===0&&console.log("⚠️ No services or service visits found in database"),o.length>0&&console.log("Services array sample:",o.slice(0,3).map(L=>({id:L.serviceId||L._id,date:L.date,dateType:typeof L.date,parsedDate:new Date(L.date),isValidDate:!isNaN(new Date(L.date).getTime())}))),x.length>0&&console.log("Service visits array sample:",x.slice(0,3).map(L=>({id:L.visitId||L._id,scheduledDate:L.scheduledDate,scheduledDateType:typeof L.scheduledDate,parsedDate:new Date(L.scheduledDate),isValidDate:!isNaN(new Date(L.scheduledDate).getTime()),status:L.status}))),console.log("Services this week (from services):",o.filter(L=>{const Q=new Date(L.date);return Q>=p&&Q<=M||Q>=d}).length),console.log("Services this week (from service visits):",x.filter(L=>{const Q=new Date(L.scheduledDate);return(Q>=p&&Q<=M||Q>=d)&&L.status==="Scheduled"}).length),console.log("Total services this week:",ee),o.length>0&&console.log("Sample service data:",o.slice(0,2).map(L=>({id:L.serviceId||L._id,date:L.date,dateType:typeof L.date,parsedDate:new Date(L.date)}))),x.length>0&&console.log("Sample service visit data:",x.slice(0,2).map(L=>({id:L.visitId||L._id,scheduledDate:L.scheduledDate,scheduledDateType:typeof L.scheduledDate,parsedDate:new Date(L.scheduledDate),status:L.status})));const B=o.filter(L=>{const Q=new Date(L.date);return Q>=p&&Q<=M||Q>=d}),ce=x.filter(L=>{const Q=new Date(L.scheduledDate);return(Q>=p&&Q<=M||Q>=d)&&L.status==="Scheduled"});console.log("Services found for this week (from services):",B.map(L=>({id:L.serviceId||L._id,date:L.date,type:L.type}))),console.log("Services found for this week (from visits):",ce.map(L=>({id:L.visitId||L._id,scheduledDate:L.scheduledDate,visitType:L.visitType,status:L.status}))),console.log("All services with dates:"),o.forEach((L,Q)=>{const D=new Date(L.date),r=D>=p&&D<=M||D>=d;console.log(`Service ${Q+1}:`,{id:L.serviceId||L._id,date:L.date,parsedDate:D.toISOString(),isThisWeek:r,type:L.type})}),console.log("All service visits with dates:"),x.forEach((L,Q)=>{const D=new Date(L.scheduledDate),r=(D>=p&&D<=M||D>=d)&&L.status==="Scheduled";console.log(`Visit ${Q+1}:`,{id:L.visitId||L._id,scheduledDate:L.scheduledDate,parsedDate:D.toISOString(),isThisWeek:r,status:L.status,visitType:L.visitType})});const me=l.filter(L=>{const Q=new Date(L.warrantyEnd),D=Math.ceil((Q.getTime()-g.getTime())/(1e3*60*60*24));return Q<=g||D<=30}).map(L=>{const Q=new Date(L.warrantyEnd),D=Math.ceil((Q.getTime()-g.getTime())/(1e3*60*60*24));return{id:`warranty-${L.serialNumber}`,message:Q<=g?`Warranty for ${L.model} (${L.serialNumber}) has expired`:`Warranty for ${L.model} (${L.serialNumber}) expires in ${D} days`,type:Q<=g?"error":"warning",timestamp:new Date}});return{sites:t.length,projectors:l.length,pendingPOs:m,servicesThisWeek:ee,warrantyAlerts:me}},[t,l,o,x,c]),z=n.useCallback(async(g,p,M=!1)=>{const m=`data-${g}`;if(!M){const d=ys.get(m);if(d)return d}try{const d=await p();return M||ys.set(m,d,5*60*1e3),d}catch(d){throw console.error(`Error loading ${g}:`,d),d}},[]),re=n.useCallback(async()=>{try{const g=await z("sites",()=>ie.getAllSites());a(g)}catch(g){u(`Failed to load sites: ${g.message}`)}},[z]),K=n.useCallback(async()=>{try{const g=await z("projectors",()=>ie.getAllProjectors());i(g)}catch(g){u(`Failed to load projectors: ${g.message}`)}},[z]),ne=n.useCallback(async()=>{try{console.log("Refreshing services...");const g=await z("services",()=>ie.getAllServices());console.log("Services loaded:",g.length,"items"),g.length>0&&console.log("Sample service:",g[0]),h(g)}catch(g){u(`Failed to load services: ${g.message}`)}},[z]),Y=n.useCallback(async()=>{try{const g=await z("purchase-orders",()=>ie.getAllPurchaseOrders());j(g)}catch(g){u(`Failed to load purchase orders: ${g.message}`)}},[z]),O=n.useCallback(async()=>{try{const g=await z("fse",()=>ie.getAllFSEs());v(g)}catch(g){u(`Failed to load FSEs: ${g.message}`)}},[z]),R=n.useCallback(async()=>{try{console.log("Refreshing service visits...");const g=await z("service-visits",()=>ie.getAllServiceVisits());console.log("Service visits loaded:",g.length,"items"),g.length>0&&console.log("Sample service visit:",g[0]),S(g)}catch(g){u(`Failed to load service visits: ${g.message}`)}},[z]),F=n.useCallback(async()=>{try{console.log("Refreshing RMA data..."),ys.delete("data-rma"),ys.delete("data-sites"),ys.delete("data-projectors"),ys.delete("data-services"),ys.delete("data-purchase-orders"),ys.delete("data-fse"),ys.delete("data-service-visits"),ys.delete("data-spare-parts"),await new Promise(p=>setTimeout(p,500));const g=await ie.getAllRMA();console.log("RMA data refreshed:",g.length,"items"),console.log("First RMA item:",g[0]),console.log("RMA statuses:",g.map(p=>({rmaNumber:p.rmaNumber,status:p.status}))),console.log("Setting RMA state with",g.length,"items"),V([...g])}catch(g){u(`Failed to load RMA: ${g.message}`)}},[z]),J=n.useCallback(async()=>{try{const g=await z("spare-parts",()=>ie.getAllSpareParts());b(g)}catch(g){u(`Failed to load spare parts: ${g.message}`)}},[z]),T=n.useCallback(async()=>{y(!0),u(null);try{await Promise.all([re(),K(),ne(),Y(),O(),R(),F(),J()])}catch(g){u(`Failed to load data: ${g.message}`)}finally{y(!1)}},[re,K,ne,Y,O,R,F,J]);n.useEffect(()=>{T()},[T]);const w={sites:t,projectors:l,services:o,purchaseOrders:c,fses:P,serviceVisits:x,rma:E,spareParts:_,isLoading:N,error:A,refreshData:T,refreshSites:re,refreshProjectors:K,refreshServices:ne,refreshPurchaseOrders:Y,refreshFSEs:O,refreshServiceVisits:R,refreshRMA:F,refreshSpareParts:J,dashboardData:$};return e.jsx(Ja.Provider,{value:w,children:s})},Za=n.createContext(void 0),ws=()=>{const s=n.useContext(Za);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s},Vn=({children:s})=>{const[t,a]=n.useState(null),[l,i]=n.useState(null),[o,h]=n.useState(!0),[c,j]=n.useState(null);n.useEffect(()=>{const A=localStorage.getItem("authToken");A?(i(A),ie.setAuthToken(A),P(A)):h(!1)},[]);const P=async A=>{try{const u=await fetch(`${ie.getBaseUrl()}/auth/profile`,{headers:{Authorization:`Bearer ${A}`,"Content-Type":"application/json"}});if(u.ok){const $=await u.json();a($.user),i(A)}else localStorage.removeItem("authToken"),i(null),a(null)}catch(u){console.error("Token verification failed:",u),localStorage.removeItem("authToken"),i(null),a(null)}finally{h(!1)}},v=async(A,u)=>{try{h(!0),j(null);const $=await fetch(`${ie.getBaseUrl()}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:A,password:u})}),z=await $.json();return $.ok&&z.success?(a(z.user),i(z.token),localStorage.setItem("authToken",z.token),ie.setAuthToken(z.token),!0):(j(z.error||"Login failed"),!1)}catch($){return console.error("Login error:",$),j("Network error. Please try again."),!1}finally{h(!1)}},x=n.useCallback(()=>{a(null),i(null),j(null),localStorage.removeItem("authToken"),ie.clearAuthToken()},[]),S=async A=>{try{if(!l)return!1;const u=await fetch(`${ie.getBaseUrl()}/auth/profile`,{method:"PUT",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(A)}),$=await u.json();return u.ok&&$.success?(a(z=>z?{...z,profile:{...z.profile,...A}}:null),!0):(j($.error||"Profile update failed"),!1)}catch(u){return console.error("Profile update error:",u),j("Network error. Please try again."),!1}},E=async(A,u)=>{try{if(!l)return!1;const $=await fetch(`${ie.getBaseUrl()}/auth/change-password`,{method:"PUT",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify({currentPassword:A,newPassword:u})}),z=await $.json();return $.ok&&z.success?!0:(j(z.error||"Password change failed"),!1)}catch($){return console.error("Password change error:",$),j("Network error. Please try again."),!1}},V=n.useCallback(A=>t?t.permissions.includes(A):!1,[t]),_=(t==null?void 0:t.role)==="admin",b=(t==null?void 0:t.role)==="fse",y={user:t,token:l,isAuthenticated:!!t&&!!l,isLoading:o,error:c,login:v,logout:x,updateProfile:S,changePassword:E,hasPermission:V,isAdmin:_,isFSE:b};return e.jsx(Za.Provider,{value:y,children:s})},Un=ra("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function ge({className:s,variant:t,asChild:a=!1,...l}){const i=a?Fa:"span";return e.jsx(i,{"data-slot":"badge",className:Le(Un({variant:t}),s),...l})}function te({className:s,...t}){return e.jsx("div",{"data-slot":"card",className:Le("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border",s),...t})}function oe({className:s,...t}){return e.jsx("div",{"data-slot":"card-header",className:Le("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",s),...t})}function de({className:s,...t}){return e.jsx("h4",{"data-slot":"card-title",className:Le("leading-none",s),...t})}function Re({className:s,...t}){return e.jsx("p",{"data-slot":"card-description",className:Le("text-muted-foreground",s),...t})}function se({className:s,...t}){return e.jsx("div",{"data-slot":"card-content",className:Le("px-6 [&:last-child]:pb-6",s),...t})}const Ss=(s,t)=>{if(!s||s.length===0)return"";const a=t||Object.keys(s[0]);return[a.join(","),...s.map(i=>a.map(o=>{const h=i[o];return typeof h=="string"&&(h.includes(",")||h.includes('"'))?`"${h.replace(/"/g,'""')}"`:h||""}).join(","))].join(`
`)},Cs=(s,t)=>{const a=new Blob([s],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),i=URL.createObjectURL(a);l.setAttribute("href",i),l.setAttribute("download",t),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)},Bn=(s,t)=>{const a=new Blob([s],{type:"application/pdf"}),l=document.createElement("a"),i=URL.createObjectURL(a);l.setAttribute("href",i),l.setAttribute("download",t),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)},zn=async(s,t)=>`
    PDF Content for ${t}
    Generated on: ${new Date().toLocaleDateString()}
    Data: ${JSON.stringify(s,null,2)}
  `,Xa=(s,t)=>`
    ${t.toUpperCase()} LABEL
    ID: ${s.id||s.serialNumber||s.rmaNumber}
    Date: ${new Date().toLocaleDateString()}
    ${t==="part"?`Part: ${s.partName}`:`RMA: ${s.rmaNumber}`}
  `,Qa=s=>{const t=window.open("","_blank");t&&(t.document.write(`
      <html>
        <head>
          <title>Print Label</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            .label { border: 2px solid #000; padding: 10px; margin: 10px; }
          </style>
        </head>
        <body>
          <div class="label">
            <pre>${s}</pre>
          </div>
          <script>window.print(); window.close();<\/script>
        </body>
      </html>
    `),t.document.close())},_n=(s,t)=>{try{const a=window.open("","_blank","width=800,height=600,scrollbars=yes,resizable=yes");if(!a){const l=document.createElement("a");l.href="data:text/html;charset=utf-8,"+encodeURIComponent(`
        <html>
          <head>
            <title>${s}</title>
            <meta charset="utf-8" />
            <style>
              * { box-sizing: border-box; }
              body { 
                font-family: Arial, Helvetica, sans-serif; 
                margin: 0; 
                padding: 20px; 
                color: #000; 
                background: white;
                font-size: 12px;
                line-height: 1.4;
              }
              .page { 
                width: 210mm; 
                min-height: 297mm; 
                margin: 0 auto; 
                background: white;
                padding: 15mm;
                box-shadow: 0 0 10px rgba(0,0,0,0.1);
              }
              .header { 
                display: flex; 
                justify-content: space-between; 
                align-items: flex-start; 
                margin-bottom: 15px;
                border-bottom: 2px solid #0066cc;
                padding-bottom: 10px;
              }
              .company-logo {
                color: #0066cc;
                font-weight: bold;
                font-size: 24px;
                margin-bottom: 5px;
                text-align: center;
                width: 40px;
                height: 40px;
                line-height: 40px;
                border: 2px solid #0066cc;
                border-radius: 50%;
                display: inline-block;
              }
              .company-name {
                color: #0066cc;
                font-weight: bold;
                font-size: 16px;
                margin-bottom: 5px;
              }
              .company-info { 
                font-size: 10px; 
                line-height: 1.3;
                color: #333;
              }
              .website {
                text-decoration: underline;
                font-weight: bold;
                color: #0066cc;
              }
              .report-title { 
                font-size: 28px; 
                font-weight: bold;
                text-align: center;
                margin: 15px 0;
                color: #0066cc;
                font-family: 'Times New Roman', serif;
                letter-spacing: 2px;
              }
              .subtitle {
                font-size: 14px;
                text-align: center;
                margin-bottom: 20px;
                color: #333;
              }
              table { 
                width: 100%; 
                border-collapse: collapse; 
                margin-bottom: 15px;
                font-size: 11px;
              }
              th, td { 
                border: 1px solid #000; 
                padding: 6px 8px; 
                text-align: left;
                vertical-align: top;
              }
              th { 
                background: #f0f0f0; 
                font-weight: bold;
                text-align: center;
              }
              .section-title { 
                font-weight: bold; 
                margin: 15px 0 8px 0; 
                font-size: 13px;
                color: #0066cc;
                border-bottom: 1px  solid #0066cc;
                padding-bottom: 3px;
                text-transform: uppercase;
              }
              .grid { 
                display: grid; 
                grid-template-columns: 1fr 1fr; 
                gap: 20px;
                margin-bottom: 15px;
              }
              .info-box {
                border: 1px solid #ccc;
                padding: 10px;
                background: #f9f9f9;
              }
              .indent {
                margin-left: 15px;
                margin-bottom: 3px;
              }
              .small { font-size: 10px; }
              .right { text-align: right; }
              .center { text-align: center; }
              .muted { color: #666; }
              .bold { font-weight: bold; }
              .highlight { background: #fff3cd; }
              .status-ok { color: #28a745; font-weight: bold; }
              .status-replace { color: #dc3545; font-weight: bold; }
              .measurement { font-family: 'Courier New', monospace; }
              .main-table { margin-bottom: 20px; }
              .compact-table { margin-bottom: 15px; }
              .section-cell { 
                background: #f0f0f0; 
                font-weight: bold; 
                text-align: center;
                vertical-align: middle;
              }
              .status-footer {
                margin-top: 20px;
                padding: 15px;
                border: 1px solid #ccc;
                background: #f9f9f9;
              }
              .status-item {
                margin-bottom: 8px;
              }
              .note {
                margin-top: 15px;
                padding-top: 10px;
                border-top: 1px solid #ccc;
                font-style: italic;
              }
              .link {
                color: #0066cc;
                text-decoration: underline;
                cursor: pointer;
              }
              @media print {
                body { margin: 0; padding: 0; }
                .page { 
                  width: 210mm; 
                  height: 297mm; 
                  margin: 0; 
                  padding: 15mm;
                  box-shadow: none;
                }
              }
            </style>
          </head>
          <body>
            <div class="page">${t}</div>
            <script>window.print(); window.close();<\/script>
          </body>
        </html>
      `),l.download=`${s}.html`,l.click();return}a.document.write(`
      <html>
        <head>
          <title>${s}</title>
          <meta charset="utf-8" />
          <style>
            * { box-sizing: border-box; }
            body { 
              font-family: Arial, Helvetica, sans-serif; 
              margin: 0; 
              padding: 20px; 
              color: #000; 
              background: white;
              font-size: 12px;
              line-height: 1.4;
            }
            .page { 
              width: 210mm; 
              min-height: 297mm; 
              margin: 0 auto; 
              background: white;
              padding: 15mm;
              box-shadow: 0 0 10px rgba(0,0,0,0.1);
            }
            .header { 
              display: flex; 
              justify-content: space-between; 
              align-items: flex-start; 
              margin-bottom: 15px;
              border-bottom: 2px solid #0066cc;
              padding-bottom: 10px;
            }
            .company-logo {
              color: #0066cc;
              font-weight: bold;
              font-size: 24px;
              margin-bottom: 5px;
              text-align: center;
              width: 40px;
              height: 40px;
              line-height: 40px;
              border: 2px solid #0066cc;
              border-radius: 50%;
              display: inline-block;
            }
            .company-name {
              color: #0066cc;
              font-weight: bold;
              font-size: 16px;
              margin-bottom: 5px;
            }
            .company-info { 
              font-size: 10px; 
              line-height: 1.3;
              color: #333;
            }
            .website {
              text-decoration: underline;
              font-weight: bold;
              color: #0066cc;
            }
            .report-title { 
              font-size: 28px; 
              font-weight: bold;
              text-align: center;
              margin: 15px 0;
              color: #0066cc;
              font-family: 'Times New Roman', serif;
              letter-spacing: 2px;
            }
            .subtitle {
              font-size: 14px;
              text-align: center;
              margin-bottom: 20px;
              color: #333;
            }
            table { 
              width: 100%; 
              border-collapse: collapse; 
              margin-bottom: 15px;
              font-size: 11px;
            }
            th, td { 
              border: 1px solid #000; 
              padding: 6px 8px; 
              text-align: left;
              vertical-align: top;
            }
            th { 
              background: #f0f0f0; 
              font-weight: bold;
              text-align: center;
            }
            .section-title { 
              font-weight: bold; 
              margin: 15px 0 8px 0; 
              font-size: 13px;
              color: #0066cc;
              border-bottom: 1px solid #0066cc;
              padding-bottom: 3px;
              text-transform: uppercase;
            }
            .grid { 
              display: grid; 
              grid-template-columns: 1fr 1fr; 
              gap: 20px;
              margin-bottom: 15px;
            }
            .info-box {
              border: 1px solid #ccc;
              padding: 10px;
              background: #f9f9f9;
            }
            .indent {
              margin-left: 15px;
              margin-bottom: 3px;
            }
            .small { font-size: 10px; }
            .right { text-align: right; }
            .center { text-align: center; }
            .muted { color: #666; }
            .bold { font-weight: bold; }
            .highlight { background: #fff3cd; }
            .status-ok { color: #28a745; font-weight: bold; }
            .status-replace { color: #dc3545; font-weight: bold; }
            .measurement { font-family: 'Courier New', monospace; }
            .main-table { margin-bottom: 20px; }
            .compact-table { margin-bottom: 15px; }
            .section-cell { 
              background: #f0f0f0; 
              font-weight: bold; 
              text-align: center;
              vertical-align: middle;
            }
            .status-footer {
              margin-top: 20px;
              padding: 15px;
              border: 1px solid #ccc;
              background: #f9f9f9;
            }
            .status-item {
              margin-bottom: 8px;
            }
            .note {
              margin-top: 15px;
              padding-top: 10px;
              border-top: 1px solid #ccc;
              font-style: italic;
            }
            .link {
              color: #0066cc;
              text-decoration: underline;
              cursor: pointer;
            }
            @media print {
              body { margin: 0; padding: 0; }
              .page { 
                width: 210mm; 
                height: 297mm; 
                margin: 0; 
                padding: 15mm;
                box-shadow: none;
              }
            }
          </style>
        </head>
        <body>
          <div class="page">${t}</div>
          <script>window.print(); window.close();<\/script>
        </body>
      </html>
    `),a.document.close()}catch(a){console.error("Error in printHtml:",a);const l=new Blob([`
      <html>
        <head>
          <title>${s}</title>
          <meta charset="utf-8" />
        </head>
        <body>
          ${t}
        </body>
      </html>
    `],{type:"text/html"}),i=URL.createObjectURL(l),o=document.createElement("a");o.href=i,o.download=`${s}.html`,o.click(),URL.revokeObjectURL(i)}},lt=s=>{if(console.log("exportServiceReportToPDF called with report:",s),!s){console.error("exportServiceReportToPDF: Report is undefined or null"),alert("Error: No report data available for PDF generation");return}if(typeof s!="object"){console.error("exportServiceReportToPDF: Report is not an object:",s),alert("Error: Invalid report data format");return}console.log("Report structure:",{hasEngineer:!!s.engineer,engineerKeys:s.engineer?Object.keys(s.engineer):"No engineer object",hasSiteIncharge:!!s.siteIncharge,siteInchargeKeys:s.siteIncharge?Object.keys(s.siteIncharge):"No siteIncharge object",hasSections:!!s.sections,sectionsKeys:s.sections?Object.keys(s.sections):"No sections object",reportKeys:Object.keys(s)});const t=(x,S="-")=>x==null||x===""?S:String(x),a=x=>{try{return new Date(x||Date.now()).toLocaleDateString()}catch{return t(x)}},l=(x,S,E="-")=>{try{let V=x;for(const _ of S){if(V==null||typeof V!="object")return E;V=V[_]}return V??E}catch{return E}},i=x=>{try{return console.log("Getting engineer name from report:",{engineer:x.engineer,engineerName:x.engineerName,technician:x.technician,technicianName:x.technicianName,fse:x.fse,fseName:x.fseName}),l(x,["engineer","name"])||l(x,["engineerName"])||l(x,["technician","name"])||l(x,["technicianName"])||l(x,["fse","name"])||l(x,["fseName"])||"Engineer Name Not Available"}catch(S){return console.error("Error getting engineer name:",S),"Engineer Name Not Available"}},o=x=>{try{return console.log("Getting site incharge name from report:",{siteIncharge:x.siteIncharge,siteInchargeName:x.siteInchargeName,contactPerson:x.contactPerson,contactName:x.contactName}),l(x,["siteIncharge","name"])||l(x,["siteInchargeName"])||l(x,["contactPerson","name"])||l(x,["contactName"])||"Site Contact Not Available"}catch(S){return console.error("Error getting site incharge name:",S),"Site Contact Not Available"}},h=x=>{try{return l(x,["siteIncharge","phone"])||l(x,["siteInchargePhone"])||l(x,["contactPerson","phone"])||l(x,["contactPhone"])||"Phone Not Available"}catch(S){return console.error("Error getting site incharge phone:",S),"Phone Not Available"}};console.log("Generated helper values:",{engineerName:i(s),siteInchargeName:o(s),siteInchargePhone:h(s)});const c=(l(s,["measuredColorCoordinates"])||[]).map(x=>`
    <tr>
      <td>${t(x==null?void 0:x.testPattern)}</td>
      <td class="right">${t(x==null?void 0:x.fl)}</td>
      <td class="right">${t(x==null?void 0:x.x)}</td>
      <td class="right">${t(x==null?void 0:x.y)}</td>
    </tr>
  `).join(""),j=(l(s,["cieColorAccuracy"])||[]).map(x=>`
    <tr>
      <td>${t(x==null?void 0:x.testPattern)}</td>
      <td class="right">${t(x==null?void 0:x.x)}</td>
      <td class="right">${t(x==null?void 0:x.y)}</td>
      <td class="right">${t(x==null?void 0:x.fl)}</td>
    </tr>
  `).join(""),P=(l(s,["observations"])||[]).map(x=>`<tr><td class="small center">${t(x==null?void 0:x.number)}</td><td>${t(x==null?void 0:x.description)}</td></tr>`).join("");console.log("Generated HTML components:",{mcgd:c,cie:j,observations:P});const v=`
    <div class="header">
      <div class="company-info">
        <div class="company-logo">A</div>
        <div class="company-name">ASCOMP INC.</div>
        <div>9, Community Centre, 2nd Floor, Phase I, Mayapuri, New Delhi, 110064</div>
        <div>Desk: 011-45501226</div>
        <div>Mobile: 8882475207</div>
        <div class="website">WWW.ASCOMPINC.IN</div>
        <div>Email: helpdesk@ascompinc.in</div>
      </div>
      <div class="right small">
        <div><strong>Report:</strong> ${t(l(s,["reportNumber"]))}</div>
        <div><strong>Type:</strong> ${t(l(s,["reportType"]))}</div>
        <div><strong>Date:</strong> ${a(l(s,["date"]))}</div>
      </div>
    </div>
    
    <div class="report-title">CHRISTIE</div>
    <div class="subtitle">Projector Service Report - ${t(l(s,["reportType"]))} done on Date - ${a(l(s,["date"]))}</div>
    
    <div class="grid">
      <div class="info-box">
        <div><strong>Site:</strong> ${t(l(s,["siteName"]))}</div>
        <div><strong>Personnel:</strong></div>
        <div class="indent">Site In-charge: Mr. ${o(s)} - ${h(s)}</div>
        <div class="indent">Ascomp Engineer: ${i(s)}</div>
      </div>
      <div class="info-box">
        <div><strong>Projector Information:</strong></div>
        <div class="indent">Model: ${t(l(s,["projectorModel"]))}</div>
        <div class="indent">Serial Number: ${t(l(s,["projectorSerial"]))}</div>
        <div class="indent">Software Version: ${t(l(s,["softwareVersion"]))}</div>
        <div class="indent">Projector running hours: ${t(l(s,["projectorRunningHours"]))}</div>
        <div><strong>Lamp Information:</strong></div>
        <div class="indent">Lamp Model: ${t(l(s,["lampModel"]))}</div>
        <div class="indent">Lamp running hours: ${t(l(s,["lampRunningHours"]))}</div>
        <div class="indent">Current Lamp Hours: ${t(l(s,["currentLampHours"]))}</div>
        <div class="indent">Replacement Required: ${l(s,["replacementRequired"])?"Yes":"No"}</div>
      </div>
    </div>

    <div class="section-title">SECTIONS</div>
    <table class="main-table">
      <thead>
        <tr>
          <th>SECTIONS</th>
          <th>DESCRIPTION</th>
          <th>STATUS</th>
          <th class="center">YES/NO - OK</th>
        </tr>
      </thead>
      <tbody>
        ${(l(s,["sections","opticals"])||[]).map((x,S)=>`
          <tr>
            ${S===0?`<td rowspan="${(l(s,["sections","opticals"])||[]).length}" class="section-cell">OPTICALS</td>`:""}
            <td>${t(x==null?void 0:x.description)}</td>
            <td>${t(x==null?void 0:x.status)}</td>
            <td class="center status-ok">OK</td>
          </tr>
        `).join("")}
        ${(l(s,["sections","electronics"])||[]).map((x,S)=>`
          <tr>
            ${S===0?`<td rowspan="${(l(s,["sections","electronics"])||[]).length}" class="section-cell">ELECTRONICS</td>`:""}
            <td>${t(x==null?void 0:x.description)}</td>
            <td>${t(x==null?void 0:x.status)}</td>
            <td class="center status-ok">OK</td>
          </tr>
        `).join("")}
        ${l(s,["sections","serialNumberVerified"])?`
          <tr>
            <td class="section-cell">Serial Number verified</td>
            <td>${t(l(s,["sections","serialNumberVerified","description"]))}</td>
            <td>${t(l(s,["sections","serialNumberVerified","status"]))}</td>
            <td class="center status-ok">OK</td>
          </tr>
        `:""}
        ${(l(s,["sections","disposableConsumables"])||[]).map(x=>`
          <tr>
            <td class="section-cell">Disposable Consumables</td>
            <td>${t(x==null?void 0:x.description)}</td>
            <td>${t(x==null?void 0:x.status)}</td>
            <td class="center status-ok">OK</td>
          </tr>
        `).join("")}
        ${l(s,["sections","coolant"])?`
          <tr>
            <td class="section-cell">Coolant</td>
            <td>${t(l(s,["sections","coolant","description"]))}</td>
            <td>${t(l(s,["sections","coolant","status"]))}</td>
            <td class="center status-ok">OK</td>
          </tr>
        `:""}
        ${(l(s,["sections","lightEngineTestPatterns"])||[]).map((x,S)=>`
          <tr>
            ${S===0?`<td rowspan="${(l(s,["sections","lightEngineTestPatterns"])||[]).length}" class="section-cell">Light Engine Test Pattern</td>`:""}
            <td>${t(x==null?void 0:x.description)}</td>
            <td>${t(x==null?void 0:x.status)}</td>
            <td class="center status-ok">OK</td>
          </tr>
        `).join("")}
        ${(l(s,["sections","mechanical"])||[]).map((x,S)=>`
          <tr>
            ${S===0?`<td rowspan="${(l(s,["sections","mechanical"])||[]).length}" class="section-cell">MECHANICAL</td>`:""}
            <td>${t(x==null?void 0:x.description)}</td>
            <td>${t(x==null?void 0:x.status)}</td>
            <td class="center status-ok">OK</td>
          </tr>
        `).join("")}
      </tbody>
    </table>

    <div class="grid">
      <div>
        <div class="section-title">Voltage parameters</div>
        <table class="compact-table">
          <tbody>
            <tr><td>P vs N</td><td class="right measurement">${t(l(s,["voltageParameters","pVsN"]))}</td></tr>
            <tr><td>P vs E</td><td class="right measurement">${t(l(s,["voltageParameters","pVsE"]))}</td></tr>
            <tr><td>N vs E</td><td class="right measurement">${t(l(s,["voltageParameters","nVsE"]))}</td></tr>
          </tbody>
        </table>
        
        <div class="section-title">Content Playing Server</div>
        <table class="compact-table"><tbody><tr><td>${t(l(s,["contentPlayingServer"]))}</td></tr></tbody></table>
        
        <div class="section-title">fL on 100% lamp power before and after</div>
        <table class="compact-table">
          <tbody>
            <tr><td>Before</td><td class="right measurement">${t(l(s,["lampPowerMeasurements","flBeforePM"]))}</td></tr>
            <tr><td>After</td><td class="right measurement">${t(l(s,["lampPowerMeasurements","flAfterPM"]))}</td></tr>
          </tbody>
        </table>
        
        <div class="section-title">Projector placement, room, environment</div>
        <table class="compact-table"><tbody><tr><td>${t(l(s,["environmentStatus","projectorPlacement"]),"ok")}</td></tr></tbody></table>
        
        <div class="section-title">Observations and Remarks</div>
        <table class="compact-table">
          <thead><tr><th class="small">#</th><th>Observation</th></tr></thead>
          <tbody>${P}</tbody>
        </table>
      </div>
      
      <div>
        <div class="section-title">Image Evaluation</div>
        <table class="compact-table">
          <thead><tr><th>Image Evaluation</th><th class="center">OK - Yes/No</th></tr></thead>
          <tbody>
            <tr><td>Focus/boresight</td><td class="center">${t(l(s,["imageEvaluation","focusBoresight"]),"Yes")}</td></tr>
            <tr><td>Integrator Position</td><td class="center">${t(l(s,["imageEvaluation","integratorPosition"]),"Yes")}</td></tr>
            <tr><td>Any Spot on the Screen after PPM</td><td class="center">${t(l(s,["imageEvaluation","spotOnScreen"]),"No")}</td></tr>
            <tr><td>Check Screen Cropping - FLAT and SCOPE</td><td class="center">${t(l(s,["imageEvaluation","screenCropping"]),"Yes")}</td></tr>
            <tr><td>Convergence Checked</td><td class="center">${t(l(s,["imageEvaluation","convergenceChecked"]),"Yes")}</td></tr>
            <tr><td>Channels Checked - Scope, Flat, Alternative</td><td class="center">${t(l(s,["imageEvaluation","channelsChecked"]),"Yes")}</td></tr>
            <tr><td>Pixel defects</td><td class="center">${t(l(s,["imageEvaluation","pixelDefects"]),"No")}</td></tr>
            <tr><td>Excessive image vibration</td><td class="center">${t(l(s,["imageEvaluation","imageVibration"]),"No")}</td></tr>
            <tr><td>LiteLOC</td><td class="center">${t(l(s,["imageEvaluation","liteLoc"]),"No")}</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="grid">
      <div>
        <div class="section-title">Recommended Parts to Change</div>
        <table class="compact-table">
          <thead><tr><th class="small">S. No.</th><th>Part Name</th><th>Part Number</th><th class="small">Qty</th><th>Notes</th></tr></thead>
          <tbody>
            ${(l(s,["sections","recommendedParts"])||new Array(6).fill({})).slice(0,6).map((x,S)=>`<tr><td class="small center">${S+1}</td><td>${t(x==null?void 0:x.partName)}</td><td>${t(x==null?void 0:x.partNumber)}</td><td class="small center">${t(x==null?void 0:x.quantity,"1")}</td><td>${t(x==null?void 0:x.notes)}</td></tr>`).join("")}
          </tbody>
        </table>
      </div>
      
      <div>
        <div class="section-title">Measured color coordinates (MCGD)</div>
        <table class="compact-table">
          <thead><tr><th>Test Pattern</th><th class="right">fL</th><th class="right">x</th><th class="right">y</th></tr></thead>
          <tbody>${c}</tbody>
        </table>

        <div class="section-title">CIE XYZ Color Accuracy</div>
        <table class="compact-table">
          <thead><tr><th>Test Pattern</th><th class="right">x</th><th class="right">y</th><th class="right">fL</th></tr></thead>
          <tbody>${j}</tbody>
        </table>

        <div class="section-title">Screen Information in metres</div>
        <table class="compact-table">
          <thead><tr><th></th><th>Height</th><th>Width</th><th>Gain</th></tr></thead>
          <tbody>
            <tr><td>SCOPE</td><td class="right">${t(l(s,["screenInfo","scope","height"]))}</td><td class="right">${t(l(s,["screenInfo","scope","width"]))}</td><td class="right">${t(l(s,["screenInfo","scope","gain"]))}</td></tr>
            <tr><td>FLAT</td><td class="right">${t(l(s,["screenInfo","flat","height"]))}</td><td class="right">${t(l(s,["screenInfo","flat","width"]))}</td><td class="right">${t(l(s,["screenInfo","flat","gain"]))}</td></tr>
            <tr><td>Screen Make</td><td colspan="2">${t(l(s,["screenInfo","screenMake"]))}</td><td class="right">Throw Distance ${t(l(s,["screenInfo","throwDistance"]))}</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="section-title">Air Pollution Level</div>
    <table class="compact-table">
      <thead>
        <tr>
          <th>Air Pollution Level</th>
          <th>HCHO</th>
          <th>TVOC</th>
          <th>PM 1.0</th>
          <th>PM 2.5</th>
          <th>PM 10</th>
          <th>Temperature C</th>
          <th>Humidity %</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="right">${t(l(s,["airPollutionLevel","overall"]))}</td>
          <td class="right">${t(l(s,["airPollutionLevel","hcho"]))}</td>
          <td class="right">${t(l(s,["airPollutionLevel","tvoc"]))}</td>
          <td class="right">${t(l(s,["airPollutionLevel","pm1"]))}</td>
          <td class="right">${t(l(s,["airPollutionLevel","pm25"]))}</td>
          <td class="right">${t(l(s,["airPollutionLevel","pm10"]))}</td>
          <td class="right">${t(l(s,["environmentalConditions","temperature"]))}</td>
          <td class="right">${t(l(s,["airPollutionLevel","humidity"]))}</td>
        </tr>
      </tbody>
    </table>

    <div class="status-footer">
      <div class="status-item">
        <strong>LE Status During PM:</strong> ${t(l(s,["systemStatus","leStatus"]))}
      </div>
      <div class="status-item">
        <strong>AC Status:</strong> ${t(l(s,["systemStatus","acStatus"]))}
      </div>
      <div class="status-item">
        <strong>Review Photos:</strong> <span class="link">Click Here.</span>
      </div>
      <div class="note">
        <strong>Note:</strong> The ODD file number is BEFORE and EVEN file number is AFTER, PM
      </div>
    </div>
  `;console.log("Generated HTML body length:",v.length);try{_n("Service Report",v),console.log("PDF generation completed successfully")}catch(x){console.error("Error generating PDF:",x),alert("Error generating PDF. Please try again or contact support.")}};function ft({size:s="md",text:t,className:a=""}){const l={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"};return e.jsxs("div",{className:`flex flex-col items-center justify-center ${a}`,children:[e.jsx(Ie,{className:`${l[s]} text-dark-primary animate-spin`}),t&&e.jsx("p",{className:"mt-2 text-sm text-dark-secondary animate-pulse",children:t})]})}function Ra(){const{dashboardData:s,isLoading:t,error:a,refreshData:l,sites:i,projectors:o,services:h,serviceVisits:c,purchaseOrders:j}=Us(),[P,v]=n.useState(null),[x,S]=n.useState([]);n.useEffect(()=>{E()},[]);const E=async()=>{try{const[y,A]=await Promise.all([ie.getAMCDashboardStats(),ie.getAllAMCContracts()]);v(y),S(A)}catch(y){console.error("Error loading AMC data:",y)}},V=y=>{const A=new Date,u=[];for(let $=-3;$<3;$++){const z=new Date(A.getFullYear(),A.getMonth()+$,1),re=z.toLocaleDateString("en-US",{month:"short"}),K=y.filter(O=>{const R=new Date(O.scheduledDate);return R.getMonth()===z.getMonth()&&R.getFullYear()===z.getFullYear()}),ne=K.filter(O=>O.status==="Scheduled").length,Y=K.filter(O=>O.status==="Completed").length;console.log(`Month ${re}: ${K.length} visits (${ne} scheduled, ${Y} completed)`),u.push({month:re,scheduled:ne,completed:Y})}return u},_=y=>{const A=new Date,u={active:0,expiring:0,expired:0};return y.forEach($=>{const z=new Date($.warrantyEnd),re=Math.ceil((z.getTime()-A.getTime())/(1e3*60*60*24));z>A?re<=30?u.expiring++:u.active++:u.expired++}),[{name:"Active (> 6 months)",value:u.active,color:"#10B981"},{name:"Expiring Soon (≤ 30 days)",value:u.expiring,color:"#F59E0B"},{name:"Expired",value:u.expired,color:"#EF4444"}]},b=y=>{switch(y){case"Completed":return"text-green-400";case"Scheduled":return"text-blue-400";case"Pending":return"text-yellow-400";case"Cancelled":return"text-red-400";default:return"text-gray-400"}},N=n.useMemo(()=>{const y=new Date;console.log("Service visits data:",c);const A=V(c);console.log("Generated service trends:",A);const u=_(o),$=j.filter(re=>new Date(re.createdAt)>=y).slice(0,4).map(re=>{var K;return{id:re.purchaseOrderId,site:re.siteName,projectors:re.projectorCount||0,status:re.status,amount:`$${((K=re.totalAmount)==null?void 0:K.toFixed(2))||"0.00"}`,date:new Date(re.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric"})}});console.log("Computing recent services from",c.length,"service visits");const z=c.filter(re=>!re.scheduledDate&&!re.actualDate?(console.log("Visit without date:",re),!1):!0).sort((re,K)=>{const ne=new Date(re.scheduledDate||re.actualDate);return new Date(K.scheduledDate||K.actualDate).getTime()-ne.getTime()}).slice(0,4).map(re=>{const K=new Date(re.scheduledDate||re.actualDate);return console.log("Processing visit:",{id:re.visitId||re._id,site:re.siteName,date:K.toISOString(),status:re.status}),{id:re.visitId||re._id,site:re.siteName||"Unknown Site",projector:re.projectorSerial||"Unknown Projector",type:re.visitType||"Service Visit",status:re.status||"Unknown",technician:re.fseName||"Unknown FSE",date:K.toLocaleDateString("en-US",{month:"short",day:"numeric"})}});return console.log("Final recent services:",z),{serviceTrends:A,warrantyStatus:u,recentPOs:$,recentServices:z}},[h,o,j,c]);return t?e.jsx(ft,{size:"lg",text:"Loading dashboard data..."}):a?e.jsxs("div",{className:"text-center py-10 text-dark-secondary",children:[e.jsx(Te,{className:"w-10 h-10 mb-4 text-red-400"}),e.jsx("p",{children:a}),e.jsxs(q,{onClick:l,className:"dark-button-primary mt-4",children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Retry"]})]}):e.jsx(e.Fragment,{children:e.jsxs("main",{className:"flex-1 p-8 bg-dark-bg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-dark-primary",children:"Dashboard"}),e.jsx("p",{className:"text-dark-secondary",children:"Monitor your projector warranty services and operations"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(q,{onClick:l,disabled:t,className:"dark-button-secondary gap-2",children:[t?e.jsx(Ie,{className:"w-4 h-4 animate-spin"}):e.jsx(Qe,{className:"w-4 h-4"}),"Refresh Data"]}),e.jsxs(q,{onClick:()=>{var u;const y=[{metric:"Total Sites",value:s.sites},{metric:"Total Projectors",value:s.projectors},{metric:"Pending POs",value:s.pendingPOs},{metric:"Services This Week",value:s.servicesThisWeek}],A=Ss(y);Cs(A,`dashboard_report_${new Date().toISOString().split("T")[0]}.csv`),(u=window.showToast)==null||u.call(window,{type:"success",title:"Export Successful",message:"Dashboard report exported to CSV file"})},className:"dark-button-secondary gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),"Export Report"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10",children:[e.jsxs("div",{className:"dark-card hover:dark-shadow-lg transition-all duration-300 hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-dark-tag flex items-center justify-center",children:e.jsx(ds,{className:"w-7 h-7 text-blue-400"})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ns,{className:"w-4 h-4 text-dark-positive"}),e.jsx("span",{className:"text-sm font-bold text-dark-positive",children:s.sites})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-4xl font-bold text-dark-primary mb-2",children:"Active Sites"}),e.jsx("p",{className:"text-sm font-medium text-dark-secondary",children:"Total active sites"})]})]}),e.jsxs("div",{className:"dark-card hover:dark-shadow-lg transition-all duration-300 hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-dark-tag flex items-center justify-center",children:e.jsx(ss,{className:"w-7 h-7 text-green-400"})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ns,{className:"w-4 h-4 text-dark-positive"}),e.jsx("span",{className:"text-sm font-bold text-dark-positive",children:s.projectors})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-4xl font-bold text-dark-primary mb-2",children:"Total Projectors"}),e.jsx("p",{className:"text-sm font-medium text-dark-secondary",children:"Total projectors in inventory"})]})]}),e.jsxs("div",{className:"dark-card hover:dark-shadow-lg transition-all duration-300 hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-dark-tag flex items-center justify-center",children:e.jsx(Oe,{className:"w-7 h-7 text-orange-400"})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ns,{className:"w-4 h-4 text-dark-positive"}),e.jsx("span",{className:"text-sm font-bold text-dark-positive",children:s.pendingPOs})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-4xl font-bold text-dark-primary mb-2",children:"Pending POs"}),e.jsx("p",{className:"text-sm font-medium text-dark-secondary",children:"Total pending purchase orders"})]})]}),e.jsxs("div",{className:"dark-card hover:dark-shadow-lg transition-all duration-300 hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-dark-tag flex items-center justify-center",children:e.jsx(Ye,{className:"w-7 h-7 text-purple-400"})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ns,{className:"w-4 h-4 text-dark-positive"}),e.jsx("span",{className:"text-sm font-bold text-dark-positive",children:s.servicesThisWeek})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-4xl font-bold text-dark-primary mb-2",children:"Services This Week"}),e.jsx("p",{className:"text-sm font-medium text-dark-secondary",children:"Services scheduled for this week"})]})]})]}),P&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10",children:[e.jsxs("div",{className:"dark-card hover:dark-shadow-lg transition-all duration-300 hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-dark-tag flex items-center justify-center",children:e.jsx(Oe,{className:"w-7 h-7 text-blue-600"})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ns,{className:"w-4 h-4 text-dark-positive"}),e.jsx("span",{className:"text-sm font-bold text-dark-positive",children:P.totalContracts})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-4xl font-bold text-dark-primary mb-2",children:"AMC Contracts"}),e.jsx("p",{className:"text-sm font-medium text-dark-secondary",children:"Total maintenance contracts"})]})]}),e.jsxs("div",{className:"dark-card hover:dark-shadow-lg transition-all duration-300 hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-dark-tag flex items-center justify-center",children:e.jsx(Be,{className:"w-7 h-7 text-green-600"})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ns,{className:"w-4 h-4 text-dark-positive"}),e.jsx("span",{className:"text-sm font-bold text-dark-positive",children:P.activeContracts})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-4xl font-bold text-dark-primary mb-2",children:"Active Contracts"}),e.jsx("p",{className:"text-sm font-medium text-dark-secondary",children:"Currently active contracts"})]})]}),e.jsxs("div",{className:"dark-card hover:dark-shadow-lg transition-all duration-300 hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-dark-tag flex items-center justify-center",children:e.jsx(Ye,{className:"w-7 h-7 text-blue-600"})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ns,{className:"w-4 h-4 text-dark-positive"}),e.jsx("span",{className:"text-sm font-bold text-dark-positive",children:P.upcomingServices})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-4xl font-bold text-dark-primary mb-2",children:"Upcoming Services"}),e.jsx("p",{className:"text-sm font-medium text-dark-secondary",children:"Services due in next 30 days"})]})]}),e.jsxs("div",{className:"dark-card hover:dark-shadow-lg transition-all duration-300 hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-dark-tag flex items-center justify-center",children:e.jsx(ns,{className:"w-7 h-7 text-green-600"})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ns,{className:"w-4 h-4 text-dark-positive"}),e.jsxs("span",{className:"text-sm font-bold text-dark-positive",children:["$",(P.revenue.totalValue/1e3).toFixed(1),"k"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-4xl font-bold text-dark-primary mb-2",children:"Contract Value"}),e.jsx("p",{className:"text-sm font-medium text-dark-secondary",children:"Total contract value"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10",children:[e.jsxs("div",{className:"dark-card",children:[e.jsxs(oe,{children:[e.jsx(de,{className:"text-dark-primary",children:"Service Trends"}),e.jsx(Re,{className:"text-dark-secondary",children:"Monthly service completion vs scheduled"})]}),e.jsx(se,{children:N.serviceTrends.length>0?e.jsx(Ls,{width:"100%",height:300,children:e.jsxs(Yt,{data:N.serviceTrends,children:[e.jsx(nt,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(it,{dataKey:"month",stroke:"#9CA3AF"}),e.jsx(ct,{stroke:"#9CA3AF"}),e.jsx(Os,{contentStyle:{backgroundColor:"#1F2937",border:"1px solid #374151",borderRadius:"8px",color:"#F9FAFB"}}),e.jsx(Js,{dataKey:"scheduled",fill:"#3B82F6",name:"Scheduled"}),e.jsx(Js,{dataKey:"completed",fill:"#10B981",name:"Completed"})]})}):e.jsx("div",{className:"flex items-center justify-center h-64 text-dark-secondary",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ye,{className:"w-12 h-12 mb-4 text-dark-secondary"}),e.jsx("p",{className:"text-sm",children:"No service data available. Service trends will appear here when services are created."})]})})})]}),e.jsxs("div",{className:"dark-card",children:[e.jsxs(oe,{children:[e.jsx(de,{className:"text-dark-primary",children:"Warranty Status"}),e.jsx(Re,{className:"text-dark-secondary",children:"Current warranty distribution"})]}),e.jsx(se,{children:N.warrantyStatus.some(y=>y.value>0)?e.jsx(Ls,{width:"100%",height:300,children:e.jsxs(Jt,{children:[e.jsx(Zt,{data:N.warrantyStatus,cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",label:({name:y,value:A})=>`${y}: ${A}`,children:N.warrantyStatus.map((y,A)=>e.jsx(Xt,{fill:y.color},`cell-${A}`))}),e.jsx(Os,{contentStyle:{backgroundColor:"#1F2937",border:"1px solid #374151",borderRadius:"8px",color:"#F9FAFB"}})]})}):e.jsx("div",{className:"flex items-center justify-center h-64 text-dark-secondary",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Te,{className:"w-12 h-12 mb-4 text-dark-secondary"}),e.jsx("p",{className:"text-sm",children:"Warranty status will appear here when projectors are added"})]})})})]})]}),P&&(P.overdueServices>0||P.expiringSoon>0)&&e.jsx("div",{className:"mb-10",children:e.jsxs("div",{className:"dark-card",children:[e.jsxs(oe,{children:[e.jsxs(de,{className:"text-dark-primary flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5 text-orange-500"}),"AMC Alerts"]}),e.jsx(Re,{className:"text-dark-secondary",children:"Contracts requiring immediate attention"})]}),e.jsx(se,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[P.overdueServices>0&&e.jsxs("div",{className:"p-4 bg-red-900/20 border border-red-500/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-500/20 rounded-lg flex items-center justify-center",children:e.jsx(Te,{className:"w-5 h-5 text-red-500"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-red-400",children:"Overdue Services"}),e.jsxs("p",{className:"text-sm text-red-300",children:[P.overdueServices," services overdue"]})]})]}),e.jsx("p",{className:"text-sm text-red-300",children:"Services scheduled in the past that haven't been completed. These require immediate attention to maintain contract compliance."})]}),P.expiringSoon>0&&e.jsxs("div",{className:"p-4 bg-orange-900/20 border border-orange-500/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-500/20 rounded-lg flex items-center justify-center",children:e.jsx(ts,{className:"w-5 h-5 text-orange-500"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-orange-400",children:"Expiring Soon"}),e.jsxs("p",{className:"text-sm text-orange-300",children:[P.expiringSoon," contracts expiring in 30 days"]})]})]}),e.jsx("p",{className:"text-sm text-orange-300",children:"Contracts expiring soon. Consider renewal discussions with customers."})]})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"dark-card",children:[e.jsxs(oe,{children:[e.jsx(de,{className:"text-dark-primary",children:"Recent Purchase Orders"}),e.jsx(Re,{className:"text-dark-secondary",children:"Latest purchase order activities"})]}),e.jsx(se,{children:N.recentPOs.length>0?e.jsx("div",{className:"space-y-4",children:N.recentPOs.map(y=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-dark-card-secondary rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-dark-tag rounded-lg flex items-center justify-center",children:e.jsx(Oe,{className:"w-5 h-5 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-dark-primary font-medium",children:y.site}),e.jsxs("p",{className:"text-dark-secondary text-sm",children:[y.projectors," projectors • ",y.date]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-dark-primary font-medium",children:y.amount}),e.jsx(ge,{className:`${b(y.status)} bg-opacity-20`,children:y.status})]})]},y.id))}):e.jsxs("div",{className:"text-center py-8 text-dark-secondary",children:[e.jsx(Oe,{className:"w-12 h-12 mb-4 text-dark-secondary"}),e.jsx("p",{className:"text-sm",children:"No recent purchase orders"})]})})]}),e.jsxs("div",{className:"dark-card",children:[e.jsxs(oe,{children:[e.jsx(de,{className:"text-dark-primary",children:"Recent Services"}),e.jsx(Re,{className:"text-dark-secondary",children:"Latest service activities"})]}),e.jsx(se,{children:N.recentServices.length>0?e.jsx("div",{className:"space-y-4",children:N.recentServices.map(y=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-dark-card-secondary rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-dark-tag rounded-lg flex items-center justify-center",children:e.jsx(rs,{className:"w-5 h-5 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-dark-primary font-medium",children:y.site}),e.jsxs("p",{className:"text-dark-secondary text-sm",children:[y.projector," • ",y.date]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-dark-primary font-medium",children:y.type}),e.jsx(ge,{className:`${b(y.status)} bg-opacity-20`,children:y.status})]})]},y.id))}):e.jsxs("div",{className:"text-center py-8 text-dark-secondary",children:[e.jsx(rs,{className:"w-12 h-12 mb-4 text-dark-secondary"}),e.jsx("p",{className:"text-sm",children:"No recent services"})]})})]})]})]})})}function k({className:s,type:t,...a}){return e.jsx("input",{type:t,"data-slot":"input",className:Le("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...a})}function Ea(s,[t,a]){return Math.min(a,Math.max(t,s))}function er(s){const t=n.useRef({value:s,previous:s});return n.useMemo(()=>(t.current.value!==s&&(t.current.previous=t.current.value,t.current.value=s),t.current.previous),[s])}var sr=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Hn="VisuallyHidden",Kn=n.forwardRef((s,t)=>e.jsx(qe.span,{...s,ref:t,style:{...sr,...s.style}}));Kn.displayName=Hn;var Wn=[" ","Enter","ArrowUp","ArrowDown"],qn=[" ","Enter"],_s="Select",[yt,Nt,Gn]=Yr(_s),[Xs,Fc]=Kt(_s,[Gn,La]),kt=La(),[Yn,Bs]=Xs(_s),[Jn,Zn]=Xs(_s),tr=s=>{const{__scopeSelect:t,children:a,open:l,defaultOpen:i,onOpenChange:o,value:h,defaultValue:c,onValueChange:j,dir:P,name:v,autoComplete:x,disabled:S,required:E,form:V}=s,_=kt(t),[b,N]=n.useState(null),[y,A]=n.useState(null),[u,$]=n.useState(!1),z=ll(P),[re,K]=At({prop:l,defaultProp:i??!1,onChange:o,caller:_s}),[ne,Y]=At({prop:h,defaultProp:c,onChange:j,caller:_s}),O=n.useRef(null),R=b?V||!!b.closest("form"):!0,[F,J]=n.useState(new Set),T=Array.from(F).map(w=>w.props.value).join(";");return e.jsx(nl,{..._,children:e.jsxs(Yn,{required:E,scope:t,trigger:b,onTriggerChange:N,valueNode:y,onValueNodeChange:A,valueNodeHasChildren:u,onValueNodeHasChildrenChange:$,contentId:Wt(),value:ne,onValueChange:Y,open:re,onOpenChange:K,dir:z,triggerPointerDownPosRef:O,disabled:S,children:[e.jsx(yt.Provider,{scope:t,children:e.jsx(Jn,{scope:s.__scopeSelect,onNativeOptionAdd:n.useCallback(w=>{J(g=>new Set(g).add(w))},[]),onNativeOptionRemove:n.useCallback(w=>{J(g=>{const p=new Set(g);return p.delete(w),p})},[]),children:a})}),R?e.jsxs(wr,{"aria-hidden":!0,required:E,tabIndex:-1,name:v,autoComplete:x,value:ne,onChange:w=>Y(w.target.value),disabled:S,form:V,children:[ne===void 0?e.jsx("option",{value:""}):null,Array.from(F)]},T):null]})})};tr.displayName=_s;var ar="SelectTrigger",rr=n.forwardRef((s,t)=>{const{__scopeSelect:a,disabled:l=!1,...i}=s,o=kt(a),h=Bs(ar,a),c=h.disabled||l,j=xs(t,h.onTriggerChange),P=Nt(a),v=n.useRef("touch"),[x,S,E]=Cr(_=>{const b=P().filter(A=>!A.disabled),N=b.find(A=>A.value===h.value),y=Pr(b,_,N);y!==void 0&&h.onValueChange(y.value)}),V=_=>{c||(h.onOpenChange(!0),E()),_&&(h.triggerPointerDownPosRef.current={x:Math.round(_.pageX),y:Math.round(_.pageY)})};return e.jsx(Jr,{asChild:!0,...o,children:e.jsx(qe.button,{type:"button",role:"combobox","aria-controls":h.contentId,"aria-expanded":h.open,"aria-required":h.required,"aria-autocomplete":"none",dir:h.dir,"data-state":h.open?"open":"closed",disabled:c,"data-disabled":c?"":void 0,"data-placeholder":Sr(h.value)?"":void 0,...i,ref:j,onClick:Ze(i.onClick,_=>{_.currentTarget.focus(),v.current!=="mouse"&&V(_)}),onPointerDown:Ze(i.onPointerDown,_=>{v.current=_.pointerType;const b=_.target;b.hasPointerCapture(_.pointerId)&&b.releasePointerCapture(_.pointerId),_.button===0&&_.ctrlKey===!1&&_.pointerType==="mouse"&&(V(_),_.preventDefault())}),onKeyDown:Ze(i.onKeyDown,_=>{const b=x.current!=="";!(_.ctrlKey||_.altKey||_.metaKey)&&_.key.length===1&&S(_.key),!(b&&_.key===" ")&&Wn.includes(_.key)&&(V(),_.preventDefault())})})})});rr.displayName=ar;var lr="SelectValue",nr=n.forwardRef((s,t)=>{const{__scopeSelect:a,className:l,style:i,children:o,placeholder:h="",...c}=s,j=Bs(lr,a),{onValueNodeHasChildrenChange:P}=j,v=o!==void 0,x=xs(t,j.onValueNodeChange);return Fs(()=>{P(v)},[P,v]),e.jsx(qe.span,{...c,ref:x,style:{pointerEvents:"none"},children:Sr(j.value)?e.jsx(e.Fragment,{children:h}):o})});nr.displayName=lr;var Xn="SelectIcon",ir=n.forwardRef((s,t)=>{const{__scopeSelect:a,children:l,...i}=s;return e.jsx(qe.span,{"aria-hidden":!0,...i,ref:t,children:l||"▼"})});ir.displayName=Xn;var Qn="SelectPortal",cr=s=>e.jsx(il,{asChild:!0,...s});cr.displayName=Qn;var Hs="SelectContent",or=n.forwardRef((s,t)=>{const a=Bs(Hs,s.__scopeSelect),[l,i]=n.useState();if(Fs(()=>{i(new DocumentFragment)},[]),!a.open){const o=l;return o?qt.createPortal(e.jsx(dr,{scope:s.__scopeSelect,children:e.jsx(yt.Slot,{scope:s.__scopeSelect,children:e.jsx("div",{children:s.children})})}),o):null}return e.jsx(mr,{...s,ref:t})});or.displayName=Hs;var us=10,[dr,zs]=Xs(Hs),ei="SelectContentImpl",si=cl("SelectContent.RemoveScroll"),mr=n.forwardRef((s,t)=>{const{__scopeSelect:a,position:l="item-aligned",onCloseAutoFocus:i,onEscapeKeyDown:o,onPointerDownOutside:h,side:c,sideOffset:j,align:P,alignOffset:v,arrowPadding:x,collisionBoundary:S,collisionPadding:E,sticky:V,hideWhenDetached:_,avoidCollisions:b,...N}=s,y=Bs(Hs,a),[A,u]=n.useState(null),[$,z]=n.useState(null),re=xs(t,L=>u(L)),[K,ne]=n.useState(null),[Y,O]=n.useState(null),R=Nt(a),[F,J]=n.useState(!1),T=n.useRef(!1);n.useEffect(()=>{if(A)return Zr(A)},[A]),Xr();const w=n.useCallback(L=>{const[Q,...D]=R().map(ae=>ae.ref.current),[r]=D.slice(-1),H=document.activeElement;for(const ae of L)if(ae===H||(ae==null||ae.scrollIntoView({block:"nearest"}),ae===Q&&$&&($.scrollTop=0),ae===r&&$&&($.scrollTop=$.scrollHeight),ae==null||ae.focus(),document.activeElement!==H))return},[R,$]),g=n.useCallback(()=>w([K,A]),[w,K,A]);n.useEffect(()=>{F&&g()},[F,g]);const{onOpenChange:p,triggerPointerDownPosRef:M}=y;n.useEffect(()=>{if(A){let L={x:0,y:0};const Q=r=>{var H,ae;L={x:Math.abs(Math.round(r.pageX)-(((H=M.current)==null?void 0:H.x)??0)),y:Math.abs(Math.round(r.pageY)-(((ae=M.current)==null?void 0:ae.y)??0))}},D=r=>{L.x<=10&&L.y<=10?r.preventDefault():A.contains(r.target)||p(!1),document.removeEventListener("pointermove",Q),M.current=null};return M.current!==null&&(document.addEventListener("pointermove",Q),document.addEventListener("pointerup",D,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Q),document.removeEventListener("pointerup",D,{capture:!0})}}},[A,p,M]),n.useEffect(()=>{const L=()=>p(!1);return window.addEventListener("blur",L),window.addEventListener("resize",L),()=>{window.removeEventListener("blur",L),window.removeEventListener("resize",L)}},[p]);const[m,d]=Cr(L=>{const Q=R().filter(H=>!H.disabled),D=Q.find(H=>H.ref.current===document.activeElement),r=Pr(Q,L,D);r&&setTimeout(()=>r.ref.current.focus())}),X=n.useCallback((L,Q,D)=>{const r=!T.current&&!D;(y.value!==void 0&&y.value===Q||r)&&(ne(L),r&&(T.current=!0))},[y.value]),ee=n.useCallback(()=>A==null?void 0:A.focus(),[A]),B=n.useCallback((L,Q,D)=>{const r=!T.current&&!D;(y.value!==void 0&&y.value===Q||r)&&O(L)},[y.value]),ce=l==="popper"?Vt:xr,me=ce===Vt?{side:c,sideOffset:j,align:P,alignOffset:v,arrowPadding:x,collisionBoundary:S,collisionPadding:E,sticky:V,hideWhenDetached:_,avoidCollisions:b}:{};return e.jsx(dr,{scope:a,content:A,viewport:$,onViewportChange:z,itemRefCallback:X,selectedItem:K,onItemLeave:ee,itemTextRefCallback:B,focusSelectedItem:g,selectedItemText:Y,position:l,isPositioned:F,searchRef:m,children:e.jsx(Qr,{as:si,allowPinchZoom:!0,children:e.jsx(el,{asChild:!0,trapped:y.open,onMountAutoFocus:L=>{L.preventDefault()},onUnmountAutoFocus:Ze(i,L=>{var Q;(Q=y.trigger)==null||Q.focus({preventScroll:!0}),L.preventDefault()}),children:e.jsx(sl,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:o,onPointerDownOutside:h,onFocusOutside:L=>L.preventDefault(),onDismiss:()=>y.onOpenChange(!1),children:e.jsx(ce,{role:"listbox",id:y.contentId,"data-state":y.open?"open":"closed",dir:y.dir,onContextMenu:L=>L.preventDefault(),...N,...me,onPlaced:()=>J(!0),ref:re,style:{display:"flex",flexDirection:"column",outline:"none",...N.style},onKeyDown:Ze(N.onKeyDown,L=>{const Q=L.ctrlKey||L.altKey||L.metaKey;if(L.key==="Tab"&&L.preventDefault(),!Q&&L.key.length===1&&d(L.key),["ArrowUp","ArrowDown","Home","End"].includes(L.key)){let r=R().filter(H=>!H.disabled).map(H=>H.ref.current);if(["ArrowUp","End"].includes(L.key)&&(r=r.slice().reverse()),["ArrowUp","ArrowDown"].includes(L.key)){const H=L.target,ae=r.indexOf(H);r=r.slice(ae+1)}setTimeout(()=>w(r)),L.preventDefault()}})})})})})})});mr.displayName=ei;var ti="SelectItemAlignedPosition",xr=n.forwardRef((s,t)=>{const{__scopeSelect:a,onPlaced:l,...i}=s,o=Bs(Hs,a),h=zs(Hs,a),[c,j]=n.useState(null),[P,v]=n.useState(null),x=xs(t,re=>v(re)),S=Nt(a),E=n.useRef(!1),V=n.useRef(!0),{viewport:_,selectedItem:b,selectedItemText:N,focusSelectedItem:y}=h,A=n.useCallback(()=>{if(o.trigger&&o.valueNode&&c&&P&&_&&b&&N){const re=o.trigger.getBoundingClientRect(),K=P.getBoundingClientRect(),ne=o.valueNode.getBoundingClientRect(),Y=N.getBoundingClientRect();if(o.dir!=="rtl"){const H=Y.left-K.left,ae=ne.left-H,be=re.left-ae,Z=re.width+be,C=Math.max(Z,K.width),f=window.innerWidth-us,he=Ea(ae,[us,Math.max(us,f-C)]);c.style.minWidth=Z+"px",c.style.left=he+"px"}else{const H=K.right-Y.right,ae=window.innerWidth-ne.right-H,be=window.innerWidth-re.right-ae,Z=re.width+be,C=Math.max(Z,K.width),f=window.innerWidth-us,he=Ea(ae,[us,Math.max(us,f-C)]);c.style.minWidth=Z+"px",c.style.right=he+"px"}const O=S(),R=window.innerHeight-us*2,F=_.scrollHeight,J=window.getComputedStyle(P),T=parseInt(J.borderTopWidth,10),w=parseInt(J.paddingTop,10),g=parseInt(J.borderBottomWidth,10),p=parseInt(J.paddingBottom,10),M=T+w+F+p+g,m=Math.min(b.offsetHeight*5,M),d=window.getComputedStyle(_),X=parseInt(d.paddingTop,10),ee=parseInt(d.paddingBottom,10),B=re.top+re.height/2-us,ce=R-B,me=b.offsetHeight/2,L=b.offsetTop+me,Q=T+w+L,D=M-Q;if(Q<=B){const H=O.length>0&&b===O[O.length-1].ref.current;c.style.bottom="0px";const ae=P.clientHeight-_.offsetTop-_.offsetHeight,be=Math.max(ce,me+(H?ee:0)+ae+g),Z=Q+be;c.style.height=Z+"px"}else{const H=O.length>0&&b===O[0].ref.current;c.style.top="0px";const be=Math.max(B,T+_.offsetTop+(H?X:0)+me)+D;c.style.height=be+"px",_.scrollTop=Q-B+_.offsetTop}c.style.margin=`${us}px 0`,c.style.minHeight=m+"px",c.style.maxHeight=R+"px",l==null||l(),requestAnimationFrame(()=>E.current=!0)}},[S,o.trigger,o.valueNode,c,P,_,b,N,o.dir,l]);Fs(()=>A(),[A]);const[u,$]=n.useState();Fs(()=>{P&&$(window.getComputedStyle(P).zIndex)},[P]);const z=n.useCallback(re=>{re&&V.current===!0&&(A(),y==null||y(),V.current=!1)},[A,y]);return e.jsx(ri,{scope:a,contentWrapper:c,shouldExpandOnScrollRef:E,onScrollButtonChange:z,children:e.jsx("div",{ref:j,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:u},children:e.jsx(qe.div,{...i,ref:x,style:{boxSizing:"border-box",maxHeight:"100%",...i.style}})})})});xr.displayName=ti;var ai="SelectPopperPosition",Vt=n.forwardRef((s,t)=>{const{__scopeSelect:a,align:l="start",collisionPadding:i=us,...o}=s,h=kt(a);return e.jsx(tl,{...h,...o,ref:t,align:l,collisionPadding:i,style:{boxSizing:"border-box",...o.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Vt.displayName=ai;var[ri,la]=Xs(Hs,{}),Ut="SelectViewport",hr=n.forwardRef((s,t)=>{const{__scopeSelect:a,nonce:l,...i}=s,o=zs(Ut,a),h=la(Ut,a),c=xs(t,o.onViewportChange),j=n.useRef(0);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:l}),e.jsx(yt.Slot,{scope:a,children:e.jsx(qe.div,{"data-radix-select-viewport":"",role:"presentation",...i,ref:c,style:{position:"relative",flex:1,overflow:"hidden auto",...i.style},onScroll:Ze(i.onScroll,P=>{const v=P.currentTarget,{contentWrapper:x,shouldExpandOnScrollRef:S}=h;if(S!=null&&S.current&&x){const E=Math.abs(j.current-v.scrollTop);if(E>0){const V=window.innerHeight-us*2,_=parseFloat(x.style.minHeight),b=parseFloat(x.style.height),N=Math.max(_,b);if(N<V){const y=N+E,A=Math.min(V,y),u=y-A;x.style.height=A+"px",x.style.bottom==="0px"&&(v.scrollTop=u>0?u:0,x.style.justifyContent="flex-end")}}}j.current=v.scrollTop})})})]})});hr.displayName=Ut;var ur="SelectGroup",[li,ni]=Xs(ur),ii=n.forwardRef((s,t)=>{const{__scopeSelect:a,...l}=s,i=Wt();return e.jsx(li,{scope:a,id:i,children:e.jsx(qe.div,{role:"group","aria-labelledby":i,...l,ref:t})})});ii.displayName=ur;var pr="SelectLabel",ci=n.forwardRef((s,t)=>{const{__scopeSelect:a,...l}=s,i=ni(pr,a);return e.jsx(qe.div,{id:i.id,...l,ref:t})});ci.displayName=pr;var jt="SelectItem",[oi,gr]=Xs(jt),jr=n.forwardRef((s,t)=>{const{__scopeSelect:a,value:l,disabled:i=!1,textValue:o,...h}=s,c=Bs(jt,a),j=zs(jt,a),P=c.value===l,[v,x]=n.useState(o??""),[S,E]=n.useState(!1),V=xs(t,y=>{var A;return(A=j.itemRefCallback)==null?void 0:A.call(j,y,l,i)}),_=Wt(),b=n.useRef("touch"),N=()=>{i||(c.onValueChange(l),c.onOpenChange(!1))};if(l==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return e.jsx(oi,{scope:a,value:l,disabled:i,textId:_,isSelected:P,onItemTextChange:n.useCallback(y=>{x(A=>A||((y==null?void 0:y.textContent)??"").trim())},[]),children:e.jsx(yt.ItemSlot,{scope:a,value:l,disabled:i,textValue:v,children:e.jsx(qe.div,{role:"option","aria-labelledby":_,"data-highlighted":S?"":void 0,"aria-selected":P&&S,"data-state":P?"checked":"unchecked","aria-disabled":i||void 0,"data-disabled":i?"":void 0,tabIndex:i?void 0:-1,...h,ref:V,onFocus:Ze(h.onFocus,()=>E(!0)),onBlur:Ze(h.onBlur,()=>E(!1)),onClick:Ze(h.onClick,()=>{b.current!=="mouse"&&N()}),onPointerUp:Ze(h.onPointerUp,()=>{b.current==="mouse"&&N()}),onPointerDown:Ze(h.onPointerDown,y=>{b.current=y.pointerType}),onPointerMove:Ze(h.onPointerMove,y=>{var A;b.current=y.pointerType,i?(A=j.onItemLeave)==null||A.call(j):b.current==="mouse"&&y.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Ze(h.onPointerLeave,y=>{var A;y.currentTarget===document.activeElement&&((A=j.onItemLeave)==null||A.call(j))}),onKeyDown:Ze(h.onKeyDown,y=>{var u;((u=j.searchRef)==null?void 0:u.current)!==""&&y.key===" "||(qn.includes(y.key)&&N(),y.key===" "&&y.preventDefault())})})})})});jr.displayName=jt;var at="SelectItemText",br=n.forwardRef((s,t)=>{const{__scopeSelect:a,className:l,style:i,...o}=s,h=Bs(at,a),c=zs(at,a),j=gr(at,a),P=Zn(at,a),[v,x]=n.useState(null),S=xs(t,N=>x(N),j.onItemTextChange,N=>{var y;return(y=c.itemTextRefCallback)==null?void 0:y.call(c,N,j.value,j.disabled)}),E=v==null?void 0:v.textContent,V=n.useMemo(()=>e.jsx("option",{value:j.value,disabled:j.disabled,children:E},j.value),[j.disabled,j.value,E]),{onNativeOptionAdd:_,onNativeOptionRemove:b}=P;return Fs(()=>(_(V),()=>b(V)),[_,b,V]),e.jsxs(e.Fragment,{children:[e.jsx(qe.span,{id:j.textId,...o,ref:S}),j.isSelected&&h.valueNode&&!h.valueNodeHasChildren?qt.createPortal(o.children,h.valueNode):null]})});br.displayName=at;var vr="SelectItemIndicator",fr=n.forwardRef((s,t)=>{const{__scopeSelect:a,...l}=s;return gr(vr,a).isSelected?e.jsx(qe.span,{"aria-hidden":!0,...l,ref:t}):null});fr.displayName=vr;var Bt="SelectScrollUpButton",yr=n.forwardRef((s,t)=>{const a=zs(Bt,s.__scopeSelect),l=la(Bt,s.__scopeSelect),[i,o]=n.useState(!1),h=xs(t,l.onScrollButtonChange);return Fs(()=>{if(a.viewport&&a.isPositioned){let c=function(){const P=j.scrollTop>0;o(P)};const j=a.viewport;return c(),j.addEventListener("scroll",c),()=>j.removeEventListener("scroll",c)}},[a.viewport,a.isPositioned]),i?e.jsx(kr,{...s,ref:h,onAutoScroll:()=>{const{viewport:c,selectedItem:j}=a;c&&j&&(c.scrollTop=c.scrollTop-j.offsetHeight)}}):null});yr.displayName=Bt;var zt="SelectScrollDownButton",Nr=n.forwardRef((s,t)=>{const a=zs(zt,s.__scopeSelect),l=la(zt,s.__scopeSelect),[i,o]=n.useState(!1),h=xs(t,l.onScrollButtonChange);return Fs(()=>{if(a.viewport&&a.isPositioned){let c=function(){const P=j.scrollHeight-j.clientHeight,v=Math.ceil(j.scrollTop)<P;o(v)};const j=a.viewport;return c(),j.addEventListener("scroll",c),()=>j.removeEventListener("scroll",c)}},[a.viewport,a.isPositioned]),i?e.jsx(kr,{...s,ref:h,onAutoScroll:()=>{const{viewport:c,selectedItem:j}=a;c&&j&&(c.scrollTop=c.scrollTop+j.offsetHeight)}}):null});Nr.displayName=zt;var kr=n.forwardRef((s,t)=>{const{__scopeSelect:a,onAutoScroll:l,...i}=s,o=zs("SelectScrollButton",a),h=n.useRef(null),c=Nt(a),j=n.useCallback(()=>{h.current!==null&&(window.clearInterval(h.current),h.current=null)},[]);return n.useEffect(()=>()=>j(),[j]),Fs(()=>{var v;const P=c().find(x=>x.ref.current===document.activeElement);(v=P==null?void 0:P.ref.current)==null||v.scrollIntoView({block:"nearest"})},[c]),e.jsx(qe.div,{"aria-hidden":!0,...i,ref:t,style:{flexShrink:0,...i.style},onPointerDown:Ze(i.onPointerDown,()=>{h.current===null&&(h.current=window.setInterval(l,50))}),onPointerMove:Ze(i.onPointerMove,()=>{var P;(P=o.onItemLeave)==null||P.call(o),h.current===null&&(h.current=window.setInterval(l,50))}),onPointerLeave:Ze(i.onPointerLeave,()=>{j()})})}),di="SelectSeparator",mi=n.forwardRef((s,t)=>{const{__scopeSelect:a,...l}=s;return e.jsx(qe.div,{"aria-hidden":!0,...l,ref:t})});mi.displayName=di;var _t="SelectArrow",xi=n.forwardRef((s,t)=>{const{__scopeSelect:a,...l}=s,i=kt(a),o=Bs(_t,a),h=zs(_t,a);return o.open&&h.position==="popper"?e.jsx(al,{...i,...l,ref:t}):null});xi.displayName=_t;var hi="SelectBubbleInput",wr=n.forwardRef(({__scopeSelect:s,value:t,...a},l)=>{const i=n.useRef(null),o=xs(l,i),h=er(t);return n.useEffect(()=>{const c=i.current;if(!c)return;const j=window.HTMLSelectElement.prototype,v=Object.getOwnPropertyDescriptor(j,"value").set;if(h!==t&&v){const x=new Event("change",{bubbles:!0});v.call(c,t),c.dispatchEvent(x)}},[h,t]),e.jsx(qe.select,{...a,style:{...sr,...a.style},ref:o,defaultValue:t})});wr.displayName=hi;function Sr(s){return s===""||s===void 0}function Cr(s){const t=rl(s),a=n.useRef(""),l=n.useRef(0),i=n.useCallback(h=>{const c=a.current+h;t(c),function j(P){a.current=P,window.clearTimeout(l.current),P!==""&&(l.current=window.setTimeout(()=>j(""),1e3))}(c)},[t]),o=n.useCallback(()=>{a.current="",window.clearTimeout(l.current)},[]);return n.useEffect(()=>()=>window.clearTimeout(l.current),[]),[a,i,o]}function Pr(s,t,a){const i=t.length>1&&Array.from(t).every(P=>P===t[0])?t[0]:t,o=a?s.indexOf(a):-1;let h=ui(s,Math.max(o,0));i.length===1&&(h=h.filter(P=>P!==a));const j=h.find(P=>P.textValue.toLowerCase().startsWith(i.toLowerCase()));return j!==a?j:void 0}function ui(s,t){return s.map((a,l)=>s[(t+l)%s.length])}var pi=tr,gi=rr,ji=nr,bi=ir,vi=cr,fi=or,yi=hr,Ni=jr,ki=br,wi=fr,Si=yr,Ci=Nr;function ye({...s}){return e.jsx(pi,{"data-slot":"select",...s})}function Ne({...s}){return e.jsx(ji,{"data-slot":"select-value",...s})}function ke({className:s,size:t="default",children:a,...l}){return e.jsxs(gi,{"data-slot":"select-trigger","data-size":t,className:Le("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...l,children:[a,e.jsx(bi,{asChild:!0,children:e.jsx(ea,{className:"size-4 opacity-50"})})]})}function we({className:s,children:t,position:a="popper",...l}){return e.jsx(vi,{children:e.jsxs(fi,{"data-slot":"select-content",className:Le("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:a,...l,children:[e.jsx(Pi,{}),e.jsx(yi,{className:Le("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),e.jsx(Ai,{})]})})}function I({className:s,children:t,...a}){return e.jsxs(Ni,{"data-slot":"select-item",className:Le("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",s),...a,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(wi,{children:e.jsx(Ua,{className:"size-4"})})}),e.jsx(ki,{children:t})]})}function Pi({className:s,...t}){return e.jsx(Si,{"data-slot":"select-scroll-up-button",className:Le("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(Ba,{className:"size-4"})})}function Ai({className:s,...t}){return e.jsx(Ci,{"data-slot":"select-scroll-down-button",className:Le("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(ea,{className:"size-4"})})}function os({className:s,...t}){return e.jsx("textarea",{"data-slot":"textarea",className:Le("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...t})}const Di=({siteId:s,siteName:t,auditoriums:a,onAuditoriumUpdate:l,onProjectorAdd:i})=>{const[o,h]=n.useState(!1),[c,j]=n.useState(null),[P,v]=n.useState({name:"",capacity:100,screenSize:"Standard",status:"Active",notes:""}),x=["Standard","Large","IMAX","4K","8K","Custom"],S=async()=>{var b,N,y;try{const A=await fetch(`/api/sites/${s}/auditoriums`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(P)});if(A.ok){const u=await A.json(),$=[...a,u.auditorium];l($),v({name:"",capacity:100,screenSize:"Standard",status:"Active",notes:""}),h(!1),(b=window.showToast)==null||b.call(window,{type:"success",title:"Success",message:"Auditorium added successfully"})}else{const u=await A.json();(N=window.showToast)==null||N.call(window,{type:"error",title:"Error",message:u.message||"Failed to add auditorium"})}}catch{(y=window.showToast)==null||y.call(window,{type:"error",title:"Error",message:"Failed to add auditorium"})}},E=async(b,N)=>{var y,A,u;try{const $=await fetch(`/api/sites/${s}/auditoriums/${b}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(N)});if($.ok){const z=await $.json(),re=a.map(K=>K.audiNumber===b?{...K,...z.auditorium}:K);l(re),j(null),(y=window.showToast)==null||y.call(window,{type:"success",title:"Success",message:"Auditorium updated successfully"})}else{const z=await $.json();(A=window.showToast)==null||A.call(window,{type:"error",title:"Error",message:z.message||"Failed to update auditorium"})}}catch{(u=window.showToast)==null||u.call(window,{type:"error",title:"Error",message:"Failed to update auditorium"})}},V=async b=>{var N,y,A;if(confirm("Are you sure you want to delete this auditorium? This action cannot be undone."))try{const u=await fetch(`/api/sites/${s}/auditoriums/${b}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(u.ok){const $=a.filter(z=>z.audiNumber!==b);l($),(N=window.showToast)==null||N.call(window,{type:"success",title:"Success",message:"Auditorium deleted successfully"})}else{const $=await u.json();(y=window.showToast)==null||y.call(window,{type:"error",title:"Error",message:$.message||"Failed to delete auditorium"})}}catch{(A=window.showToast)==null||A.call(window,{type:"error",title:"Error",message:"Failed to delete auditorium"})}},_=b=>{switch(b){case"Active":return"bg-green-100 text-green-800";case"Inactive":return"bg-gray-100 text-gray-800";case"Under Maintenance":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Auditoriums"}),e.jsxs(q,{onClick:()=>h(!0),className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-4 w-4"}),"Add Auditorium"]})]}),o&&e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{children:"Add New Auditorium"})}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Name"}),e.jsx(k,{value:P.name,onChange:b=>v({...P,name:b.target.value}),placeholder:"e.g., Main Auditorium"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Capacity"}),e.jsx(k,{type:"number",value:P.capacity,onChange:b=>v({...P,capacity:parseInt(b.target.value)}),placeholder:"100"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Screen Size"}),e.jsxs(ye,{value:P.screenSize,onValueChange:b=>v({...P,screenSize:b}),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsx(we,{children:x.map(b=>e.jsx(I,{value:b,children:b},b))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs(ye,{value:P.status,onValueChange:b=>v({...P,status:b}),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Active",children:"Active"}),e.jsx(I,{value:"Inactive",children:"Inactive"}),e.jsx(I,{value:"Under Maintenance",children:"Under Maintenance"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Notes"}),e.jsx(os,{value:P.notes,onChange:b=>v({...P,notes:b.target.value}),placeholder:"Additional notes..."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{onClick:S,children:"Add Auditorium"}),e.jsx(q,{variant:"outline",onClick:()=>h(!1),children:"Cancel"})]})]})]}),e.jsx("div",{className:"grid gap-4",children:a.map(b=>e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(St,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx(de,{className:"text-lg",children:b.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{children:b.audiNumber}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[b.capacity," seats"]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:b.screenSize})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:_(b.status),children:b.status}),e.jsxs(ge,{variant:"secondary",children:[b.projectorCount," Projectors"]}),e.jsx(q,{variant:"ghost",size:"sm",onClick:()=>j(c===b.audiNumber?null:b.audiNumber),children:e.jsx(ks,{className:"h-4 w-4"})}),e.jsx(q,{variant:"ghost",size:"sm",onClick:()=>V(b.audiNumber),className:"text-red-600 hover:text-red-700",children:e.jsx(Vs,{className:"h-4 w-4"})})]})]})}),c===b.audiNumber&&e.jsxs(se,{className:"border-t pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Name"}),e.jsx(k,{value:b.name,onChange:N=>E(b.audiNumber,{name:N.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Capacity"}),e.jsx(k,{type:"number",value:b.capacity,onChange:N=>E(b.audiNumber,{capacity:parseInt(N.target.value)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Screen Size"}),e.jsxs(ye,{value:b.screenSize,onValueChange:N=>E(b.audiNumber,{screenSize:N}),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsx(we,{children:x.map(N=>e.jsx(I,{value:N,children:N},N))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs(ye,{value:b.status,onValueChange:N=>E(b.audiNumber,{status:N}),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Active",children:"Active"}),e.jsx(I,{value:"Inactive",children:"Inactive"}),e.jsx(I,{value:"Under Maintenance",children:"Under Maintenance"})]})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"Notes"}),e.jsx(os,{value:b.notes,onChange:N=>E(b.audiNumber,{notes:N.target.value})})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(q,{onClick:()=>j(null),children:"Save Changes"}),e.jsx(q,{variant:"outline",onClick:()=>j(null),children:"Cancel"})]})]}),b.projectors&&b.projectors.length>0&&e.jsxs(se,{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Projectors in this Auditorium"}),e.jsx("div",{className:"grid gap-2",children:b.projectors.map(N=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-1 bg-gray-200 rounded",children:e.jsx(St,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:N.projectorNumber}),e.jsxs("div",{className:"text-sm text-gray-600",children:[N.brand," ",N.model," • ",N.serialNumber]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{variant:"outline",children:N.status}),e.jsx(ge,{variant:"outline",children:N.condition})]})]},N._id))})]}),e.jsx(se,{className:"border-t pt-4",children:e.jsxs(q,{variant:"outline",className:"w-full",onClick:()=>i==null?void 0:i(b.audiNumber,{}),children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"Add Projector to ",b.name]})})]},b.audiNumber))}),a.length===0&&e.jsx(te,{children:e.jsxs(se,{className:"text-center py-8",children:[e.jsx(St,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Auditoriums Yet"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Get started by adding your first auditorium to this site."}),e.jsxs(q,{onClick:()=>h(!0),children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"Add First Auditorium"]})]})})]})};function Ri(){var D,r,H,ae,be,Z;const[s,t]=n.useState([]),[a,l]=n.useState([]),[i,o]=n.useState(""),[h,c]=n.useState("All"),[j,P]=n.useState("All"),[v,x]=n.useState(null),[S,E]=n.useState(!1),[V,_]=n.useState(!1),[b,N]=n.useState(!0),[y,A]=n.useState(null),[u,$]=n.useState(null),[z,re]=n.useState(null),[K,ne]=n.useState(null),[Y,O]=n.useState({name:"",siteCode:"",region:"Central",state:"",address:{street:"",city:"",state:"",pincode:"",country:"India"},contactPerson:{name:"",email:"",phone:"",designation:""},businessHours:{openTime:"09:00",closeTime:"18:00",workingDays:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},siteType:"Mall",status:"Active",auditoriums:[{audiNumber:"AUDI-01",name:"Main Auditorium",capacity:100,screenSize:"Standard",projectorCount:0,status:"Active",notes:"Default auditorium"}],contractDetails:{contractNumber:"",startDate:"",endDate:"",contractValue:0,serviceLevel:"Standard"}}),R=["Mall","Cinema","Corporate Office","Convention Center","Hotel","Restaurant","Educational Institute","Other"],F=["Active","Inactive","Under Maintenance"],J=["Basic","Standard","Premium"],T=["North","South","East","West","Central","Northeast","Northwest","Southeast","Southwest"];n.useEffect(()=>{w()},[]),n.useEffect(()=>{z&&(g(),M())},[z]),n.useEffect(()=>{m()},[s,i,h,j]);const w=async()=>{try{ne(null);const f=(await fetch("http://localhost:4000/api/health")).ok;if(re(f),!f)throw new Error("Backend health check failed")}catch(C){console.error("Backend connection failed:",C),re(!1),ne(`Cannot connect to backend server. Please ensure:
1. Express.js server is running on http://localhost:4000
2. MongoDB is connected and running
3. Run "cd server && npm start" to start backend`)}},g=async()=>{try{N(!0),A(null);const C=await ie.getAllSites();t(C)}catch(C){console.error("Error loading sites:",C),A("Failed to load sites. Backend server may not be running."),t([])}finally{N(!1)}},p=async C=>{var f,he;try{const pe=s.find(ve=>ve._id===C);if(!pe){A("Site not found");return}const Pe=[{name:pe.name,type:pe.siteType,status:pe.status,address:pe.fullAddress,contact:pe.contactPerson.name,email:pe.contactPerson.email,phone:pe.contactPerson.phone,contractValue:((f=pe.contractDetails)==null?void 0:f.contractValue)||0,totalProjectors:pe.totalProjectors||0,activeProjectors:pe.activeProjectors||0}],W=Ss(Pe);Cs(W,`site_${pe.name.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.csv`),(he=window.showToast)==null||he.call(window,{type:"success",title:"Export Successful",message:`Site details for ${pe.name} exported to CSV file`})}catch(pe){console.error("Error exporting site details:",pe),A("Failed to export site details: "+pe.message)}},M=async()=>{try{const C=await ie.getSiteStats();$(C)}catch(C){console.error("Error loading site statistics:",C),$({totalSites:s.length,activeSites:s.filter(f=>f.status==="Active").length,inactiveSites:s.filter(f=>f.status==="Inactive").length,maintenanceSites:s.filter(f=>f.status==="Under Maintenance").length})}},m=()=>{let C=s;i&&(C=C.filter(f=>f.name.toLowerCase().includes(i.toLowerCase())||f.siteCode&&f.siteCode.toLowerCase().includes(i.toLowerCase())||f.region&&f.region.toLowerCase().includes(i.toLowerCase())||f.state&&f.state.toLowerCase().includes(i.toLowerCase())||f.address.city.toLowerCase().includes(i.toLowerCase())||f.address.state.toLowerCase().includes(i.toLowerCase())||f.contactPerson.name.toLowerCase().includes(i.toLowerCase()))),h!=="All"&&(C=C.filter(f=>f.siteType===h)),j!=="All"&&(C=C.filter(f=>f.status===j)),l(C)},d=async()=>{try{N(!0),await ie.createSite(Y),await g(),await M(),E(!1),ce(),console.log("Site added successfully")}catch(C){console.error("Error adding site:",C),A("Failed to add site: "+C.message)}finally{N(!1)}},X=async C=>{if(confirm("Are you sure you want to delete this site? This action cannot be undone."))try{N(!0),await ie.deleteSite(C),await g(),await M(),console.log("Site deleted successfully")}catch(f){console.error("Error deleting site:",f),A("Failed to delete site: "+f.message)}finally{N(!1)}},ee=C=>{if(v){const f={...v,auditoriums:C};x(f),t(s.map(he=>he._id===v._id?f:he)),l(a.map(he=>he._id===v._id?f:he))}},B=(C,f)=>{console.log("Add projector to auditorium:",C,f)},ce=()=>{O({name:"",siteCode:"",region:"Central",state:"",address:{street:"",city:"",state:"",pincode:"",country:"India"},contactPerson:{name:"",email:"",phone:"",designation:""},businessHours:{openTime:"09:00",closeTime:"18:00",workingDays:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},siteType:"Mall",status:"Active",auditoriums:[{audiNumber:"AUDI-01",name:"Main Auditorium",capacity:100,screenSize:"Standard",projectorCount:0,status:"Active",notes:"Default auditorium"}],contractDetails:{contractNumber:"",startDate:"",endDate:"",contractValue:0,serviceLevel:"Standard"}})},me=C=>{switch(C){case"Active":return"bg-green-600";case"Inactive":return"bg-gray-600";case"Under Maintenance":return"bg-orange-600";default:return"bg-gray-600"}},L=C=>{switch(C){case"Mall":return"bg-blue-600";case"Cinema":return"bg-purple-600";case"Corporate Office":return"bg-green-600";case"Convention Center":return"bg-orange-600";case"Hotel":return"bg-pink-600";default:return"bg-gray-600"}},Q=C=>C?new Date(C).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Not set";return z===!1?e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"bg-dark-bg border-b border-dark-color px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-dark-primary",children:"Site Management"}),e.jsx("p",{className:"text-sm text-dark-secondary mt-1",children:"Backend server connection required"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-red-400",children:[e.jsx(rt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Backend Offline"})]}),e.jsxs("button",{onClick:w,className:"dark-button-primary gap-2 flex items-center",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Retry Connection"]})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto p-8 bg-dark-bg",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"mb-8 p-6 bg-red-900 bg-opacity-30 rounded-lg border border-red-600",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(sa,{className:"w-6 h-6 text-red-400 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-400 mb-2",children:"Backend Server Not Running"}),e.jsx("p",{className:"text-red-300 mb-4",children:K}),e.jsxs("div",{className:"bg-red-950 bg-opacity-50 rounded-lg p-4 mb-4",children:[e.jsx("h4",{className:"font-semibold text-red-300 mb-2",children:"Quick Start Commands:"}),e.jsxs("div",{className:"space-y-2 text-sm font-mono text-red-200",children:[e.jsx("div",{className:"bg-red-900 bg-opacity-30 p-2 rounded",children:"# Terminal 1: Start Backend Server"}),e.jsx("div",{className:"bg-red-900 bg-opacity-30 p-2 rounded",children:"cd server && npm install && npm run dev"}),e.jsx("div",{className:"bg-red-900 bg-opacity-30 p-2 rounded mt-3",children:"# Terminal 2: Start Frontend (this app)"}),e.jsx("div",{className:"bg-red-900 bg-opacity-30 p-2 rounded",children:"npm start"})]})]}),e.jsxs("div",{className:"text-sm text-red-300",children:[e.jsx("p",{className:"mb-2",children:e.jsx("strong",{children:"Requirements:"})}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Node.js installed"}),e.jsx("li",{children:"MongoDB running (local or cloud)"}),e.jsx("li",{children:"Backend server running on port 5000"})]})]})]})]})}),e.jsxs("div",{className:"dark-card",children:[e.jsx("h3",{className:"text-xl font-semibold text-dark-primary mb-4",children:"Setup Instructions"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-primary mb-2",children:"1. Start MongoDB"}),e.jsxs("div",{className:"bg-dark-bg p-3 rounded-lg text-sm font-mono text-dark-secondary",children:["# Windows: net start MongoDB",e.jsx("br",{}),"# macOS: brew services start mongodb-community",e.jsx("br",{}),"# Linux: sudo systemctl start mongod"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-primary mb-2",children:"2. Start Backend Server"}),e.jsxs("div",{className:"bg-dark-bg p-3 rounded-lg text-sm font-mono text-dark-secondary",children:["cd server",e.jsx("br",{}),"npm install",e.jsx("br",{}),"npm run dev"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-primary mb-2",children:"3. Verify Backend"}),e.jsxs("p",{className:"text-dark-secondary text-sm mb-2",children:["Check that the backend is running by visiting:"," ",e.jsx("a",{href:"http://localhost:4000/api/health",target:"_blank",rel:"noopener noreferrer",className:"text-dark-cta hover:underline",children:"http://localhost:4000/api/health"})]})]}),e.jsxs("button",{onClick:w,className:"dark-button-primary gap-2 flex items-center",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Test Connection"]})]})]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"bg-dark-bg border-b border-dark-color px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-dark-primary",children:"Site Management"}),e.jsx("p",{className:"text-sm text-dark-secondary mt-1",children:"Manage projector installation sites and locations"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex items-center space-x-2",children:z?e.jsxs(e.Fragment,{children:[e.jsx(Ot,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-sm text-green-400",children:"Backend Online"})]}):e.jsxs(e.Fragment,{children:[e.jsx(rt,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:"text-sm text-red-400",children:"Checking..."})]})}),e.jsxs("button",{onClick:()=>{g(),M()},className:"dark-button-secondary gap-2 flex items-center",disabled:b,children:[e.jsx(Qe,{className:`w-4 h-4 ${b?"animate-spin":""}`}),"Refresh"]}),e.jsxs("button",{onClick:()=>E(!0),className:"dark-button-primary gap-2 flex items-center",disabled:!z,children:[e.jsx(Xe,{className:"w-4 h-4"}),"Add Site"]})]})]})}),e.jsxs("main",{className:"flex-1 overflow-auto p-8 bg-dark-bg",children:[y&&e.jsx("div",{className:"mb-6 p-4 bg-red-900 bg-opacity-30 rounded-lg border border-red-600",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{className:"w-5 h-5 text-red-400"}),e.jsx("p",{className:"text-red-400",children:y}),e.jsx("button",{onClick:()=>A(null),className:"ml-auto text-red-400 hover:text-red-300",children:"×"})]})}),u&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"dark-card text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-600 flex items-center justify-center mx-auto mb-4",children:e.jsx(tt,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-dark-primary mb-1",children:u.totalSites||s.length}),e.jsx("p",{className:"text-sm text-dark-secondary",children:"Total Sites"})]}),e.jsxs("div",{className:"dark-card text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-600 flex items-center justify-center mx-auto mb-4",children:e.jsx(Be,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-dark-primary mb-1",children:u.activeSites||s.filter(C=>C.status==="Active").length}),e.jsx("p",{className:"text-sm text-dark-secondary",children:"Active Sites"})]}),e.jsxs("div",{className:"dark-card text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-orange-600 flex items-center justify-center mx-auto mb-4",children:e.jsx(mt,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-dark-primary mb-1",children:u.maintenanceSites||s.filter(C=>C.status==="Under Maintenance").length}),e.jsx("p",{className:"text-sm text-dark-secondary",children:"Under Maintenance"})]}),e.jsxs("div",{className:"dark-card text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-600 flex items-center justify-center mx-auto mb-4",children:e.jsx(ss,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-dark-primary mb-1",children:s.reduce((C,f)=>C+(f.totalProjectors||0),0)}),e.jsx("p",{className:"text-sm text-dark-secondary",children:"Total Projectors"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 mb-8",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(vs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-dark-secondary w-4 h-4"}),e.jsx(k,{placeholder:"Search sites, cities, or contacts...",value:i,onChange:C=>o(C.target.value),className:"pl-10 bg-dark-card border-dark-color text-dark-primary"})]}),e.jsxs("select",{value:h,onChange:C=>c(C.target.value),className:"px-4 py-2 bg-dark-card border border-dark-color rounded-xl text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"All",children:"All Types"}),R.map(C=>e.jsx("option",{value:C,children:C},C))]}),e.jsxs("select",{value:j,onChange:C=>P(C.target.value),className:"px-4 py-2 bg-dark-card border border-dark-color rounded-xl text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"All",children:"All Status"}),F.map(C=>e.jsx("option",{value:C,children:C},C))]})]}),b&&s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ie,{className:"w-12 h-12 text-dark-secondary mx-auto mb-4 animate-spin"}),e.jsx("p",{className:"text-dark-secondary",children:"Loading sites..."})]}):a.length>0?e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:a.map(C=>{var f;return e.jsxs("div",{className:"dark-card",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-dark-primary mb-1",children:C.name}),e.jsxs("p",{className:"text-sm text-dark-secondary flex items-center gap-1",children:[e.jsx(ds,{className:"w-3 h-3"}),C.address.city,", ",C.address.state]}),e.jsxs("p",{className:"text-xs text-dark-secondary flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"Code:"})," ",C.siteCode||"N/A"," |",e.jsx("span",{className:"font-medium ml-1",children:"Region:"})," ",C.region||"N/A"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`dark-tag ${me(C.status)}`,children:C.status}),e.jsx("button",{className:"p-1 hover:bg-dark-hover rounded",children:e.jsx(_l,{className:"w-4 h-4 text-dark-secondary"})})]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:`dark-tag ${L(C.siteType)} inline-flex items-center gap-1`,children:[e.jsx(tt,{className:"w-3 h-3"}),C.siteType]}),e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"w-4 h-4 text-dark-secondary"}),e.jsx("span",{className:"text-dark-primary",children:C.contactPerson.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Mt,{className:"w-4 h-4 text-dark-secondary"}),e.jsx("span",{className:"text-dark-primary",children:C.contactPerson.email})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(It,{className:"w-4 h-4 text-dark-secondary"}),e.jsx("span",{className:"text-dark-primary",children:C.contactPerson.phone})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"w-4 h-4 text-dark-secondary"}),e.jsxs("span",{className:"text-dark-primary",children:[C.businessHours.openTime," - ",C.businessHours.closeTime]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center mb-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-dark-primary",children:C.totalProjectors||0}),e.jsx("div",{className:"text-xs text-dark-secondary",children:"Total Projectors"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-dark-primary",children:C.activeProjectors||0}),e.jsx("div",{className:"text-xs text-dark-secondary",children:"Active"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-dark-primary",children:((f=C.contractDetails)==null?void 0:f.serviceLevel)||"N/A"}),e.jsx("div",{className:"text-xs text-dark-secondary",children:"Service Level"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>x(C),className:"flex-1 dark-button-secondary text-sm py-2 gap-2 flex items-center justify-center",children:[e.jsx(es,{className:"w-4 h-4"}),"View Details"]}),e.jsx("button",{className:"dark-button-secondary p-2",children:e.jsx(ks,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>X(C._id),className:"dark-button-secondary p-2 text-red-400 hover:text-red-300",children:e.jsx(Vs,{className:"w-4 h-4"})})]})]},C._id)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(tt,{className:"w-16 h-16 text-dark-secondary mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-dark-primary mb-2",children:"No Sites Found"}),e.jsx("p",{className:"text-dark-secondary mb-4",children:i||h!=="All"||j!=="All"?"No sites match your current filters.":"No sites have been added to the system yet."}),z&&e.jsxs("button",{onClick:()=>E(!0),className:"dark-button-primary gap-2 flex items-center mx-auto",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Add First Site"]})]}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-dark-bg border-2 border-dark-color rounded-xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-dark-primary",children:"Add New Site"}),e.jsx("button",{onClick:()=>{E(!1),ce()},className:"p-2 hover:bg-dark-hover rounded-lg transition-colors",children:e.jsx(Te,{className:"w-5 h-5 text-dark-secondary rotate-45"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary",children:"Basic Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"Site Name *"}),e.jsx(k,{value:Y.name,onChange:C=>O({...Y,name:C.target.value}),className:"bg-dark-bg border-dark-color text-dark-primary",placeholder:"Enter site name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"Site Code *"}),e.jsx(k,{value:Y.siteCode,onChange:C=>O({...Y,siteCode:C.target.value.toUpperCase()}),className:"bg-dark-bg border-dark-color text-dark-primary",placeholder:"Enter site code (e.g., NOMAL123)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"Region *"}),e.jsx("select",{value:Y.region,onChange:C=>O({...Y,region:C.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-color rounded-xl text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:T.map(C=>e.jsx("option",{value:C,children:C},C))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"State *"}),e.jsx(k,{value:Y.state,onChange:C=>O({...Y,state:C.target.value}),className:"bg-dark-bg border-dark-color text-dark-primary",placeholder:"State"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"Site Type *"}),e.jsx("select",{value:Y.siteType,onChange:C=>O({...Y,siteType:C.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-color rounded-xl text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:R.map(C=>e.jsx("option",{value:C,children:C},C))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"Status"}),e.jsx("select",{value:Y.status,onChange:C=>O({...Y,status:C.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-color rounded-xl text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:F.map(C=>e.jsx("option",{value:C,children:C},C))})]}),e.jsx("h4",{className:"text-md font-semibold text-dark-primary mt-6",children:"Address"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"Street Address *"}),e.jsx(k,{value:Y.address.street,onChange:C=>O({...Y,address:{...Y.address,street:C.target.value}}),className:"bg-dark-bg border-dark-color text-dark-primary",placeholder:"Street address"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"City *"}),e.jsx(k,{value:Y.address.city,onChange:C=>O({...Y,address:{...Y.address,city:C.target.value}}),className:"bg-dark-bg border-dark-color text-dark-primary",placeholder:"City"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"State *"}),e.jsx(k,{value:Y.address.state,onChange:C=>O({...Y,address:{...Y.address,state:C.target.value}}),className:"bg-dark-bg border-dark-color text-dark-primary",placeholder:"State"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"Pincode *"}),e.jsx(k,{value:Y.address.pincode,onChange:C=>O({...Y,address:{...Y.address,pincode:C.target.value}}),className:"bg-dark-bg border-dark-color text-dark-primary",placeholder:"Pincode"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"Country"}),e.jsx(k,{value:Y.address.country,onChange:C=>O({...Y,address:{...Y.address,country:C.target.value}}),className:"bg-dark-bg border-dark-color text-dark-primary",placeholder:"Country"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary",children:"Contact Person"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"Name *"}),e.jsx(k,{value:Y.contactPerson.name,onChange:C=>O({...Y,contactPerson:{...Y.contactPerson,name:C.target.value}}),className:"bg-dark-bg border-dark-color text-dark-primary",placeholder:"Contact person name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"Email *"}),e.jsx(k,{type:"email",value:Y.contactPerson.email,onChange:C=>O({...Y,contactPerson:{...Y.contactPerson,email:C.target.value}}),className:"bg-dark-bg border-dark-color text-dark-primary",placeholder:"Email address"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"Phone *"}),e.jsx(k,{value:Y.contactPerson.phone,onChange:C=>O({...Y,contactPerson:{...Y.contactPerson,phone:C.target.value}}),className:"bg-dark-bg border-dark-color text-dark-primary",placeholder:"Phone number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"Designation"}),e.jsx(k,{value:Y.contactPerson.designation,onChange:C=>O({...Y,contactPerson:{...Y.contactPerson,designation:C.target.value}}),className:"bg-dark-bg border-dark-color text-dark-primary",placeholder:"Job title"})]})]}),e.jsx("h4",{className:"text-md font-semibold text-dark-primary mt-6",children:"Business Hours"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"Open Time"}),e.jsx(k,{type:"time",value:Y.businessHours.openTime,onChange:C=>O({...Y,businessHours:{...Y.businessHours,openTime:C.target.value}}),className:"bg-dark-bg border-dark-color text-dark-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"Close Time"}),e.jsx(k,{type:"time",value:Y.businessHours.closeTime,onChange:C=>O({...Y,businessHours:{...Y.businessHours,closeTime:C.target.value}}),className:"bg-dark-bg border-dark-color text-dark-primary"})]})]}),e.jsx("h4",{className:"text-md font-semibold text-dark-primary mt-6",children:"Contract Details"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"Contract Number"}),e.jsx(k,{value:Y.contractDetails.contractNumber,onChange:C=>O({...Y,contractDetails:{...Y.contractDetails,contractNumber:C.target.value}}),className:"bg-dark-bg border-dark-color text-dark-primary",placeholder:"Contract number"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"Start Date"}),e.jsx(k,{type:"date",value:Y.contractDetails.startDate,onChange:C=>O({...Y,contractDetails:{...Y.contractDetails,startDate:C.target.value}}),className:"bg-dark-bg border-dark-color text-dark-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"End Date"}),e.jsx(k,{type:"date",value:Y.contractDetails.endDate,onChange:C=>O({...Y,contractDetails:{...Y.contractDetails,endDate:C.target.value}}),className:"bg-dark-bg border-dark-color text-dark-primary"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"Contract Value (₹)"}),e.jsx(k,{type:"number",value:Y.contractDetails.contractValue,onChange:C=>O({...Y,contractDetails:{...Y.contractDetails,contractValue:Number(C.target.value)}}),className:"bg-dark-bg border-dark-color text-dark-primary",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-secondary mb-2",children:"Service Level"}),e.jsx("select",{value:Y.contractDetails.serviceLevel,onChange:C=>O({...Y,contractDetails:{...Y.contractDetails,serviceLevel:C.target.value}}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-color rounded-xl text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:J.map(C=>e.jsx("option",{value:C,children:C},C))})]})]})]})]}),e.jsxs("div",{className:"flex space-x-3 pt-6 mt-6 border-t border-dark-color",children:[e.jsx("button",{onClick:()=>{E(!1),ce()},className:"flex-1 dark-button-secondary",children:"Cancel"}),e.jsx("button",{onClick:d,disabled:!Y.name||!Y.address.street||!Y.contactPerson.name,className:"flex-1 dark-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:"Add Site"})]})]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-dark-bg border-2 border-dark-color rounded-xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-dark-primary",children:"Site Details"}),e.jsx("button",{onClick:()=>x(null),className:"p-2 hover:bg-dark-hover rounded-lg transition-colors",children:e.jsx(Te,{className:"w-5 h-5 text-dark-secondary rotate-45"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Basic Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Site Name"}),e.jsx("p",{className:"text-dark-primary font-semibold",children:v.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Type"}),e.jsxs("div",{className:`dark-tag ${L(v.siteType)} inline-flex items-center gap-1 mt-1`,children:[e.jsx(tt,{className:"w-3 h-3"}),v.siteType]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Status"}),e.jsx("div",{className:`dark-tag ${me(v.status)} inline-flex items-center gap-1 mt-1`,children:v.status})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Address"}),e.jsx("p",{className:"text-dark-primary",children:v.fullAddress})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Contact Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"w-4 h-4 text-dark-secondary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-dark-primary font-medium",children:v.contactPerson.name}),e.jsx("p",{className:"text-sm text-dark-secondary",children:v.contactPerson.designation})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Mt,{className:"w-4 h-4 text-dark-secondary"}),e.jsx("p",{className:"text-dark-primary",children:v.contactPerson.email})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(It,{className:"w-4 h-4 text-dark-secondary"}),e.jsx("p",{className:"text-dark-primary",children:v.contactPerson.phone})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"w-4 h-4 text-dark-secondary"}),e.jsxs("p",{className:"text-dark-primary",children:[v.businessHours.openTime," - ",v.businessHours.closeTime]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Contract Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Contract Number"}),e.jsx("p",{className:"text-dark-primary",children:((D=v.contractDetails)==null?void 0:D.contractNumber)||"Not specified"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Start Date"}),e.jsx("p",{className:"text-dark-primary",children:Q((r=v.contractDetails)==null?void 0:r.startDate)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"End Date"}),e.jsx("p",{className:"text-dark-primary",children:Q((H=v.contractDetails)==null?void 0:H.endDate)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Contract Value"}),e.jsxs("p",{className:"text-dark-primary font-semibold",children:["₹",((be=(ae=v.contractDetails)==null?void 0:ae.contractValue)==null?void 0:be.toLocaleString())||"0"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Service Level"}),e.jsx("p",{className:"text-dark-primary",children:(Z=v.contractDetails)==null?void 0:Z.serviceLevel})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Projector Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-bg rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary mb-1",children:v.totalProjectors||0}),e.jsx("div",{className:"text-sm text-dark-secondary",children:"Total Projectors"})]}),e.jsxs("div",{className:"text-center p-4 bg-dark-bg rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary mb-1",children:v.activeProjectors||0}),e.jsx("div",{className:"text-sm text-dark-secondary",children:"Active Projectors"})]}),e.jsxs("div",{className:"text-center p-4 bg-dark-bg rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary mb-1",children:v.totalAuditoriums||0}),e.jsx("div",{className:"text-sm text-dark-secondary",children:"Total Auditoriums"})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary",children:"Auditorium Management"}),e.jsxs("button",{onClick:()=>_(!V),className:"dark-button-secondary px-4 py-2",children:[V?"Hide":"Show"," Auditoriums"]})]}),V&&e.jsx("div",{className:"bg-dark-card border border-dark-color rounded-lg p-4",children:e.jsx(Di,{siteId:v._id,siteName:v.name,auditoriums:v.auditoriums||[],onAuditoriumUpdate:ee,onProjectorAdd:B})})]})]})]}),e.jsxs("div",{className:"flex space-x-3 pt-6 mt-6 border-t border-dark-color",children:[e.jsx("button",{className:"flex-1 dark-button-secondary",children:"Edit Site"}),e.jsx("button",{onClick:()=>p(v._id),className:"dark-button-secondary px-6",children:"Export Details"})]})]})})]})]})}function Ei(){var B,ce,me,L,Q,D,r,H,ae,be,Z,C;const[s,t]=n.useState(""),[a,l]=n.useState(null),[i,o]=n.useState(null),[h,c]=n.useState(!0),[j,P]=n.useState([]),[v,x]=n.useState(!1),[S,E]=n.useState(!1),[V,_]=n.useState(null),[b,N]=n.useState("checking"),[y,A]=n.useState(!1),[u,$]=n.useState({projectorNumber:"",serialNumber:"",model:"",brand:"",siteId:"",siteName:"",siteCode:"",auditoriumId:"",auditoriumName:"",installDate:"",warrantyEnd:"",status:"Active",condition:"Good",lastService:"",nextService:"",totalServices:0,hoursUsed:0,expectedLife:1e4,position:"",rackPosition:"",customer:"",technician:"",location:""}),[z,re]=n.useState([]),[K,ne]=n.useState([]),[Y,O]=n.useState([]);n.useEffect(()=>{R()},[]);const R=async()=>{try{x(!0),_(null),N("checking"),N("connected"),console.log("Attempting to connect to backend..."),await Promise.all([F(),J()]),E(!0)}catch(f){console.error("Error loading data:",f),N("disconnected"),_(f.message||"Failed to load data. Please check if the Express.js server is running.")}finally{x(!1)}},F=async()=>{try{const f=await ie.getAllProjectors(),he=await ie.getAllServiceReports(),pe=f.map(Pe=>{const W=he.filter($e=>$e.projectorSerial===Pe.serialNumber),ve=W.length,Ce=W.reduce(($e,Ve)=>{const U=parseInt(Ve.projectorRunningHours)||0;return $e+U},0),Ae=W.length>0?new Date(Math.max(...W.map($e=>new Date($e.date).getTime()))):null,Ue=Ae?new Date(Ae.getTime()+90*24*60*60*1e3):null,Fe=Pe.expectedLife?Math.round(Ce/Pe.expectedLife*100):0;return{...Pe,totalServices:ve,hoursUsed:Ce,lastService:Ae,nextService:Ue,lifePercentage:Fe,serviceHistory:W}});P(pe),console.log("Loaded enhanced projectors:",pe.length)}catch(f){console.error("Error loading projectors:",f),_("Failed to load projectors data: "+f.message)}},J=async()=>{try{const f=await ie.getAllSites();re(f),console.log("Loaded sites:",f.length)}catch(f){console.error("Error loading sites:",f),_("Failed to load sites data: "+f.message)}},T=async()=>{if(s.trim())try{x(!0),_(null);const f=await ie.getProjector(s);if(f&&!f.error){try{const he=await ie.getRMAHistoryByProjector(s);f.rmaHistory=he||[]}catch(he){console.error("Error fetching RMA history:",he),f.rmaHistory=[]}try{const he=await ie.getServiceReportsByProjector(s);if(ne(he||[]),he&&he.length>0){const pe=he.length,Pe=he.reduce((Ae,Ue)=>{const Fe=parseInt(Ue.projectorRunningHours)||0;return Ae+Fe},0),W=new Date(Math.max(...he.map(Ae=>new Date(Ae.date).getTime()))),ve=new Date(W.getTime()+90*24*60*60*1e3),Ce=a.expectedLife?Math.round(Pe/a.expectedLife*100):0;l({...a,totalServices:pe,hoursUsed:Pe,lastService:W,nextService:ve,lifePercentage:Ce})}}catch(he){console.error("Error fetching reports:",he),ne([])}try{const he=await ie.getRecommendedSpares({projectorSerial:s});O(he||[])}catch(he){console.error("Error fetching spares:",he),O([])}o(f),l(f),c(!1),console.log("Found projector with RMA history:",f)}else o(null),l(null),ne([]),O([]),_(`No projector found with serial number: ${s}`)}catch(f){console.error("Error searching for projector:",f),o(null),l(null),_(`Search failed: ${f.message}`)}finally{x(!1)}},w=f=>{f.key==="Enter"&&T()},g=f=>{switch(f){case"Active":return"bg-green-600";case"Under Service":return"bg-orange-600";case"Inactive":return"bg-gray-600";case"Needs Repair":return"bg-red-600";default:return"bg-gray-600"}},p=f=>{switch(f){case"Excellent":return"text-green-400";case"Good":return"text-blue-400";case"Fair":return"text-orange-400";case"Needs Repair":return"text-red-400";default:return"text-gray-400"}},M=f=>{switch(f){case"Completed":return"bg-green-600";case"In Progress":return"bg-blue-600";case"Scheduled":return"bg-orange-600";default:return"bg-gray-600"}},m=f=>f?new Date(f).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Not available",d=async()=>{var f;try{x(!0),_(null);const he={...u,installDate:u.installDate?new Date(u.installDate):new Date,warrantyStart:u.warrantyStart?new Date(u.warrantyStart):null,warrantyEnd:u.warrantyEnd?new Date(u.warrantyEnd):null,lastService:u.lastService?new Date(u.lastService):null,nextService:u.nextService?new Date(u.nextService):null};console.log("Creating projector with data:",he),await ie.createProjector(he),A(!1),$({serialNumber:"",model:"",brand:"",siteId:"",site:"",location:"",installDate:"",warrantyStart:"",warrantyEnd:"",status:"Active",condition:"Good",lastService:"",nextService:"",totalServices:0,hoursUsed:0,expectedLife:1e4,customer:"",technician:""}),await F(),(f=window.showToast)==null||f.call(window,{type:"success",title:"Projector Created Successfully",message:`Projector ${he.serialNumber} has been added to the system`})}catch(he){console.error("Error creating projector:",he),_("Failed to create projector: "+he.message)}finally{x(!1)}},X=async()=>{var f;try{x(!0);const he=Ss(j,["serialNumber","model","brand","site","location","status","condition","totalServices","hoursUsed"]);Cs(he,`projectors_report_${new Date().toISOString().split("T")[0]}.csv`),(f=window.showToast)==null||f.call(window,{type:"success",title:"Export Successful",message:"Projectors report exported to CSV file"})}catch(he){console.error("Error exporting report:",he),_("Failed to export projectors report: "+he.message)}finally{x(!1)}},ee=async()=>{var f;try{(f=window.showToast)==null||f.call(window,{type:"info",title:"Order Parts",message:"Parts ordering interface will be available in the next update"})}catch(he){console.error("Error ordering parts:",he),_("Failed to open parts ordering: "+he.message)}};return!S&&v?e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"bg-dark-bg border-b border-dark-color px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-dark-primary",children:"Projector Management"}),e.jsx("p",{className:"text-sm text-dark-secondary mt-1",children:"Connecting to backend server..."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[b==="checking"&&e.jsx(Ie,{className:"w-4 h-4 animate-spin text-blue-400"}),b==="connected"&&e.jsx(Ot,{className:"w-4 h-4 text-green-400"}),b==="disconnected"&&e.jsx(rt,{className:"w-4 h-4 text-red-400"}),e.jsxs("span",{className:"text-sm text-dark-secondary",children:[b==="checking"&&"Connecting...",b==="connected"&&"Connected",b==="disconnected"&&"Disconnected"]})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto p-8 bg-dark-bg",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(sa,{className:"w-16 h-16 text-dark-secondary mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-dark-primary mb-2",children:"Connecting to Backend"}),e.jsx("p",{className:"text-dark-secondary mb-4",children:"Setting up Express.js server and MongoDB database..."}),Ks()&&e.jsxs("div",{className:"text-xs text-dark-secondary",children:[e.jsxs("p",{children:["API URL: ",ie.getBaseUrl()]}),e.jsx("p",{className:"mt-2",children:"Make sure your Express.js server is running:"}),e.jsx("code",{className:"bg-dark-card px-2 py-1 rounded mt-1 inline-block",children:"cd server && npm run dev"})]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"bg-dark-bg border-b border-dark-color px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-dark-primary",children:"Projector Management"}),e.jsx("p",{className:"text-sm text-dark-secondary mt-1",children:"Search by serial number for complete projector details"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[b==="connected"&&e.jsx(Ot,{className:"w-4 h-4 text-green-400"}),b==="disconnected"&&e.jsx(rt,{className:"w-4 h-4 text-red-400"}),e.jsxs("span",{className:"text-sm text-dark-secondary",children:[b==="connected"&&"Connected",b==="disconnected"&&"Disconnected"]})]}),e.jsxs("button",{onClick:()=>{c(!0),o(null),l(null),t(""),_(null),F()},className:"dark-button-secondary gap-2 flex items-center",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Refresh Data"]}),e.jsxs("button",{onClick:async()=>{var f;try{x(!0),await F(),(f=window.showToast)==null||f.call(window,{type:"success",title:"Data Refreshed",message:"Projector data updated from latest service reports"})}catch(he){console.error("Error refreshing data:",he)}finally{x(!1)}},className:"dark-button-secondary gap-2 flex items-center",disabled:v,children:[v?e.jsx(Ie,{className:"w-4 h-4 animate-spin"}):e.jsx(Qe,{className:"w-4 h-4"}),"Sync Reports"]}),e.jsx("button",{onClick:()=>{c(!0),o(null),l(null),t(""),_(null)},className:"dark-button-secondary",children:"View All Projectors"}),e.jsxs("button",{onClick:()=>A(!0),className:"dark-button-primary gap-2 flex items-center",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Add Projector"]})]})]})}),e.jsxs("main",{className:"flex-1 overflow-auto p-8 bg-dark-bg",children:[V&&e.jsx("div",{className:"mb-6 p-4 bg-red-900 bg-opacity-30 rounded-lg border border-red-600",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{className:"w-5 h-5 text-red-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-400",children:V}),b==="disconnected"&&Ks()&&e.jsxs("div",{className:"mt-2 text-xs text-red-300",children:[e.jsx("p",{children:"To fix this issue:"}),e.jsxs("p",{children:["1. Navigate to the server directory: ",e.jsx("code",{className:"bg-red-800 px-1 rounded",children:"cd server"})]}),e.jsxs("p",{children:["2. Install dependencies: ",e.jsx("code",{className:"bg-red-800 px-1 rounded",children:"npm install"})]}),e.jsxs("p",{children:["3. Start the server: ",e.jsx("code",{className:"bg-red-800 px-1 rounded",children:"npm run dev"})]})]})]})]})}),b==="disconnected"&&e.jsx("div",{className:"mb-6 p-4 bg-yellow-900 bg-opacity-30 rounded-lg border border-yellow-600",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rt,{className:"w-5 h-5 text-yellow-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-400",children:"Backend server not available"}),e.jsx("p",{className:"text-xs text-yellow-300 mt-1",children:"The projector data will not be available until the server is running."})]}),e.jsx("button",{onClick:R,className:"ml-auto dark-button-secondary text-sm px-3 py-1",children:"Retry Connection"})]})}),e.jsx("div",{className:"mb-6 p-4 bg-blue-900 bg-opacity-30 border border-blue-600 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Oe,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-400",children:"Automatic Data Population"}),e.jsx("p",{className:"text-sm text-blue-200",children:"Projector hours, service counts, and service dates are automatically calculated from completed service reports. No manual entry required - data syncs automatically when FSE engineers submit reports."})]})]})}),e.jsxs("div",{className:"dark-card mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-dark-primary mb-2",children:"Projector Serial Number Lookup"}),e.jsx("p",{className:"text-dark-secondary",children:"Enter a projector serial number to view complete details, service history, and RMA information"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${b==="connected"?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-sm text-dark-secondary",children:"MongoDB + Express.js"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(vs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-dark-secondary w-5 h-5"}),e.jsx(k,{placeholder:"Enter projector serial number...",value:s,onChange:f=>t(f.target.value),onKeyPress:w,className:"pl-12 h-12 bg-dark-card border-dark-color text-dark-primary text-base",disabled:v||b==="disconnected"})]}),e.jsxs("button",{onClick:T,disabled:v||!s.trim()||b==="disconnected",className:"dark-button-primary h-12 px-6 gap-2 flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:[v?e.jsx(Ie,{className:"w-5 h-5 animate-spin"}):e.jsx(vs,{className:"w-5 h-5"}),"Search"]})]})]}),a&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 dark-card",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-primary mb-2",children:a.model}),e.jsxs("p",{className:"text-dark-secondary",children:["Serial: ",a.serialNumber]})]}),e.jsx("div",{className:`dark-tag ${g(a.status)}`,children:a.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Brand"}),e.jsx("p",{className:"text-dark-primary font-semibold",children:a.brand})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Site Location"}),e.jsxs("p",{className:"text-dark-primary flex items-center gap-2",children:[e.jsx(ds,{className:"w-4 h-4 text-dark-secondary"}),a.site]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Specific Location"}),e.jsx("p",{className:"text-dark-primary",children:a.location})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Customer"}),e.jsx("p",{className:"text-dark-primary",children:a.customer})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Install Date"}),e.jsxs("p",{className:"text-dark-primary flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-dark-secondary"}),m(a.installDate)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Warranty Start"}),e.jsxs("p",{className:"text-dark-primary flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-dark-secondary"}),a.warrantyStart?m(a.warrantyStart):(B=a.amcContract)!=null&&B.contractStartDate?m(a.amcContract.contractStartDate):"Not specified"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Warranty End"}),e.jsxs("p",{className:"text-dark-primary flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-dark-secondary"}),m(a.warrantyEnd)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Condition"}),e.jsx("p",{className:`font-semibold ${p(a.condition)}`,children:a.condition})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Primary Technician"}),e.jsxs("p",{className:"text-dark-primary flex items-center gap-2",children:[e.jsx(as,{className:"w-4 h-4 text-dark-secondary"}),a.technician]})]})]})]})]}),a.amcContract&&e.jsxs("div",{className:"dark-card",children:[e.jsxs("h3",{className:"text-lg font-bold text-dark-primary mb-4 flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5"}),"AMC Contract Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Contract Number"}),e.jsx("p",{className:"text-dark-primary font-semibold",children:a.amcContract.contractNumber})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Contract Status"}),e.jsx("div",{className:`dark-tag ${a.amcContract.status==="Active"?"bg-green-600":a.amcContract.status==="Expired"?"bg-red-600":"bg-yellow-600"}`,children:a.amcContract.status})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Contract Value"}),e.jsxs("p",{className:"text-dark-primary font-semibold",children:["₹",((ce=a.amcContract.contractValue)==null?void 0:ce.toLocaleString())||"0"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Contract Start"}),e.jsxs("p",{className:"text-dark-primary flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-dark-secondary"}),m(a.amcContract.contractStartDate)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Contract End"}),e.jsxs("p",{className:"text-dark-primary flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-dark-secondary"}),m(a.amcContract.contractEndDate)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Contract Manager"}),e.jsxs("p",{className:"text-dark-primary flex items-center gap-2",children:[e.jsx(as,{className:"w-4 h-4 text-dark-secondary"}),a.amcContract.contractManager]})]})]})]})]}),e.jsxs("div",{className:"dark-card",children:[e.jsx("h3",{className:"text-lg font-bold text-dark-primary mb-4",children:"Usage Statistics"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-bg rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary mb-1",children:((me=a.hoursUsed)==null?void 0:me.toLocaleString())||"0"}),e.jsx("div",{className:"text-sm text-dark-secondary",children:"Hours Used (from Reports)"})]}),e.jsxs("div",{className:"text-center p-4 bg-dark-bg rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary mb-1",children:a.totalServices||0}),e.jsx("div",{className:"text-sm text-dark-secondary",children:"Total Services (from Reports)"})]}),e.jsxs("div",{className:"text-center p-4 bg-dark-bg rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-dark-primary mb-1",children:[a.lifePercentage||0,"%"]}),e.jsx("div",{className:"text-sm text-dark-secondary",children:"Life Used (Calculated)"})]}),e.jsxs("div",{className:"text-center p-4 bg-dark-bg rounded-lg",children:[e.jsx("div",{className:"text-sm text-dark-secondary mb-1",children:"Next Service"}),e.jsx("div",{className:"font-semibold text-dark-primary",children:m(a.nextService)})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-900 bg-opacity-30 border border-blue-600 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-blue-300",children:"Data Source: Service Reports"})]}),e.jsx("p",{className:"text-xs text-blue-200 mt-1",children:"Hours and service counts are automatically calculated from completed service reports"})]})]})]}),e.jsxs("div",{className:"dark-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-dark-primary flex items-center gap-2",children:[e.jsx(va,{className:"w-5 h-5"}),"Service History (",((L=a.serviceHistory)==null?void 0:L.length)||0," services)"]}),e.jsx("button",{className:"dark-button-secondary text-sm px-4 py-2",children:"View All Services"})]}),a.serviceHistory&&a.serviceHistory.length>0?e.jsx("div",{className:"space-y-4",children:a.serviceHistory.map((f,he)=>{var pe,Pe,W;return e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-color",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-dark-primary",children:f.reportType||"Service Report"}),e.jsx("div",{className:`dark-tag ${M(f.status||"Completed")}`,children:f.status||"Completed"}),he===0&&e.jsx("div",{className:"dark-tag bg-blue-600",children:"Latest"}),he===1&&e.jsx("div",{className:"dark-tag bg-purple-600",children:"2nd Service"}),he===2&&e.jsx("div",{className:"dark-tag bg-orange-600",children:"1st Service"})]}),e.jsx("p",{className:"text-sm text-dark-secondary",children:f.observations&&f.observations.length>0&&((pe=f.observations[0])==null?void 0:pe.description)||"Service completed"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-dark-primary",children:m(f.date)}),e.jsx("p",{className:"text-xs text-dark-secondary",children:((Pe=f.engineer)==null?void 0:Pe.name)||"FSE Engineer"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Report #:"}),e.jsx("p",{className:"text-dark-primary font-medium",children:f.reportNumber})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Running Hours:"}),e.jsx("p",{className:"text-dark-primary font-medium",children:f.projectorRunningHours||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Site:"}),e.jsx("p",{className:"text-dark-primary font-medium",children:f.siteName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Engineer:"}),e.jsx("p",{className:"text-dark-primary font-medium",children:((W=f.engineer)==null?void 0:W.name)||"Not specified"})]})]})]},f._id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(va,{className:"w-12 h-12 text-dark-secondary mx-auto mb-4"}),e.jsx("p",{className:"text-dark-secondary",children:"No service history found"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"dark-card",children:[e.jsxs("h3",{className:"text-xl font-bold text-dark-primary flex items-center gap-2 mb-6",children:[e.jsx(Oe,{className:"w-5 h-5"}),"Recent Service Report"]}),K.length>0?e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-color",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-sm text-dark-secondary",children:"Visit"}),e.jsx("div",{className:"text-sm font-medium text-dark-primary",children:K[0].visitId})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Engineer:"}),e.jsx("p",{className:"text-dark-primary font-medium",children:((Q=K[0].engineer)==null?void 0:Q.name)||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Date:"}),e.jsx("p",{className:"text-dark-primary font-medium",children:m(K[0].date)})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"text-dark-secondary text-sm",children:"Image Evaluation"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 mt-2 text-xs",children:Object.entries(((D=K[0].sections)==null?void 0:D.imageEvaluation)||{}).map(([f,he])=>e.jsx("div",{className:`dark-tag ${he?"bg-green-600":"bg-gray-600"}`,children:f},f))})]}),((H=(r=K[0].sections)==null?void 0:r.observations)==null?void 0:H.length)>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"text-dark-secondary text-sm",children:"Observations"}),e.jsx("ul",{className:"list-disc pl-5 text-sm text-dark-primary mt-1",children:K[0].sections.observations.filter(Boolean).slice(0,4).map((f,he)=>e.jsx("li",{children:f},he))})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{className:"dark-button-secondary text-sm",onClick:()=>{const f=K[0]._id;window.location.hash=`#/service-reports/${f}?readonly=1`},children:"View full report"})})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Oe,{className:"w-12 h-12 text-dark-secondary mx-auto mb-4"}),e.jsx("p",{className:"text-dark-secondary",children:"No service report found"})]})]}),e.jsxs("div",{className:"dark-card",children:[e.jsxs("h3",{className:"text-xl font-bold text-dark-primary flex items-center gap-2 mb-6",children:[e.jsx(Je,{className:"w-5 h-5"}),"Recommended Spares (",Y.length,")"]}),Y.length>0?e.jsx("div",{className:"space-y-3",children:Y.slice(0,5).map(f=>e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-color",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-dark-primary font-semibold",children:f.partName}),e.jsx("p",{className:"text-sm text-dark-secondary",children:f.partNumber})]}),e.jsx("div",{className:`dark-tag ${f.status==="Approved"?"bg-green-600":f.status==="Ordered"?"bg-blue-600":"bg-yellow-600"}`,children:f.status})]}),f.notes&&e.jsx("p",{className:"text-sm text-dark-secondary mt-2",children:f.notes})]},f._id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Je,{className:"w-12 h-12 text-dark-secondary mx-auto mb-4"}),e.jsx("p",{className:"text-dark-secondary",children:"No recommended spares yet"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"dark-card",children:[e.jsxs("h3",{className:"text-xl font-bold text-dark-primary flex items-center gap-2 mb-6",children:[e.jsx(ms,{className:"w-5 h-5"}),"RMA History (",((ae=a.rmaHistory)==null?void 0:ae.length)||0,")"]}),a.rmaHistory&&a.rmaHistory.length>0?e.jsx("div",{className:"space-y-4",children:a.rmaHistory.map((f,he)=>{var pe;return e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-color",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-primary",children:f.partName}),e.jsx("p",{className:"text-sm text-dark-secondary",children:f.partNumber})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`dark-tag ${f.status==="Under Review"?"bg-yellow-600":"bg-green-600"}`,children:f.status}),e.jsx("p",{className:"text-xs text-dark-secondary mt-1",children:m(f.issueDate)})]})]}),e.jsx("p",{className:"text-sm text-dark-secondary mb-2",children:f.reason}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-dark-secondary",children:["RMA #: ",f.rmaNumber]}),e.jsxs("span",{className:"text-sm font-medium text-dark-primary",children:["₹",(pe=f.estimatedCost)==null?void 0:pe.toLocaleString()]})]})]},f._id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ms,{className:"w-12 h-12 text-dark-secondary mx-auto mb-4"}),e.jsx("p",{className:"text-dark-secondary",children:"No RMA history found"})]})]}),e.jsxs("div",{className:"dark-card",children:[e.jsxs("h3",{className:"text-xl font-bold text-dark-primary flex items-center gap-2 mb-6",children:[e.jsx(Je,{className:"w-5 h-5"}),"Associated Spare Parts (",((be=a.spareParts)==null?void 0:be.length)||0,")"]}),a.spareParts&&a.spareParts.length>0?e.jsx("div",{className:"space-y-4",children:a.spareParts.map((f,he)=>{var pe;return e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-color",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-primary",children:f.partName}),e.jsx("p",{className:"text-sm text-dark-secondary",children:f.partNumber})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-sm font-medium text-dark-primary",children:["₹",(pe=f.unitPrice)==null?void 0:pe.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-dark-secondary",children:["Stock: ",f.stockQuantity]})]})]}),e.jsxs("div",{className:"text-sm text-dark-secondary",children:["Last Updated: ",m(f.updatedAt)]})]},f._id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Je,{className:"w-12 h-12 text-dark-secondary mx-auto mb-4"}),e.jsx("p",{className:"text-dark-secondary",children:"No spare parts found"})]})]})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("button",{className:"dark-button-primary gap-2 flex items-center",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Schedule Service"]}),e.jsxs("button",{className:"dark-button-secondary gap-2 flex items-center",children:[e.jsx(rs,{className:"w-4 h-4"}),"Update Status"]}),e.jsxs("button",{onClick:ee,className:"dark-button-secondary gap-2 flex items-center",children:[e.jsx(Je,{className:"w-4 h-4"}),"Order Parts"]}),e.jsxs("button",{onClick:X,disabled:v,className:"dark-button-secondary gap-2 flex items-center",children:[e.jsx(We,{className:"w-4 h-4"}),"Export Report"]})]})]}),h&&!a&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-dark-primary",children:"All Projectors"}),e.jsxs("p",{className:"text-dark-secondary",children:[j.length," projectors in system"]})]}),v?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ie,{className:"w-12 h-12 text-dark-secondary mx-auto mb-4 animate-spin"}),e.jsx("p",{className:"text-dark-secondary",children:"Loading projectors..."})]}):j.length>0?e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:j.map((f,he)=>e.jsxs("div",{className:"dark-card hover:dark-shadow-lg transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-dark-primary mb-1",children:f.model}),e.jsx("p",{className:"text-sm text-dark-secondary",children:f.serialNumber})]}),e.jsx("div",{className:`dark-tag ${g(f.status)}`,children:f.status})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(ds,{className:"w-4 h-4 text-dark-secondary"}),e.jsx("span",{className:"text-dark-primary",children:f.site})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(ss,{className:"w-4 h-4 text-dark-secondary"}),e.jsx("span",{className:"text-dark-primary",children:f.location})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(ts,{className:"w-4 h-4 text-dark-secondary"}),e.jsxs("span",{className:"text-dark-primary",children:["Last Service: ",m(f.lastService)]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center mb-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-dark-primary",children:f.totalServices||0}),e.jsx("div",{className:"text-xs text-dark-secondary",children:"Services"}),e.jsx("div",{className:"text-xs text-green-400",children:"From Reports"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-dark-primary",children:f.hoursUsed||0}),e.jsx("div",{className:"text-xs text-dark-secondary",children:"Hours"}),e.jsx("div",{className:"text-xs text-green-400",children:"From Reports"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-dark-primary",children:[f.lifePercentage||0,"%"]}),e.jsx("div",{className:"text-xs text-dark-secondary",children:"Life Used"}),e.jsx("div",{className:"text-xs text-green-400",children:"Calculated"})]})]}),e.jsx("button",{onClick:async()=>{l(f),c(!1),t(f.serialNumber),_(null);try{const pe=await ie.getProjector(f.serialNumber);if(pe&&!pe.error){const Pe=await ie.getServiceReportsByProjector(f.serialNumber);if(Pe&&Pe.length>0){const W=Pe.length,ve=Pe.reduce((Fe,$e)=>{const Ve=parseInt($e.projectorRunningHours)||0;return Fe+Ve},0),Ce=new Date(Math.max(...Pe.map(Fe=>new Date(Fe.date).getTime()))),Ae=new Date(Ce.getTime()+90*24*60*60*1e3),Ue=pe.expectedLife?Math.round(ve/pe.expectedLife*100):0;l({...pe,totalServices:W,hoursUsed:ve,lastService:Ce,nextService:Ae,lifePercentage:Ue,serviceHistory:Pe})}else l(pe)}}catch(pe){console.error("Error loading projector details:",pe)}},className:"w-full dark-button-primary text-sm py-2",disabled:b==="disconnected",children:"View Details"})]},f.serialNumber))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ss,{className:"w-16 h-16 text-dark-secondary mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-dark-primary mb-2",children:"No Projectors Found"}),e.jsx("p",{className:"text-dark-secondary",children:b==="disconnected"?"Connect to the backend server to view projectors.":"No projectors have been added to the system yet."})]})]}),y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-dark-bg border-2 border-dark-color rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-dark-primary",children:"Add New Projector"}),e.jsx("p",{className:"text-sm text-dark-secondary mt-1",children:"Service data (hours, services, dates) will be auto-populated from FSE reports"})]}),e.jsx("button",{onClick:()=>A(!1),className:"p-2 hover:bg-dark-hover rounded-lg transition-colors",children:e.jsx(Ke,{className:"w-5 h-5 text-dark-secondary"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Serial Number *"}),e.jsx(k,{value:u.serialNumber,onChange:f=>$({...u,serialNumber:f.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter serial number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Model *"}),e.jsx(k,{value:u.model,onChange:f=>$({...u,model:f.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"e.g., Epson EB-2250U"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Brand *"}),e.jsx(k,{value:u.brand,onChange:f=>$({...u,brand:f.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"e.g., Epson"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Site *"}),e.jsxs("select",{value:u.siteId,onChange:f=>{const he=z.find(pe=>pe._id===f.target.value);$({...u,siteId:f.target.value,siteName:he?he.name:"",siteCode:he?he.siteCode:""})},className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"",children:"Select a site"}),z.map(f=>e.jsx("option",{value:f._id,children:f.name},f._id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Auditorium *"}),e.jsxs("select",{value:u.auditoriumId,onChange:f=>{var Pe;const he=z.find(W=>W._id===u.siteId),pe=(Pe=he==null?void 0:he.auditoriums)==null?void 0:Pe.find(W=>W.audiNumber===f.target.value);$({...u,auditoriumId:f.target.value,auditoriumName:pe?pe.name:""})},className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",disabled:!u.siteId,children:[e.jsx("option",{value:"",children:"Select an auditorium"}),u.siteId&&((C=(Z=z.find(f=>f._id===u.siteId))==null?void 0:Z.auditoriums)==null?void 0:C.map(f=>e.jsxs("option",{value:f.audiNumber,children:[f.name," (",f.audiNumber,")"]},f.audiNumber)))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Status"}),e.jsxs("select",{value:u.status,onChange:f=>$({...u,status:f.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Under Service",children:"Under Service"}),e.jsx("option",{value:"Retired",children:"Retired"}),e.jsx("option",{value:"Maintenance",children:"Maintenance"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Install Date"}),e.jsx(k,{type:"date",value:u.installDate,onChange:f=>$({...u,installDate:f.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Position"}),e.jsx(k,{value:u.position,onChange:f=>$({...u,position:f.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"e.g., Front Left, Center"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Warranty End Date"}),e.jsx(k,{type:"date",value:u.warrantyEnd,onChange:f=>$({...u,warrantyEnd:f.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Condition"}),e.jsxs("select",{value:u.condition,onChange:f=>$({...u,condition:f.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"Excellent",children:"Excellent"}),e.jsx("option",{value:"Good",children:"Good"}),e.jsx("option",{value:"Fair",children:"Fair"}),e.jsx("option",{value:"Needs Repair",children:"Needs Repair"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Expected Life (hours)"}),e.jsx(k,{type:"number",value:u.expectedLife,onChange:f=>$({...u,expectedLife:Number(f.target.value)}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"10000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Hours Used"}),e.jsx(k,{type:"number",value:u.hoursUsed,onChange:f=>$({...u,hoursUsed:Number(f.target.value)}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"0",disabled:!0}),e.jsx("p",{className:"text-xs text-dark-secondary mt-1",children:"Auto-populated from service reports"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Total Services"}),e.jsx(k,{type:"number",value:u.totalServices,onChange:f=>$({...u,totalServices:Number(f.target.value)}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"0",disabled:!0}),e.jsx("p",{className:"text-xs text-dark-secondary mt-1",children:"Auto-populated from service reports"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Customer"}),e.jsx(k,{value:u.customer,onChange:f=>$({...u,customer:f.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Customer name"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Technician"}),e.jsx(k,{value:u.technician,onChange:f=>$({...u,technician:f.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Technician name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Last Service Date"}),e.jsx(k,{type:"date",value:u.lastService,onChange:f=>$({...u,lastService:f.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",disabled:!0}),e.jsx("p",{className:"text-xs text-dark-secondary mt-1",children:"Auto-populated from service reports"})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Next Service Date"}),e.jsx(k,{type:"date",value:u.nextService,onChange:f=>$({...u,nextService:f.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",disabled:!0}),e.jsx("p",{className:"text-xs text-dark-secondary mt-1",children:"Auto-calculated from last service"})]})})]}),e.jsxs("div",{className:"flex space-x-3 mt-6 pt-6 border-t border-dark-color",children:[e.jsx("button",{onClick:()=>A(!1),className:"flex-1 dark-button-secondary",children:"Cancel"}),e.jsx("button",{onClick:d,disabled:v||!u.serialNumber||!u.model||!u.brand||!u.siteId||!u.location,className:"flex-1 dark-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:v?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4 animate-spin mr-2"}),"Creating..."]}):"Create Projector"})]})]})})]})]})}var Ti="Label",Ar=n.forwardRef((s,t)=>e.jsx(qe.label,{...s,ref:t,onMouseDown:a=>{var i;a.target.closest("button, input, select, textarea")||((i=s.onMouseDown)==null||i.call(s,a),!a.defaultPrevented&&a.detail>1&&a.preventDefault())}}));Ar.displayName=Ti;var Mi=Ar;function le({className:s,...t}){return e.jsx(Mi,{"data-slot":"label",className:Le("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...t})}function Ta({onClose:s,onPOCreated:t,editMode:a=!1,existingPO:l,onPOUpdated:i}){const[o,h]=n.useState([]),[c,j]=n.useState([]),[P,v]=n.useState(null),[x,S]=n.useState([]),[E,V]=n.useState(!1),[_,b]=n.useState(!0),[N,y]=n.useState(null),[A,u]=n.useState({customer:"",customerSite:"",siteId:"",projectors:[],totalAmount:0,status:"Pending",priority:"Medium",dateRaised:new Date().toISOString().split("T")[0],expectedDelivery:new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0],description:"AMC Warranty Contract",customerContact:{name:"",phone:"",email:""}});n.useEffect(()=>{$()},[]),n.useEffect(()=>{var R,F,J,T,w,g;if(a&&l){console.log("Initializing edit mode with PO:",l);const p=o.find(M=>M.name===l.customerSite||l.site);if(p){v(p),u({customer:l.customer||"",customerSite:l.customerSite||l.site||"",siteId:p._id,projectors:l.projectors||l.lineItems||[],totalAmount:l.totalAmount||0,status:l.status||"Pending",priority:l.priority||"Medium",dateRaised:l.dateRaised?new Date(l.dateRaised).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],expectedDelivery:l.expectedDelivery?new Date(l.expectedDelivery).toISOString().split("T")[0]:new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0],description:l.description||"AMC Warranty Contract",customerContact:{name:((R=l.customerContact)==null?void 0:R.name)||((F=l.contact)==null?void 0:F.name)||"",phone:((J=l.customerContact)==null?void 0:J.phone)||((T=l.contact)==null?void 0:T.phone)||"",email:((w=l.customerContact)==null?void 0:w.email)||((g=l.contact)==null?void 0:g.email)||""}});const M=(l.projectors||l.lineItems||[]).map(m=>m.serialNumber||m.partNumber||m.model);S(M)}}},[a,l,o]),n.useEffect(()=>{P&&(z(P.name),u(R=>{var F;return{...R,customerSite:P.name,siteId:P._id,customer:((F=P.contactPerson)==null?void 0:F.name)||P.name}}))},[P]),n.useEffect(()=>{if(x.length>0){const R=x.length*1e4;u(F=>({...F,totalAmount:R,projectors:x.map(J=>{const T=c.find(w=>w.serialNumber===J);return{serialNumber:J,model:(T==null?void 0:T.model)||"",location:(T==null?void 0:T.location)||"",service:"AMC Warranty"}})}))}else u(R=>({...R,totalAmount:0,projectors:[]}))},[x,c]);const $=async()=>{try{b(!0),console.log("Loading sites...");const R=await ie.getAllSites();console.log("Sites loaded:",R),h(R)}catch(R){console.error("Error loading sites:",R),y("Failed to load sites: "+R.message)}finally{b(!1)}},z=async R=>{try{V(!0);const J=(await ie.getAllProjectors()).filter(T=>T.site===R);j(J)}catch(F){y("Failed to load projectors: "+F.message)}finally{V(!1)}},re=R=>{S(F=>F.includes(R)?F.filter(J=>J!==R):[...F,R])},K=()=>{x.length===c.length?S([]):S(c.map(R=>R.serialNumber))},ne=async()=>{try{if(x.length===0){y("Please select at least one projector");return}V(!0),y(null);const R={...A,poNumber:a?l.poNumber||l.id:`PO-${Date.now()}`,dateRaised:new Date(A.dateRaised),expectedDelivery:new Date(A.expectedDelivery),lineItems:A.projectors.map(J=>({description:`AMC Warranty Contract for ${J.model}`,quantity:1,unitPrice:1e4,total:1e4,partNumber:J.serialNumber,serviceType:"AMC Warranty"})),subtotal:A.totalAmount,taxRate:0,taxAmount:0,discount:0,totalAmount:A.totalAmount};console.log("Sending PO data:",R);let F;a&&l?(F=await ie.updatePurchaseOrder(l._id||l.id,R),console.log("PO updated:",F),i&&i(F)):(F=await ie.createPurchaseOrder(R),console.log("PO created:",F),await Y(F),t&&t(F)),s()}catch(R){console.error("PO operation error:",R);let F=a?"Failed to update PO":"Failed to create PO";if(R.message&&(F+=": "+R.message),R.response)try{const J=await R.response.json();J.error&&(F+=": "+J.error),J.details&&(F+=" - "+J.details)}catch{}y(F)}finally{V(!1)}},Y=async R=>{try{console.log("Creating AMC contracts for PO:",R);for(const F of x){const J=c.find(T=>T.serialNumber===F);if(J){const T={contractNumber:`AMC-${Date.now()}-${F}`,customerName:R.customer,customerSite:R.customerSite,projector:J._id,site:R.siteId,projectorSerial:F,projectorModel:J.model,projectorBrand:J.brand,siteName:R.customerSite,contractStartDate:new Date(R.dateRaised),contractEndDate:new Date(new Date(R.dateRaised).getTime()+31536e6),contractDuration:12,contractValue:1e4,paymentStatus:"Pending",contractManager:"System",assignedFSE:{fseId:"",fseName:""}};console.log("Creating AMC contract:",T);const w=await ie.createAMCContract(T);console.log("AMC contract created:",w)}}}catch(F){console.error("Error creating AMC contracts:",F)}},O=R=>R.amcContractId?{status:"AMC Active",color:"bg-green-100 text-green-800"}:R.warrantyEnd&&new Date(R.warrantyEnd)>new Date?{status:"Under Warranty",color:"bg-blue-100 text-blue-800"}:{status:"No Coverage",color:"bg-gray-100 text-gray-800"};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs(te,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(de,{className:"text-2xl font-bold",children:a?"Edit Smart PO":"Smart PO Creation"}),e.jsx(Re,{children:a?"Update existing PO with new details":"Create PO with automatic projector selection and AMC contract generation"})]}),e.jsx(q,{variant:"ghost",size:"sm",onClick:s,children:e.jsx(Ke,{className:"w-4 h-4"})})]}),e.jsxs(se,{className:"space-y-6",children:[N&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{children:N})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(le,{className:"text-sm font-medium",children:"Select Site"}),e.jsxs("div",{className:"relative",children:[e.jsx(As,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),o.length===0?e.jsx("div",{className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500",children:_?"Loading sites...":"No sites available"}):e.jsxs("select",{value:(P==null?void 0:P._id)||"",onChange:R=>{const F=o.find(J=>J._id===R.target.value);v(F||null),S([])},className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Choose a site..."}),o.map(R=>{var F;return e.jsxs("option",{value:R._id,children:[R.name," - ",R.address.city,", ",R.address.state,(F=R.contactPerson)!=null&&F.name?` (${R.contactPerson.name})`:""]},R._id)})]})]}),o.length===0&&!_&&e.jsx("p",{className:"text-sm text-gray-500",children:"No sites found. Please check if the server is running and sites are available."})]}),P&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(le,{className:"text-sm font-medium",children:["Projectors at ",P.name]}),e.jsx(q,{variant:"outline",size:"sm",onClick:K,className:"text-xs",children:x.length===c.length?"Deselect All":"Select All"})]}),E?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Ie,{className:"w-6 h-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading projectors..."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-60 overflow-y-auto border border-gray-200 rounded-lg p-4",children:c.map(R=>{const F=O(R),J=x.includes(R.serialNumber);return e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${J?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>re(R.serialNumber),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:J,onChange:()=>re(R.serialNumber),className:"mt-1"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ss,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-sm truncate",children:R.model})]}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("p",{children:["Serial: ",R.serialNumber]}),e.jsxs("p",{children:["Location: ",R.location]}),e.jsxs("p",{children:["Brand: ",R.brand]})]}),e.jsx(ge,{className:`mt-2 text-xs ${F.color}`,children:F.status})]})]})},R._id)})}),c.length===0&&!E&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ss,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No projectors found at this site"})]})]}),x.length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Va,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-blue-900",children:"PO Summary"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Selected Projectors:"}),e.jsx("p",{className:"font-semibold text-blue-900",children:x.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Per Projector Rate:"}),e.jsx("p",{className:"font-semibold text-blue-900",children:"₹10,000"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Total Amount:"}),e.jsxs("p",{className:"font-semibold text-blue-900",children:["₹",A.totalAmount.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Contract Period:"}),e.jsx("p",{className:"font-semibold text-blue-900",children:"1 Year"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{className:"text-sm font-medium",children:"Contact Name"}),e.jsx(k,{value:A.customerContact.name,onChange:R=>u(F=>({...F,customerContact:{...F.customerContact,name:R.target.value}})),placeholder:"Contact person name",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-sm font-medium"}),e.jsx(k,{value:A.customerContact.phone,onChange:R=>u(F=>({...F,customerContact:{...F.customerContact,phone:R.target.value}})),placeholder:" number",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-sm font-medium",children:"Email"}),e.jsx(k,{value:A.customerContact.email,onChange:R=>u(F=>({...F,customerContact:{...F.customerContact,email:R.target.value}})),placeholder:"Email address",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-sm font-medium",children:"Date Raised"}),e.jsx(k,{type:"date",value:A.dateRaised,onChange:R=>u(F=>({...F,dateRaised:R.target.value})),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-sm font-medium",children:"Expected Delivery"}),e.jsx(k,{type:"date",value:A.expectedDelivery,onChange:R=>u(F=>({...F,expectedDelivery:R.target.value})),className:"mt-1"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{className:"text-sm font-medium",children:"Description"}),e.jsx(k,{value:A.description,onChange:R=>u(F=>({...F,description:R.target.value})),placeholder:"PO description or special requirements",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-sm font-medium",children:"Status"}),e.jsxs("select",{value:A.status,onChange:R=>u(F=>({...F,status:R.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"Draft",children:"Draft"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Rejected",children:"Rejected"}),e.jsx("option",{value:"Cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-sm font-medium",children:"Priority"}),e.jsxs("select",{value:A.priority,onChange:R=>u(F=>({...F,priority:R.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"Low",children:"Low"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"High",children:"High"}),e.jsx("option",{value:"Critical",children:"Critical"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t",children:[e.jsx(q,{variant:"outline",onClick:s,disabled:E,children:"Cancel"}),e.jsx(q,{onClick:ne,disabled:E||x.length===0,className:"bg-blue-600 hover:bg-blue-700",children:E?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4 mr-2 animate-spin"}),a?"Updating PO...":"Creating PO..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),a?"Update PO":"Create PO & AMC Contracts"]})})]})]})]})})}function Ii(){const{sites:s,projectors:t}=Us(),[a,l]=n.useState(""),[i,o]=n.useState("All"),[h,c]=n.useState(!1),[j,P]=n.useState(!1),[v,x]=n.useState(!1),[S,E]=n.useState(null),[V,_]=n.useState(null),[b,N]=n.useState(!1),[y,A]=n.useState(null),[u,$]=n.useState([]),[z,re]=n.useState(null),[K,ne]=n.useState({id:"",customer:"",site:"",siteId:"",projectors:[],priority:"Medium",status:"Pending",totalAmount:0,dateRaised:"",expectedService:"",description:"",contact:{name:"",phone:"",email:""}}),Y=async()=>{try{N(!0);const d=await ie.getAllPurchaseOrders();$(d)}catch(d){console.error("Error loading purchase orders:",d),$([])}finally{N(!1)}};n.useEffect(()=>{Y()},[]);const O=d=>{const X=s.find(ee=>ee._id===d);if(X){re(X);const ee=t.filter(B=>B.site===X.name);ne({...K,siteId:X._id,site:X.name,customer:X.customer||X.name,projectors:ee,contact:{name:String(X.contactPerson||""),phone:String(X.contactPhone||""),email:String(X.contactEmail||"")}})}},R=d=>{_(d),x(!0)},F=d=>{var X;$(ee=>ee.map(B=>B._id===d._id||B.id===d.id?d:B)),(X=window.showToast)==null||X.call(window,{type:"success",title:"PO Updated",message:`PO ${d.poNumber||d.id} updated successfully`}),x(!1),_(null)},J=u.filter(d=>{const X=d.id.toLowerCase().includes(a.toLowerCase())||d.customer.toLowerCase().includes(a.toLowerCase()),ee=i==="All"||d.status===i;return X&&ee}),T=d=>{switch(d){case"Approved":return"bg-green-600";case"Pending":return"bg-orange-600";case"In Progress":return"bg-blue-600";case"Completed":return"bg-gray-600";case"Rejected":return"bg-red-600";default:return"bg-gray-600"}},w=d=>{switch(d){case"High":return"text-red-400";case"Medium":return"text-orange-400";case"Low":return"text-green-400";default:return"text-gray-400"}},g=d=>{switch(d){case"Approved":return e.jsx(Be,{className:"w-4 h-4"});case"Pending":return e.jsx(ts,{className:"w-4 h-4"});case"In Progress":return e.jsx(Te,{className:"w-4 h-4"});case"Completed":return e.jsx(Be,{className:"w-4 h-4"});case"Rejected":return e.jsx(dt,{className:"w-4 h-4"});default:return e.jsx(ts,{className:"w-4 h-4"})}},p=async()=>{var d;try{N(!0),A(null);const X={...K,id:K.id||`PO-${Date.now()}`,dateRaised:K.dateRaised||new Date().toISOString().split("T")[0]};await ie.createPurchaseOrder(X),c(!1),ne({id:"",customer:"",site:"",siteId:"",projectors:[],priority:"Medium",status:"Pending",totalAmount:0,dateRaised:"",expectedService:"",description:"",contact:{name:"",phone:"",email:""}}),await Y(),(d=window.showToast)==null||d.call(window,{type:"success",title:"Purchase Order Created",message:`PO ${X.id} has been created successfully`})}catch(X){console.error("Error creating PO:",X),A("Failed to create purchase order: "+X.message)}finally{N(!1)}},M=async()=>{var d;try{N(!0);const X=Ss(u,["id","customer","site","status","priority","totalAmount","dateRaised","expectedService"]);Cs(X,`purchase_orders_${new Date().toISOString().split("T")[0]}.csv`),(d=window.showToast)==null||d.call(window,{type:"success",title:"Export Successful",message:"Purchase orders exported to CSV file"})}catch(X){console.error("Error exporting POs:",X),A("Failed to export purchase orders: "+X.message)}finally{N(!1)}},m=async d=>{var X;try{const ee=u.find(ce=>ce.id===d);if(!ee){A("Purchase order not found");return}const B=await zn(ee,"Purchase Order");Bn(B,`PO_${d}.pdf`),(X=window.showToast)==null||X.call(window,{type:"success",title:"PDF Downloaded",message:`Purchase order ${d} PDF downloaded successfully`})}catch(ee){console.error("Error downloading PDF:",ee),A("Failed to download PDF: "+ee.message)}};return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"bg-dark-bg border-b border-dark-color px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-dark-primary",children:"Purchase Orders"}),e.jsx("p",{className:"text-sm text-dark-secondary mt-1",children:"Manage service requests and purchase orders"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:M,disabled:b,className:"dark-button-secondary gap-2 flex items-center",children:[e.jsx(We,{className:"w-4 h-4"}),"Export"]}),e.jsxs("button",{onClick:()=>c(!0),className:"dark-button-primary gap-2 flex items-center",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Create PO"]}),e.jsxs("button",{onClick:()=>P(!0),className:"dark-button-primary gap-2 flex items-center bg-green-600 hover:bg-green-700",children:[e.jsx(Va,{className:"w-4 h-4"}),"Smart PO"]})]})]})}),e.jsxs("main",{className:"flex-1 overflow-auto p-8 bg-dark-bg",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-8",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(vs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-dark-secondary w-4 h-4"}),e.jsx(k,{placeholder:"Search PO ID or customer...",value:a,onChange:d=>l(d.target.value),className:"pl-10 bg-dark-card border-dark-color text-dark-primary"})]}),e.jsxs("select",{value:i,onChange:d=>o(d.target.value),className:"px-4 py-2 bg-dark-card border border-dark-color rounded-xl text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"All",children:"All Status"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-8",children:[e.jsxs("div",{className:"dark-card text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-dark-primary mb-1",children:u.length}),e.jsx("p",{className:"text-sm text-dark-secondary",children:"Total POs"})]}),e.jsxs("div",{className:"dark-card text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-orange-400 mb-1",children:u.filter(d=>d.status==="Pending").length}),e.jsx("p",{className:"text-sm text-dark-secondary",children:"Pending"})]}),e.jsxs("div",{className:"dark-card text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-green-400 mb-1",children:u.filter(d=>d.status==="Approved").length}),e.jsx("p",{className:"text-sm text-dark-secondary",children:"Approved"})]}),e.jsxs("div",{className:"dark-card text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-blue-400 mb-1",children:u.filter(d=>d.status==="In Progress").length}),e.jsx("p",{className:"text-sm text-dark-secondary",children:"In Progress"})]}),e.jsxs("div",{className:"dark-card text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-400 mb-1",children:u.filter(d=>d.status==="Completed").length}),e.jsx("p",{className:"text-sm text-dark-secondary",children:"Completed"})]})]}),e.jsx("div",{className:"dark-card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-color",children:[e.jsx("th",{className:"text-left font-semibold text-dark-primary pb-4",children:"PO Details"}),e.jsx("th",{className:"text-left font-semibold text-dark-primary pb-4",children:"Customer & Site"}),e.jsx("th",{className:"text-center font-semibold text-dark-primary pb-4",children:"Projectors"}),e.jsx("th",{className:"text-center font-semibold text-dark-primary pb-4",children:"Priority"}),e.jsx("th",{className:"text-center font-semibold text-dark-primary pb-4",children:"Status"}),e.jsx("th",{className:"text-right font-semibold text-dark-primary pb-4",children:"Amount"}),e.jsx("th",{className:"text-center font-semibold text-dark-primary pb-4",children:"Actions"})]})}),e.jsx("tbody",{children:J.map((d,X)=>e.jsxs("tr",{className:"border-b border-dark-color hover:bg-dark-table-hover transition-colors",children:[e.jsx("td",{className:"py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-primary",children:d.id}),e.jsxs("p",{className:"text-xs text-dark-secondary flex items-center gap-1 mt-1",children:[e.jsx(Ye,{className:"w-3 h-3"}),"Raised: ",d.dateRaised]}),e.jsxs("p",{className:"text-xs text-dark-secondary flex items-center gap-1",children:[e.jsx(ts,{className:"w-3 h-3"}),"Expected: ",d.expectedService]})]})}),e.jsx("td",{className:"py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-dark-primary",children:d.customer}),e.jsx("p",{className:"text-xs text-dark-secondary flex items-center gap-1 mt-1",children:d.site})]})}),e.jsx("td",{className:"py-4 text-center",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-dark-primary",children:d.projectors.length})})}),e.jsx("td",{className:"py-4 text-center",children:e.jsx("span",{className:`text-sm font-semibold ${w(d.priority)}`,children:d.priority})}),e.jsx("td",{className:"py-4 text-center",children:e.jsxs("div",{className:`dark-tag ${T(d.status)} flex items-center gap-1 justify-center`,children:[g(d.status),d.status]})}),e.jsx("td",{className:"py-4 text-right",children:e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("span",{className:"text-sm font-semibold text-dark-primary",children:d.totalAmount.toLocaleString()})})}),e.jsx("td",{className:"py-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("button",{className:"p-2 hover:bg-dark-hover rounded-lg transition-colors",onClick:()=>E(d),children:e.jsx(es,{className:"w-4 h-4 text-dark-secondary"})}),e.jsx("button",{className:"p-2 hover:bg-dark-hover rounded-lg transition-colors",onClick:()=>R(d),children:e.jsx(ks,{className:"w-4 h-4 text-dark-secondary"})})]})})]},X))})]})})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-dark-bg border-2 border-dark-color rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-dark-primary",children:"Purchase Order Details"}),e.jsx("button",{onClick:()=>E(null),className:"p-2 hover:bg-dark-hover rounded-lg transition-colors",children:e.jsx(dt,{className:"w-5 h-5 text-dark-secondary"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"PO ID"}),e.jsx("p",{className:"text-dark-primary font-semibold",children:S.id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Status"}),e.jsxs("div",{className:`dark-tag ${T(S.status)} inline-flex items-center gap-1 mt-1`,children:[g(S.status),S.status]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Priority"}),e.jsx("p",{className:`font-semibold ${w(S.priority)}`,children:S.priority})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Total Amount"}),e.jsxs("p",{className:"text-dark-primary font-semibold",children:["₹",S.totalAmount.toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-3",children:"Customer Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Customer"}),e.jsx("p",{className:"text-dark-primary",children:S.customer})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Site Location"}),e.jsx("p",{className:"text-dark-primary",children:S.site})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Contact Person"}),e.jsx("p",{className:"text-dark-primary",children:S.contact&&typeof S.contact=="object"?String(S.contact.name||"Not specified"):String(S.contact||"Not specified")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary"}),e.jsx("p",{className:"text-dark-primary",children:S.contact&&typeof S.contact=="object"?String(S.contact.phone||"Not specified"):"Not specified"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-3",children:"Projectors & Services"}),e.jsx("div",{className:"space-y-3",children:S.projectors.map((d,X)=>e.jsx("div",{className:"bg-dark-bg rounded-lg p-4 border border-dark-color",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Model"}),e.jsx("p",{className:"text-dark-primary",children:d.model})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Location"}),e.jsx("p",{className:"text-dark-primary",children:d.location})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Service"}),e.jsx("p",{className:"text-dark-primary",children:d.service})]})]})},X))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Description"}),e.jsx("p",{className:"text-dark-primary mt-1",children:S.description})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[S.status==="Pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"flex-1 dark-button-primary",children:"Approve PO"}),e.jsx("button",{className:"flex-1 dark-button-secondary",children:"Request Changes"})]}),S.status==="Approved"&&e.jsx("button",{className:"flex-1 dark-button-primary",children:"Schedule Service"}),e.jsx("button",{onClick:()=>m(S.id),className:"dark-button-secondary px-6",children:"Download PDF"})]})]})]})})]}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-dark-bg border-2 border-dark-color rounded-xl p-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-dark-primary",children:"Create New Purchase Order"}),e.jsx("button",{onClick:()=>c(!1),className:"text-dark-secondary hover:text-dark-primary",children:e.jsx(Ke,{className:"w-5 h-5"})})]}),y&&e.jsx("div",{className:"mb-4 p-3 bg-red-900 bg-opacity-30 rounded-lg border border-red-600",children:e.jsx("p",{className:"text-red-400 text-sm",children:y})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"PO ID"}),e.jsx(k,{value:K.id,onChange:d=>ne({...K,id:d.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"PO-2024-XXX (auto-generated if empty)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Customer *"}),e.jsx(k,{value:K.customer,onChange:d=>ne({...K,customer:d.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter customer name"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Site *"}),e.jsxs("select",{value:K.siteId,onChange:d=>O(d.target.value),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"",children:"Select a site"}),s.map(d=>e.jsxs("option",{value:d._id,children:[d.name," - ",d.location]},d._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Priority"}),e.jsxs("select",{value:K.priority,onChange:d=>ne({...K,priority:d.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"Low",children:"Low"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"High",children:"High"})]})]})]}),z&&e.jsxs("div",{className:"bg-dark-card-secondary rounded-lg p-4 border border-dark-color",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-dark-primary",children:"Site Details"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ds,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-xs text-dark-secondary",children:z.location})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Total Projectors:"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx(ss,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-dark-primary font-medium",children:t.filter(d=>d.site===z.name).length})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Site Type:"}),e.jsx("div",{className:"mt-1",children:e.jsx(ge,{className:"bg-blue-600 text-white text-xs",children:z.siteType||"Commercial"})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Contact Person:"}),e.jsx("div",{className:"mt-1 text-dark-primary",children:z.contactPerson?String(z.contactPerson):"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Working Hours:"}),e.jsxs("div",{className:"mt-1 text-dark-primary",children:[z.openTime," - ",z.closeTime]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Date Raised"}),e.jsx(k,{type:"date",value:K.dateRaised,onChange:d=>ne({...K,dateRaised:d.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Expected Service Date"}),e.jsx(k,{type:"date",value:K.expectedService,onChange:d=>ne({...K,expectedService:d.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Total Amount (₹)"}),e.jsx(k,{type:"number",value:K.totalAmount,onChange:d=>ne({...K,totalAmount:Number(d.target.value)}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Status"}),e.jsxs("select",{value:K.status,onChange:d=>ne({...K,status:d.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Description *"}),e.jsx("textarea",{value:K.description,onChange:d=>ne({...K,description:d.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",rows:3,placeholder:"Describe the service request or purchase order"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-3",children:"Contact Information"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Contact Name"}),e.jsx(k,{value:K.contact.name,onChange:d=>ne({...K,contact:{...K.contact,name:d.target.value}}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter contact name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary"}),e.jsx(k,{value:K.contact.phone,onChange:d=>ne({...K,contact:{...K.contact,phone:d.target.value}}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter phone number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Email"}),e.jsx(k,{type:"email",value:K.contact.email,onChange:d=>ne({...K,contact:{...K.contact,email:d.target.value}}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter email address"})]})]})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6 pt-6 border-t border-dark-color",children:[e.jsx("button",{onClick:()=>c(!1),className:"flex-1 dark-button-secondary",children:"Cancel"}),e.jsx("button",{onClick:p,disabled:b||!K.customer||!K.site||!K.description,className:"flex-1 dark-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:b?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4 animate-spin mr-2"}),"Creating..."]}):"Create PO"})]})]})}),j&&e.jsx(Ta,{onClose:()=>P(!1),onPOCreated:d=>{var X,ee,B;P(!1),Y(),(B=window.showToast)==null||B.call(window,{type:"success",title:"Smart PO Created",message:`PO ${d.poNumber||d.id} created with ${((X=d.projectors)==null?void 0:X.length)||((ee=d.lineItems)==null?void 0:ee.length)||0} projectors and AMC contracts`})}}),v&&V&&e.jsx(Ta,{editMode:!0,existingPO:V,onClose:()=>{x(!1),_(null)},onPOUpdated:F,onPOCreated:()=>{}})]})}function Ds({className:s,...t}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:Le("w-full caption-bottom text-sm",s),...t})})}function Rs({className:s,...t}){return e.jsx("thead",{"data-slot":"table-header",className:Le("[&_tr]:border-b",s),...t})}function Es({className:s,...t}){return e.jsx("tbody",{"data-slot":"table-body",className:Le("[&_tr:last-child]:border-0",s),...t})}function He({className:s,...t}){return e.jsx("tr",{"data-slot":"table-row",className:Le("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",s),...t})}function fe({className:s,...t}){return e.jsx("th",{"data-slot":"table-head",className:Le("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}function je({className:s,...t}){return e.jsx("td",{"data-slot":"table-cell",className:Le("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}function ps({...s}){return e.jsx(ol,{"data-slot":"dialog",...s})}function Fi({...s}){return e.jsx(ul,{"data-slot":"dialog-portal",...s})}function Li({className:s,...t}){return e.jsx(pl,{"data-slot":"dialog-overlay",className:Le("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...t})}function gs({className:s,children:t,...a}){return e.jsxs(Fi,{"data-slot":"dialog-portal",children:[e.jsx(Li,{}),e.jsxs(dl,{"data-slot":"dialog-content",className:Le("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...a,children:[t,e.jsxs(ml,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(Ke,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function js({className:s,...t}){return e.jsx("div",{"data-slot":"dialog-header",className:Le("flex flex-col gap-2 text-center sm:text-left",s),...t})}function bs({className:s,...t}){return e.jsx(xl,{"data-slot":"dialog-title",className:Le("text-lg leading-none font-semibold",s),...t})}function Ys({className:s,...t}){return e.jsx(hl,{"data-slot":"dialog-description",className:Le("text-muted-foreground text-sm",s),...t})}function Dr({className:s,...t}){return e.jsx(gl,{"data-slot":"tabs",className:Le("flex flex-col gap-2",s),...t})}function Rr({className:s,...t}){return e.jsx(jl,{"data-slot":"tabs-list",className:Le("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex",s),...t})}function Ws({className:s,...t}){return e.jsx(bl,{"data-slot":"tabs-trigger",className:Le("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...t})}function qs({className:s,...t}){return e.jsx(vl,{"data-slot":"tabs-content",className:Le("flex-1 outline-none",s),...t})}function Oi(){var $e,Ve;const{sites:s,projectors:t,fses:a,serviceVisits:l,refreshServiceVisits:i}=Us(),[o,h]=n.useState("planning"),[c,j]=n.useState(""),[P,v]=n.useState("All"),[x,S]=n.useState("All");n.useState(null);const[E,V]=n.useState(!1),[_,b]=n.useState(!1),[N,y]=n.useState(null),[A,u]=n.useState([]),[$,z]=n.useState(null),[re,K]=n.useState([]),[ne,Y]=n.useState(null),[O,R]=n.useState([]),[F,J]=n.useState({siteId:"",siteName:"",projectorSerial:"",projectorModel:"",selectedProjectors:[],type:"AMC Service 1",amcPeriod:"AMC Period 1",date:"",technician:"",fseId:"",fseName:"",status:"Scheduled",notes:"",recommendations:{spareParts:[],rmaParts:[]},cost:0,hours:0,nextServiceDate:"",warrantyStatus:"Under Warranty"}),[T,w]=n.useState([]),[g,p]=n.useState(""),[M,m]=n.useState("all"),[d,X]=n.useState("all"),[ee,B]=n.useState(null),[ce,me]=n.useState(!1),[L,Q]=n.useState(!1),[D,r]=n.useState(!1),[H,ae]=n.useState({siteName:"",projectorSerial:"",selectedProjectors:[],fseName:"",visitType:"Scheduled Maintenance",scheduledDate:"",priority:"Medium",description:"",notes:""}),[be,Z]=n.useState([]);n.useEffect(()=>{C()},[]),n.useEffect(()=>{Pe()},[l,g,M,d]),n.useEffect(()=>{if($){const U=t.filter(xe=>xe.site===$.name);K(U),J(xe=>({...xe,siteId:$._id,siteName:$.name}))}else K([])},[$,t]),n.useEffect(()=>{ne&&J(U=>({...U,fseId:ne.fseId,fseName:ne.name,technician:ne.name}))},[ne]),n.useEffect(()=>{if(H.siteName&&t.length>0){const U=t.filter(xe=>xe.siteName===H.siteName||xe.site===H.siteName);Z(U),H.projectorSerial&&!U.find(xe=>xe.serialNumber===H.projectorSerial)&&ae(xe=>({...xe,projectorSerial:""}))}else Z([])},[H.siteName,t]);const C=async()=>{b(!0);try{const U=await ie.getServices();u(U||[])}catch(U){console.error("Error loading services:",U),y("Failed to load services")}finally{b(!1)}},f=async()=>{b(!0);try{const U=O.length>0?O:[F.projectorSerial];for(const xe of U){if(!xe)continue;const Se={...F,projectorSerial:xe,selectedProjectors:[xe]};await ie.createService(Se)}await C(),V(!1),he()}catch(U){console.error("Error adding service:",U),y("Failed to add service")}finally{b(!1)}},he=()=>{J({siteId:"",siteName:"",projectorSerial:"",projectorModel:"",selectedProjectors:[],type:"AMC Service 1",amcPeriod:"AMC Period 1",date:"",technician:"",fseId:"",fseName:"",status:"Scheduled",notes:"",recommendations:{spareParts:[],rmaParts:[]},cost:0,hours:0,nextServiceDate:"",warrantyStatus:"Under Warranty"}),z(null),Y(null),R([])},pe=()=>{const U=A.map(Se=>({"Site Name":Se.siteName,"Projector Serial":Se.projectorSerial,Type:Se.type,Date:Se.date,FSE:Se.fseName,Status:Se.status,Cost:Se.cost,Hours:Se.hours})),xe=Ss(U);Cs(xe,"service-planning-data.csv")},Pe=()=>{let U=l||[];g&&(U=U.filter(xe=>{var Se,ze,cs,fs;return((Se=xe.siteName)==null?void 0:Se.toLowerCase().includes(g.toLowerCase()))||((ze=xe.projectorSerial)==null?void 0:ze.toLowerCase().includes(g.toLowerCase()))||((cs=xe.fseName)==null?void 0:cs.toLowerCase().includes(g.toLowerCase()))||((fs=xe.visitType)==null?void 0:fs.toLowerCase().includes(g.toLowerCase()))})),M!=="all"&&(U=U.filter(xe=>xe.status===M)),d!=="all"&&(U=U.filter(xe=>xe.priority===d)),w(U)},W=async()=>{r(!0);try{if(!H.siteName||!H.fseName||!H.scheduledDate){alert("Please fill in all required fields: Site, FSE, and Scheduled Date");return}const U=a.find(ze=>ze.name===H.fseName);if(!U){alert("Selected FSE not found. Please select a valid FSE.");return}const xe=s.find(ze=>ze.name===H.siteName);if(!xe){alert("Selected site not found. Please select a valid site.");return}const Se=H.selectedProjectors.length>0?H.selectedProjectors:[H.projectorSerial];if(Se.length===0||Se.length===1&&!Se[0]){alert("Please select at least one projector.");return}for(const ze of Se){if(!ze)continue;const cs={visitId:`VISIT-${Date.now()}-${Math.random().toString(36).substr(2,6)}`,siteId:xe._id,siteName:H.siteName,projectorSerial:ze,fseId:U.fseId,fseName:H.fseName,visitType:H.visitType,scheduledDate:new Date(H.scheduledDate).toISOString(),priority:H.priority,description:H.description||"",notes:H.notes||"",status:"Scheduled",amcServiceInterval:"Outside AMC"};console.log("Creating visit with data:",cs),await ie.createServiceVisit(cs)}await i(),me(!1),Ae()}catch(U){console.error("Error adding visit:",U),alert("Failed to create service visit. Please try again.")}finally{r(!1)}},ve=async()=>{if(ee!=null&&ee._id){r(!0);try{await ie.updateServiceVisit(ee._id,ee),await i(),Q(!1),B(null)}catch(U){console.error("Error updating visit:",U)}finally{r(!1)}}},Ce=async U=>{if(confirm("Are you sure you want to delete this visit?")){r(!0);try{await ie.deleteServiceVisit(U),await i()}catch(xe){console.error("Error deleting visit:",xe)}finally{r(!1)}}},Ae=()=>{ae({siteName:"",projectorSerial:"",selectedProjectors:[],fseName:"",visitType:"Scheduled Maintenance",scheduledDate:"",priority:"Medium",description:"",notes:""})},Ue=U=>{switch(U==null?void 0:U.toLowerCase()){case"completed":return"bg-green-100 text-green-800";case"in progress":return"bg-blue-100 text-blue-800";case"scheduled":return"bg-yellow-100 text-yellow-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},Fe=U=>{switch(U==null?void 0:U.toLowerCase()){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Service Management"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Plan services and manage service visits in one place"})]})}),e.jsxs(Dr,{value:o,onValueChange:h,className:"space-y-6",children:[e.jsxs(Rr,{className:"grid w-full grid-cols-2",children:[e.jsxs(Ws,{value:"planning",className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4"}),"Service Planning"]}),e.jsxs(Ws,{value:"visits",className:"flex items-center gap-2",children:[e.jsx(rs,{className:"h-4 w-4"}),"Service Visits"]})]}),e.jsx(qs,{value:"planning",className:"space-y-6",children:e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-5 w-5"}),"Service Planning"]}),e.jsx(Re,{children:"Plan and schedule maintenance services for projectors"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(q,{onClick:pe,variant:"outline",size:"sm",children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"Export"]}),e.jsxs(q,{onClick:()=>V(!0),children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"Add Service Plan"]})]})]})}),e.jsxs(se,{children:[e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx(k,{placeholder:"Search services...",value:c,onChange:U=>j(U.target.value),className:"max-w-sm"})}),e.jsxs(ye,{value:P,onValueChange:v,children:[e.jsx(ke,{className:"w-48",children:e.jsx(Ne,{placeholder:"by type"})}),e.jsxs(we,{children:[e.jsx(I,{value:"All",children:"All Types"}),e.jsx(I,{value:"AMC Service 1",children:"AMC Service 1"}),e.jsx(I,{value:"AMC Service 2",children:"AMC Service 2"}),e.jsx(I,{value:"Emergency",children:"Emergency"})]})]}),e.jsxs(ye,{value:x,onValueChange:S,children:[e.jsx(ke,{className:"w-48",children:e.jsx(Ne,{placeholder:"by status"})}),e.jsxs(we,{children:[e.jsx(I,{value:"All",children:"All Status"}),e.jsx(I,{value:"Scheduled",children:"Scheduled"}),e.jsx(I,{value:"In Progress",children:"In Progress"}),e.jsx(I,{value:"Completed",children:"Completed"})]})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(Ds,{children:[e.jsx(Rs,{children:e.jsxs(He,{children:[e.jsx(fe,{children:"Site"}),e.jsx(fe,{children:"Projector"}),e.jsx(fe,{children:"Type"}),e.jsx(fe,{children:"Date"}),e.jsx(fe,{children:"FSE"}),e.jsx(fe,{children:"Status"}),e.jsx(fe,{children:"Cost"}),e.jsx(fe,{children:"Actions"})]})}),e.jsx(Es,{children:_?e.jsx(He,{children:e.jsx(je,{colSpan:8,className:"text-center py-8",children:e.jsx(Ie,{className:"h-6 w-6 animate-spin mx-auto"})})}):A.length===0?e.jsx(He,{children:e.jsx(je,{colSpan:8,className:"text-center py-8 text-gray-500",children:"No service plans found"})}):A.map(U=>e.jsxs(He,{children:[e.jsx(je,{children:U.siteName}),e.jsx(je,{children:U.projectorSerial}),e.jsx(je,{children:U.type}),e.jsx(je,{children:new Date(U.date).toLocaleDateString()}),e.jsx(je,{children:U.fseName}),e.jsx(je,{children:e.jsx(ge,{className:Ue(U.status),children:U.status})}),e.jsxs(je,{children:["₹",U.cost]}),e.jsx(je,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{variant:"outline",size:"sm",children:e.jsx(es,{className:"h-4 w-4"})}),e.jsx(q,{variant:"outline",size:"sm",children:e.jsx(ks,{className:"h-4 w-4"})})]})})]},U._id))})]})})]})]})}),e.jsx(qs,{value:"visits",className:"space-y-6",children:e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"h-5 w-5"}),"Service Visits"]}),e.jsx(Re,{children:"Manage and track service visits for field engineers"})]}),e.jsxs(q,{onClick:()=>me(!0),children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"Add Visit"]})]})}),e.jsxs(se,{children:[e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx(k,{placeholder:"Search visits...",value:g,onChange:U=>p(U.target.value),className:"max-w-sm"})}),e.jsxs(ye,{value:M,onValueChange:m,children:[e.jsx(ke,{className:"w-48",children:e.jsx(Ne,{placeholder:"by status"})}),e.jsxs(we,{children:[e.jsx(I,{value:"all",children:"All Status"}),e.jsx(I,{value:"Scheduled",children:"Scheduled"}),e.jsx(I,{value:"In Progress",children:"In Progress"}),e.jsx(I,{value:"Completed",children:"Completed"}),e.jsx(I,{value:"Cancelled",children:"Cancelled"})]})]}),e.jsxs(ye,{value:d,onValueChange:X,children:[e.jsx(ke,{className:"w-48",children:e.jsx(Ne,{placeholder:"by priority"})}),e.jsxs(we,{children:[e.jsx(I,{value:"all",children:"All Priorities"}),e.jsx(I,{value:"High",children:"High"}),e.jsx(I,{value:"Medium",children:"Medium"}),e.jsx(I,{value:"Low",children:"Low"})]})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(Ds,{children:[e.jsx(Rs,{children:e.jsxs(He,{children:[e.jsx(fe,{children:"Site"}),e.jsx(fe,{children:"Projector"}),e.jsx(fe,{children:"FSE"}),e.jsx(fe,{children:"Type"}),e.jsx(fe,{children:"Scheduled Date"}),e.jsx(fe,{children:"Status"}),e.jsx(fe,{children:"Priority"}),e.jsx(fe,{children:"Actions"})]})}),e.jsx(Es,{children:D?e.jsx(He,{children:e.jsx(je,{colSpan:8,className:"text-center py-8",children:e.jsx(Ie,{className:"h-6 w-6 animate-spin mx-auto"})})}):T.length===0?e.jsx(He,{children:e.jsx(je,{colSpan:8,className:"text-center py-8 text-gray-500",children:"No service visits found"})}):T.map(U=>e.jsxs(He,{children:[e.jsx(je,{children:U.siteName}),e.jsx(je,{children:U.projectorSerial}),e.jsx(je,{children:U.fseName}),e.jsx(je,{children:U.visitType}),e.jsx(je,{children:U.scheduledDate?new Date(U.scheduledDate).toLocaleDateString():"N/A"}),e.jsx(je,{children:e.jsx(ge,{className:Ue(U.status||""),children:U.status})}),e.jsx(je,{children:e.jsx(ge,{className:Fe(U.priority||""),children:U.priority})}),e.jsx(je,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{variant:"outline",size:"sm",onClick:()=>{B(U),Q(!0)},children:e.jsx(ks,{className:"h-4 w-4"})}),e.jsx(q,{variant:"outline",size:"sm",onClick:()=>Ce(U._id),children:e.jsx("div",{className:"h-4 w-4"})})]})})]},U._id))})]})})]})]})})]}),e.jsx(ps,{open:E,onOpenChange:V,children:e.jsxs(gs,{className:"max-w-2xl",children:[e.jsxs(js,{children:[e.jsx(bs,{children:"Add New Service Plan"}),e.jsx(Ys,{children:"Create a new service plan for projector maintenance"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Site"}),e.jsxs(ye,{onValueChange:U=>{const xe=s.find(Se=>Se._id===U);z(xe)},children:[e.jsx(ke,{children:e.jsx(Ne,{placeholder:"Select site"})}),e.jsx(we,{children:s.map(U=>e.jsx(I,{value:U._id,children:U.name},U._id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"FSE"}),e.jsxs(ye,{onValueChange:U=>{const xe=a.find(Se=>Se._id===U);Y(xe)},children:[e.jsx(ke,{children:e.jsx(Ne,{placeholder:"Select FSE"})}),e.jsx(we,{children:a.map(U=>e.jsx(I,{value:U._id,children:U.name},U._id))})]})]})]}),$&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Projector Selection"}),e.jsxs(ye,{onValueChange:U=>{if(U==="all"){const xe=re.map(Se=>Se.serialNumber);R(xe),J(Se=>({...Se,projectorSerial:""}))}else U==="single"?(R([]),J(xe=>({...xe,projectorSerial:""}))):(R([]),J(xe=>({...xe,projectorSerial:U})))},children:[e.jsx(ke,{children:e.jsx(Ne,{placeholder:"Select projectors"})}),e.jsxs(we,{children:[e.jsxs(I,{value:"all",children:["🎯 Select All Projectors (",re.length,")"]}),e.jsx(I,{value:"single",children:"📋 Select Individual Projector"}),re.map(U=>e.jsxs(I,{value:U.serialNumber,children:[U.serialNumber," - ",U.model]},U._id))]})]}),(O.length>0||F.projectorSerial)&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg mt-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Selected Projectors:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:O.length>0?O.map((U,xe)=>{const Se=re.find(ze=>ze.serialNumber===U);return e.jsxs(ge,{variant:"secondary",className:"text-xs",children:[U," - ",(Se==null?void 0:Se.model)||"Unknown Model"]},xe)}):F.projectorSerial&&e.jsxs(ge,{variant:"secondary",className:"text-xs",children:[F.projectorSerial," - ",(($e=re.find(U=>U.serialNumber===F.projectorSerial))==null?void 0:$e.model)||"Unknown Model"]})}),O.length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["💡 ",O.length," service plan(s) will be created for the selected projectors"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Service Type"}),e.jsxs(ye,{onValueChange:U=>J(xe=>({...xe,type:U})),children:[e.jsx(ke,{children:e.jsx(Ne,{placeholder:"Select type"})}),e.jsxs(we,{children:[e.jsx(I,{value:"AMC Service 1",children:"AMC Service 1"}),e.jsx(I,{value:"AMC Service 2",children:"AMC Service 2"}),e.jsx(I,{value:"Emergency",children:"Emergency"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Date"}),e.jsx(k,{type:"date",value:F.date,onChange:U=>J(xe=>({...xe,date:U.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Notes"}),e.jsx(k,{placeholder:"Enter service notes...",value:F.notes,onChange:U=>J(xe=>({...xe,notes:U.target.value}))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(q,{variant:"outline",onClick:()=>V(!1),children:"Cancel"}),e.jsx(q,{onClick:f,disabled:_,children:_?e.jsx(Ie,{className:"h-4 w-4 animate-spin"}):"Add Service"})]})]})}),e.jsx(ps,{open:ce,onOpenChange:me,children:e.jsxs(gs,{className:"max-w-2xl",children:[e.jsxs(js,{children:[e.jsx(bs,{children:"Add New Service Visit"}),e.jsx(Ys,{children:"Schedule a new service visit for field engineers"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Site"}),e.jsxs(ye,{onValueChange:U=>ae(xe=>({...xe,siteName:U})),children:[e.jsx(ke,{children:e.jsx(Ne,{placeholder:"Select site"})}),e.jsx(we,{children:s.map(U=>e.jsx(I,{value:U.name,children:U.name},U._id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Projector Selection"}),e.jsxs(ye,{onValueChange:U=>{if(U==="all"){const xe=be.map(Se=>Se.serialNumber);ae(Se=>({...Se,selectedProjectors:xe,projectorSerial:""}))}else ae(U==="single"?xe=>({...xe,selectedProjectors:[],projectorSerial:""}):xe=>({...xe,projectorSerial:U,selectedProjectors:[]}))},children:[e.jsx(ke,{children:e.jsx(Ne,{placeholder:"Select projectors"})}),e.jsxs(we,{children:[e.jsxs(I,{value:"all",children:["🎯 Select All Projectors (",be.length,")"]}),e.jsx(I,{value:"single",children:"📋 Select Individual Projector"}),be.map(U=>e.jsxs(I,{value:U.serialNumber,children:[U.serialNumber," - ",U.model]},U._id))]})]})]})]}),(H.selectedProjectors.length>0||H.projectorSerial)&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Selected Projectors:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:H.selectedProjectors.length>0?H.selectedProjectors.map((U,xe)=>{const Se=be.find(ze=>ze.serialNumber===U);return e.jsxs(ge,{variant:"secondary",className:"text-xs",children:[U," - ",(Se==null?void 0:Se.model)||"Unknown Model"]},xe)}):H.projectorSerial&&e.jsxs(ge,{variant:"secondary",className:"text-xs",children:[H.projectorSerial," - ",((Ve=be.find(U=>U.serialNumber===H.projectorSerial))==null?void 0:Ve.model)||"Unknown Model"]})}),H.selectedProjectors.length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["💡 ",H.selectedProjectors.length," visit(s) will be created for the selected projectors"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"FSE"}),e.jsxs(ye,{onValueChange:U=>ae(xe=>({...xe,fseName:U})),children:[e.jsx(ke,{children:e.jsx(Ne,{placeholder:"Select FSE"})}),e.jsx(we,{children:a.map(U=>e.jsx(I,{value:U.name,children:U.name},U._id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Visit Type"}),e.jsxs(ye,{onValueChange:U=>ae(xe=>({...xe,visitType:U})),children:[e.jsx(ke,{children:e.jsx(Ne,{placeholder:"Select type"})}),e.jsxs(we,{children:[e.jsx(I,{value:"Scheduled Maintenance",children:"Scheduled Maintenance"}),e.jsx(I,{value:"Emergency Repair",children:"Emergency Repair"}),e.jsx(I,{value:"Installation",children:"Installation"}),e.jsx(I,{value:"Inspection",children:"Inspection"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Scheduled Date"}),e.jsx(k,{type:"datetime-local",value:H.scheduledDate,onChange:U=>ae(xe=>({...xe,scheduledDate:U.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Priority"}),e.jsxs(ye,{onValueChange:U=>ae(xe=>({...xe,priority:U})),children:[e.jsx(ke,{children:e.jsx(Ne,{placeholder:"Select priority"})}),e.jsxs(we,{children:[e.jsx(I,{value:"High",children:"High"}),e.jsx(I,{value:"Medium",children:"Medium"}),e.jsx(I,{value:"Low",children:"Low"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Description"}),e.jsx(k,{placeholder:"Enter visit description...",value:H.description,onChange:U=>ae(xe=>({...xe,description:U.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Notes"}),e.jsx(k,{placeholder:"Enter additional notes...",value:H.notes,onChange:U=>ae(xe=>({...xe,notes:U.target.value}))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(q,{variant:"outline",onClick:()=>me(!1),children:"Cancel"}),e.jsx(q,{onClick:W,disabled:D,children:D?e.jsx(Ie,{className:"h-4 w-4 animate-spin"}):"Add Visit"})]})]})}),e.jsx(ps,{open:L,onOpenChange:Q,children:e.jsxs(gs,{className:"max-w-2xl",children:[e.jsxs(js,{children:[e.jsx(bs,{children:"Edit Service Visit"}),e.jsx(Ys,{children:"Update service visit details"})]}),ee&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Site"}),e.jsx(k,{value:ee.siteName||"",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Projector"}),e.jsx(k,{value:ee.projectorSerial||"",readOnly:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"FSE"}),e.jsx(k,{value:ee.fseName||"",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs(ye,{value:ee.status||"",onValueChange:U=>B(xe=>xe?{...xe,status:U}:null),children:[e.jsx(ke,{children:e.jsx(Ne,{placeholder:"Select status"})}),e.jsxs(we,{children:[e.jsx(I,{value:"Scheduled",children:"Scheduled"}),e.jsx(I,{value:"In Progress",children:"In Progress"}),e.jsx(I,{value:"Completed",children:"Completed"}),e.jsx(I,{value:"Cancelled",children:"Cancelled"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Notes"}),e.jsx(k,{placeholder:"Enter notes...",value:ee.notes||"",onChange:U=>B(xe=>xe?{...xe,notes:U.target.value}:null)})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(q,{variant:"outline",onClick:()=>Q(!1),children:"Cancel"}),e.jsx(q,{onClick:ve,disabled:D,children:D?e.jsx(Ie,{className:"h-4 w-4 animate-spin"}):"Update Visit"})]})]})})]})}function $i(){const{services:s,fses:t,serviceVisits:a,projectors:l}=Us(),[i,o]=n.useState(""),[h,c]=n.useState("All"),[j,P]=n.useState("All"),[v,x]=n.useState("All"),[S,E]=n.useState("All"),[V,_]=n.useState(null),[b,N]=n.useState([]),[y,A]=n.useState(!0),[u,$]=n.useState(null),[z,re]=n.useState(!1),[K,ne]=n.useState(!1),[Y,O]=n.useState(!1);n.useState({serviceId:"",projectorSerial:"",fseId:"",fseName:"",partNumber:"",partName:"",type:"Spare Part",priority:"Medium",reason:"",estimatedCost:0,status:"Pending",technician:"",serviceDate:"",notes:""});const[R,F]=n.useState({projectorSerial:"",serviceType:"AMC Service 1",issues:[],fseId:"",customerFeedback:"",recommendations:[]});n.useEffect(()=>{J()},[]);const J=async()=>{try{A(!0),$(null);const d=await ie.getRecommendedSpares(),X=B=>{switch(B){case"Approved":return"Approved";case"Ordered":return"Ordered";case"Issued":return"Installed";case"Rejected":return"Rejected";default:return"Pending"}},ee=(d||[]).map(B=>{var ce,me,L;return{id:B._id,serviceId:B.visitId||"",projectorSerial:B.projectorSerial||"",fseId:((ce=B.requestedBy)==null?void 0:ce.userId)||"",fseName:((me=B.requestedBy)==null?void 0:me.name)||"FSE",partNumber:B.partNumber||"",partName:B.partName||"",type:"Spare Part",priority:"Medium",reason:B.notes||"",estimatedCost:0,status:X(B.status),technician:((L=B.requestedBy)==null?void 0:L.name)||"",serviceDate:B.createdAt?new Date(B.createdAt).toISOString().split("T")[0]:"",notes:B.notes||""}});N(ee)}catch(d){console.error("Error loading recommendations:",d),$("Failed to load recommendations data.")}finally{A(!1)}},T=async()=>{var d;try{A(!0);const X={reportId:`AI-${Date.now()}`,visitId:`SRV-AI-${Date.now()}`,projectorSerial:R.projectorSerial,partNumber:"LAMP-001",partName:"Projector Lamp",quantity:1,notes:`AI-generated recommendation based on ${R.serviceType}${R.customerFeedback?` | Feedback: ${R.customerFeedback}`:""}`,status:"New"};await ie.createRecommendedSpare(X),await J(),ne(!1),F({projectorSerial:"",serviceType:"AMC Service 1",issues:[],fseId:"",customerFeedback:"",recommendations:[]}),(d=window.showToast)==null||d.call(window,{type:"success",title:"AI Recommendation Generated",message:"Saved to Recommended Spares queue"})}catch(X){console.error("Error testing recommendation:",X),$("Failed to generate test recommendation.")}finally{A(!1)}},w=d=>{switch(d){case"High":return"bg-red-600";case"Medium":return"bg-yellow-600";case"Low":return"bg-green-600";default:return"bg-gray-600"}},g=d=>{switch(d){case"Spare Part":return"bg-blue-600";case"RMA Part":return"bg-red-600";case"Preventive Maintenance":return"bg-green-600";case"Upgrade":return"bg-purple-600";default:return"bg-gray-600"}},p=d=>{switch(d){case"Pending":return"bg-yellow-600";case"Approved":return"bg-green-600";case"Rejected":return"bg-red-600";case"Ordered":return"bg-blue-600";case"Received":return"bg-indigo-600";case"Installed":return"bg-green-700";default:return"bg-gray-600"}},M=d=>new Date(d).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),m=b.filter(d=>{const X=d.partName.toLowerCase().includes(i.toLowerCase())||d.projectorSerial.toLowerCase().includes(i.toLowerCase())||d.fseName.toLowerCase().includes(i.toLowerCase()),ee=h==="All"||d.type===h,B=j==="All"||d.priority===j,ce=v==="All"||d.status===v,me=S==="All"||d.fseId===S;return X&&ee&&B&&ce&&me});return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"bg-dark-bg border-b border-dark-color px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-dark-primary",children:"Service Recommendations"}),e.jsx("p",{className:"text-sm text-dark-secondary mt-1",children:"FSE recommendations and AI-powered suggestions"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>ne(!0),className:"dark-button-secondary gap-2 flex items-center",children:[e.jsx(ka,{className:"w-4 h-4"}),"Test AI"]}),e.jsxs("button",{onClick:()=>re(!0),className:"dark-button-primary gap-2 flex items-center",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Add Recommendation"]})]})]})}),e.jsxs("div",{className:"px-8 py-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium text-dark-secondary",children:"Total Recommendations"}),e.jsx(Lt,{className:"h-4 w-4 text-blue-400"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary",children:b.length}),e.jsxs("p",{className:"text-xs text-dark-secondary",children:[b.filter(d=>d.status==="Approved").length," approved"]})]})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium text-dark-secondary",children:"High Priority"}),e.jsx(Te,{className:"h-4 w-4 text-red-400"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary",children:b.filter(d=>d.priority==="High").length}),e.jsx("p",{className:"text-xs text-dark-secondary",children:"Urgent attention required"})]})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium text-dark-secondary",children:"Total Value"}),e.jsx(ns,{className:"h-4 w-4 text-green-400"})]}),e.jsxs(se,{children:[e.jsxs("div",{className:"text-2xl font-bold text-dark-primary",children:["₹",b.reduce((d,X)=>d+X.estimatedCost,0).toLocaleString()]}),e.jsx("p",{className:"text-xs text-dark-secondary",children:"Estimated total cost"})]})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium text-dark-secondary",children:"AI Generated"}),e.jsx(ya,{className:"h-4 w-4 text-yellow-400"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary",children:b.filter(d=>{var X;return(X=d.notes)==null?void 0:X.includes("AI-generated")}).length}),e.jsx("p",{className:"text-xs text-dark-secondary",children:"AI-powered suggestions"})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(vs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-dark-secondary w-4 h-4"}),e.jsx(k,{placeholder:"Search recommendations...",value:i,onChange:d=>o(d.target.value),className:"pl-10 bg-dark-card border-dark-color text-dark-primary"})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("select",{value:h,onChange:d=>c(d.target.value),className:"px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"All",children:"All Types"}),e.jsx("option",{value:"Spare Part",children:"Spare Parts"}),e.jsx("option",{value:"RMA Part",children:"RMA Parts"}),e.jsx("option",{value:"Preventive Maintenance",children:"Preventive Maintenance"}),e.jsx("option",{value:"Upgrade",children:"Upgrades"})]}),e.jsxs("select",{value:j,onChange:d=>P(d.target.value),className:"px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"All",children:"All Priorities"}),e.jsx("option",{value:"High",children:"High"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"Low",children:"Low"})]}),e.jsxs("select",{value:v,onChange:d=>x(d.target.value),className:"px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"All",children:"All Status"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"}),e.jsx("option",{value:"Ordered",children:"Ordered"}),e.jsx("option",{value:"Received",children:"Received"}),e.jsx("option",{value:"Installed",children:"Installed"})]}),e.jsxs("select",{value:S,onChange:d=>E(d.target.value),className:"px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"All",children:"All FSEs"}),t.map(d=>e.jsx("option",{value:d._id,children:d.name},d._id))]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map(d=>e.jsxs(te,{className:"dark-card hover:dark-shadow-lg transition-all duration-300",children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-dark-tag rounded-lg flex items-center justify-center",children:e.jsx(Je,{className:"w-6 h-6 text-blue-400"})}),e.jsxs("div",{children:[e.jsx(de,{className:"text-dark-primary",children:d.partName}),e.jsx(Re,{className:"text-dark-secondary",children:d.partNumber})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(ge,{className:w(d.priority),children:d.priority}),e.jsx(ge,{className:g(d.type),children:d.type})]})]})}),e.jsxs(se,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ss,{className:"w-4 h-4 text-dark-secondary"}),e.jsx("span",{className:"text-sm text-dark-primary",children:d.projectorSerial})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(as,{className:"w-4 h-4 text-dark-secondary"}),e.jsx("span",{className:"text-sm text-dark-primary",children:d.fseName})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-dark-secondary"}),e.jsx("span",{className:"text-sm text-dark-primary",children:M(d.serviceDate)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_a,{className:"w-4 h-4 text-dark-secondary"}),e.jsxs("span",{className:"text-sm text-dark-primary",children:["₹",d.estimatedCost.toLocaleString()]})]}),e.jsx("div",{className:"text-sm text-dark-secondary line-clamp-2",children:d.reason}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ge,{className:p(d.status),children:d.status}),d.customerFeedback&&e.jsx(ge,{className:"bg-green-600 text-white",children:"Customer Approved"})]})]}),e.jsxs("div",{className:"flex space-x-2 mt-4 pt-4 border-t border-dark-color",children:[e.jsxs(q,{onClick:()=>{_(d),O(!0)},className:"flex-1 dark-button-secondary",size:"sm",children:[e.jsx(es,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsxs(q,{onClick:()=>{_(d)},className:"flex-1 dark-button-primary",size:"sm",disabled:d.status!=="Pending",children:[e.jsx(ha,{className:"w-4 h-4 mr-1"}),"Approve"]})]})]})]},d.id))}),m.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Lt,{className:"w-12 h-12 mx-auto mb-4 text-dark-secondary"}),e.jsx("p",{className:"text-dark-secondary",children:"No recommendations found matching your criteria"})]})]}),K&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-dark-bg border-2 border-dark-color rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-dark-primary",children:"Test AI Recommendations"}),e.jsx("button",{onClick:()=>ne(!1),className:"text-dark-secondary hover:text-dark-primary",children:e.jsx(Ke,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Projector Serial"}),e.jsxs("select",{value:R.projectorSerial,onChange:d=>F({...R,projectorSerial:d.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"",children:"Select projector"}),l.map(d=>e.jsxs("option",{value:d.serialNumber,children:[d.serialNumber," ",d.brand?`- ${d.brand}`:""," ",d.model?` ${d.model}`:""," ",d.site?`- ${d.site}`:""]},d._id||d.serialNumber))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Service Type"}),e.jsxs("select",{value:R.serviceType,onChange:d=>F({...R,serviceType:d.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"AMC Service 1",children:"AMC Service 1"}),e.jsx("option",{value:"AMC Service 2",children:"AMC Service 2"}),e.jsx("option",{value:"Special Service",children:"Special Service"}),e.jsx("option",{value:"Emergency Repair",children:"Emergency Repair"}),e.jsx("option",{value:"Preventive Maintenance",children:"Preventive Maintenance"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"FSE"}),e.jsxs("select",{value:R.fseId,onChange:d=>F({...R,fseId:d.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"",children:"Select FSE"}),t.map(d=>e.jsx("option",{value:d._id,children:d.name},d._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Customer Feedback (Optional)"}),e.jsx("textarea",{value:R.customerFeedback,onChange:d=>F({...R,customerFeedback:d.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",rows:3,placeholder:"Any customer feedback or issues reported..."})]}),e.jsxs("div",{className:"bg-blue-900 bg-opacity-30 border border-blue-600 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(ya,{className:"w-5 h-5 text-yellow-400"}),e.jsx("span",{className:"text-sm font-medium text-blue-400",children:"AI Analysis"})]}),e.jsx("p",{className:"text-sm text-blue-300",children:"The AI will analyze the service data and generate recommendations based on:"}),e.jsxs("ul",{className:"text-sm text-blue-300 mt-2 space-y-1",children:[e.jsx("li",{children:"• Projector usage patterns and maintenance history"}),e.jsx("li",{children:"• Common failure patterns and preventive measures"}),e.jsx("li",{children:"• Manufacturer recommendations and warranty status"}),e.jsx("li",{children:"• Cost-benefit analysis of recommended parts"})]})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6 pt-6 border-t border-dark-color",children:[e.jsx("button",{onClick:()=>ne(!1),className:"flex-1 dark-button-secondary",children:"Cancel"}),e.jsx("button",{onClick:T,disabled:y||!R.projectorSerial||!R.fseId,className:"flex-1 dark-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:y?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4 animate-spin mr-2"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ka,{className:"w-4 h-4 mr-2"}),"Generate AI Recommendations"]})})]})]})}),Y&&V&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-dark-bg border-2 border-dark-color rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-dark-primary",children:["Recommendation Details - ",V.partName]}),e.jsx("button",{onClick:()=>O(!1),className:"text-dark-secondary hover:text-dark-primary",children:e.jsx(Ke,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Basic Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Part Number"}),e.jsx("p",{className:"text-dark-primary font-medium",children:V.partNumber})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Projector Serial"}),e.jsx("p",{className:"text-dark-primary",children:V.projectorSerial})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"FSE"}),e.jsx("p",{className:"text-dark-primary",children:V.fseName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Service Date"}),e.jsx("p",{className:"text-dark-primary",children:M(V.serviceDate)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Reason"}),e.jsx("p",{className:"text-dark-primary",children:V.reason})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Status & Cost"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ge,{className:p(V.status),children:V.status}),e.jsxs(ge,{className:w(V.priority),children:[V.priority," Priority"]}),e.jsx(ge,{className:g(V.type),children:V.type})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Estimated Cost"}),e.jsxs("p",{className:"text-dark-primary font-medium",children:["₹",V.estimatedCost.toLocaleString()]})]}),V.actualCost&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Actual Cost"}),e.jsxs("p",{className:"text-dark-primary font-medium",children:["₹",V.actualCost.toLocaleString()]})]}),V.customerFeedback&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Customer Feedback"}),e.jsx("p",{className:"text-dark-primary",children:V.customerFeedback})]}),V.warrantyInfo&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Warranty Status"}),e.jsx("p",{className:"text-dark-primary",children:V.warrantyInfo})]})]})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t border-dark-color",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(q,{className:"dark-button-primary",children:[e.jsx(ha,{className:"w-4 h-4 mr-2"}),"Approve Recommendation"]}),e.jsxs(q,{className:"dark-button-secondary",children:[e.jsx(ks,{className:"w-4 h-4 mr-2"}),"Edit Details"]}),e.jsxs(q,{className:"dark-button-secondary",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Export Report"]})]})})]})}),e.jsx("div",{className:"mt-12",children:e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-5 w-5"}),"Spare Parts from Service Reports"]}),e.jsx(Re,{children:"Spare parts recommended by FSEs during service visits"})]}),e.jsx(se,{children:e.jsx(Vi,{})})]})})]})}function Vi(){const[s,t]=n.useState([]),[a,l]=n.useState(!0);n.useEffect(()=>{i()},[]);const i=async()=>{try{l(!0);const h=await ie.getAllServiceReports();t(h||[])}catch(h){console.error("Error loading service reports:",h)}finally{l(!1)}},o=s.flatMap(h=>(h.recommendedParts||[]).map(c=>{var j;return{...c,reportNumber:h.reportNumber,siteName:h.siteName,projectorSerial:h.projectorSerial,engineerName:((j=h.engineer)==null?void 0:j.name)||"Unknown",reportDate:h.date,reportType:h.reportType}}));return a?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Ie,{className:"h-6 w-6 animate-spin text-dark-secondary"}),e.jsx("span",{className:"ml-2 text-dark-secondary",children:"Loading spare parts..."})]}):o.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Je,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No spare parts recommended in service reports yet"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"FSEs can add spare part recommendations when creating service reports"})]}):e.jsx("div",{className:"space-y-4",children:o.map((h,c)=>e.jsxs("div",{className:"border border-dark-color rounded-lg p-4 bg-dark-card",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Part Name"}),e.jsx("p",{className:"text-dark-primary font-medium",children:h.partName||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Part Number"}),e.jsx("p",{className:"text-dark-primary",children:h.partNumber||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Quantity"}),e.jsx("p",{className:"text-dark-primary",children:h.quantity||1})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Notes"}),e.jsx("p",{className:"text-dark-primary",children:h.notes||"No notes"})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-dark-color",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Report: "}),e.jsx("span",{className:"text-dark-primary",children:h.reportNumber})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Site: "}),e.jsx("span",{className:"text-dark-primary",children:h.siteName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Projector: "}),e.jsx("span",{className:"text-dark-primary",children:h.projectorSerial})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Engineer: "}),e.jsx("span",{className:"text-dark-primary",children:h.engineerName})]})]})})]},c))})}function Ui(){const{fses:s,services:t,serviceVisits:a}=Us(),[l,i]=n.useState([]),[o,h]=n.useState(null),[c,j]=n.useState(!1),[P,v]=n.useState(!1),[x,S]=n.useState(!1),[E,V]=n.useState(!1),[_,b]=n.useState(!1),[N,y]=n.useState(null),[A,u]=n.useState(""),[$,z]=n.useState("All"),[re,K]=n.useState("All"),[ne,Y]=n.useState(null),[O,R]=n.useState(!1),[F,J]=n.useState([]),[T,w]=n.useState(!1),[g,p]=n.useState({totalFSEs:0,activeFSEs:0,onDutyFSEs:0,onLeaveFSEs:0,totalServices:0,averageRating:0}),[M,m]=n.useState({name:"",email:"",phone:"",employeeId:"",designation:"Field Service Engineer",specialization:[],assignedTerritory:[],status:"Active",experience:0,certifications:[],supervisor:{name:"",email:"",phone:""},emergencyContact:{name:"",relationship:"",phone:""}}),d=D=>{const r=t.filter(C=>C.technician===D.name);a.filter(C=>C.fseId===D._id);const H=r.filter(C=>C.status==="Completed").length,ae=r.filter(C=>C.status==="Scheduled"||C.status==="In Progress").length,be=r.reduce((C,f)=>{var Pe,W,ve,Ce;const he=((W=(Pe=f.recommendations)==null?void 0:Pe.spareParts)==null?void 0:W.length)||0,pe=((Ce=(ve=f.recommendations)==null?void 0:ve.rmaParts)==null?void 0:Ce.length)||0;return C+he+pe},0),Z=4.2+Math.random()*.8;return{totalServices:r.length,completedServices:H,pendingServices:ae,averageRating:Math.round(Z*10)/10,totalHours:r.reduce((C,f)=>C+(f.hours||0),0),recommendations:be,territories:D.assignedTerritory,specializations:D.specialization}};n.useEffect(()=>{if(s.length>0){const D={totalFSEs:s.length,activeFSEs:s.filter(r=>r.status==="Active").length,onDutyFSEs:s.filter(r=>r.status==="On Duty").length,onLeaveFSEs:s.filter(r=>r.status==="On Leave").length,totalServices:t.length,averageRating:4.5};p(D)}},[s,t]),n.useEffect(()=>{let D=s;A&&(D=D.filter(r=>r.name.toLowerCase().includes(A.toLowerCase())||r.email.toLowerCase().includes(A.toLowerCase())||r.employeeId.toLowerCase().includes(A.toLowerCase()))),$!=="All"&&(D=D.filter(r=>r.status===$)),re!=="All"&&(D=D.filter(r=>r.assignedTerritory.includes(re))),i(D)},[s,A,$,re]);const X=async()=>{var D;try{if(b(!0),y(null),!M.name||!M.email||!M.phone||!M.employeeId){y("Please fill in all required fields");return}await ie.createFSE(M),j(!1),m({name:"",email:"",phone:"",employeeId:"",designation:"Field Service Engineer",specialization:[],assignedTerritory:[],status:"Active",experience:0,certifications:[],supervisor:{name:"",email:"",phone:""},emergencyContact:{name:"",relationship:"",phone:""}}),(D=window.showToast)==null||D.call(window,{type:"success",title:"FSE Created",message:`${M.name} has been added successfully`})}catch(r){console.error("Error creating FSE:",r),y("Failed to create FSE: "+r.message)}finally{b(!1)}},ee=async()=>{var D;try{if(b(!0),y(null),!o){console.error("No FSE selected for update");return}console.log("Updating FSE:",o._id,o);const r=await ie.updateFSE(o._id,o);console.log("Update result:",r),v(!1),h(null),(D=window.showToast)==null||D.call(window,{type:"success",title:"FSE Updated",message:`${o.name} has been updated successfully`})}catch(r){console.error("Error updating FSE:",r),y("Failed to update FSE: "+r.message)}finally{b(!1)}},B=D=>{h(D),Y(d(D)),V(!0)},ce=async D=>{try{w(!0),h(D);const H=(await ie.getAllServiceReports()).filter(ae=>{var be,Z;return((be=ae.engineer)==null?void 0:be.name)===D.name||((Z=ae.engineer)==null?void 0:Z.email)===D.email});J(H),R(!0)}catch(r){console.error("Error loading FSE reports:",r),y("Failed to load FSE reports: "+r.message)}finally{w(!1)}},me=D=>{switch(D){case"Active":return"bg-green-600";case"Inactive":return"bg-gray-600";case"On Leave":return"bg-orange-600";case"On Duty":return"bg-blue-600";default:return"bg-gray-600"}},L=D=>{const r=["bg-blue-600","bg-green-600","bg-purple-600","bg-orange-600","bg-red-600","bg-indigo-600"];return r[D.length%r.length]},Q=D=>new Date(D).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"bg-dark-bg border-b border-dark-color px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-dark-primary",children:"FSE Management"}),e.jsx("p",{className:"text-sm text-dark-secondary mt-1",children:"Manage Field Service Engineers and their assignments"})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("button",{onClick:()=>j(!0),className:"dark-button-primary gap-2 flex items-center",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Add FSE"]})})]})}),e.jsxs("div",{className:"px-8 py-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium text-dark-secondary",children:"Total FSEs"}),e.jsx(ot,{className:"h-4 w-4 text-blue-400"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary",children:g.totalFSEs}),e.jsxs("p",{className:"text-xs text-dark-secondary",children:[g.activeFSEs," active, ",g.onDutyFSEs," on duty"]})]})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium text-dark-secondary",children:"Total Services"}),e.jsx(rs,{className:"h-4 w-4 text-green-400"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary",children:g.totalServices}),e.jsx("p",{className:"text-xs text-dark-secondary",children:"Across all FSEs"})]})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium text-dark-secondary",children:"Average Rating"}),e.jsx(Ft,{className:"h-4 w-4 text-yellow-400"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary",children:g.averageRating}),e.jsx("p",{className:"text-xs text-dark-secondary",children:"Customer satisfaction"})]})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium text-dark-secondary",children:"On Leave"}),e.jsx(ts,{className:"h-4 w-4 text-orange-400"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary",children:g.onLeaveFSEs}),e.jsx("p",{className:"text-xs text-dark-secondary",children:"Currently unavailable"})]})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium text-dark-secondary",children:"Total Reports"}),e.jsx(Oe,{className:"h-4 w-4 text-purple-400"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary",children:e.jsx("span",{className:"text-green-400",children:"Reports Filled"})}),e.jsx("p",{className:"text-xs text-dark-secondary",children:'Click "Reports" on any FSE card to view'})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(vs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-dark-secondary w-4 h-4"}),e.jsx(k,{placeholder:"Search FSEs by name, email, or ID...",value:A,onChange:D=>u(D.target.value),className:"pl-10 bg-dark-card border-dark-color text-dark-primary"})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("select",{value:$,onChange:D=>z(D.target.value),className:"px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"All",children:"All Status"}),e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"}),e.jsx("option",{value:"On Leave",children:"On Leave"}),e.jsx("option",{value:"On Duty",children:"On Duty"})]}),e.jsxs("select",{value:re,onChange:D=>K(D.target.value),className:"px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"All",children:"All Territories"}),e.jsx("option",{value:"North",children:"North"}),e.jsx("option",{value:"South",children:"South"}),e.jsx("option",{value:"East",children:"East"}),e.jsx("option",{value:"West",children:"West"}),e.jsx("option",{value:"Central",children:"Central"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(D=>e.jsxs(te,{className:"dark-card hover:dark-shadow-lg transition-all duration-300",children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"w-12 h-12 bg-dark-tag rounded-lg flex items-center justify-center relative",children:[e.jsx("div",{className:"w-6 h-6 text-blue-400"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-dark-bg flex items-center justify-center",children:e.jsx(Oe,{className:"w-2 h-2 text-white"})})]}),e.jsxs("div",{children:[e.jsx(de,{className:"text-dark-primary",children:D.name}),e.jsx(Re,{className:"text-dark-secondary",children:D.designation})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ge,{className:me(D.status),children:D.status}),e.jsx(ge,{className:"bg-green-600 text-white text-xs",children:"Reports Available"})]})]})}),e.jsxs(se,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Mt,{className:"w-4 h-4 text-dark-secondary"}),e.jsx("span",{className:"text-sm text-dark-primary",children:D.email})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(It,{className:"w-4 h-4 text-dark-secondary"}),e.jsx("span",{className:"text-sm text-dark-primary",children:D.phone})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Dl,{className:"w-4 h-4 text-dark-secondary"}),e.jsx("span",{className:"text-sm text-dark-primary",children:D.employeeId})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Pl,{className:"w-4 h-4 text-dark-secondary"}),e.jsxs("span",{className:"text-sm text-dark-primary",children:[D.experience," years exp."]})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:D.assignedTerritory.map((r,H)=>e.jsx(ge,{className:`${L(r)} text-white text-xs`,children:r},H))}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ta,{className:"w-4 h-4 text-dark-secondary"}),e.jsxs("span",{className:"text-sm text-dark-primary",children:[D.certifications.length," certifications"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-dark-secondary"}),e.jsxs("span",{className:"text-sm text-dark-primary",children:[e.jsx("span",{className:"text-green-400 font-medium",children:"Reports Available"}),' - Click "Reports" to view']})]})]}),e.jsxs("div",{className:"flex space-x-2 mt-4 pt-4 border-t border-dark-color",children:[e.jsxs(q,{onClick:()=>{h(D),S(!0)},className:"flex-1 dark-button-secondary",size:"sm",children:[e.jsx(es,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsxs(q,{onClick:()=>B(D),className:"flex-1 dark-button-primary",size:"sm",children:[e.jsx("div",{className:"w-4 h-4 mr-1"}),"Metrics"]}),e.jsxs(q,{onClick:()=>ce(D),className:"flex-1 dark-button-secondary",size:"sm",children:[e.jsx(Oe,{className:"w-4 h-4 mr-1"}),"Reports"]}),e.jsxs(q,{onClick:()=>{h(D),v(!0)},className:"flex-1 dark-button-secondary",size:"sm",children:[e.jsx(ks,{className:"w-4 h-4 mr-1"}),"Edit"]})]})]})]},D._id))}),l.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ot,{className:"w-12 h-12 mx-auto mb-4 text-dark-secondary"}),e.jsx("p",{className:"text-dark-secondary",children:"No FSEs found matching your criteria"})]})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-dark-bg border-2 border-dark-color rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-dark-primary",children:"Add New FSE"}),e.jsx("button",{onClick:()=>j(!1),className:"text-dark-secondary hover:text-dark-primary",children:e.jsx(Ke,{className:"w-5 h-5"})})]}),N&&e.jsx("div",{className:"mb-4 p-3 bg-red-900 bg-opacity-30 rounded-lg border border-red-600",children:e.jsx("p",{className:"text-red-400 text-sm",children:N})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Name *"}),e.jsx(k,{value:M.name,onChange:D=>m({...M,name:D.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter full name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Email *"}),e.jsx(k,{type:"email",value:M.email,onChange:D=>m({...M,email:D.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter email address"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Phone *"}),e.jsx(k,{value:M.phone,onChange:D=>m({...M,phone:D.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter phone number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Employee ID *"}),e.jsx(k,{value:M.employeeId,onChange:D=>m({...M,employeeId:D.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter employee ID"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Designation"}),e.jsxs("select",{value:M.designation,onChange:D=>m({...M,designation:D.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"Field Service Engineer",children:"Field Service Engineer"}),e.jsx("option",{value:"Senior FSE",children:"Senior FSE"}),e.jsx("option",{value:"Lead FSE",children:"Lead FSE"}),e.jsx("option",{value:"Technical Specialist",children:"Technical Specialist"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Experience (Years)"}),e.jsx(k,{type:"number",value:M.experience,onChange:D=>m({...M,experience:Number(D.target.value)}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Status"}),e.jsxs("select",{value:M.status,onChange:D=>m({...M,status:D.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"}),e.jsx("option",{value:"On Leave",children:"On Leave"}),e.jsx("option",{value:"On Duty",children:"On Duty"})]})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6 pt-6 border-t border-dark-color",children:[e.jsx("button",{onClick:()=>j(!1),className:"flex-1 dark-button-secondary",children:"Cancel"}),e.jsx("button",{onClick:X,disabled:_||!M.name||!M.email||!M.phone||!M.employeeId,className:"flex-1 dark-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:_?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4 animate-spin mr-2"}),"Creating..."]}):"Create FSE"})]})]})}),E&&o&&ne&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-dark-bg border-2 border-dark-color rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-dark-primary",children:["Performance Metrics - ",o.name]}),e.jsx("button",{onClick:()=>V(!1),className:"text-dark-secondary hover:text-dark-primary",children:e.jsx(Ke,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium text-dark-secondary",children:"Total Services"}),e.jsx(rs,{className:"h-4 w-4 text-blue-400"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary",children:ne.totalServices}),e.jsxs("p",{className:"text-xs text-dark-secondary",children:[ne.completedServices," completed"]})]})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium text-dark-secondary",children:"Rating"}),e.jsx(Ft,{className:"h-4 w-4 text-yellow-400"})]}),e.jsxs(se,{children:[e.jsxs("div",{className:"text-2xl font-bold text-dark-primary",children:[ne.averageRating,"/5.0"]}),e.jsx("p",{className:"text-xs text-dark-secondary",children:"Customer satisfaction"})]})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium text-dark-secondary",children:"Total Hours"}),e.jsx(ts,{className:"h-4 w-4 text-green-400"})]}),e.jsxs(se,{children:[e.jsxs("div",{className:"text-2xl font-bold text-dark-primary",children:[ne.totalHours,"h"]}),e.jsx("p",{className:"text-xs text-dark-secondary",children:"Service hours logged"})]})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium text-dark-secondary",children:"Recommendations"}),e.jsx("div",{className:"h-4 w-4 text-purple-400"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary",children:ne.recommendations}),e.jsx("p",{className:"text-xs text-dark-secondary",children:"Parts & services suggested"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{children:[e.jsx(de,{className:"text-dark-primary",children:"Territories"}),e.jsx(Re,{className:"text-dark-secondary",children:"Assigned service areas"})]}),e.jsx(se,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:ne.territories.map((D,r)=>e.jsx(ge,{className:`${L(D)} text-white`,children:D},r))})})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{children:[e.jsx(de,{className:"text-dark-primary",children:"Specializations"}),e.jsx(Re,{className:"text-dark-secondary",children:"Technical expertise areas"})]}),e.jsx(se,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:ne.specializations.map((D,r)=>e.jsx(ge,{className:"bg-indigo-600 text-white",children:D},r))})})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6 pt-6 border-t border-dark-color",children:[e.jsx("button",{onClick:()=>V(!1),className:"flex-1 dark-button-secondary",children:"Close"}),e.jsx("button",{onClick:()=>{V(!1),h(o),S(!0)},className:"flex-1 dark-button-primary",children:"View Full Profile"})]})]})}),P&&o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-dark-bg border-2 border-dark-color rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-dark-primary",children:"Edit FSE"}),e.jsx("button",{onClick:()=>v(!1),className:"text-dark-secondary hover:text-dark-primary",children:e.jsx(Ke,{className:"w-5 h-5"})})]}),N&&e.jsx("div",{className:"mb-4 p-3 bg-red-900 bg-opacity-30 rounded-lg border border-red-600",children:e.jsx("p",{className:"text-red-400 text-sm",children:N})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Name *"}),e.jsx(k,{value:o.name,onChange:D=>h({...o,name:D.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter full name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Email *"}),e.jsx(k,{type:"email",value:o.email,onChange:D=>h({...o,email:D.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter email address"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Phone *"}),e.jsx(k,{value:o.phone,onChange:D=>h({...o,phone:D.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter phone number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Employee ID *"}),e.jsx(k,{value:o.employeeId,onChange:D=>h({...o,employeeId:D.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter employee ID"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Designation"}),e.jsxs("select",{value:o.designation,onChange:D=>h({...o,designation:D.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"Field Service Engineer",children:"Field Service Engineer"}),e.jsx("option",{value:"Senior FSE",children:"Senior FSE"}),e.jsx("option",{value:"Lead FSE",children:"Lead FSE"}),e.jsx("option",{value:"Technical Specialist",children:"Technical Specialist"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Experience (Years)"}),e.jsx(k,{type:"number",value:o.experience,onChange:D=>h({...o,experience:Number(D.target.value)}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Status"}),e.jsxs("select",{value:o.status,onChange:D=>h({...o,status:D.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"}),e.jsx("option",{value:"On Leave",children:"On Leave"}),e.jsx("option",{value:"On Duty",children:"On Duty"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Assigned Territories"}),e.jsx("div",{className:"mt-2 space-y-2",children:["North","South","East","West","Central","NCR"].map(D=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:o.assignedTerritory.includes(D),onChange:r=>{r.target.checked?h({...o,assignedTerritory:[...o.assignedTerritory,D]}):h({...o,assignedTerritory:o.assignedTerritory.filter(H=>H!==D)})},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-dark-primary",children:D})]},D))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Specializations"}),e.jsx("div",{className:"mt-2 space-y-2",children:["Projector Installation","Maintenance","Repair","Network Setup","Software Configuration","Hardware Troubleshooting"].map(D=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:o.specialization.includes(D),onChange:r=>{r.target.checked?h({...o,specialization:[...o.specialization,D]}):h({...o,specialization:o.specialization.filter(H=>H!==D)})},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-dark-primary",children:D})]},D))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Supervisor Name"}),e.jsx(k,{value:o.supervisor.name,onChange:D=>h({...o,supervisor:{...o.supervisor,name:D.target.value}}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Supervisor name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Supervisor Email"}),e.jsx(k,{type:"email",value:o.supervisor.email,onChange:D=>h({...o,supervisor:{...o.supervisor,email:D.target.value}}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Supervisor email"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Emergency Contact Name"}),e.jsx(k,{value:o.emergencyContact.name,onChange:D=>h({...o,emergencyContact:{...o.emergencyContact,name:D.target.value}}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Emergency contact name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Emergency Contact Phone"}),e.jsx(k,{value:o.emergencyContact.phone,onChange:D=>h({...o,emergencyContact:{...o.emergencyContact,phone:D.target.value}}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Emergency contact phone"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Emergency Contact Relationship"}),e.jsx(k,{value:o.emergencyContact.relationship,onChange:D=>h({...o,emergencyContact:{...o.emergencyContact,relationship:D.target.value}}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"e.g., Spouse, Parent, Sibling"})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6 pt-6 border-t border-dark-color",children:[e.jsx("button",{onClick:()=>v(!1),className:"flex-1 dark-button-secondary",children:"Cancel"}),e.jsx("button",{onClick:ee,disabled:_||!o.name||!o.email||!o.phone||!o.employeeId,className:"flex-1 dark-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:_?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4 animate-spin mr-2"}),"Updating..."]}):"Update FSE"})]})]})}),O&&o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-dark-bg border-2 border-dark-color rounded-xl p-6 w-full max-w-6xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-dark-primary",children:["Service Reports - ",o.name]}),e.jsx("button",{onClick:()=>R(!1),className:"text-dark-secondary hover:text-dark-primary",children:e.jsx(Ke,{className:"w-5 h-5"})})]}),T?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ie,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-400"}),e.jsx("p",{className:"text-dark-secondary",children:"Loading reports..."})]}):F.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Oe,{className:"w-12 h-12 mx-auto mb-4 text-dark-secondary"}),e.jsx("h3",{className:"text-lg font-medium text-dark-primary mb-2",children:"No Reports Found"}),e.jsxs("p",{className:"text-dark-secondary",children:[o.name," hasn't submitted any service reports yet."]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-medium text-dark-primary",children:["Service Reports (",F.length,")"]}),e.jsxs(ge,{className:"bg-green-600 text-white",children:["Reports Filled: ",F.length]})]}),e.jsx("div",{className:"grid gap-4",children:F.map(D=>{var r,H,ae,be,Z,C;return e.jsx(te,{className:"dark-card hover:dark-shadow-lg transition-all duration-300",children:e.jsxs(se,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Oe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-dark-primary text-lg",children:D.reportNumber}),e.jsxs("p",{className:"text-sm text-dark-secondary",children:[D.reportTitle," - ",D.reportType]})]})]}),e.jsx(ge,{className:"bg-green-600 text-white",children:"Completed"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-dark-card p-3 rounded-lg border border-dark-color",children:[e.jsx("div",{className:"text-dark-secondary font-medium",children:"Site"}),e.jsx("div",{className:"text-dark-primary",children:D.siteName})]}),e.jsxs("div",{className:"bg-dark-card p-3 rounded-lg border border-dark-color",children:[e.jsx("div",{className:"text-dark-secondary font-medium",children:"Projector"}),e.jsxs("div",{className:"text-dark-primary",children:[D.brand," ",D.projectorModel]})]}),e.jsxs("div",{className:"bg-dark-card p-3 rounded-lg border border-dark-color",children:[e.jsx("div",{className:"text-dark-secondary font-medium",children:"Serial Number"}),e.jsx("div",{className:"text-dark-primary",children:D.projectorSerial})]}),e.jsxs("div",{className:"bg-dark-card p-3 rounded-lg border border-dark-color",children:[e.jsx("div",{className:"text-dark-secondary font-medium",children:"Date"}),e.jsx("div",{className:"text-dark-primary",children:Q(D.date)})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-dark-color",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsxs("span",{className:"text-dark-secondary",children:["Opticals: ",((H=(r=D.sections)==null?void 0:r.opticals)==null?void 0:H.length)||0]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsxs("span",{className:"text-dark-secondary",children:["Electronics: ",((be=(ae=D.sections)==null?void 0:ae.electronics)==null?void 0:be.length)||0]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),e.jsxs("span",{className:"text-dark-secondary",children:["Mechanical: ",((C=(Z=D.sections)==null?void 0:Z.mechanical)==null?void 0:C.length)||0]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(q,{variant:"outline",size:"sm",className:"dark-button-secondary",onClick:()=>{window.open(`/service-reports/${D._id}`,"_blank")},children:[e.jsx(es,{className:"w-4 h-4 mr-1"}),"View Report"]}),e.jsxs(q,{variant:"outline",size:"sm",className:"dark-button-primary",onClick:()=>{var f;(f=window.showToast)==null||f.call(window,{type:"success",title:"Report Export",message:"PDF export functionality will be implemented here."})},children:[e.jsx(We,{className:"w-4 h-4 mr-1"}),"Export PDF"]})]})]})})]})},D._id)})}),e.jsxs("div",{className:"bg-blue-900 bg-opacity-30 border border-blue-600 rounded-lg p-4 mt-6",children:[e.jsx("h4",{className:"font-semibold text-blue-400 mb-2",children:"Report Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-300",children:"Total Reports"}),e.jsx("div",{className:"text-white font-semibold",children:F.length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-300",children:"Latest Report"}),e.jsx("div",{className:"text-white font-semibold",children:F.length>0?Q(F[0].date):"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-300",children:"Report Types"}),e.jsx("div",{className:"text-white font-semibold",children:[...new Set(F.map(D=>D.reportType))].join(", ")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-300",children:"Sites Covered"}),e.jsx("div",{className:"text-white font-semibold",children:[...new Set(F.map(D=>D.siteName))].length})]})]})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6 pt-6 border-t border-dark-color",children:[e.jsx("button",{onClick:()=>R(!1),className:"flex-1 dark-button-secondary",children:"Close"}),e.jsx("button",{onClick:()=>{R(!1),h(o),V(!0)},className:"flex-1 dark-button-primary",children:"View Performance Metrics"})]})]})})]})}function Bi(){const[s,t]=n.useState(""),[a,l]=n.useState("All"),[i,o]=n.useState("All"),[h,c]=n.useState(null),[j,P]=n.useState([]),[v,x]=n.useState(!0),[S,E]=n.useState(null),[V,_]=n.useState(!1),[b,N]=n.useState(!1),[y,A]=n.useState(""),[u,$]=n.useState([]),[z,re]=n.useState(null),[K,ne]=n.useState("file"),[Y,O]=n.useState(null),[R,F]=n.useState(!1),[J,T]=n.useState([]),[w,g]=n.useState(!1),[p,M]=n.useState({partNumber:"",partName:"",category:"Spare Parts",brand:"",projectorModel:"",stockQuantity:0,reorderLevel:5,unitPrice:0,supplier:"",location:"",description:""});n.useEffect(()=>{m()},[]);const m=async()=>{try{x(!0),E(null);const Z=await ie.getAllSpareParts();P(Z),console.log("Loaded spare parts:",Z.length)}catch(Z){console.error("Error loading spare parts:",Z),E("Failed to load spare parts data.")}finally{x(!1)}},d=async()=>{var Z;try{x(!0),await ie.createSparePart(p),_(!1),M({partNumber:"",partName:"",category:"Spare Parts",brand:"",projectorModel:"",stockQuantity:0,reorderLevel:5,unitPrice:0,supplier:"",location:"",description:""}),await m(),(Z=window.showToast)==null||Z.call(window,{type:"success",title:"Part Added Successfully",message:`${p.partName} has been added to inventory`})}catch(C){console.error("Error adding part:",C),E("Failed to add new part.")}finally{x(!1)}},X=async()=>{var Z,C,f,he;try{x(!0),re(null);const pe=y.trim().split(`
`);if(pe.length<2){re("CSV must have at least a header row and one data row");return}const Pe=pe[0].split(",").map(U=>U.trim().replace(/"/g,"")),W=["partNumber","partName","category","projectorModel"],ve=Pe.map(U=>U.toLowerCase());if(!W.map(U=>U.toLowerCase()).every(U=>ve.includes(U))){re(`CSV must have these exact headers: ${W.join(", ")}. Found: ${Pe.join(", ")}`);return}const Ae=pe.slice(1).map((U,xe)=>{const Se=U.split(",").map(Me=>Me.trim().replace(/^"|"$/g,""));if(Se.length!==Pe.length)throw new Error(`Row ${xe+2} has ${Se.length} columns, expected ${Pe.length}`);const ze={TEST:"Spare Parts",Lamps:"Spare Parts",Filters:"Spare Parts",Boards:"Spare Parts",Cables:"Spare Parts",Other:"Spare Parts",RMA:"RMA"},cs=Se[Pe.indexOf("category")],fs=ze[cs]||"Spare Parts",is={partNumber:Se[Pe.indexOf("partNumber")],partName:Se[Pe.indexOf("partName")],category:fs,projectorModel:Se[Pe.indexOf("projectorModel")],stockQuantity:0,reorderLevel:5,unitPrice:1,status:"In Stock",brand:"Christie",supplier:"TBD",location:"Warehouse",description:""},Ee=["partNumber","partName","category","projectorModel","brand","unitPrice","supplier","location"].filter(Me=>!is[Me]);return Ee.length>0&&(console.error("Missing required fields:",Ee),console.error("Part object:",is)),console.log("Complete part object before API call:",JSON.stringify(is,null,2)),console.log("Field check - brand:",is.brand),console.log("Field check - unitPrice:",is.unitPrice),console.log("Field check - supplier:",is.supplier),console.log("Field check - location:",is.location),is}),Ue=Ae.map(U=>U.partNumber),Fe=Ue.filter((U,xe)=>Ue.indexOf(U)!==xe);if(Fe.length>0){const U=[...new Set(Fe)];console.warn("Duplicate part numbers found in CSV:",U)}try{const xe=(await ie.getAllSpareParts()).map(ze=>ze.partNumber),Se=Ue.filter(ze=>xe.includes(ze));Se.length>0&&console.warn("Part numbers already exist in database:",Se)}catch(U){console.warn("Could not check existing part numbers:",U)}Ae.length>0&&(console.log("First part structure:",Ae[0]),console.log("First part keys:",Object.keys(Ae[0])));const $e=[],Ve=[];console.log("Starting bulk upload with",Ae.length,"parts"),console.log("First few parts:",Ae.slice(0,3));for(const U of Ae)try{console.log("Creating part:",U.partNumber,U.partName);const xe=await ie.createSparePart(U);$e.push(xe),console.log("Successfully created:",U.partNumber)}catch(xe){console.error(`Failed to create part ${U.partNumber}:`,xe),console.error("Part data that failed:",U),Ve.push({partNumber:U.partNumber,error:xe.message||"Unknown error",details:((Z=xe.response)==null?void 0:Z.data)||xe.data||"No additional details"})}console.log("Bulk upload completed. Created:",$e.length,"Failed:",Ve.length),Ve.length>0&&console.log("Failed parts:",Ve.slice(0,5)),N(!1),A(""),$([]),await m(),$e.length===0&&Ve.length>0?(C=window.showToast)==null||C.call(window,{type:"error",title:"Bulk Upload Failed",message:"Failed to add any spare parts. Check console for details."}):Ve.length>0?(f=window.showToast)==null||f.call(window,{type:"warning",title:"Bulk Upload Partial Success",message:`Successfully added ${$e.length} out of ${Ae.length} spare parts. ${Ve.length} failed.`}):(he=window.showToast)==null||he.call(window,{type:"success",title:"Bulk Upload Successful",message:`Successfully added ${$e.length} out of ${Ae.length} spare parts`})}catch(pe){console.error("Error in bulk upload:",pe),re(pe.message||"Failed to process bulk upload")}finally{x(!1)}},ee=Z=>{var f;const C=(f=Z.target.files)==null?void 0:f[0];if(C){console.log("File selected:",C.name,"Size:",C.size,"Type:",C.type),O(C),re(null),F(!0);const he=new FileReader;he.onload=pe=>{var W;const Pe=(W=pe.target)==null?void 0:W.result;console.log("File content length:",Pe.length),A(Pe),B(Pe),F(!1)},he.onerror=()=>{console.error("Error reading file"),re("Error reading file. Please try again."),F(!1)},he.readAsText(C)}},B=Z=>{try{re(null);const C=Z.trim().split(`
`);if(C.length<2){re("CSV must have at least a header row and one data row");return}const f=C[0].split(",").map(Ce=>Ce.trim().replace(/"/g,"")),he=["partNumber","partName","category","projectorModel"],pe=f.map(Ce=>Ce.toLowerCase());if(!he.map(Ce=>Ce.toLowerCase()).every(Ce=>pe.includes(Ce))){re(`CSV must have these exact headers: ${he.join(", ")}. Found: ${f.join(", ")}`);return}const W=[];if(C.slice(1).forEach((Ce,Ae)=>{Ce.split(",").map(Fe=>Fe.trim().replace(/^"|"$/g,"")).length!==f.length&&W.push(Ae+2)}),W.length>0){const Ce=W.slice(0,5).join(", "),Ae=W.length>5?` and ${W.length-5} more`:"";re(`Rows ${Ce}${Ae} have incorrect number of columns. Expected ${f.length}, found different. Click "Show Problem Rows" to see details.`);const Ue=W.map(Fe=>{const $e=Fe-2,Ve=C[$e+1],U=Ve.split(",").map(xe=>xe.trim().replace(/^"|"$/g,""));return{row:Fe,content:Ve,expected:f.length,actual:U.length}});T(Ue);return}const ve=C.slice(1,6).map((Ce,Ae)=>{const Ue=Ce.split(",").map($e=>$e.trim().replace(/^"|"$/g,"")),Fe={};return f.forEach(($e,Ve)=>{Fe[$e]=Ue[Ve]}),Fe});$(ve)}catch(C){re(C.message||"Failed to process CSV data")}},ce=()=>{B(y)},me=async()=>{var Z;try{x(!0);const C=Ss(j,["partNumber","partName","category","brand","projectorModel","stockQuantity","unitPrice","status"]);Cs(C,`spare_parts_inventory_${new Date().toISOString().split("T")[0]}.csv`),(Z=window.showToast)==null||Z.call(window,{type:"success",title:"Export Successful",message:"Spare parts inventory exported to CSV file"})}catch(C){console.error("Error exporting inventory:",C),E("Failed to export inventory: "+C.message)}finally{x(!1)}},L=async Z=>{var C;try{const f=j.find(pe=>pe._id===Z);if(!f){E("Part not found");return}const he=Xa(f,"part");Qa(he),(C=window.showToast)==null||C.call(window,{type:"success",title:"Label Printed",message:`Part label for ${f.partNumber} sent to printer`})}catch(f){console.error("Error printing label:",f),E("Failed to print label: "+f.message)}},Q=j.filter(Z=>{var pe,Pe,W;if(Z.category==="RMA")return!1;const C=(((pe=Z.partName)==null?void 0:pe.toLowerCase().includes(s.toLowerCase()))||((Pe=Z.partNumber)==null?void 0:Pe.toLowerCase().includes(s.toLowerCase()))||((W=Z.brand)==null?void 0:W.toLowerCase().includes(s.toLowerCase())))??!1,f=a==="All"||Z.category===a,he=i==="All"||Z.status===i;return C&&f&&he}),D=Z=>{switch(Z){case"In Stock":return"bg-green-600";case"Low Stock":return"bg-orange-600";case"Out of Stock":return"bg-red-600";case"On Order":return"bg-blue-600";case"Discontinued":return"bg-gray-600";default:return"bg-gray-600"}},r=Z=>{switch(Z){case"Spare Parts":return"bg-blue-600";case"Lamps":return"bg-yellow-600";case"Filters":return"bg-green-600";case"Boards":return"bg-purple-600";case"Cables":return"bg-orange-600";case"Other":return"bg-gray-600";default:return"bg-gray-600"}},H=Z=>{switch(Z){case"In Stock":return e.jsx(Be,{className:"w-4 h-4"});case"Low Stock":return e.jsx(Te,{className:"w-4 h-4"});case"Out of Stock":return e.jsx(Te,{className:"w-4 h-4"});case"On Order":return e.jsx(ts,{className:"w-4 h-4"});case"Discontinued":return e.jsx(Ke,{className:"w-4 h-4"});default:return e.jsx(Je,{className:"w-4 h-4"})}},ae=async(Z,C)=>{try{await ie.updateSparePartStock(Z,C),await m(),console.log("Part stock updated successfully")}catch(f){console.error("Error updating part stock:",f),E("Failed to update part stock.")}},be=Z=>Z?new Date(Z).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Not available";return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"bg-dark-bg border-b border-dark-color px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-dark-primary",children:"Spare Parts Inventory"}),e.jsx("p",{className:"text-sm text-dark-secondary mt-1",children:"Manage spare parts inventory, stock levels, suppliers, and reorder alerts"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:m,className:"dark-button-secondary gap-2 flex items-center",disabled:v,children:[e.jsx(Qe,{className:`w-4 h-4 ${v?"animate-spin":""}`}),"Refresh"]}),e.jsxs("button",{onClick:()=>N(!0),className:"dark-button-secondary gap-2 flex items-center",children:[e.jsx(Ns,{className:"w-4 h-4"}),"Bulk Upload"]}),e.jsxs("button",{onClick:me,disabled:v,className:"dark-button-secondary gap-2 flex items-center",children:[e.jsx(We,{className:"w-4 h-4"}),"Export Inventory"]}),e.jsxs("button",{onClick:()=>_(!0),className:"dark-button-primary gap-2 flex items-center",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Add Part"]})]})]})}),e.jsxs("main",{className:"flex-1 overflow-auto p-8 bg-dark-bg",children:[S&&e.jsx("div",{className:"mb-6 p-4 bg-red-900 bg-opacity-30 rounded-lg border border-red-600",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{className:"w-5 h-5 text-red-400"}),e.jsx("p",{className:"text-red-400",children:S})]})}),e.jsxs("div",{className:"flex items-center space-x-4 mb-8",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(vs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-dark-secondary w-4 h-4"}),e.jsx(k,{placeholder:"Search parts, numbers, or brands...",value:s,onChange:Z=>t(Z.target.value),className:"pl-10 bg-dark-card border-dark-color text-dark-primary"})]}),e.jsxs("select",{value:a,onChange:Z=>l(Z.target.value),className:"px-4 py-2 bg-dark-card border border-dark-color rounded-xl text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"All",children:"All Categories"}),e.jsx("option",{value:"Spare Parts",children:"Spare Parts"}),e.jsx("option",{value:"Lamps",children:"Lamps"}),e.jsx("option",{value:"Filters",children:"Filters"}),e.jsx("option",{value:"Boards",children:"Boards"}),e.jsx("option",{value:"Cables",children:"Cables"}),e.jsx("option",{value:"Other",children:"Other"})]}),e.jsxs("select",{value:i,onChange:Z=>o(Z.target.value),className:"px-4 py-2 bg-dark-card border border-dark-color rounded-xl text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"All",children:"All Status"}),e.jsx("option",{value:"In Stock",children:"In Stock"}),e.jsx("option",{value:"Low Stock",children:"Low Stock"}),e.jsx("option",{value:"Out of Stock",children:"Out of Stock"}),e.jsx("option",{value:"On Order",children:"On Order"}),e.jsx("option",{value:"Discontinued",children:"Discontinued"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{className:"text-sm text-dark-secondary",children:"MongoDB + Express.js"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-8",children:[e.jsxs("div",{className:"dark-card text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-600 flex items-center justify-center mx-auto mb-4",children:e.jsx(Je,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-dark-primary mb-1",children:j.length}),e.jsx("p",{className:"text-sm text-dark-secondary",children:"Total Parts"})]}),e.jsxs("div",{className:"dark-card text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-600 flex items-center justify-center mx-auto mb-4",children:e.jsx(Be,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-dark-primary mb-1",children:j.filter(Z=>Z.status==="In Stock").length}),e.jsx("p",{className:"text-sm text-dark-secondary",children:"In Stock"})]}),e.jsxs("div",{className:"dark-card text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-orange-600 flex items-center justify-center mx-auto mb-4",children:e.jsx(Te,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-dark-primary mb-1",children:j.filter(Z=>Z.status==="Low Stock").length}),e.jsx("p",{className:"text-sm text-dark-secondary",children:"Low Stock"})]}),e.jsxs("div",{className:"dark-card text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-orange-600 flex items-center justify-center mx-auto mb-4",children:e.jsx(Te,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-dark-primary mb-1",children:j.filter(Z=>Z.status==="Low Stock").length}),e.jsx("p",{className:"text-sm text-dark-secondary",children:"Low Stock Alerts"})]}),e.jsxs("div",{className:"dark-card text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-600 flex items-center justify-center mx-auto mb-4",children:e.jsx(Al,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-dark-primary mb-1",children:j.reduce((Z,C)=>Z+(C.stockQuantity||0),0)}),e.jsx("p",{className:"text-sm text-dark-secondary",children:"Total Stock"})]})]}),e.jsx("div",{className:"dark-card",children:v?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ie,{className:"w-12 h-12 text-dark-secondary mx-auto mb-4 animate-spin"}),e.jsx("p",{className:"text-dark-secondary",children:"Loading spare parts..."})]}):Q.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-color",children:[e.jsx("th",{className:"text-left font-semibold text-dark-primary pb-4",children:"Part Details"}),e.jsx("th",{className:"text-left font-semibold text-dark-primary pb-4",children:"Brand & Model"}),e.jsx("th",{className:"text-center font-semibold text-dark-primary pb-4",children:"Category"}),e.jsx("th",{className:"text-center font-semibold text-dark-primary pb-4",children:"Stock"}),e.jsx("th",{className:"text-center font-semibold text-dark-primary pb-4",children:"Status"}),e.jsx("th",{className:"text-right font-semibold text-dark-primary pb-4",children:"Price"}),e.jsx("th",{className:"text-center font-semibold text-dark-primary pb-4",children:"Actions"})]})}),e.jsx("tbody",{children:Q.map((Z,C)=>e.jsxs("tr",{className:"border-b border-dark-color hover:bg-dark-table-hover transition-colors",children:[e.jsx("td",{className:"py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-dark-primary",children:Z.partName}),e.jsxs("p",{className:"text-xs text-dark-secondary flex items-center gap-1 mt-1",children:[e.jsx(_a,{className:"w-3 h-3"}),Z.partNumber]}),e.jsxs("p",{className:"text-xs text-dark-secondary flex items-center gap-1",children:[e.jsx(Ye,{className:"w-3 h-3"}),"Updated: ",be(Z.updatedAt)]})]})}),e.jsx("td",{className:"py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-dark-primary",children:Z.brand}),e.jsxs("p",{className:"text-xs text-dark-secondary flex items-center gap-1 mt-1",children:[e.jsx(ss,{className:"w-3 h-3"}),Z.projectorModel]})]})}),e.jsx("td",{className:"py-4 text-center",children:e.jsxs("div",{className:`dark-tag ${r(Z.category)} flex items-center gap-1 justify-center`,children:[Z.category==="RMA"?e.jsx(ms,{className:"w-3 h-3"}):e.jsx(Je,{className:"w-3 h-3"}),Z.category]})}),e.jsx("td",{className:"py-4 text-center",children:e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-dark-primary",children:Z.stockQuantity||0}),e.jsxs("p",{className:"text-xs text-dark-secondary",children:["Min: ",Z.reorderLevel||0]})]})}),e.jsx("td",{className:"py-4 text-center",children:e.jsxs("div",{className:`dark-tag ${D(Z.status)} flex items-center gap-1 justify-center`,children:[H(Z.status),Z.status]})}),e.jsx("td",{className:"py-4 text-right",children:e.jsxs("span",{className:"text-sm font-semibold text-dark-primary",children:["₹",(Z.unitPrice||0).toLocaleString()]})}),e.jsx("td",{className:"py-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("button",{className:"p-2 hover:bg-dark-hover rounded-lg transition-colors",onClick:()=>c(Z),children:e.jsx(es,{className:"w-4 h-4 text-dark-secondary"})}),e.jsx("button",{className:"p-2 hover:bg-dark-hover rounded-lg transition-colors",children:e.jsx(ks,{className:"w-4 h-4 text-dark-secondary"})}),Z.category==="RMA"&&e.jsx("button",{className:"p-2 hover:bg-dark-hover rounded-lg transition-colors",children:e.jsx(ms,{className:"w-4 h-4 text-blue-400"})})]})})]},Z._id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Je,{className:"w-16 h-16 text-dark-secondary mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-dark-primary mb-2",children:"No Parts Found"}),e.jsx("p",{className:"text-dark-secondary",children:s||a!=="All"||i!=="All"?"No parts match your current filters.":"No spare parts have been added to the system yet."})]})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-dark-bg border-2 border-dark-color rounded-xl p-6 max-w-3xl w-full max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-dark-primary",children:"Part Details"}),e.jsx("button",{onClick:()=>c(null),className:"p-2 hover:bg-dark-hover rounded-lg transition-colors",children:e.jsx(Vs,{className:"w-5 h-5 text-dark-secondary"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Basic Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Part Name"}),e.jsx("p",{className:"text-dark-primary font-semibold",children:h.partName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Part Number"}),e.jsx("p",{className:"text-dark-primary",children:h.partNumber})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Brand"}),e.jsx("p",{className:"text-dark-primary",children:h.brand})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Model"}),e.jsx("p",{className:"text-dark-primary",children:h.projectorModel})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Category"}),e.jsxs("div",{className:`dark-tag ${r(h.category)} inline-flex items-center gap-1 mt-1`,children:[h.category==="RMA"?e.jsx(ms,{className:"w-3 h-3"}):e.jsx(Je,{className:"w-3 h-3"}),h.category]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Stock Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Current Stock"}),e.jsx("p",{className:"text-dark-primary font-semibold text-xl",children:h.stockQuantity||0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Reorder Level"}),e.jsx("p",{className:"text-dark-primary font-semibold text-xl",children:h.reorderLevel||0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Unit Price"}),e.jsxs("p",{className:"text-dark-primary font-semibold",children:["₹",(h.unitPrice||0).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Status"}),e.jsxs("div",{className:`dark-tag ${D(h.status)} inline-flex items-center gap-1 mt-1`,children:[H(h.status),h.status]})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Additional Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Supplier"}),e.jsx("p",{className:"text-dark-primary",children:h.supplier||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Location"}),e.jsxs("p",{className:"text-dark-primary flex items-center gap-1",children:[e.jsx(ds,{className:"w-4 h-4 text-dark-secondary"}),h.location||"Not specified"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Last Updated"}),e.jsxs("p",{className:"text-dark-primary flex items-center gap-1",children:[e.jsx(Ye,{className:"w-4 h-4 text-dark-secondary"}),be(h.updatedAt)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Description"}),e.jsx("p",{className:"text-dark-primary",children:h.description||"No description available"})]})]})]})})]}),e.jsxs("div",{className:"flex space-x-3 pt-6 mt-6 border-t border-dark-color",children:[e.jsx("button",{className:"flex-1 dark-button-secondary",onClick:()=>{var C;const Z=prompt("Enter new stock quantity:",((C=h.stockQuantity)==null?void 0:C.toString())||"0");Z&&!isNaN(Number(Z))&&(ae(h._id,Number(Z)),c(null))},children:"Update Stock"}),h.category==="RMA"&&e.jsx("button",{className:"flex-1 dark-button-primary",children:"Process RMA"}),h.status==="Low Stock"&&e.jsx("button",{className:"flex-1 dark-button-primary",children:"Reorder Stock"}),e.jsx("button",{onClick:()=>L(h._id),className:"dark-button-secondary px-6",children:"Print Label"})]})]})})]}),V&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-dark-bg border-2 border-dark-color rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-dark-primary",children:"Add New Part"}),e.jsx("button",{onClick:()=>_(!1),className:"text-dark-secondary hover:text-dark-primary",children:e.jsx(Ke,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Part Number *"}),e.jsx(k,{value:p.partNumber,onChange:Z=>M({...p,partNumber:Z.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter part number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Part Name *"}),e.jsx(k,{value:p.partName,onChange:Z=>M({...p,partName:Z.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter part name"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Brand *"}),e.jsx(k,{value:p.brand,onChange:Z=>M({...p,brand:Z.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter brand"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Projector Model *"}),e.jsx(k,{value:p.projectorModel,onChange:Z=>M({...p,projectorModel:Z.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter projector model"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Stock Quantity"}),e.jsx(k,{type:"number",value:p.stockQuantity,onChange:Z=>M({...p,stockQuantity:Number(Z.target.value)}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Reorder Level"}),e.jsx(k,{type:"number",value:p.reorderLevel,onChange:Z=>M({...p,reorderLevel:Number(Z.target.value)}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Unit Price (₹)"}),e.jsx(k,{type:"number",value:p.unitPrice,onChange:Z=>M({...p,unitPrice:Number(Z.target.value)}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"0"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Category"}),e.jsxs("select",{value:p.category,onChange:Z=>M({...p,category:Z.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"Spare Parts",children:"Spare Parts"}),e.jsx("option",{value:"RMA",children:"RMA Items"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Supplier"}),e.jsx(k,{value:p.supplier,onChange:Z=>M({...p,supplier:Z.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter supplier"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Location"}),e.jsx(k,{value:p.location,onChange:Z=>M({...p,location:Z.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter storage location"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Description"}),e.jsx("textarea",{value:p.description,onChange:Z=>M({...p,description:Z.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",rows:3,placeholder:"Enter part description"})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6 pt-6 border-t border-dark-color",children:[e.jsx("button",{onClick:()=>_(!1),className:"flex-1 dark-button-secondary",children:"Cancel"}),e.jsx("button",{onClick:d,disabled:v||!p.partNumber||!p.partName||!p.brand||!p.projectorModel,className:"flex-1 dark-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:v?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4 animate-spin mr-2"}),"Adding..."]}):"Add Part"})]})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-dark-card border border-dark-color rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-dark-primary",children:"Bulk Upload Spare Parts"}),e.jsx("button",{onClick:()=>{N(!1),A(""),$([]),re(null),O(null),ne("file"),F(!1),T([]),g(!1)},className:"text-dark-secondary hover:text-dark-primary",children:e.jsx(Ke,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-900 bg-opacity-30 border border-blue-600 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("h3",{className:"font-semibold text-blue-400",children:"CSV Format Instructions"})}),e.jsx("p",{className:"text-blue-300 text-sm mb-2",children:"Upload a CSV file with exactly 4 columns for reference purposes:"}),e.jsxs("ul",{className:"text-blue-300 text-sm space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"partNumber:"})," Manufacturer part number (e.g., LMP-001)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"partName:"})," Name of the spare part (e.g., Lamp Module)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"category:"})," Category (e.g., Lamps, Filters, Boards, Cables, Other)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"projectorModel:"})," Compatible projector model (e.g., CP2220, CP2230, CP4220, CP4230, CP2215, CP4425-RGB)"]})]}),e.jsx("div",{className:"mt-3 p-2 bg-dark-bg rounded border border-blue-600",children:e.jsxs("p",{className:"text-blue-300 text-xs font-mono",children:["partNumber,partName,category,projectorModel",e.jsx("br",{}),"LMP-001,Lamp Module,Lamps,CP2220",e.jsx("br",{}),"FLT-002,Air Filter,Filters,CP2230",e.jsx("br",{}),"BRD-003,Main Board,Boards,CP4220"]})})]}),e.jsxs("div",{className:"flex space-x-4 mb-4",children:[e.jsxs("button",{onClick:()=>ne("file"),className:`px-4 py-2 rounded-lg border transition-colors ${K==="file"?"bg-dark-cta border-dark-cta text-white":"bg-dark-bg border-dark-color text-dark-secondary hover:text-dark-primary"}`,children:[e.jsx(Ns,{className:"w-4 h-4 inline mr-2"}),"Upload File"]}),e.jsxs("button",{onClick:()=>ne("paste"),className:`px-4 py-2 rounded-lg border transition-colors ${K==="paste"?"bg-dark-cta border-dark-cta text-white":"bg-dark-bg border-dark-color text-dark-secondary hover:text-dark-primary"}`,children:[e.jsx(Oe,{className:"w-4 h-4 inline mr-2"}),"Paste Data"]})]}),K==="file"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary mb-2 block",children:"Upload CSV File"}),e.jsxs("div",{className:"border-2 border-dashed border-dark-color rounded-lg p-6 text-center hover:border-dark-cta transition-colors",children:[e.jsx("input",{type:"file",accept:".csv",onChange:ee,className:"hidden",id:"csv-file-upload",disabled:R}),e.jsx("label",{htmlFor:"csv-file-upload",className:`cursor-pointer ${R?"opacity-50":""}`,children:R?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-8 h-8 mx-auto mb-2 text-dark-secondary animate-spin"}),e.jsx("p",{className:"text-dark-secondary mb-1",children:"Processing file..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ns,{className:"w-8 h-8 mx-auto mb-2 text-dark-secondary"}),e.jsx("p",{className:"text-dark-secondary mb-1",children:Y?Y.name:"Click to select CSV file"}),e.jsx("p",{className:"text-xs text-dark-secondary",children:"or drag and drop your CSV file here"})]})})]})]}),K==="paste"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary mb-2 block",children:"Paste CSV Data"}),e.jsx("textarea",{value:y,onChange:Z=>A(Z.target.value),className:"w-full h-48 px-3 py-2 bg-dark-bg border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta font-mono text-sm",placeholder:"partNumber,partName,category,projectorModel"})]}),z&&e.jsx("div",{className:"p-4 bg-red-900 bg-opacity-30 rounded-lg border border-red-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{className:"w-5 h-5 text-red-400"}),e.jsx("p",{className:"text-red-400 text-sm",children:z})]}),J.length>0&&e.jsx("button",{onClick:()=>g(!0),className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded-lg transition-colors",children:"Show Problem Rows"})]})}),u.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-dark-primary mb-3",children:"Preview (First 5 rows)"}),e.jsx("div",{className:"bg-dark-bg border border-dark-color rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-dark-color",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-dark-secondary",children:"Part Number"}),e.jsx("th",{className:"px-3 py-2 text-left text-dark-secondary",children:"Part Name"}),e.jsx("th",{className:"px-3 py-2 text-left text-dark-secondary",children:"Category"}),e.jsx("th",{className:"px-3 py-2 text-left text-dark-secondary",children:"Projector Model"})]})}),e.jsx("tbody",{children:u.map((Z,C)=>e.jsxs("tr",{className:"border-t border-dark-color",children:[e.jsx("td",{className:"px-3 py-2 text-dark-primary",children:Z.partNumber}),e.jsx("td",{className:"px-3 py-2 text-dark-primary",children:Z.partName}),e.jsx("td",{className:"px-3 py-2 text-dark-primary",children:Z.category}),e.jsx("td",{className:"px-3 py-2 text-dark-primary",children:Z.projectorModel})]},C))})]})})]}),e.jsxs("div",{className:"flex space-x-3 pt-4 border-t border-dark-color",children:[e.jsxs("button",{onClick:ce,className:"flex-1 dark-button-secondary gap-2 flex items-center justify-center",children:[e.jsx(es,{className:"w-4 h-4"}),"Preview"]}),e.jsx("button",{onClick:()=>{N(!1),A(""),$([]),re(null),O(null),ne("file"),F(!1)},className:"flex-1 dark-button-secondary",children:"Cancel"}),e.jsx("button",{onClick:X,disabled:v||!y.trim(),className:"flex-1 dark-button-primary disabled:opacity-50 disabled:cursor-not-allowed gap-2 flex items-center justify-center",children:v?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ns,{className:"w-4 h-4"}),"Upload Parts"]})})]})]})]})}),w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-dark-card border border-dark-color rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-dark-primary",children:"Problem Rows in CSV"}),e.jsx("button",{onClick:()=>g(!1),className:"text-dark-secondary hover:text-dark-primary",children:e.jsx(Ke,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-yellow-900 bg-opacity-30 border border-yellow-600 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-yellow-400 mb-2",children:"How to Fix:"}),e.jsxs("ul",{className:"text-yellow-300 text-sm space-y-1",children:[e.jsx("li",{children:"• Each row must have exactly 4 columns: partNumber, partName, category, projectorModel"}),e.jsx("li",{children:"• Remove any extra commas or columns"}),e.jsx("li",{children:'• If a value contains commas, wrap it in quotes: "Part, Name"'}),e.jsx("li",{children:"• Check for trailing commas at the end of rows"})]})]}),e.jsx("div",{className:"bg-dark-bg border border-dark-color rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-dark-color",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-dark-secondary",children:"Row #"}),e.jsx("th",{className:"px-3 py-2 text-left text-dark-secondary",children:"Expected Columns"}),e.jsx("th",{className:"px-3 py-2 text-left text-dark-secondary",children:"Actual Columns"}),e.jsx("th",{className:"px-3 py-2 text-left text-dark-secondary",children:"Row Content"})]})}),e.jsx("tbody",{children:J.map((Z,C)=>e.jsxs("tr",{className:"border-t border-dark-color",children:[e.jsx("td",{className:"px-3 py-2 text-red-400 font-mono",children:Z.row}),e.jsx("td",{className:"px-3 py-2 text-green-400 font-mono",children:Z.expected}),e.jsx("td",{className:"px-3 py-2 text-red-400 font-mono",children:Z.actual}),e.jsx("td",{className:"px-3 py-2 text-dark-primary font-mono text-xs break-all",children:Z.content})]},C))})]})}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-dark-color",children:e.jsx("button",{onClick:()=>g(!1),className:"dark-button-secondary",children:"Close"})})]})]})})]})}function zi(){const{rma:s,refreshRMA:t,isLoading:a}=Us(),[l,i]=n.useState(0),[o,h]=n.useState([]),c=r=>({_id:r._id,rmaNumber:r.rmaNumber||r.rmaNumber||"N/A",callLogNumber:r.callLogNumber||r.callLogNumber||"N/A",rmaOrderNumber:r.rmaOrderNumber||r.rmaOrderNumber||"N/A",ascompRaisedDate:r.ascompRaisedDate?new Date(r.ascompRaisedDate).toLocaleDateString():r.issueDate?new Date(r.issueDate).toLocaleDateString():"N/A",customerErrorDate:r.customerErrorDate?new Date(r.customerErrorDate).toLocaleDateString():r.issueDate?new Date(r.issueDate).toLocaleDateString():"N/A",siteName:r.siteName||r.customerSite||"N/A",productName:r.productName||r.projectorModel||"N/A",productPartNumber:r.productPartNumber||r.partNumber||"N/A",serialNumber:r.serialNumber||r.projectorSerial||"N/A",defectivePartNumber:r.defectivePartNumber||r.partNumber||"N/A",defectivePartName:r.defectivePartName||r.partName||"Projector Component",defectiveSerialNumber:r.defectiveSerialNumber||r.projectorSerial||"N/A",symptoms:r.symptoms||r.failureDescription||r.reason||"N/A",replacedPartNumber:r.replacedPartNumber||"N/A",replacedPartName:r.replacedPartName||"N/A",replacedPartSerialNumber:r.replacedPartSerialNumber||"N/A",replacementNotes:r.replacementNotes||"N/A",shippedDate:r.shippedDate?new Date(r.shippedDate).toLocaleDateString():"N/A",trackingNumber:r.trackingNumber||"N/A",shippedThru:r.shippedThru||"N/A",remarks:r.remarks||r.notes||"N/A",createdBy:r.createdBy||r.technician||"System",caseStatus:r.caseStatus||r.status||"Under Review",rmaReturnShippedDate:r.rmaReturnShippedDate?new Date(r.rmaReturnShippedDate).toLocaleDateString():"N/A",rmaReturnTrackingNumber:r.rmaReturnTrackingNumber||"N/A",rmaReturnShippedThru:r.rmaReturnShippedThru||"N/A",daysCountShippedToSite:r.daysCountShippedToSite||0,daysCountReturnToCDS:r.daysCountReturnToCDS||0,priority:r.priority||"Medium",warrantyStatus:r.warrantyStatus||"In Warranty",estimatedCost:r.estimatedCost||0,notes:r.notes||"N/A",brand:r.brand||"N/A",projectorModel:r.projectorModel||"N/A",customerSite:r.customerSite||"N/A",technician:r.technician||"N/A",physicalCondition:r.physicalCondition||"Good",logicalCondition:r.logicalCondition||"Good",issueDescription:r.issueDescription||r.failureDescription||r.reason||"N/A",rmaReason:r.rmaReason||r.reason||"N/A",approvalStatus:r.approvalStatus||"Pending Review",assignedTo:r.assignedTo||r.technician||"N/A"});n.useEffect(()=>{if(s&&s.length>0){const r=s.map(c);h(r),console.log("Mapped RMA data:",r)}else h([])},[s]),console.log("RMAPage rendered with",(s==null?void 0:s.length)||0,"items"),console.log("Local RMA items:",(o==null?void 0:o.length)||0,"items"),n.useEffect(()=>{i(r=>r+1)},[s]),n.useEffect(()=>{console.log("RMA Items length:",(s==null?void 0:s.length)||0),s&&s.length>0&&(console.log("RMA Items from DataContext:",s[0]),console.log("First RMA _id:",s[0]._id),console.log("All RMA _ids:",s.map(r=>r._id)),console.log("All RMA statuses:",s.map(r=>({rmaNumber:r.rmaNumber,status:r.status,caseStatus:r.caseStatus}))))},[s]);const[j,P]=n.useState(""),[v,x]=n.useState("All"),[S,E]=n.useState("All"),[V,_]=n.useState(null),[b,N]=n.useState(!1),[y,A]=n.useState(!1),[u,$]=n.useState(null),[z,re]=n.useState(!1),[K,ne]=n.useState(null),[Y,O]=n.useState(!1),[R,F]=n.useState(""),[J,T]=n.useState([]),[w,g]=n.useState({rmaNumber:"",callLogNumber:"",rmaOrderNumber:"",ascompRaisedDate:"",customerErrorDate:"",siteName:"",productName:"",productPartNumber:"",serialNumber:"",defectivePartNumber:"",defectivePartName:"",defectiveSerialNumber:"",symptoms:"",replacedPartNumber:"",replacedPartName:"",replacedPartSerialNumber:"",replacementNotes:"",shippedDate:"",trackingNumber:"",shippedThru:"",remarks:"",createdBy:"",caseStatus:"Under Review",rmaReturnShippedDate:"",rmaReturnTrackingNumber:"",rmaReturnShippedThru:"",daysCountShippedToSite:0,daysCountReturnToCDS:0,priority:"Medium",warrantyStatus:"In Warranty",estimatedCost:0,notes:"",brand:"",projectorModel:"",customerSite:"",technician:"",physicalCondition:"Good",logicalCondition:"Good",issueDescription:"",rmaReason:""});n.useEffect(()=>{p()},[]);const p=async()=>{try{const r=await ie.getAllProjectors();T(r)}catch(r){console.error("Error loading projectors:",r),ne("Failed to load projector data.")}},M=r=>{g({...w,serialNumber:r.serialNumber,productName:r.model,siteName:r.site,createdBy:r.technician||"System"}),O(!1),F("")},m=(o||[]).filter(r=>{const H=(r.productName||"").toLowerCase().includes(j.toLowerCase())||(r.rmaNumber||"").toLowerCase().includes(j.toLowerCase())||(r.siteName||"").toLowerCase().includes(j.toLowerCase())||(r.serialNumber||"").toLowerCase().includes(j.toLowerCase())||(r.defectivePartName||"").toLowerCase().includes(j.toLowerCase()),ae=v==="All"||r.caseStatus===v,be=S==="All"||r.priority===S;return H&&ae&&be}),d=r=>{switch(r){case"Under Review":return"bg-yellow-50 text-yellow-700 border border-yellow-200";case"Replacement Approved":return"bg-green-50 text-green-700 border border-green-200";case"Repair In Progress":return"bg-blue-50 text-blue-700 border border-blue-200";case"In Progress":return"bg-blue-50 text-blue-700 border border-blue-200";case"Completed":return"bg-gray-50 text-gray-700 border border-gray-200";case"Rejected":return"bg-red-50 text-red-700 border border-red-200";case"Sent to CDS":return"bg-purple-50 text-purple-700 border border-purple-200";case"CDS Approved":return"bg-emerald-50 text-emerald-700 border border-emerald-200";case"Replacement Shipped":return"bg-indigo-50 text-indigo-700 border border-indigo-200";default:return"bg-gray-50 text-gray-700 border border-gray-200"}},X=r=>{switch(r){case"High":return"text-red-400";case"Medium":return"text-orange-400";case"Low":return"text-green-400";default:return"text-gray-400"}},ee=r=>{switch(r){case"In Warranty":return"text-green-400";case"Extended Warranty":return"text-blue-400";case"Out of Warranty":return"text-orange-400";case"Expired":return"text-red-400";default:return"text-gray-400"}},B=r=>{switch(r){case"Under Review":return e.jsx(ts,{className:"w-4 h-4"});case"Replacement Approved":return e.jsx(Be,{className:"w-4 h-4"});case"Repair In Progress":return e.jsx(Te,{className:"w-4 h-4"});case"In Progress":return e.jsx(Te,{className:"w-4 h-4"});case"Completed":return e.jsx(Be,{className:"w-4 h-4"});case"Rejected":return e.jsx(dt,{className:"w-4 h-4"});default:return e.jsx(ms,{className:"w-4 h-4"})}},ce=async()=>{try{re(!0),ne(null);const r=ae=>{switch(ae){case"Active":return"In Warranty";case"Expired":return"Expired";case"Expiring Soon":return"Extended Warranty";case"In Warranty":case"Extended Warranty":case"Out of Warranty":case"Expired":return ae;default:return"In Warranty"}},H={rmaNumber:w.rmaNumber,callLogNumber:w.callLogNumber,rmaOrderNumber:w.rmaOrderNumber,ascompRaisedDate:w.ascompRaisedDate,customerErrorDate:w.customerErrorDate,siteName:w.siteName,productName:w.productName,productPartNumber:w.productPartNumber,serialNumber:w.serialNumber,defectivePartNumber:w.defectivePartNumber,defectivePartName:w.defectivePartName,defectiveSerialNumber:w.defectiveSerialNumber,symptoms:w.symptoms,replacedPartNumber:w.replacedPartNumber,replacedPartSerialNumber:w.replacedPartSerialNumber,shippedDate:w.shippedDate,trackingNumber:w.trackingNumber,shippedThru:w.shippedThru,remarks:w.remarks,createdBy:w.createdBy,caseStatus:w.caseStatus,rmaReturnShippedDate:w.rmaReturnShippedDate,rmaReturnTrackingNumber:w.rmaReturnTrackingNumber,rmaReturnShippedThru:w.rmaReturnShippedThru,daysCountShippedToSite:w.daysCountShippedToSite,daysCountReturnToCDS:w.daysCountReturnToCDS,priority:w.priority,warrantyStatus:w.warrantyStatus,estimatedCost:w.estimatedCost,notes:w.notes,brand:w.brand,projectorModel:w.projectorModel,customerSite:w.customerSite,technician:w.technician,physicalCondition:w.physicalCondition,logicalCondition:w.logicalCondition,issueDescription:w.issueDescription,rmaReason:w.rmaReason};await ie.createRMA(H),N(!1),g({rmaNumber:"",callLogNumber:"",rmaOrderNumber:"",ascompRaisedDate:"",customerErrorDate:"",siteName:"",productName:"",productPartNumber:"",serialNumber:"",defectivePartNumber:"",defectivePartName:"",defectiveSerialNumber:"",symptoms:"",replacedPartNumber:"",replacedPartName:"",replacedPartSerialNumber:"",replacementNotes:"",shippedDate:"",trackingNumber:"",shippedThru:"",remarks:"",createdBy:"",caseStatus:"Under Review",rmaReturnShippedDate:"",rmaReturnTrackingNumber:"",rmaReturnShippedThru:"",daysCountShippedToSite:0,daysCountReturnToCDS:0,priority:"Medium",warrantyStatus:"In Warranty",estimatedCost:0,notes:"",brand:"",projectorModel:"",customerSite:"",technician:"",physicalCondition:"Good",logicalCondition:"Good",issueDescription:"",rmaReason:""}),await t()}catch(r){console.error("Error creating RMA:",r),ne("Failed to create RMA.")}finally{re(!1)}},me=async r=>{if(console.log("Editing RMA:",r),console.log("RMA _id:",r._id),console.log("RMA keys:",Object.keys(r)),console.log("RMA status:",r.status),console.log("RMA approvalStatus:",r.approvalStatus),console.log("Full RMA object:",JSON.stringify(r,null,2)),!r._id){console.error("RMA object missing _id field:",r),ne("Invalid RMA data. Cannot edit this RMA.");return}try{console.log("Fetching fresh RMA data from API...");const ae=await(await fetch(`http://localhost:4000/api/rma/${r._id}`)).json();console.log("Fresh RMA data from API:",ae),$(ae),console.log("Set editingRMA to fresh data:",ae),A(!0)}catch(H){console.error("Failed to fetch fresh RMA data:",H),$({...r}),A(!0)}},L=async()=>{var r;try{if(re(!0),ne(null),console.log("Updating RMA with data:",u),console.log("RMA ID:",u._id),console.log("RMA Status being updated to:",u.status),console.log("Full editingRMA object:",JSON.stringify(u,null,2)),!u._id)throw new Error("RMA ID is missing. Cannot update RMA.");await ie.updateRMA(u._id,u),console.log("Updating local state for RMA:",u._id),console.log("New status:",u.status),h(H=>{const ae=H.map(be=>be._id===u._id?{...be,...u}:be);return console.log("Updated local RMA items:",ae.map(be=>({rmaNumber:be.rmaNumber,status:be.status}))),ae}),i(H=>H+1),A(!1),$(null),(r=window.showToast)==null||r.call(window,{type:"success",title:"RMA Updated",message:`RMA ${u.rmaNumber} has been updated successfully`}),await t(),setTimeout(async()=>{console.log("Forcing complete data refresh..."),await t(),i(H=>H+1),console.log("RMA data after forced refresh:",s),console.log("RMA statuses after forced refresh:",(s||[]).map(H=>({rmaNumber:H.rmaNumber,status:H.status,priority:H.priority})))},1e3)}catch(H){console.error("Error updating RMA:",H),ne("Failed to update RMA: "+H.message)}finally{re(!1)}},Q=async()=>{var r;try{re(!0);const H=Ss(s||[],["rmaNumber","projectorSerial","partName","brand","projectorModel","customerSite","status","priority","estimatedCost","warrantyStatus"]);Cs(H,`rma_report_${new Date().toISOString().split("T")[0]}.csv`),(r=window.showToast)==null||r.call(window,{type:"success",title:"Export Successful",message:"RMA report exported to CSV file"})}catch(H){console.error("Error exporting RMA:",H),ne("Failed to export RMA report: "+H.message)}finally{re(!1)}},D=async r=>{var H;try{const ae=(s||[]).find(Z=>Z._id===r);if(!ae){ne("RMA not found");return}const be=Xa(ae,"rma");Qa(be),(H=window.showToast)==null||H.call(window,{type:"success",title:"Label Printed",message:`RMA label for ${ae.rmaNumber} sent to printer`})}catch(ae){console.error("Error printing label:",ae),ne("Failed to print label: "+ae.message)}};return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"bg-gradient-to-r from-blue-600 to-indigo-700 text-white px-8 py-8 rounded-b-3xl shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-3",children:"RMA Management"}),e.jsx("p",{className:"text-xl text-blue-100 opacity-90",children:"Manage Return Merchandise Authorization requests"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[a&&e.jsxs("div",{className:"flex items-center gap-2 text-blue-100 bg-blue-800/50 px-4 py-2 rounded-lg border border-blue-400/30",children:[e.jsx(Ie,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Loading..."})]}),e.jsxs("button",{onClick:async()=>{console.log("Manual refresh clicked"),await t(),i(r=>r+1)},className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-all duration-200 flex items-center gap-2 border border-blue-400/30 hover:shadow-lg",children:[e.jsx(ms,{className:"w-4 h-4"}),"Refresh"]}),e.jsxs("button",{onClick:Q,disabled:z,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-all duration-200 flex items-center gap-2 border border-green-400/30 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(We,{className:"w-4 h-4"}),"Export"]}),e.jsxs("button",{onClick:()=>N(!0),className:"bg-white text-blue-600 hover:bg-gray-100 px-6 py-2 rounded-lg font-semibold transition-all duration-200 flex items-center gap-2 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5",children:[e.jsx(Xe,{className:"w-4 h-4"}),"New RMA"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20 hover:bg-white/15 transition-all duration-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-white/20 rounded-full",children:e.jsx(Je,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-blue-100 opacity-90",children:"Total RMAs"}),e.jsx("p",{className:"text-3xl font-bold text-white",children:o.length})]})]})}),e.jsx("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20 hover:bg-white/15 transition-all duration-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-white/20 rounded-full",children:e.jsx(ts,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-blue-100 opacity-90",children:"Under Review"}),e.jsx("p",{className:"text-3xl font-bold text-white",children:o.filter(r=>r.caseStatus==="Under Review").length})]})]})}),e.jsx("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20 hover:bg-white/15 transition-all duration-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-white/20 rounded-full",children:e.jsx($a,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-blue-100 opacity-90",children:"In Progress"}),e.jsx("p",{className:"text-3xl font-bold text-white",children:o.filter(r=>r.caseStatus==="In Progress"||r.caseStatus==="Repair In Progress").length})]})]})}),e.jsx("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20 hover:bg-white/15 transition-all duration-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-white/20 rounded-full",children:e.jsx(Be,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-blue-100 opacity-90",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-white",children:o.filter(r=>r.caseStatus==="Completed").length})]})]})})]})]}),e.jsxs("main",{className:"flex-1 overflow-auto p-8 bg-gray-50",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8 border border-gray-200",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center space-y-4 lg:space-y-0 lg:space-x-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(vs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx(k,{placeholder:"Search RMA number, serial number, part, or site...",value:j,onChange:r=>P(r.target.value),className:"pl-10 bg-gray-50 border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500 h-11"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("select",{value:v,onChange:r=>x(r.target.value),className:"px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-w-[150px] h-11",children:[e.jsx("option",{value:"All",children:"All Status"}),e.jsx("option",{value:"Under Review",children:"Under Review"}),e.jsx("option",{value:"Replacement Approved",children:"Replacement Approved"}),e.jsx("option",{value:"Repair In Progress",children:"Repair In Progress"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Rejected",children:"Rejected"}),e.jsx("option",{value:"In Progress",children:"In Progress"})]}),e.jsxs("select",{value:S,onChange:r=>E(r.target.value),className:"px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-w-[150px] h-11",children:[e.jsx("option",{value:"All",children:"All Priority"}),e.jsx("option",{value:"High",children:"High Priority"}),e.jsx("option",{value:"Medium",children:"Medium Priority"}),e.jsx("option",{value:"Low",children:"Low Priority"})]})]}),e.jsxs(q,{onClick:()=>{P(""),x("All"),E("All")},variant:"outline",className:"border-gray-300 text-gray-700 hover:bg-gray-50 h-11 px-6",children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Clear Filters"]})]}),(j||v!=="All"||S!=="All")&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Active Filters:"}),j&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs",children:['Search: "',j,'"']}),v!=="All"&&e.jsxs("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs",children:["Status: ",v]}),S!=="All"&&e.jsxs("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs",children:["Priority: ",S]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-gradient-to-r from-gray-50 to-blue-50 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"RMA Records"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Showing ",m.length," RMA records"]})]}),e.jsx("div",{className:"overflow-x-auto",children:m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(Je,{className:"w-12 h-12 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No RMAs Found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No RMA records match your current filters."}),e.jsxs(q,{onClick:()=>N(!0),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Create New RMA"]})]}):e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-gray-50 to-blue-50 border-b-2 border-blue-200",children:[e.jsx("th",{className:"text-left font-bold text-gray-800 py-4 px-4 border-r border-gray-200 text-sm uppercase tracking-wide",children:"RMA #"}),e.jsx("th",{className:"text-left font-bold text-gray-800 py-4 px-4 border-r border-gray-200 text-sm uppercase tracking-wide",children:"Site & Product"}),e.jsx("th",{className:"text-left font-bold text-gray-800 py-4 px-4 border-r border-gray-200 text-sm uppercase tracking-wide",children:"Defective Part"}),e.jsx("th",{className:"text-left font-bold text-gray-800 py-4 px-4 border-r border-gray-200 text-sm uppercase tracking-wide",children:"Replacement Part"}),e.jsx("th",{className:"text-left font-bold text-gray-800 py-4 px-4 border-r border-gray-200 text-sm uppercase tracking-wide",children:"Status & Priority"}),e.jsx("th",{className:"text-left font-bold text-gray-800 py-4 px-4 border-r border-gray-200 text-sm uppercase tracking-wide",children:"Dates & Tracking"}),e.jsx("th",{className:"text-center font-bold text-gray-800 py-4 px-4 text-sm uppercase tracking-wide",children:"Actions"})]})}),e.jsx("tbody",{children:m.map((r,H)=>e.jsxs("tr",{className:`border-b border-gray-100 transition-all duration-200 ${H%2===0?"bg-white":"bg-gray-50"} hover:bg-blue-50 hover:shadow-sm`,children:[e.jsx("td",{className:"py-4 px-4 border-r border-gray-100",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold text-blue-600 hover:text-blue-800 cursor-pointer text-base",children:r.rmaNumber||"N/A"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Call: ",r.callLogNumber||"N/A"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Order: ",r.rmaOrderNumber||"N/A"]})]})}),e.jsx("td",{className:"py-4 px-4 border-r border-gray-100",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-gray-800 text-sm",children:r.siteName||"N/A"}),e.jsx("div",{className:"text-gray-700 text-sm",children:r.productName||"N/A"}),e.jsxs("div",{className:"text-xs text-gray-600 font-mono",children:["SN: ",r.serialNumber||"N/A"]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Part: ",r.productPartNumber||"N/A"]})]})}),e.jsx("td",{className:"py-4 px-4 border-r border-gray-100",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-gray-700 text-sm",children:r.defectivePartName||"N/A"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Part: ",r.defectivePartNumber||"N/A"]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Serial: ",r.defectiveSerialNumber||"N/A"]}),r.symptoms&&r.symptoms!=="N/A"&&e.jsx("div",{className:"text-xs text-gray-600 bg-gray-100 px-2 py-1 rounded",title:r.symptoms,children:r.symptoms})]})}),e.jsx("td",{className:"py-4 px-4 border-r border-gray-100",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-gray-700 text-sm",children:r.replacedPartName||"N/A"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Part: ",r.replacedPartNumber||"N/A"]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Serial: ",r.replacedPartSerialNumber||"N/A"]}),r.replacementNotes&&r.replacementNotes!=="N/A"&&e.jsx("div",{className:"text-xs text-gray-600 bg-gray-100 px-2 py-1 rounded",title:r.replacementNotes,children:r.replacementNotes})]})}),e.jsx("td",{className:"py-4 px-4 border-r border-gray-100",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${d(r.caseStatus||"Under Review")}`,children:r.caseStatus||"Under Review"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Priority: ",e.jsx("span",{className:`font-semibold ${X(r.priority||"Medium")}`,children:r.priority||"Medium"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Created by: ",r.createdBy||"System"]})]})}),e.jsx("td",{className:"py-4 px-4 border-r border-gray-100",children:e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Raised:"})," ",r.ascompRaisedDate||"N/A"]}),e.jsxs("div",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Error:"})," ",r.customerErrorDate||"N/A"]}),r.shippedDate&&r.shippedDate!=="N/A"&&e.jsxs("div",{className:"text-green-600",children:[e.jsx("span",{className:"font-medium",children:"Shipped:"})," ",r.shippedDate]}),r.trackingNumber&&r.trackingNumber!=="N/A"&&e.jsxs("div",{className:"text-blue-600 font-mono",children:[e.jsx("span",{className:"font-medium",children:"Track:"})," ",r.trackingNumber]}),r.shippedThru&&r.shippedThru!=="N/A"&&e.jsxs("div",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Via:"})," ",r.shippedThru]})]})}),e.jsx("td",{className:"py-4 px-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("button",{className:"p-2 hover:bg-blue-100 rounded-lg transition-colors text-blue-600 hover:text-blue-800 border border-blue-200 hover:border-blue-300",onClick:()=>_(r),title:"View Details",children:e.jsx(es,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-green-100 rounded-lg transition-colors text-green-600 hover:text-green-800 border border-green-200 hover:border-green-300",onClick:()=>me(r),title:"Edit RMA",children:e.jsx(ks,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-purple-100 rounded-lg transition-colors text-purple-600 hover:text-purple-800 border border-purple-200 hover:border-purple-300",title:"View Documents",children:e.jsx(Oe,{className:"w-4 h-4"})})]})})]},`${r._id}-${l}`))},`rma-tbody-${l}`)]},`rma-table-${l}`)})]}),V&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-dark-bg border-2 border-dark-color rounded-xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-dark-primary",children:["RMA Details - ",V.rmaNumber]}),e.jsx("button",{onClick:()=>_(null),className:"p-2 hover:bg-dark-hover rounded-lg transition-colors",children:e.jsx(dt,{className:"w-5 h-5 text-dark-secondary"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Basic Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"RMA Number"}),e.jsx("p",{className:"text-dark-primary font-semibold",children:V.rmaNumber})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Part Name"}),e.jsx("p",{className:"text-dark-primary",children:V.partName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Part Number"}),e.jsx("p",{className:"text-dark-primary",children:V.productPartNumber})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Serial Number"}),e.jsx("p",{className:"text-dark-primary",children:V.serialNumber})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Brand & Model"}),e.jsxs("p",{className:"text-dark-primary",children:[V.brand," ",V.productName]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Customer Site"}),e.jsx("p",{className:"text-dark-primary",children:V.siteName})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Issue & Status"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Issue Description"}),e.jsx("p",{className:"text-dark-primary text-sm",children:V.symptoms})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"RMA Reason"}),e.jsx("p",{className:"text-dark-primary",children:V.rmaReason})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Current Status"}),e.jsxs("div",{className:`dark-tag ${d(V.caseStatus)} inline-flex items-center gap-1 mt-1`,children:[B(V.caseStatus),V.caseStatus]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Priority"}),e.jsx("span",{className:`font-semibold ${X(V.priority)}`,children:V.priority})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Approval Status"}),e.jsx("p",{className:"text-dark-primary",children:V.approvalStatus})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Assigned To"}),e.jsx("p",{className:"text-dark-primary",children:V.assignedTo})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Additional Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"RMA Date"}),e.jsx("p",{className:"text-dark-primary",children:V.ascompRaisedDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Expected Resolution"}),e.jsx("p",{className:"text-dark-primary",children:V.expectedResolution})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Estimated Cost"}),e.jsxs("p",{className:"text-dark-primary font-semibold",children:["₹",V.estimatedCost.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Warranty Status"}),e.jsx("span",{className:`font-semibold ${ee(V.warrantyStatus)}`,children:V.warrantyStatus})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Physical Condition"}),e.jsx("p",{className:"text-dark-primary",children:V.physicalCondition})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Logical Condition"}),e.jsx("p",{className:"text-dark-primary",children:V.logicalCondition})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Service Report"}),e.jsx("p",{className:"text-dark-primary",children:V.serviceReport})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Technician"}),e.jsx("p",{className:"text-dark-primary",children:V.technician})]})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Notes"}),e.jsx("p",{className:"text-dark-primary mt-2 p-4 bg-dark-bg rounded-lg border border-dark-color text-sm",children:V.notes})]}),e.jsxs("div",{className:"flex space-x-3 pt-6 mt-6 border-t border-dark-color",children:[V.caseStatus==="Under Review"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"flex-1 dark-button-primary",children:"Approve RMA"}),e.jsx("button",{className:"flex-1 dark-button-secondary",children:"Request More Info"})]}),V.caseStatus==="Replacement Approved"&&e.jsx("button",{className:"flex-1 dark-button-primary",children:"Process Replacement"}),V.caseStatus==="Repair In Progress"&&e.jsx("button",{className:"flex-1 dark-button-primary",children:"Update Progress"}),e.jsx("button",{className:"dark-button-secondary px-6",children:"Download RMA Report"}),e.jsx("button",{onClick:()=>D(V._id),className:"dark-button-secondary px-6",children:"Print Label"})]})]})})]}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-dark-bg border-2 border-dark-color rounded-xl p-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-dark-primary",children:"Create New RMA"}),e.jsx("button",{onClick:()=>N(!1),className:"text-dark-secondary hover:text-dark-primary",children:e.jsx(Ke,{className:"w-5 h-5"})})]}),K&&e.jsx("div",{className:"mb-4 p-3 bg-red-900 bg-opacity-30 rounded-lg border border-red-600",children:e.jsx("p",{className:"text-red-400 text-sm",children:K})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"RMA Number *"}),e.jsx(k,{value:w.rmaNumber,onChange:r=>g({...w,rmaNumber:r.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"RMA-2024-XXX"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Part Number *"}),e.jsx(k,{value:w.productPartNumber,onChange:r=>g({...w,productPartNumber:r.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter part number",required:!0}),!w.productPartNumber&&e.jsx("p",{className:"text-xs text-red-400 mt-1",children:"Part Number is required"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Part Name *"}),e.jsx(k,{value:w.productName,onChange:r=>g({...w,productName:r.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter part name",required:!0}),!w.productName&&e.jsx("p",{className:"text-xs text-red-400 mt-1",children:"Part Name is required"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Brand *"}),e.jsx(k,{value:w.brand,onChange:r=>g({...w,brand:r.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter brand"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Projector Model *"}),e.jsx(k,{value:w.productName,onChange:r=>g({...w,productName:r.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter projector model"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Serial Number"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{value:w.serialNumber,onChange:r=>g({...w,serialNumber:r.target.value}),className:"mt-1 flex-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter serial number"}),e.jsx("button",{type:"button",onClick:()=>O(!0),className:"mt-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors",children:"Select"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Customer Site *"}),e.jsx(k,{value:w.siteName,onChange:r=>g({...w,siteName:r.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter customer site"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Technician"}),e.jsx(k,{value:w.technician,onChange:r=>g({...w,technician:r.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter technician name"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Priority"}),e.jsxs("select",{value:w.priority,onChange:r=>g({...w,priority:r.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"Low",children:"Low"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"High",children:"High"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Warranty Status"}),e.jsxs("select",{value:w.warrantyStatus,onChange:r=>g({...w,warrantyStatus:r.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"In Warranty",children:"In Warranty"}),e.jsx("option",{value:"Extended Warranty",children:"Extended Warranty"}),e.jsx("option",{value:"Out of Warranty",children:"Out of Warranty"}),e.jsx("option",{value:"Expired",children:"Expired"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Physical Condition"}),e.jsxs("select",{value:w.physicalCondition,onChange:r=>g({...w,physicalCondition:r.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"Excellent",children:"Excellent"}),e.jsx("option",{value:"Good",children:"Good"}),e.jsx("option",{value:"Fair",children:"Fair"}),e.jsx("option",{value:"Poor",children:"Poor"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Logical Condition"}),e.jsxs("select",{value:w.logicalCondition,onChange:r=>g({...w,logicalCondition:r.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"Good",children:"Good"}),e.jsx("option",{value:"Faulty",children:"Faulty"}),e.jsx("option",{value:"Degraded",children:"Degraded"}),e.jsx("option",{value:"Partial Failure",children:"Partial Failure"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Issue Description *"}),e.jsx("textarea",{value:w.symptoms,onChange:r=>g({...w,symptoms:r.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",rows:3,placeholder:"Describe the issue with the part"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"RMA Reason *"}),e.jsx("textarea",{value:w.rmaReason,onChange:r=>g({...w,rmaReason:r.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",rows:2,placeholder:"Reason for RMA request",required:!0}),!w.rmaReason&&e.jsx("p",{className:"text-xs text-red-400 mt-1",children:"RMA Reason is required"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Estimated Cost (₹)"}),e.jsx(k,{type:"number",value:w.estimatedCost,onChange:r=>g({...w,estimatedCost:Number(r.target.value)}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Notes"}),e.jsx("textarea",{value:w.notes,onChange:r=>g({...w,notes:r.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-card border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",rows:3,placeholder:"Additional notes"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Defective Part Name"}),e.jsx(k,{value:w.defectivePartName,onChange:r=>g({...w,defectivePartName:r.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter defective part name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Defective Part Number"}),e.jsx(k,{value:w.defectivePartNumber,onChange:r=>g({...w,defectivePartNumber:r.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter defective part number"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Defective Serial Number"}),e.jsx(k,{value:w.defectiveSerialNumber,onChange:r=>g({...w,defectiveSerialNumber:r.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter defective serial number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Symptoms"}),e.jsx(k,{value:w.symptoms,onChange:r=>g({...w,symptoms:r.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter symptoms"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Replacement Part Name"}),e.jsx(k,{value:w.replacedPartName,onChange:r=>g({...w,replacedPartName:r.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter replacement part name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Replacement Part Number"}),e.jsx(k,{value:w.replacedPartNumber,onChange:r=>g({...w,replacedPartNumber:r.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter replacement part number"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Replacement Serial Number"}),e.jsx(k,{value:w.replacedPartSerialNumber,onChange:r=>g({...w,replacedPartSerialNumber:r.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter replacement serial number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Replacement Notes"}),e.jsx(k,{value:w.replacementNotes,onChange:r=>g({...w,replacementNotes:r.target.value}),className:"mt-1 bg-dark-card border-dark-color text-dark-primary",placeholder:"Enter replacement notes"})]})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6 pt-6 border-t border-dark-color",children:[e.jsx("button",{onClick:()=>N(!1),className:"flex-1 dark-button-secondary",children:"Cancel"}),e.jsx("button",{onClick:ce,disabled:z||!w.rmaNumber||!w.productPartNumber||!w.productName||!w.rmaReason,className:"flex-1 dark-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:z?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4 animate-spin mr-2"}),"Creating..."]}):"Create RMA"})]})]})}),y&&u&&(()=>(console.log("Rendering edit modal with editingRMA:",u),console.log("editingRMA.status:",u.caseStatus),console.log("editingRMA.approvalStatus:",u.approvalStatus),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-dark-bg border-2 border-dark-color rounded-xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-dark-primary",children:["Edit RMA - ",u.rmaNumber]}),e.jsx("button",{onClick:()=>A(!1),className:"p-2 hover:bg-dark-hover rounded-lg transition-colors",children:e.jsx(Ke,{className:"w-5 h-5 text-dark-secondary"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-dark-card p-4 rounded-lg border border-dark-color",children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"RMA Number"}),e.jsx(k,{value:u.rmaNumber||"",onChange:r=>$({...u,rmaNumber:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"RMA-2024-XXX"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Call Log Number"}),e.jsx(k,{value:u.callLogNumber||"",onChange:r=>$({...u,callLogNumber:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Call log number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"RMA Order Number"}),e.jsx(k,{value:u.rmaOrderNumber||"",onChange:r=>$({...u,rmaOrderNumber:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Order number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Site Name"}),e.jsx(k,{value:u.siteName||"",onChange:r=>$({...u,siteName:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Site name"})]})]})]}),e.jsxs("div",{className:"bg-dark-card p-4 rounded-lg border border-dark-color",children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Product Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Product Name"}),e.jsx(k,{value:u.productName||"",onChange:r=>$({...u,productName:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Product name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Product Part Number"}),e.jsx(k,{value:u.productPartNumber||"",onChange:r=>$({...u,productPartNumber:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Part number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Serial Number"}),e.jsx(k,{value:u.serialNumber||"",onChange:r=>$({...u,serialNumber:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Serial number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Brand"}),e.jsx(k,{value:u.brand||"",onChange:r=>$({...u,brand:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Brand"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Projector Model"}),e.jsx(k,{value:u.projectorModel||"",onChange:r=>$({...u,projectorModel:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Model"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Customer Site"}),e.jsx(k,{value:u.customerSite||"",onChange:r=>$({...u,customerSite:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Customer site"})]})]})]}),e.jsxs("div",{className:"bg-dark-card p-4 rounded-lg border border-dark-color",children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Defective Part Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Defective Part Number"}),e.jsx(k,{value:u.defectivePartNumber||"",onChange:r=>$({...u,defectivePartNumber:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Defective part number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Defective Part Name"}),e.jsx(k,{value:u.defectivePartName||"",onChange:r=>$({...u,defectivePartName:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Defective part name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Defective Serial Number"}),e.jsx(k,{value:u.defectiveSerialNumber||"",onChange:r=>$({...u,defectiveSerialNumber:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Defective serial number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Symptoms"}),e.jsx("textarea",{value:u.symptoms||"",onChange:r=>$({...u,symptoms:r.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-bg border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",rows:2,placeholder:"Describe symptoms"})]})]})]}),e.jsxs("div",{className:"bg-dark-card p-4 rounded-lg border border-dark-color",children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Replacement Part Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Replaced Part Number"}),e.jsx(k,{value:u.replacedPartNumber||"",onChange:r=>$({...u,replacedPartNumber:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Replaced part number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Replaced Part Name"}),e.jsx(k,{value:u.replacedPartName||"",onChange:r=>$({...u,replacedPartName:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Replaced part name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Replaced Part Serial Number"}),e.jsx(k,{value:u.replacedPartSerialNumber||"",onChange:r=>$({...u,replacedPartSerialNumber:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Replaced part serial"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Replacement Notes"}),e.jsx("textarea",{value:u.replacementNotes||"",onChange:r=>$({...u,replacementNotes:r.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-bg border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",rows:2,placeholder:"Replacement notes"})]})]})]}),e.jsxs("div",{className:"bg-dark-card p-4 rounded-lg border border-dark-color",children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Shipping Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Shipped Date"}),e.jsx(k,{type:"date",value:u.shippedDate?u.shippedDate.split("T")[0]:"",onChange:r=>$({...u,shippedDate:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Tracking Number"}),e.jsx(k,{value:u.trackingNumber||"",onChange:r=>$({...u,trackingNumber:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Tracking number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Shipped Through"}),e.jsx(k,{value:u.shippedThru||"",onChange:r=>$({...u,shippedThru:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Shipping carrier"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"RMA Return Shipped Date"}),e.jsx(k,{type:"date",value:u.rmaReturnShippedDate?u.rmaReturnShippedDate.split("T")[0]:"",onChange:r=>$({...u,rmaReturnShippedDate:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"RMA Return Tracking Number"}),e.jsx(k,{value:u.rmaReturnTrackingNumber||"",onChange:r=>$({...u,rmaReturnTrackingNumber:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Return tracking number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"RMA Return Shipped Through"}),e.jsx(k,{value:u.rmaReturnShippedThru||"",onChange:r=>$({...u,rmaReturnShippedThru:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Return shipping carrier"})]})]})]}),e.jsxs("div",{className:"bg-dark-card p-4 rounded-lg border border-dark-color",children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Important Dates"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"ASCOMP Raised Date"}),e.jsx(k,{type:"date",value:u.ascompRaisedDate?u.ascompRaisedDate.split("T")[0]:"",onChange:r=>$({...u,ascompRaisedDate:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Customer Error Date"}),e.jsx(k,{type:"date",value:u.customerErrorDate?u.customerErrorDate.split("T")[0]:"",onChange:r=>$({...u,customerErrorDate:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary"})]})]})]}),e.jsxs("div",{className:"bg-dark-card p-4 rounded-lg border border-dark-color",children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Status & Workflow"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"RMA Status *"}),e.jsxs("div",{className:"text-xs text-red-400 mb-1",children:['Debug: Current status value = "',u.caseStatus,'"']}),e.jsxs("select",{value:u.caseStatus,onChange:r=>{console.log("Status changed from",u.caseStatus,"to",r.target.value),$({...u,caseStatus:r.target.value})},className:"mt-1 w-full px-3 py-2 bg-dark-bg border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",onFocus:()=>console.log("Status dropdown focused, current value:",u.caseStatus),onMouseEnter:()=>console.log("Status dropdown hovered, current value:",u.caseStatus),children:[e.jsx("option",{value:"Under Review",children:"Under Review"}),e.jsx("option",{value:"Sent to CDS",children:"Sent to CDS"}),e.jsx("option",{value:"CDS Approved",children:"CDS Approved"}),e.jsx("option",{value:"Replacement Shipped",children:"Replacement Shipped"}),e.jsx("option",{value:"Replacement Received",children:"Replacement Received"}),e.jsx("option",{value:"Installation Complete",children:"Installation Complete"}),e.jsx("option",{value:"Faulty Part Returned",children:"Faulty Part Returned"}),e.jsx("option",{value:"CDS Confirmed Return",children:"CDS Confirmed Return"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Priority"}),e.jsxs("select",{value:u.priority,onChange:r=>$({...u,priority:r.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-bg border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"Low",children:"Low"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"High",children:"High"}),e.jsx("option",{value:"Critical",children:"Critical"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Warranty Status"}),e.jsxs("select",{value:u.warrantyStatus,onChange:r=>$({...u,warrantyStatus:r.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-bg border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"In Warranty",children:"In Warranty"}),e.jsx("option",{value:"Extended Warranty",children:"Extended Warranty"}),e.jsx("option",{value:"Out of Warranty",children:"Out of Warranty"}),e.jsx("option",{value:"Expired",children:"Expired"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Approval Status"}),e.jsxs("div",{className:"text-xs text-blue-400 mb-1",children:['Debug: Current approvalStatus = "',u.approvalStatus,'"']}),e.jsxs("select",{value:u.approvalStatus,onChange:r=>$({...u,approvalStatus:r.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-bg border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"Pending Review",children:"Pending Review"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"}),e.jsx("option",{value:"Under Investigation",children:"Under Investigation"})]})]})]})]}),e.jsxs("div",{className:"bg-dark-card p-4 rounded-lg border border-dark-color",children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Condition & Assessment"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Physical Condition"}),e.jsxs("select",{value:u.physicalCondition,onChange:r=>$({...u,physicalCondition:r.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-bg border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"Excellent",children:"Excellent"}),e.jsx("option",{value:"Good",children:"Good"}),e.jsx("option",{value:"Fair",children:"Fair"}),e.jsx("option",{value:"Poor",children:"Poor"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Logical Condition"}),e.jsxs("select",{value:u.logicalCondition,onChange:r=>$({...u,logicalCondition:r.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-bg border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",children:[e.jsx("option",{value:"Good",children:"Good"}),e.jsx("option",{value:"Faulty",children:"Faulty"}),e.jsx("option",{value:"Degraded",children:"Degraded"}),e.jsx("option",{value:"Partial Failure",children:"Partial Failure"})]})]})]})]}),e.jsxs("div",{className:"bg-dark-card p-4 rounded-lg border border-dark-color",children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Additional Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Created By"}),e.jsx(k,{value:u.createdBy||"",onChange:r=>$({...u,createdBy:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Created by"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Technician"}),e.jsx(k,{value:u.technician||"",onChange:r=>$({...u,technician:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Technician name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Assigned To"}),e.jsx(k,{value:u.assignedTo||"",onChange:r=>$({...u,assignedTo:r.target.value}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"Assigned to"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Estimated Cost (₹)"}),e.jsx(k,{type:"number",value:u.estimatedCost||0,onChange:r=>$({...u,estimatedCost:Number(r.target.value)}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Days Count Shipped to Site"}),e.jsx(k,{type:"number",value:u.daysCountShippedToSite||0,onChange:r=>$({...u,daysCountShippedToSite:Number(r.target.value)}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Days Count Return to CDS"}),e.jsx(k,{type:"number",value:u.daysCountReturnToCDS||0,onChange:r=>$({...u,daysCountReturnToCDS:Number(r.target.value)}),className:"mt-1 bg-dark-bg border-dark-color text-dark-primary",placeholder:"0"})]})]})]}),e.jsxs("div",{className:"bg-dark-card p-4 rounded-lg border border-dark-color",children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Text Fields"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Remarks"}),e.jsx("textarea",{value:u.remarks||"",onChange:r=>$({...u,remarks:r.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-bg border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",rows:2,placeholder:"Additional remarks"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Issue Description"}),e.jsx("textarea",{value:u.issueDescription||"",onChange:r=>$({...u,issueDescription:r.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-bg border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",rows:2,placeholder:"Issue description"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"RMA Reason"}),e.jsx("textarea",{value:u.rmaReason||"",onChange:r=>$({...u,rmaReason:r.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-bg border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",rows:2,placeholder:"RMA reason"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-dark-secondary",children:"Notes"}),e.jsx("textarea",{value:u.notes||"",onChange:r=>$({...u,notes:r.target.value}),className:"mt-1 w-full px-3 py-2 bg-dark-bg border border-dark-color rounded-lg text-dark-primary focus:outline-none focus:ring-2 focus:ring-dark-cta",rows:3,placeholder:"Additional notes"})]})]})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6 pt-6 border-t border-dark-color",children:[e.jsx("button",{onClick:()=>A(!1),className:"flex-1 dark-button-secondary",children:"Cancel"}),e.jsx("button",{onClick:L,disabled:z,className:"flex-1 dark-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:z?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4 animate-spin mr-2"}),"Updating..."]}):"Update RMA"})]})]})})))(),Y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-dark-bg border-2 border-dark-color rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-dark-primary",children:"Select Serial Number"}),e.jsx("button",{onClick:()=>{O(!1),F("")},className:"text-dark-secondary hover:text-dark-primary",children:e.jsx(Ke,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"mb-4",children:e.jsx(k,{placeholder:"Search serial numbers, part names, or brands...",value:R,onChange:r=>F(r.target.value),className:"w-full bg-dark-card border-dark-color text-dark-primary"})}),e.jsx("div",{className:"space-y-3",children:(()=>{const r=(J||[]).filter(H=>(H.serialNumber||"").toLowerCase().includes(R.toLowerCase())||(H.model||"").toLowerCase().includes(R.toLowerCase())||(H.brand||"").toLowerCase().includes(R.toLowerCase())||(H.site||"").toLowerCase().includes(R.toLowerCase()));return r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Je,{className:"w-12 h-12 text-dark-secondary mx-auto mb-4"}),e.jsx("p",{className:"text-dark-secondary",children:"No projectors found matching your search."})]}):r.map((H,ae)=>e.jsx("div",{onClick:()=>M(H),className:"p-4 border border-dark-color rounded-lg hover:bg-dark-hover cursor-pointer transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-lg font-semibold text-blue-400",children:H.serialNumber}),e.jsx(ge,{className:`text-white text-xs ${H.status==="Active"?"bg-green-600":H.status==="Under Service"?"bg-yellow-600":H.status==="Needs Repair"?"bg-red-600":"bg-gray-600"}`,children:H.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Model:"}),e.jsx("p",{className:"text-dark-primary font-medium",children:H.model})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Brand:"}),e.jsx("p",{className:"text-dark-primary font-medium",children:H.brand})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Site:"}),e.jsx("p",{className:"text-dark-primary font-medium",children:H.site})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Location:"}),e.jsx("p",{className:"text-dark-primary font-medium",children:H.location})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Technician:"}),e.jsx("p",{className:"text-dark-primary font-medium",children:H.technician})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Warranty:"}),e.jsx("p",{className:"text-dark-primary font-medium",children:H.warrantyStatus||"Active"})]})]})]}),e.jsx("div",{className:"ml-4",children:e.jsx("button",{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors",children:"Select"})})]})},ae))})()}),e.jsx("div",{className:"flex justify-end mt-6 pt-6 border-t border-dark-color",children:e.jsx("button",{onClick:()=>{O(!1),F("")},className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm font-medium transition-colors",children:"Cancel"})})]})})]})}function _i(){var ne,Y,O,R,F,J,T,w,g,p,M,m,d,X,ee;const[s,t]=n.useState([]),[a,l]=n.useState([]),[i,o]=n.useState([]),[h,c]=n.useState(null),[j,P]=n.useState(!0),[v,x]=n.useState(null),[S,E]=n.useState(!1),[V,_]=n.useState("all"),[b,N]=n.useState("all"),[y,A]=n.useState(""),[u,$]=n.useState("overview");n.useEffect(()=>{z()},[V,b,y]);const z=async()=>{var B,ce,me;try{P(!0),x(null),E(!1);const[L,Q,D,r]=await Promise.all([ie.get(`/analytics/sites?${new URLSearchParams({...V&&V!=="all"&&{region:V},...b&&b!=="all"&&{state:b},...y&&{siteCode:y}})}`),ie.get("/analytics/regions"),ie.get(`/analytics/states?${new URLSearchParams({...V&&V!=="all"&&{region:V}})}`),ie.get("/analytics/dashboard-stats")]);t(L.sites||[]),l(Q||[]),o(D||[]),c(r||null),P(!1)}catch(L){console.error("Error loading analytics data:",L),((B=L.response)==null?void 0:B.status)===403||((ce=L.response)==null?void 0:ce.status)===401?(E(!0),x("Authentication required. Please log in again.")):((me=L.response)==null?void 0:me.status)===404?x("Analytics endpoint not found. Please check server configuration."):x(L.message||"Failed to load analytics data"),P(!1)}},re=()=>{const B=s.map(me=>{var L,Q,D,r,H,ae,be,Z,C,f,he,pe,Pe,W,ve,Ce,Ae,Ue,Fe,$e,Ve,U,xe,Se,ze,cs,fs,is,G,Ee,Me,hs,ls;return{"Site Name":((L=me.site)==null?void 0:L.name)||"","Site Code":((Q=me.site)==null?void 0:Q.siteCode)||"",Region:((D=me.site)==null?void 0:D.region)||"",State:((r=me.site)==null?void 0:r.state)||"","Site Type":((H=me.site)==null?void 0:H.siteType)||"",Status:((ae=me.site)==null?void 0:ae.status)||"","Total Auditoriums":((be=me.site)==null?void 0:be.totalAuditoriums)||0,"Total Projectors":((C=(Z=me.analysis)==null?void 0:Z.projectors)==null?void 0:C.total)||0,"Active Projectors":((he=(f=me.analysis)==null?void 0:f.projectors)==null?void 0:he.active)||0,"Under Service":((Pe=(pe=me.analysis)==null?void 0:pe.projectors)==null?void 0:Pe.underService)||0,"Needs Repair":((ve=(W=me.analysis)==null?void 0:W.projectors)==null?void 0:ve.needsRepair)||0,"Total RMAs":((Ae=(Ce=me.analysis)==null?void 0:Ce.rma)==null?void 0:Ae.total)||0,"RMA Total Cost":((Fe=(Ue=me.analysis)==null?void 0:Ue.rma)==null?void 0:Fe.totalCost)||0,"Avg RMA Resolution Time":((Ve=($e=me.analysis)==null?void 0:$e.rma)==null?void 0:Ve.avgResolutionTime)||0,"Total Spare Parts":((xe=(U=me.analysis)==null?void 0:U.spareParts)==null?void 0:xe.total)||0,"Spare Parts Value":((ze=(Se=me.analysis)==null?void 0:Se.spareParts)==null?void 0:ze.totalValue)||0,"Low Stock Parts":((fs=(cs=me.analysis)==null?void 0:cs.spareParts)==null?void 0:fs.lowStockCount)||0,"Total Services":((G=(is=me.analysis)==null?void 0:is.services)==null?void 0:G.total)||0,"Avg Satisfaction":((Me=(Ee=me.analysis)==null?void 0:Ee.services)==null?void 0:Me.avgSatisfaction)||0,"Total Issues":((ls=(hs=me.analysis)==null?void 0:hs.services)==null?void 0:ls.totalIssues)||0}}),ce=Ss(B);Cs(ce,"site-analysis-report.csv")},K=B=>{switch(B){case"Active":return"bg-green-100 text-green-800";case"Under Service":return"bg-yellow-100 text-yellow-800";case"Needs Repair":return"bg-red-100 text-red-800";case"Inactive":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return j?e.jsx("div",{className:"flex-1 overflow-auto p-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ft,{})})}):S?e.jsx("div",{className:"flex-1 overflow-auto p-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ta,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-2",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"You need to be logged in to access the analytics data. Please log in again."}),e.jsx(q,{onClick:()=>window.location.reload(),children:"Refresh Page"})]})}):v?e.jsx("div",{className:"flex-1 overflow-auto p-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Te,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-2",children:"Error Loading Analytics"}),e.jsx("p",{className:"text-gray-600 mb-4",children:v}),e.jsx(q,{onClick:z,className:"mt-4",children:"Retry"})]})}):e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Site Analytics & Analysis"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Comprehensive analysis of sites by region, state, and site code with RMA, projector, and spare parts insights"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(q,{onClick:z,variant:"outline",children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Refresh Data"]}),e.jsxs(q,{onClick:re,variant:"outline",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Export Report"]})]})]})}),e.jsxs("main",{className:"flex-1 overflow-auto p-8 bg-gray-50",children:[e.jsxs(te,{className:"mb-6",children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(vt,{className:"w-5 h-5"}),"Analysis Filters"]})}),e.jsx(se,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"region",children:"Region"}),e.jsxs(ye,{value:V,onValueChange:_,children:[e.jsx(ke,{children:e.jsx(Ne,{placeholder:"All Regions"})}),e.jsxs(we,{children:[e.jsx(I,{value:"all",children:"All Regions"}),e.jsx(I,{value:"North",children:"North"}),e.jsx(I,{value:"South",children:"South"}),e.jsx(I,{value:"East",children:"East"}),e.jsx(I,{value:"West",children:"West"}),e.jsx(I,{value:"Central",children:"Central"}),e.jsx(I,{value:"Northeast",children:"Northeast"}),e.jsx(I,{value:"Northwest",children:"Northwest"}),e.jsx(I,{value:"Southeast",children:"Southeast"}),e.jsx(I,{value:"Southwest",children:"Southwest"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"state",children:"State"}),e.jsxs(ye,{value:b,onValueChange:N,children:[e.jsx(ke,{children:e.jsx(Ne,{placeholder:"All States"})}),e.jsxs(we,{children:[e.jsx(I,{value:"all",children:"All States"}),Array.from(new Set(i.map(B=>B._id))).map(B=>e.jsx(I,{value:B,children:B},B))]})]})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"siteCode",children:"Site Code"}),e.jsx(k,{id:"siteCode",placeholder:"Search by site code...",value:y,onChange:B=>A(B.target.value)})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(q,{onClick:z,className:"w-full",children:[e.jsx(vs,{className:"w-4 h-4 mr-2"}),"Apply Filters"]})})]})})]}),e.jsx("div",{className:"flex space-x-1 mb-6",children:[{id:"overview",label:"Overview",icon:$s},{id:"sites",label:"Site Analysis",icon:As},{id:"regions",label:"Regional Analysis",icon:gt},{id:"states",label:"State Analysis",icon:ds}].map(B=>{const ce=B.icon;return e.jsxs(q,{variant:u===B.id?"default":"outline",onClick:()=>$(B.id),className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),B.label]},B.id)})}),u==="overview"&&h&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(te,{children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium",children:"Total Sites"}),e.jsx(As,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold",children:((ne=h.sites)==null?void 0:ne.totalSites)||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Across ",((O=(Y=h.sites)==null?void 0:Y.byRegion)==null?void 0:O.length)||0," regions"]})]})]}),e.jsxs(te,{children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium",children:"Total Projectors"}),e.jsx(ss,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold",children:((R=h.projectors)==null?void 0:R.totalProjectors)||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[((F=h.projectors)==null?void 0:F.activeProjectors)||0," active"]})]})]}),e.jsxs(te,{children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium",children:"Total RMAs"}),e.jsx(ms,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold",children:((J=h.rma)==null?void 0:J.totalRMAs)||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["₹",(((T=h.rma)==null?void 0:T.totalCost)||0).toLocaleString()," total cost"]})]})]}),e.jsxs(te,{children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium",children:"Spare Parts"}),e.jsx(Je,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold",children:((w=h.spareParts)==null?void 0:w.totalParts)||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[((g=h.spareParts)==null?void 0:g.lowStock)||0," low stock"]})]})]})]}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{children:"Site Distribution by Region"})}),e.jsx(se,{children:e.jsx("div",{className:"h-80",children:e.jsx(Ls,{width:"100%",height:"100%",children:e.jsxs(Yt,{data:a,children:[e.jsx(nt,{strokeDasharray:"3 3"}),e.jsx(it,{dataKey:"_id"}),e.jsx(ct,{}),e.jsx(Os,{}),e.jsx(Js,{dataKey:"siteCount",fill:"#3b82f6",name:"Sites"}),e.jsx(Js,{dataKey:"totalProjectors",fill:"#10b981",name:"Projectors"})]})})})})]}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{children:"Projector Status Distribution"})}),e.jsx(se,{children:e.jsx("div",{className:"h-80",children:e.jsx(Ls,{width:"100%",height:"100%",children:e.jsxs(Jt,{children:[e.jsx(Zt,{data:[{name:"Active",value:((p=h.projectors)==null?void 0:p.activeProjectors)||0,color:"#10b981"},{name:"Under Service",value:((M=h.projectors)==null?void 0:M.underService)||0,color:"#f59e0b"},{name:"Needs Repair",value:((m=h.projectors)==null?void 0:m.needsRepair)||0,color:"#ef4444"}],cx:"50%",cy:"50%",labelLine:!1,label:({name:B,percent:ce})=>`${B} ${(ce*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:[{name:"Active",value:((d=h.projectors)==null?void 0:d.activeProjectors)||0,color:"#10b981"},{name:"Under Service",value:((X=h.projectors)==null?void 0:X.underService)||0,color:"#f59e0b"},{name:"Needs Repair",value:((ee=h.projectors)==null?void 0:ee.needsRepair)||0,color:"#ef4444"}].map((B,ce)=>e.jsx(Xt,{fill:B.color},`cell-${ce}`))}),e.jsx(Os,{})]})})})})]})]}),u==="sites"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(te,{children:[e.jsxs(oe,{children:[e.jsx(de,{children:"Detailed Site Analysis"}),e.jsxs(Re,{children:["Comprehensive analysis of ",s.length," sites with detailed breakdowns"]})]}),e.jsx(se,{children:e.jsx("div",{className:"space-y-6",children:s.map(B=>{var ce,me,L,Q,D,r,H,ae,be,Z,C,f,he,pe,Pe,W,ve,Ce,Ae,Ue,Fe,$e,Ve,U,xe,Se;return e.jsxs(te,{className:"border-l-4 border-l-blue-500",children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(As,{className:"w-5 h-5"}),B.site.name,e.jsx(ge,{variant:"outline",children:B.site.siteCode})]}),e.jsxs(Re,{className:"flex items-center gap-4 mt-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(gt,{className:"w-4 h-4"}),B.site.region]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ds,{className:"w-4 h-4"}),B.site.state]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Vl,{className:"w-4 h-4"}),B.site.siteType]})]})]}),e.jsx(ge,{className:K(B.site.status),children:B.site.status})]})}),e.jsx(se,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(ss,{className:"w-4 h-4"}),"Projectors (",((me=(ce=B.analysis)==null?void 0:ce.projectors)==null?void 0:me.total)||0,")"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Active:"}),e.jsx(ge,{variant:"outline",className:"bg-green-100 text-green-800",children:((Q=(L=B.analysis)==null?void 0:L.projectors)==null?void 0:Q.active)||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Under Service:"}),e.jsx(ge,{variant:"outline",className:"bg-yellow-100 text-yellow-800",children:((r=(D=B.analysis)==null?void 0:D.projectors)==null?void 0:r.underService)||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Needs Repair:"}),e.jsx(ge,{variant:"outline",className:"bg-red-100 text-red-800",children:((ae=(H=B.analysis)==null?void 0:H.projectors)==null?void 0:ae.needsRepair)||0})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(ms,{className:"w-4 h-4"}),"RMA (",((Z=(be=B.analysis)==null?void 0:be.rma)==null?void 0:Z.total)||0,")"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Cost:"}),e.jsxs("span",{className:"font-medium",children:["₹",(((f=(C=B.analysis)==null?void 0:C.rma)==null?void 0:f.totalCost)||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Avg Resolution:"}),e.jsxs("span",{className:"font-medium",children:[((pe=(he=B.analysis)==null?void 0:he.rma)==null?void 0:pe.avgResolutionTime)||0," days"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),"Spare Parts (",((W=(Pe=B.analysis)==null?void 0:Pe.spareParts)==null?void 0:W.total)||0,")"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Value:"}),e.jsxs("span",{className:"font-medium",children:["₹",(((Ce=(ve=B.analysis)==null?void 0:ve.spareParts)==null?void 0:Ce.totalValue)||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Low Stock:"}),e.jsx(ge,{variant:"outline",className:"bg-orange-100 text-orange-800",children:((Ue=(Ae=B.analysis)==null?void 0:Ae.spareParts)==null?void 0:Ue.lowStockCount)||0})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(rs,{className:"w-4 h-4"}),"Services (",(($e=(Fe=B.analysis)==null?void 0:Fe.services)==null?void 0:$e.total)||0,")"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Avg Satisfaction:"}),e.jsxs("span",{className:"font-medium",children:[((U=(Ve=B.analysis)==null?void 0:Ve.services)==null?void 0:U.avgSatisfaction)||0,"/5"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Issues:"}),e.jsx("span",{className:"font-medium",children:((Se=(xe=B.analysis)==null?void 0:xe.services)==null?void 0:Se.totalIssues)||0})]})]})]})]})})]},B.site._id)})})})]})}),u==="regions"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(te,{children:[e.jsxs(oe,{children:[e.jsx(de,{children:"Regional Analysis"}),e.jsx(Re,{children:"Site and projector distribution across different regions"})]}),e.jsx(se,{children:e.jsx("div",{className:"space-y-4",children:a.map(B=>e.jsxs(te,{className:"border-l-4 border-l-green-500",children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(gt,{className:"w-5 h-5"}),B._id," Region"]})}),e.jsxs(se,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm text-gray-600",children:"Sites"}),e.jsx("p",{className:"text-2xl font-bold",children:B.siteCount})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm text-gray-600",children:"States"}),e.jsx("p",{className:"text-2xl font-bold",children:B.states.length})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm text-gray-600",children:"Total Projectors"}),e.jsx("p",{className:"text-2xl font-bold",children:B.totalProjectors})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm text-gray-600",children:"Active Projectors"}),e.jsx("p",{className:"text-2xl font-bold",children:B.activeProjectors})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h6",{className:"font-medium text-sm text-gray-600 mb-2",children:"Site Types"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:B.siteTypes.map(ce=>e.jsx(ge,{variant:"outline",children:ce},ce))})]})]})]},B._id))})})]})}),u==="states"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(te,{children:[e.jsxs(oe,{children:[e.jsx(de,{children:"State-wise Analysis"}),e.jsx(Re,{children:"Detailed breakdown of sites and projectors by state"})]}),e.jsx(se,{children:e.jsxs(Ds,{children:[e.jsx(Rs,{children:e.jsxs(He,{children:[e.jsx(fe,{children:"State"}),e.jsx(fe,{children:"Region"}),e.jsx(fe,{children:"Sites"}),e.jsx(fe,{children:"Site Codes"}),e.jsx(fe,{children:"Total Projectors"}),e.jsx(fe,{children:"Active Projectors"}),e.jsx(fe,{children:"Site Types"})]})}),e.jsx(Es,{children:i.map(B=>e.jsxs(He,{children:[e.jsx(je,{className:"font-medium",children:B._id}),e.jsx(je,{children:B.region}),e.jsx(je,{children:B.siteCount}),e.jsx(je,{children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[B.siteCodes.slice(0,3).map(ce=>e.jsx(ge,{variant:"outline",className:"text-xs",children:ce},ce)),B.siteCodes.length>3&&e.jsxs(ge,{variant:"outline",className:"text-xs",children:["+",B.siteCodes.length-3]})]})}),e.jsx(je,{children:B.totalProjectors}),e.jsx(je,{children:B.activeProjectors}),e.jsx(je,{children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[B.siteTypes.slice(0,2).map(ce=>e.jsx(ge,{variant:"outline",className:"text-xs",children:ce},ce)),B.siteTypes.length>2&&e.jsxs(ge,{variant:"outline",className:"text-xs",children:["+",B.siteTypes.length-2]})]})})]},B._id))})]})})]})})]})]})}function Hi(){ws();const[s,t]=n.useState(!1),[a,l]=n.useState("idle");n.useEffect(()=>{(async()=>{try{const x=await fetch("/api/settings",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(x.ok){const S=await x.json();o(S.settings)}}catch(x){console.error("Error loading settings:",x)}})()},[]);const[i,o]=n.useState({companyName:"ProjectorCare",warrantyDefaultDays:365,autoAlertDays:30,maxFileUploadSize:10,sessionTimeout:24,enableNotifications:!0,enableEmailAlerts:!0,enableSMSAlerts:!1,backupFrequency:"daily",dataRetentionDays:1095,maintenanceMode:!1}),h=async()=>{t(!0),l("saving");try{const v=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify(i)});if(v.ok){const x=await v.json();l("saved"),setTimeout(()=>l("idle"),2e3)}else l("error")}catch(v){console.error("Error saving settings:",v),l("error")}finally{t(!1)}},c=async()=>{try{const v=await fetch("/api/settings/reset",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(v.ok){const x=await v.json();o(x.settings),alert("Settings reset to defaults successfully")}else alert("Failed to reset settings")}catch(v){console.error("Error resetting settings:",v),alert("Error resetting settings")}},j=async()=>{if(confirm("Are you sure you want to clear all data? This action cannot be undone."))try{(await fetch("/api/clear-all-data",{method:"POST"})).ok?alert("Database cleared successfully"):alert("Failed to clear database")}catch{alert("Error clearing database")}},P=async()=>{try{const v=await fetch("/api/export-data");if(v.ok){const x=await v.blob(),S=window.URL.createObjectURL(x),E=document.createElement("a");E.href=S,E.download="projectorcare-data.json",E.click()}}catch{alert("Error exporting data")}};return e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Settings"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configure your warranty management system"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ge,{className:"bg-blue-100 text-blue-700",children:"Admin Access"}),e.jsx(ge,{className:"bg-green-100 text-green-700",children:"System Active"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs(te,{children:[e.jsxs(oe,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(gt,{className:"w-5 h-5"}),"Company Settings"]}),e.jsx(Re,{children:"Configure basic company information and defaults"})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name"}),e.jsx(k,{value:i.companyName,onChange:v=>o({...i,companyName:v.target.value}),className:"bg-white border-gray-300 text-gray-900"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Default Warranty Days"}),e.jsx(k,{type:"number",value:i.warrantyDefaultDays,onChange:v=>o({...i,warrantyDefaultDays:parseInt(v.target.value)}),className:"bg-white border-gray-300 text-gray-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Alert Days Before Expiry"}),e.jsx(k,{type:"number",value:i.autoAlertDays,onChange:v=>o({...i,autoAlertDays:parseInt(v.target.value)}),className:"bg-white border-gray-300 text-gray-900"})]})]})]})]}),e.jsxs(te,{children:[e.jsxs(oe,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(mt,{className:"w-5 h-5"}),"System Settings"]}),e.jsx(Re,{children:"Configure system behavior and limits"})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max File  (MB)"}),e.jsx(k,{type:"number",value:i.maxFileUploadSize,onChange:v=>o({...i,maxFileUploadSize:parseInt(v.target.value)}),className:"bg-white border-gray-300 text-gray-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Session Timeout (hours)"}),e.jsx(k,{type:"number",value:i.sessionTimeout,onChange:v=>o({...i,sessionTimeout:parseInt(v.target.value)}),className:"bg-white border-gray-300 text-gray-900"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Retention (days)"}),e.jsx(k,{type:"number",value:i.dataRetentionDays,onChange:v=>o({...i,dataRetentionDays:parseInt(v.target.value)}),className:"bg-white border-gray-300 text-gray-900"})]})]})]}),e.jsxs(te,{children:[e.jsxs(oe,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(Qt,{className:"w-5 h-5"}),"Notification Settings"]}),e.jsx(Re,{children:"Configure alert and notification preferences"})]}),e.jsx(se,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Enable Notifications"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Show in-app notifications"})]}),e.jsx("input",{type:"checkbox",checked:i.enableNotifications,onChange:v=>o({...i,enableNotifications:v.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Email Alerts"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Send warranty expiry alerts via email"})]}),e.jsx("input",{type:"checkbox",checked:i.enableEmailAlerts,onChange:v=>o({...i,enableEmailAlerts:v.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"SMS Alerts"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Send urgent alerts via SMS"})]}),e.jsx("input",{type:"checkbox",checked:i.enableSMSAlerts,onChange:v=>o({...i,enableSMSAlerts:v.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"})]})]})})]}),e.jsxs(te,{children:[e.jsxs(oe,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(Il,{className:"w-5 h-5"}),"Backup & Maintenance"]}),e.jsx(Re,{children:"Configure data backup and system maintenance"})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Backup Frequency"}),e.jsxs("select",{value:i.backupFrequency,onChange:v=>o({...i,backupFrequency:v.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 bg-white text-gray-900",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Maintenance Mode"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Temporarily disable system access"})]}),e.jsx("input",{type:"checkbox",checked:i.maintenanceMode,onChange:v=>o({...i,maintenanceMode:v.target.checked}),className:"w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500"})]})]})]})]}),e.jsxs(te,{children:[e.jsxs(oe,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(ta,{className:"w-5 h-5"}),"System Actions"]}),e.jsx(Re,{children:"Administrative actions for system management"})]}),e.jsx(se,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(q,{onClick:h,disabled:s,className:"bg-blue-600 hover:bg-blue-700",children:[s?e.jsx(Qe,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Gl,{className:"w-4 h-4 mr-2"}),a==="saving"?"Saving...":a==="saved"?"Saved!":a==="error"?"Error":"Save Settings"]}),e.jsxs(q,{onClick:c,variant:"outline",children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Reset to Defaults"]}),e.jsxs(q,{onClick:P,variant:"outline",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Export Data"]}),e.jsxs(q,{onClick:j,variant:"outline",className:"text-red-600 hover:text-red-700 border-red-300 hover:border-red-400",children:[e.jsx(Vs,{className:"w-4 h-4 mr-2"}),"Clear Database"]})]})})]}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5 text-green-600"}),"System Status"]})}),e.jsx(se,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 rounded-lg",children:[e.jsx(Be,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Database"}),e.jsx("p",{className:"text-xs text-green-600",children:"Connected"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-blue-50 rounded-lg",children:[e.jsx(ts,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Uptime"}),e.jsx("p",{className:"text-xs text-blue-600",children:"24h 32m"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-yellow-50 rounded-lg",children:[e.jsx(Te,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Warnings"}),e.jsx("p",{className:"text-xs text-yellow-600",children:"2 pending"})]})]})]})})]})]})}function Ki(){const{user:s}=ws(),[t,a]=n.useState([]),[l,i]=n.useState([]),[o,h]=n.useState([]),[c,j]=n.useState(""),[P,v]=n.useState("All"),[x,S]=n.useState(!1),[E,V]=n.useState(!0),[_,b]=n.useState(null),[N,y]=n.useState({username:"",email:"",password:"",role:"fse",firstName:"",lastName:"",phone:""});n.useEffect(()=>{A(),u()},[]),n.useEffect(()=>{$()},[t,c,P]);const A=async()=>{try{V(!0);const O=await fetch(`${ie.getBaseUrl()}/auth/users`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"}});if(O.ok){const R=await O.json();a(R.users)}else b("Failed to load users")}catch(O){b(O.message)}finally{V(!1)}},u=async()=>{try{const O=await ie.getAllFSEs();console.log("Available FSEs:",O),i(O)}catch(O){console.error("Failed to load FSEs:",O)}},$=()=>{let O=t;c&&(O=O.filter(R=>{var F,J,T,w;return R.username.toLowerCase().includes(c.toLowerCase())||R.email.toLowerCase().includes(c.toLowerCase())||((J=(F=R.profile)==null?void 0:F.firstName)==null?void 0:J.toLowerCase().includes(c.toLowerCase()))||((w=(T=R.profile)==null?void 0:T.lastName)==null?void 0:w.toLowerCase().includes(c.toLowerCase()))})),P!=="All"&&(O=O.filter(R=>R.role===P)),h(O)},z=async()=>{try{console.log("Creating user with data:",N);const O=await fetch(`${ie.getBaseUrl()}/auth/register`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"},body:JSON.stringify(N)}),R=await O.json();O.ok?(S(!1),K(),await A()):b(R.error||"Failed to create user")}catch(O){console.error("Error creating user:",O),b(O.message)}},re=async O=>{if(confirm("Are you sure you want to delete this user?"))try{(await fetch(`${ie.getBaseUrl()}/auth/users/${O}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"}})).ok?await A():b("Failed to delete user")}catch(R){b(R.message)}},K=()=>{y({username:"",email:"",password:"",role:"fse",firstName:"",lastName:"",phone:""})},ne=O=>{switch(O){case"admin":return"bg-red-100 text-red-700";case"fse":return"bg-blue-100 text-blue-700";default:return"bg-gray-100 text-gray-700"}},Y=O=>O?"bg-green-100 text-green-700":"bg-red-100 text-red-700";return E?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ie,{className:"w-8 h-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Loading users..."})]})}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"User Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage system users and create new FSE accounts"})]}),e.jsxs(q,{onClick:()=>S(!0),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Add New User"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(vs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(k,{placeholder:"Search users...",value:c,onChange:O=>j(O.target.value),className:"pl-10 bg-white border-gray-300 text-gray-900 placeholder-gray-500"})]})}),e.jsxs("select",{value:P,onChange:O=>v(O.target.value),className:"border border-gray-300 rounded-md px-3 py-2 bg-white text-gray-900",children:[e.jsx("option",{value:"All",children:"All Roles"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"fse",children:"FSE"})]})]}),e.jsxs(te,{children:[e.jsxs(oe,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"w-5 h-5"}),"System Users (",o.length,")"]}),e.jsx(Re,{children:"Manage user accounts and permissions"})]}),e.jsxs(se,{children:[_&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-red-600",children:_})}),e.jsx("div",{className:"space-y-4",children:o.map(O=>{var R,F,J;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx(as,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:(R=O.profile)!=null&&R.firstName&&((F=O.profile)!=null&&F.lastName)?`${O.profile.firstName} ${O.profile.lastName}`:O.username}),e.jsx(ge,{className:ne(O.role),children:O.role.toUpperCase()}),e.jsx(ge,{className:Y(O.isActive),children:O.isActive?"Active":"Inactive"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:O.email}),O.fseDetails&&e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(As,{className:"w-3 h-3 mr-1"}),O.fseDetails.designation]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(ds,{className:"w-3 h-3 mr-1"}),(J=O.fseDetails.assignedTerritory)==null?void 0:J.join(", ")]})]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:O.userId!==(s==null?void 0:s.userId)&&e.jsx(q,{variant:"outline",size:"sm",onClick:()=>re(O.userId),className:"text-red-600 hover:text-red-700",children:e.jsx(Vs,{className:"w-4 h-4"})})})]})},O._id)})})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(te,{className:"w-full max-w-md mx-4",children:[e.jsxs(oe,{children:[e.jsx(de,{children:"Add New User"}),e.jsx(Re,{children:"Create a new user account"})]}),e.jsx(se,{children:e.jsxs("form",{onSubmit:O=>{O.preventDefault(),z()},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name"}),e.jsx(k,{value:N.firstName,onChange:O=>y({...N,firstName:O.target.value}),className:"bg-white border-gray-300 text-gray-900 placeholder-gray-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name"}),e.jsx(k,{value:N.lastName,onChange:O=>y({...N,lastName:O.target.value}),className:"bg-white border-gray-300 text-gray-900 placeholder-gray-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),e.jsx(k,{value:N.username,onChange:O=>y({...N,username:O.target.value}),className:"bg-white border-gray-300 text-gray-900 placeholder-gray-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx(k,{type:"email",value:N.email,onChange:O=>y({...N,email:O.target.value}),className:"bg-white border-gray-300 text-gray-900 placeholder-gray-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e.jsx(k,{type:"password",value:N.password,onChange:O=>y({...N,password:O.target.value}),className:"bg-white border-gray-300 text-gray-900 placeholder-gray-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1"}),e.jsx(k,{value:N.phone,onChange:O=>y({...N,phone:O.target.value}),className:"bg-white border-gray-300 text-gray-900 placeholder-gray-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),e.jsxs("select",{value:N.role,onChange:O=>y({...N,role:O.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 bg-white text-gray-900",children:[e.jsx("option",{value:"fse",children:"FSE (Field Service Engineer)"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(q,{type:"submit",className:"flex-1",children:"Create User"}),e.jsx(q,{type:"button",variant:"outline",onClick:()=>{S(!1),K()},children:"Cancel"})]})]})})]})})]})}function Wi(){var A,u,$,z,re,K,ne,Y,O,R,F,J,T,w;const[s,t]=n.useState(null),[a,l]=n.useState(!0),[i,o]=n.useState(null),[h,c]=n.useState(null),[j,P]=n.useState(!1),[v,x]=n.useState([]),[S,E]=n.useState(!1);n.useEffect(()=>{V()},[]);const V=async()=>{try{l(!0),o(null);const g=await ie.getCloudStats();t(g)}catch(g){console.error("Error loading cloud stats:",g),o("Failed to load cloud storage statistics")}finally{l(!1)}},_=async g=>{try{E(!0),o(null);const p=await ie.getServiceVisitsByProjector(g),M=[];p.forEach(m=>{m.photos&&m.photos.length>0&&m.photos.forEach(d=>{M.push({...d,visitId:m.visitId,visitDate:m.scheduledDate,visitType:m.visitType})})}),x(M),c(g),P(!0)}catch(p){console.error("Error loading folder photos:",p),o("Failed to load folder photos")}finally{E(!1)}},b=g=>{if(g===0)return"0 Bytes";const p=1024,M=["Bytes","KB","MB","GB"],m=Math.floor(Math.log(g)/Math.log(p));return parseFloat((g/Math.pow(p,m)).toFixed(2))+" "+M[m]},N=()=>{var g,p;return s&&((p=(g=s.cloudinaryUsage)==null?void 0:g.credits)==null?void 0:p.used_percent)||0},y=s?Object.entries(s.foldersBySerial).map(([g,p])=>({serialNumber:g,visits:p.visits,files:p.files,size:p.size,lastModified:new Date().toLocaleDateString()})):[];return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"bg-dark-bg border-b border-dark-color px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-dark-primary",children:"Cloud Storage"}),e.jsx("p",{className:"text-sm text-dark-secondary mt-1",children:"Manage and monitor cloud storage for service visit photos"})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs(q,{onClick:V,disabled:a,className:"dark-button-secondary gap-2",children:[a?e.jsx(Ie,{className:"w-4 h-4 animate-spin"}):e.jsx(Qe,{className:"w-4 h-4"}),"Refresh"]})})]})}),e.jsxs("div",{className:"p-8 space-y-8",children:[i&&e.jsx("div",{className:"p-4 bg-red-900 bg-opacity-30 rounded-lg border border-red-600",children:e.jsx("p",{className:"text-red-400 text-sm",children:i})}),a?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Ie,{className:"w-8 h-8 animate-spin text-dark-secondary"})}):s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium text-dark-secondary",children:"Total Folders"}),e.jsx(ba,{className:"h-4 w-4 text-blue-400"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary",children:s.totalFolders}),e.jsx("p",{className:"text-xs text-dark-secondary",children:"Serial number folders"})]})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium text-dark-secondary",children:"Total Files"}),e.jsx(ga,{className:"h-4 w-4 text-green-400"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary",children:s.totalFiles}),e.jsx("p",{className:"text-xs text-dark-secondary",children:"Photos uploaded"})]})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium text-dark-secondary",children:"Storage Used"}),e.jsx($l,{className:"h-4 w-4 text-purple-400"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary",children:b(((u=(A=s.cloudinaryUsage)==null?void 0:A.storage)==null?void 0:u.usage)||0)}),e.jsxs("p",{className:"text-xs text-dark-secondary",children:[N().toFixed(1),"% of credits used"]})]})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium text-dark-secondary",children:"Cloudinary Plan"}),e.jsx(sa,{className:"h-4 w-4 text-orange-400"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold text-dark-primary",children:(($=s.cloudinaryUsage)==null?void 0:$.plan)||"Free"}),e.jsxs("p",{className:"text-xs text-dark-secondary",children:[((re=(z=s.cloudinaryUsage)==null?void 0:z.credits)==null?void 0:re.usage)||0," / ",((ne=(K=s.cloudinaryUsage)==null?void 0:K.credits)==null?void 0:ne.limit)||25," credits used"]})]})]})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{children:[e.jsx(de,{className:"text-dark-primary",children:"Cloudinary Usage"}),e.jsx(Re,{className:"text-dark-secondary",children:"Cloudinary storage and bandwidth usage"})]}),e.jsx(se,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-bg rounded-lg",children:[e.jsx("div",{className:"text-lg font-bold text-dark-primary",children:((O=(Y=s.cloudinaryUsage)==null?void 0:Y.objects)==null?void 0:O.usage)||0}),e.jsx("div",{className:"text-xs text-dark-secondary",children:"Images"})]}),e.jsxs("div",{className:"text-center p-4 bg-dark-bg rounded-lg",children:[e.jsx("div",{className:"text-lg font-bold text-dark-primary",children:b(((F=(R=s.cloudinaryUsage)==null?void 0:R.storage)==null?void 0:F.usage)||0)}),e.jsx("div",{className:"text-xs text-dark-secondary",children:"Storage"})]}),e.jsxs("div",{className:"text-center p-4 bg-dark-bg rounded-lg",children:[e.jsx("div",{className:"text-lg font-bold text-dark-primary",children:b(((T=(J=s.cloudinaryUsage)==null?void 0:J.bandwidth)==null?void 0:T.usage)||0)}),e.jsx("div",{className:"text-xs text-dark-secondary",children:"Bandwidth"})]}),e.jsxs("div",{className:"text-center p-4 bg-dark-bg rounded-lg",children:[e.jsx("div",{className:"text-lg font-bold text-dark-primary",children:((w=s.cloudinaryUsage)==null?void 0:w.requests)||0}),e.jsx("div",{className:"text-xs text-dark-secondary",children:"Requests"})]})]})})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{children:[e.jsx(de,{className:"text-dark-primary",children:"Folders by Serial Number"}),e.jsx(Re,{className:"text-dark-secondary",children:"Storage breakdown by projector serial number"})]}),e.jsx(se,{children:y.length>0?e.jsx("div",{className:"space-y-4",children:y.map(g=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-dark-bg rounded-lg border border-dark-color",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(ba,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-dark-primary",children:g.serialNumber}),e.jsxs("p",{className:"text-xs text-dark-secondary",children:[g.visits," visits, ",g.files," files"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-dark-primary",children:b(g.size)}),e.jsxs("p",{className:"text-xs text-dark-secondary",children:[g.files," files"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(q,{size:"sm",variant:"outline",className:"dark-button-secondary",onClick:()=>_(g.serialNumber),disabled:S,children:S?e.jsx(Ie,{className:"w-4 h-4 animate-spin"}):e.jsx(es,{className:"w-4 h-4"})}),e.jsx(q,{size:"sm",variant:"outline",className:"dark-button-secondary",children:e.jsx(We,{className:"w-4 h-4"})})]})]})]},g.serialNumber))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Tt,{className:"w-12 h-12 mx-auto mb-4 text-dark-secondary"}),e.jsx("p",{className:"text-dark-secondary",children:"No cloud storage folders found"})]})})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{children:[e.jsx(de,{className:"text-dark-primary",children:"Storage Actions"}),e.jsx(Re,{className:"text-dark-secondary",children:"Manage cloud storage and perform maintenance tasks"})]}),e.jsx(se,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(q,{variant:"outline",className:"dark-button-secondary",onClick:()=>{alert("Backup functionality coming soon")},children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Backup Storage"]}),e.jsxs(q,{variant:"outline",className:"dark-button-secondary",onClick:()=>{alert("Cleanup functionality coming soon")},children:[e.jsx(Vs,{className:"w-4 h-4 mr-2"}),"Cleanup Old Files"]}),e.jsxs(q,{variant:"outline",className:"dark-button-secondary",onClick:()=>{alert("Analytics functionality coming soon")},children:[e.jsx($s,{className:"w-4 h-4 mr-2"}),"Storage Analytics"]})]})})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Tt,{className:"w-12 h-12 mx-auto mb-4 text-dark-secondary"}),e.jsx("p",{className:"text-dark-secondary",children:"No cloud storage data available"})]})]}),j&&h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-dark-bg border-2 border-dark-color rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-dark-primary",children:["Folder: ",h]}),e.jsxs("p",{className:"text-sm text-dark-secondary mt-1",children:[v.length," photos • ",b(v.reduce((g,p)=>g+(p.fileSize||0),0))]})]}),e.jsx(q,{onClick:()=>P(!1),className:"text-dark-secondary hover:text-dark-primary",children:"×"})]}),v.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:v.map((g,p)=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"aspect-square bg-dark-bg border border-dark-color rounded-lg overflow-hidden",children:e.jsx("img",{src:g.cloudUrl||"/placeholder-image.jpg",alt:g.description||g.originalName,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200",onError:M=>{M.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjM0I0MjU5Ii8+CjxwYXRoIGQ9Ik02MCAxMDBMMTAwIDgwTDE0MCAxMDBMMTgwIDEyMEgxNDBMMTAwIDE0MEw2MCAxMjBINjBaIiBmaWxsPSIjN0M4Q0E5Ii8+CjxjaXJjbGUgY3g9IjEwMCIgY3k9IjgwIiByPSIxMCIgZmlsbD0iIzdDOENBOSIvPgo8L3N2Zz4K"}})}),e.jsxs("div",{className:"mt-2 text-xs text-dark-secondary",children:[e.jsx("div",{className:"font-medium text-dark-primary",children:g.visitId}),e.jsx("div",{children:g.category}),e.jsx("div",{children:new Date(g.uploadedAt).toLocaleDateString()})]})]},p))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ga,{className:"w-12 h-12 mx-auto mb-4 text-dark-secondary"}),e.jsx("p",{className:"text-dark-secondary",children:"No photos found in this folder"})]})]})})]})}function qi(){const[s,t]=n.useState(!1),[a,l]=n.useState("json"),[i,o]=n.useState(""),[h,c]=n.useState(""),[j,P]=n.useState(null),[v,x]=n.useState(null),[S,E]=n.useState({sites:{success:0,failed:0,errors:[]},projectors:{success:0,failed:0,errors:[]}}),[V,_]=n.useState(!1),[b,N]=n.useState(""),y=n.useRef(null),A=n.useRef(null),u=()=>{o(""),c(""),x(null),P(null),_(!1)},$=async()=>{try{t(!0),_(!1);const F=JSON.parse(i),J={sites:{success:0,failed:0,errors:[]},projectors:{success:0,failed:0,errors:[]}};for(const T of F.sites)try{const w=await ie.createSite(T);J.sites.success++;for(const g of T.projectors)try{const p=await ie.createProjector({...g,siteId:w._id});J.projectors.success++}catch(p){J.projectors.failed++,J.projectors.errors.push(`Projector ${g.serialNumber}: ${p.message}`)}}catch(w){J.sites.failed++,J.sites.errors.push(`Site ${T.name}: ${w.message}`)}E(J),_(!0)}catch(F){console.error("Bulk upload error:",F),alert("Error parsing JSON data. Please check the format.")}finally{t(!1)}},z=async()=>{try{t(!0),_(!1);const F=h.trim().split(`
`);if(F.length<2)throw new Error("CSV file must have at least a header row and one data row");const J=F[0].split(",").map(Q=>Q.trim());console.log("CSV Headers:",J),console.log("First data row:",F[1]);const T={sites:{success:0,failed:0,errors:[]},projectors:{success:0,failed:0,errors:[]}},w=new Map;for(let Q=1;Q<F.length;Q++){const D=F[Q];if(!D.trim())continue;const r=R(D);if(console.log(`Row ${Q} values:`,r),r.length<47){T.sites.errors.push(`Row ${Q}: Insufficient columns. Expected 47, got ${r.length}`);continue}const H=r[0];if(!H){T.sites.errors.push(`Row ${Q}: Missing site name`);continue}w.has(H)||w.set(H,{siteData:{name:H,siteCode:r[1]||`SITE-${Date.now()}`,region:r[2]||"North",state:r[3]||"",address:{street:r[4]||"",city:r[5]||"",state:r[6]||"",pincode:r[7]||"",country:r[8]||"India"},contactPerson:{name:r[9]||"",email:r[10]||"",phone:r[11]||"",designation:r[12]||""},businessHours:{openTime:r[13]||"09:00",closeTime:r[14]||"18:00",workingDays:r[15]?r[15].replace(/"/g,"").split(","):["Monday","Tuesday","Wednesday","Thursday","Friday"]},siteType:r[16]||"Mall",status:r[17]||"Active",amcContract:{contractNumber:r[18]||`AMC-${Date.now()}`,contractStartDate:r[19]||new Date().toISOString().split("T")[0],contractEndDate:r[20]||new Date(Date.now()+365*24*60*60*1e3).toISOString().split("T")[0],contractValue:parseFloat(r[21])||0,contractManager:r[22]||"Unassigned",status:r[23]||"Active",serviceLevel:r[24]||"Standard"},auditoriums:[{audiNumber:r[25]||"AUDI-01",name:r[26]||"Main Auditorium",capacity:parseInt(r[27])||100,screenSize:r[28]||"Standard",status:r[29]||"Active"}],projectors:[]},projectors:[]});const ae={projectorNumber:r[30]||`PROJ-${Date.now()}-${Q}`,serialNumber:r[31]||`SER-${Date.now()}-${Q}`,model:r[32]||"Unknown Model",brand:r[33]||"Unknown Brand",auditoriumId:r[34]||"AUDI-01",auditoriumName:r[35]||"Main Auditorium",installDate:r[36]||new Date().toISOString().split("T")[0],warrantyEnd:r[37]||new Date(Date.now()+3*365*60*60*1e3).toISOString().split("T")[0],status:r[38]||"Active",condition:r[39]||"Good",expectedLife:parseInt(r[40])||1e4,siteName:H,siteCode:w.get(H).siteData.siteCode,amcContract:r[41]?{contractNumber:r[41]||`AMC-${Date.now()}`,contractStartDate:r[42]||new Date().toISOString().split("T")[0],contractEndDate:r[43]||new Date(Date.now()+365*24*60*60*1e3).toISOString().split("T")[0],contractValue:parseFloat(r[44])||0,contractManager:r[45]||"Unassigned",status:r[46]||"Active"}:void 0};w.get(H).projectors.push(ae)}console.log("CSV Processing Summary:");for(const[Q,D]of w)console.log(`Site: "${Q}" - ${D.projectors.length} projectors`),console.log("Projectors:",D.projectors.map(r=>r.serialNumber));console.log("Fetching existing sites and projectors...");const[g,p]=await Promise.all([ie.getAllSites(),ie.getAllProjectors()]);console.log(`Found ${g.length} existing sites and ${p.length} existing projectors`),console.log("Sites to process:",Array.from(w.keys())),console.log("Existing site names:",Array.from(g.map(Q=>Q.name)));const M=new Set(g.map(Q=>Q.name)),m=new Set(p.map(Q=>Q.serialNumber));let d=0;const X=w.size;for(const[Q,D]of w){d++,N(`Processing site ${d}/${X}: ${Q}`);try{if(M.has(Q)){console.log(`Site "${Q}" already exists. Adding projectors to existing site.`);const H=g.find(ae=>ae.name===Q);if(!H){T.sites.failed++,T.sites.errors.push(`Site "${Q}" exists but not found. Skipping.`);continue}for(const ae of D.projectors)try{if(m.has(ae.serialNumber)){T.projectors.failed++,T.projectors.errors.push(`Projector ${ae.serialNumber}: Already exists. Skipping.`);continue}console.log(`Creating projector: ${ae.serialNumber} for existing site: ${Q}`);const be=await ie.createProjector({...ae,siteId:H._id,siteName:Q,siteCode:w.get(Q).siteData.siteCode});if(console.log("Projector created successfully:",be),T.projectors.success++,ae.amcContract)try{const Z=await ie.createAMCContract({contractNumber:ae.amcContract.contractNumber,projectorSerial:ae.serialNumber,contractStartDate:ae.amcContract.contractStartDate,contractEndDate:ae.amcContract.contractEndDate,contractValue:ae.amcContract.contractValue,contractManager:ae.amcContract.contractManager,status:ae.amcContract.status});console.log("AMC contract created successfully:",Z)}catch(Z){console.warn(`Failed to create AMC contract for projector ${ae.serialNumber}:`,Z.message)}}catch(be){T.projectors.failed++,T.projectors.errors.push(`Projector ${ae.serialNumber}: ${be.message}`)}continue}console.log(`Creating site: ${Q}`);const r=await ie.createSite(D.siteData);T.sites.success++;for(const H of D.projectors)try{if(m.has(H.serialNumber)){T.projectors.failed++,T.projectors.errors.push(`Projector ${H.serialNumber}: Already exists. Skipping.`);continue}console.log(`Creating projector: ${H.serialNumber} for site: ${Q}`);const ae=await ie.createProjector({...H,siteId:r._id,siteName:Q,siteCode:w.get(Q).siteData.siteCode});if(console.log("Projector created successfully:",ae),T.projectors.success++,H.amcContract)try{const be=await ie.createAMCContract({contractNumber:H.amcContract.contractNumber,projectorSerial:H.serialNumber,contractStartDate:H.amcContract.contractStartDate,contractEndDate:H.amcContract.contractEndDate,contractValue:H.amcContract.contractValue,contractManager:H.amcContract.contractManager,status:H.amcContract.status});console.log("AMC contract created successfully:",be)}catch(be){console.warn(`Failed to create AMC contract for projector ${H.serialNumber}:`,be.message)}}catch(ae){T.projectors.failed++,T.projectors.errors.push(`Projector ${H.serialNumber}: ${ae.message}`)}try{const H=me.filter(ae=>ae.site===Q);console.log(`Updating site "${Q}" with ${H.length} projectors`)}catch(H){console.warn(`Could not update projector count for site ${Q}:`,H)}}catch(r){T.sites.failed++,T.sites.errors.push(`Site ${Q}: ${r.message}`)}}const ee=w.size,B=Array.from(w.values()).reduce((Q,D)=>Q+D.projectors.length,0);console.log("Verifying upload results...");const[ce,me]=await Promise.all([ie.getAllSites(),ie.getAllProjectors()]);console.log(`Final count - Sites: ${ce.length}, Projectors: ${me.length}`);const L=ce.filter(Q=>Array.from(w.keys()).includes(Q.name));for(const Q of L){const D=me.filter(r=>r.site===Q.name);console.log(`Site "${Q.name}" has ${D.length} projectors:`,D.map(r=>r.serialNumber))}if(E({...T,summary:{totalSites:ee,totalProjectors:B,processedSites:T.sites.success+T.sites.failed,processedProjectors:T.projectors.success+T.projectors.failed}}),_(!0),T.sites.success>0||T.projectors.success>0){try{console.log("Forcing refresh of sites data...");const Q=await ie.getAllSites();console.log("Refreshed sites data:",Q.map(D=>({name:D.name,totalProjectors:D.totalProjectors,activeProjectors:D.activeProjectors})))}catch(Q){console.error("Error refreshing sites:",Q)}alert(`Upload completed successfully!

Sites created: ${T.sites.success}
Projectors created: ${T.projectors.success}

Next steps:
1. Click "Check Database" button to verify data
2. Go to Sites page and click "Refresh" button
3. Check browser console for detailed logs

If counts are still 0, the issue is in the backend calculation.`)}}catch(F){console.error("CSV upload error:",F),alert("Error processing CSV data. Please check the format.")}finally{t(!1),N("")}},re=F=>{var T;const J=(T=F.target.files)==null?void 0:T[0];if(J&&(J.type==="text/csv"||J.name.toLowerCase().endsWith(".csv"))){P(J);const w=new FileReader;w.onload=g=>{var M;const p=(M=g.target)==null?void 0:M.result;c(p),console.log("CSV file loaded:",J.name,"Size:",J.size,"Content length:",p.length)},w.onerror=()=>{alert("Error reading CSV file")},w.readAsText(J)}else alert("Please select a valid CSV file (.csv extension)")},K=F=>{var T;const J=(T=F.target.files)==null?void 0:T[0];if(J&&(J.type==="application/json"||J.name.toLowerCase().endsWith(".json"))){x(J);const w=new FileReader;w.onload=g=>{var M;const p=(M=g.target)==null?void 0:M.result;o(p),console.log("JSON file loaded:",J.name,"Size:",J.size,"Content length:",p.length)},w.onerror=()=>{alert("Error reading JSON file")},w.readAsText(J)}else alert("Please select a valid JSON file (.json extension)")},ne=F=>{F.preventDefault();const J=F.dataTransfer.files[0];if(J&&(J.type==="text/csv"||J.name.toLowerCase().endsWith(".csv"))){P(J);const T=new FileReader;T.onload=w=>{var p;const g=(p=w.target)==null?void 0:p.result;c(g),console.log("CSV file dropped:",J.name,"Size:",J.size,"Content length:",g.length)},T.onerror=()=>{alert("Error reading CSV file")},T.readAsText(J)}else alert("Please drop a valid CSV file (.csv extension)")},Y=F=>{F.preventDefault();const J=F.dataTransfer.files[0];if(J&&(J.type==="application/json"||J.name.toLowerCase().endsWith(".json"))){x(J);const T=new FileReader;T.onload=w=>{var p;const g=(p=w.target)==null?void 0:p.result;o(g),console.log("JSON file dropped:",J.name,"Size:",J.size,"Content length:",g.length)},T.onerror=()=>{alert("Error reading JSON file")},T.readAsText(J)}else alert("Please drop a valid JSON file (.json extension)")},O=F=>{F.preventDefault()},R=F=>{const J=[];let T="",w=!1;for(let g=0;g<F.length;g++){const p=F[g];p==='"'?w=!w:p===","&&!w?(J.push(T.trim()),T=""):T+=p}return J.push(T.trim()),J};return e.jsx("div",{className:"p-8 bg-dark-bg min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-dark-primary mb-2",children:"Bulk Upload Sites & Projectors"}),e.jsx("p",{className:"text-dark-secondary",children:"Upload multiple sites and their projectors at once using JSON or CSV format"})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{children:[e.jsx(de,{className:"text-dark-primary",children:"Upload Format"}),e.jsx(Re,{className:"text-dark-secondary",children:"Choose your preferred upload format"})]}),e.jsx(se,{children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs(q,{onClick:()=>{l("json"),u()},className:`flex-1 ${a==="json"?"dark-button-primary":"dark-button-secondary"}`,children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"JSON Format"]}),e.jsxs(q,{onClick:()=>{l("csv"),u()},className:`flex-1 ${a==="csv"?"dark-button-primary":"dark-button-secondary"}`,children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"CSV Format"]})]})})]}),e.jsxs(te,{className:"dark-card",children:[e.jsxs(oe,{children:[e.jsx(de,{className:"text-dark-primary",children:"Upload Data"}),e.jsx(Re,{className:"text-dark-secondary",children:a==="json"?"Paste your JSON data below (should include sites array with nested projectors and AMC contracts)":"Upload a CSV file or paste CSV data below (one row per projector, grouped by site). CSV should have 47 columns including site details, site AMC contracts, auditorium info, projector data, and projector AMC contracts."})]}),e.jsx(se,{children:e.jsxs("div",{className:"space-y-4",children:[a==="csv"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{onDrop:ne,onDragOver:O,className:"border-2 border-dashed border-gray-600 rounded-lg p-8 text-center hover:border-gray-500 transition-colors",children:[e.jsx(ja,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-2",children:"Upload CSV File"}),e.jsx("p",{className:"text-dark-secondary mb-4",children:"Drag and drop your CSV file here, or click to browse"}),e.jsx("input",{ref:y,type:"file",accept:".csv",onChange:re,className:"hidden"}),e.jsxs(q,{onClick:()=>{var F;return(F=y.current)==null?void 0:F.click()},className:"dark-button-secondary",children:[e.jsx(Ns,{className:"w-4 h-4 mr-2"}),"Choose CSV File"]}),j&&e.jsx("div",{className:"mt-4 p-3 bg-green-900/20 border border-green-500 rounded-lg",children:e.jsxs("p",{className:"text-green-400 text-sm",children:["✅ File loaded: ",j.name," (",(j.size/1024).toFixed(1)," KB)"]})})]}),a==="csv"&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-800/50 rounded-lg border border-gray-600",children:[e.jsx("h4",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Upload Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(q,{onClick:z,disabled:s||!h.trim(),className:`${s||!h.trim()?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"} px-6 py-3 rounded-lg font-semibold transition-colors border-2 border-blue-500`,style:{minWidth:"150px",fontSize:"16px"},children:[s?e.jsx(Ie,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Ns,{className:"w-4 h-4 mr-2"}),s?"Uploading...":"Upload Data"]}),e.jsxs(q,{onClick:()=>{const F=`Site Name,Site Code,Region,State,Street,City,State,Pincode,Country,Contact Name,Contact Email,Contact Phone,Contact Designation,Open Time,Close Time,Working Days,Site Type,Status,Site AMC Contract Number,Site AMC Start Date,Site AMC End Date,Site AMC Value,Site AMC Manager,Site AMC Status,Site AMC Service Level,Auditorium Number,Auditorium Name,Auditorium Capacity,Screen Size,Auditorium Status,Projector Number,Serial Number,Model,Brand,Auditorium ID,Auditorium Name,Install Date,Warranty End,Status,Condition,Expected Life,Projector AMC Contract Number,Projector AMC Start Date,Projector AMC End Date,Projector AMC Value,Projector AMC Manager,Projector AMC Status
Example Mall,SM001,North,Delhi,123 Main St,New Delhi,Delhi,110001,India,John Doe,john@example.com,+91-9876543210,Manager,09:00,18:00,"Monday,Tuesday,Wednesday,Thursday,Friday",Mall,Active,AMC-SITE-001,2024-01-01,2025-01-01,50000,John Manager,Active,Standard,AUDI-01,Main Hall,100,Standard,Active,PROJ001,SER001,Epson EB-2250U,Epson,AUDI-01,Main Hall,2024-01-01,2027-01-01,Active,Good,10000,AMC-PROJ-001,2024-01-01,2025-01-01,10000,AMC Manager,Active`,J=new Blob([F],{type:"text/csv"}),T=window.URL.createObjectURL(J),w=document.createElement("a");w.href=T,w.download="bulk_upload_template.csv",w.click(),window.URL.revokeObjectURL(T)},variant:"outline",className:"dark-button-secondary",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Download CSV Template"]}),e.jsxs(q,{onClick:u,variant:"outline",className:"dark-button-secondary",children:[e.jsx(xt,{className:"w-4 h-4 mr-2"}),"Clear Data"]}),s&&b&&e.jsx("div",{className:"w-full mt-3 p-3 bg-blue-900/20 border border-blue-500 rounded-lg",children:e.jsx("div",{className:"text-blue-400 text-sm font-medium",children:b})})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"text-dark-secondary",children:"OR"})}),e.jsxs("div",{className:"p-4 bg-blue-900/20 border border-blue-600 rounded-lg",children:[e.jsx("h4",{className:"text-lg font-semibold text-blue-400 mb-2",children:"CSV Structure (47 columns)"}),e.jsxs("div",{className:"text-sm text-blue-200 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Columns 1-24:"})," Site Information (Name, Code, Region, State, Address, Contact, Business Hours, Type, Status)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Columns 25-29:"})," Site AMC Contract (Contract Number, Start/End Dates, Value, Manager, Status, Service Level)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Columns 30-40:"})," Auditorium & Projector Information (Auditorium Details, Projector Number, Serial, Model, Brand, Dates, Status, Condition, Life)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Columns 41-47:"})," Projector AMC Contract (Contract Number, Start/End Dates, Value, Manager, Status)"]}),e.jsxs("p",{className:"text-xs mt-2",children:["💡 ",e.jsx("strong",{children:"Tip:"})," Download the CSV template above to see the exact format. Each row represents one projector, and sites are automatically grouped."]})]})]})]}),a==="json"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"text-lg font-semibold text-dark-primary",children:"JSON Data"}),e.jsxs(q,{onClick:()=>{const J=JSON.stringify({sites:[{name:"Example Mall",siteCode:"SM001",region:"North",state:"Delhi",address:{street:"123 Main Street",city:"New Delhi",state:"Delhi",pincode:"110001",country:"India"},contactPerson:{name:"John Doe",email:"john@example.com",phone:"+91-9876543210",designation:"Manager"},businessHours:{openTime:"09:00",closeTime:"18:00",workingDays:["Monday","Tuesday","Wednesday","Thursday","Friday"]},siteType:"Mall",status:"Active",amcContract:{contractNumber:"AMC-SITE-001",contractStartDate:"2024-01-01",contractEndDate:"2025-01-01",contractValue:5e4,contractManager:"John Manager",status:"Active",serviceLevel:"Standard"},auditoriums:[{audiNumber:"AUDI-01",name:"Main Auditorium",capacity:100,screenSize:"Standard",status:"Active"}],projectors:[{projectorNumber:"PROJ001",serialNumber:"SER001",model:"Epson EB-2250U",brand:"Epson",auditoriumId:"AUDI-01",auditoriumName:"Main Auditorium",installDate:"2024-01-01",warrantyEnd:"2027-01-01",status:"Active",condition:"Good",expectedLife:1e4,amcContract:{contractNumber:"AMC001",contractStartDate:"2024-01-01",contractEndDate:"2025-01-01",contractValue:1e4,contractManager:"AMC Manager",status:"Active"}}]}]},null,2),T=new Blob([J],{type:"application/json"}),w=window.URL.createObjectURL(T),g=document.createElement("a");g.href=w,g.download="bulk_upload_template.json",g.click(),window.URL.revokeObjectURL(w)},variant:"outline",className:"dark-button-secondary",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Download JSON Template"]})]}),e.jsxs("div",{onDrop:Y,onDragOver:O,className:"border-2 border-dashed border-gray-600 rounded-lg p-8 text-center hover:border-gray-500 transition-colors",children:[e.jsx(ja,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-dark-primary mb-2",children:"Upload JSON File"}),e.jsx("p",{className:"text-dark-secondary mb-4",children:"Drag and drop your JSON file here, or click to browse"}),e.jsx("input",{ref:A,type:"file",accept:".json",onChange:K,className:"hidden"}),e.jsxs(q,{onClick:()=>{var F;return(F=A.current)==null?void 0:F.click()},className:"dark-button-secondary",children:[e.jsx(Ns,{className:"w-4 h-4 mr-2"}),"Choose JSON File"]}),v&&e.jsxs("div",{className:"mt-4 p-3 bg-green-900/20 border border-green-500 rounded-lg",children:[e.jsxs("p",{className:"text-green-400 text-sm",children:["✅ File loaded: ",v.name," (",(v.size/1024).toFixed(1)," KB)"]}),e.jsxs("p",{className:"text-green-400 text-sm mt-1",children:["📊 Data loaded: ",i.length," characters"]})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"text-dark-secondary",children:"OR"})}),e.jsx(os,{placeholder:"Paste JSON data here...",value:i,onChange:F=>o(F.target.value),className:"min-h-[300px] font-mono text-sm"}),a==="json"&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-800/50 rounded-lg border border-gray-600",children:[e.jsx("h4",{className:"text-lg font-semibold text-dark-primary mb-4",children:"Upload Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(q,{onClick:$,disabled:s||!i.trim(),className:`${s||!i.trim()?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"} px-6 py-3 rounded-lg font-semibold transition-colors border-2 border-blue-500`,style:{minWidth:"150px",fontSize:"16px"},children:[s?e.jsx(Ie,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Ns,{className:"w-4 h-4 mr-2"}),s?"Uploading...":"Upload Data"]}),e.jsxs(q,{onClick:u,variant:"outline",className:"dark-button-secondary",children:[e.jsx(xt,{className:"w-4 h-4 mr-2"}),"Clear Data"]}),s&&b&&e.jsx("div",{className:"w-full mt-3 p-3 bg-blue-900/20 border border-blue-500 rounded-lg",children:e.jsx("div",{className:"text-blue-400 text-sm font-medium",children:b})})]})]})]}),a==="csv"&&e.jsx(os,{placeholder:"Paste CSV data here...",value:h,onChange:F=>c(F.target.value),className:"min-h-[300px] font-mono text-sm"}),a==="csv"&&e.jsx("div",{className:"flex items-center space-x-2 text-sm mt-4",children:h.trim()?e.jsxs("div",{className:"flex items-center space-x-2 text-green-400",children:[e.jsx(Be,{className:"w-4 h-4"}),e.jsxs("span",{children:["CSV data loaded (",h.split(`
`).length," lines)"]})]}):e.jsxs("div",{className:"flex items-center space-x-2 text-yellow-400",children:[e.jsx(xt,{className:"w-4 h-4"}),e.jsx("span",{children:"No CSV data loaded"})]})}),a==="json"&&e.jsx("div",{className:"flex items-center space-x-2 text-sm mt-4",children:i.trim()?e.jsxs("div",{className:"flex items-center space-x-2 text-green-400",children:[e.jsx(Be,{className:"w-4 h-4"}),e.jsx("span",{children:v?`JSON file loaded: ${v.name} (${(v.size/1024).toFixed(1)} KB)`:`JSON data loaded (${i.length} characters)`})]}):e.jsxs("div",{className:"flex items-center space-x-2 text-yellow-400",children:[e.jsx(xt,{className:"w-4 h-4"}),e.jsx("span",{children:"No JSON data loaded"})]})})]})})]}),V&&e.jsxs(te,{className:"dark-card",children:[e.jsx(oe,{children:e.jsx(de,{className:"text-dark-primary",children:"Upload Results"})}),e.jsxs(se,{children:[S.summary&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-800/50 rounded-lg",children:[e.jsx("h4",{className:"text-lg font-semibold text-dark-primary mb-3",children:"Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Total Sites:"}),e.jsx("div",{className:"text-dark-primary font-semibold",children:S.summary.totalSites})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Total Projectors:"}),e.jsx("div",{className:"text-dark-primary font-semibold",children:S.summary.totalProjectors})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Processed Sites:"}),e.jsx("div",{className:"text-dark-primary font-semibold",children:S.summary.processedSites})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-secondary",children:"Processed Projectors:"}),e.jsx("div",{className:"text-dark-primary font-semibold",children:S.summary.processedProjectors})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(tt,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"text-lg font-semibold text-dark-primary",children:"Sites"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Be,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-dark-secondary",children:["Successfully uploaded: ",S.sites.success]})]}),S.sites.failed>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{className:"w-4 h-4 text-red-500"}),e.jsxs("span",{className:"text-dark-secondary",children:["Failed: ",S.sites.failed]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ss,{className:"w-5 h-5 text-green-500"}),e.jsx("h3",{className:"text-lg font-semibold text-dark-primary",children:"Projectors"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Be,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-dark-secondary",children:["Successfully uploaded: ",S.projectors.success]})]}),S.projectors.failed>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{className:"w-4 h-4 text-red-500"}),e.jsxs("span",{className:"text-dark-secondary",children:["Failed: ",S.projectors.failed]})]})]})]})]}),(S.sites.errors.length>0||S.projectors.errors.length>0)&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-dark-primary mb-3",children:"Error Details"}),e.jsxs("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:[S.sites.errors.map((F,J)=>e.jsx("div",{className:"text-red-400 text-sm",children:F},`site-${J}`)),S.projectors.errors.map((F,J)=>e.jsx("div",{className:"text-red-400 text-sm",children:F},`projector-${J}`))]})]})]})]})]})})}var wt="Checkbox",[Gi,Lc]=Kt(wt),[Yi,na]=Gi(wt);function Ji(s){const{__scopeCheckbox:t,checked:a,children:l,defaultChecked:i,disabled:o,form:h,name:c,onCheckedChange:j,required:P,value:v="on",internal_do_not_use_render:x}=s,[S,E]=At({prop:a,defaultProp:i??!1,onChange:j,caller:wt}),[V,_]=n.useState(null),[b,N]=n.useState(null),y=n.useRef(!1),A=V?!!h||!!V.closest("form"):!0,u={checked:S,disabled:o,setChecked:E,control:V,setControl:_,name:c,form:h,value:v,hasConsumerStoppedPropagationRef:y,required:P,defaultChecked:Is(i)?!1:i,isFormControl:A,bubbleInput:b,setBubbleInput:N};return e.jsx(Yi,{scope:t,...u,children:Zi(x)?x(u):l})}var Er="CheckboxTrigger",Tr=n.forwardRef(({__scopeCheckbox:s,onKeyDown:t,onClick:a,...l},i)=>{const{control:o,value:h,disabled:c,checked:j,required:P,setControl:v,setChecked:x,hasConsumerStoppedPropagationRef:S,isFormControl:E,bubbleInput:V}=na(Er,s),_=xs(i,v),b=n.useRef(j);return n.useEffect(()=>{const N=o==null?void 0:o.form;if(N){const y=()=>x(b.current);return N.addEventListener("reset",y),()=>N.removeEventListener("reset",y)}},[o,x]),e.jsx(qe.button,{type:"button",role:"checkbox","aria-checked":Is(j)?"mixed":j,"aria-required":P,"data-state":$r(j),"data-disabled":c?"":void 0,disabled:c,value:h,...l,ref:_,onKeyDown:Ze(t,N=>{N.key==="Enter"&&N.preventDefault()}),onClick:Ze(a,N=>{x(y=>Is(y)?!0:!y),V&&E&&(S.current=N.isPropagationStopped(),S.current||N.stopPropagation())})})});Tr.displayName=Er;var Mr=n.forwardRef((s,t)=>{const{__scopeCheckbox:a,name:l,checked:i,defaultChecked:o,required:h,disabled:c,value:j,onCheckedChange:P,form:v,...x}=s;return e.jsx(Ji,{__scopeCheckbox:a,checked:i,defaultChecked:o,disabled:c,required:h,onCheckedChange:P,name:l,form:v,value:j,internal_do_not_use_render:({isFormControl:S})=>e.jsxs(e.Fragment,{children:[e.jsx(Tr,{...x,ref:t,__scopeCheckbox:a}),S&&e.jsx(Or,{__scopeCheckbox:a})]})})});Mr.displayName=wt;var Ir="CheckboxIndicator",Fr=n.forwardRef((s,t)=>{const{__scopeCheckbox:a,forceMount:l,...i}=s,o=na(Ir,a);return e.jsx(fl,{present:l||Is(o.checked)||o.checked===!0,children:e.jsx(qe.span,{"data-state":$r(o.checked),"data-disabled":o.disabled?"":void 0,...i,ref:t,style:{pointerEvents:"none",...s.style}})})});Fr.displayName=Ir;var Lr="CheckboxBubbleInput",Or=n.forwardRef(({__scopeCheckbox:s,...t},a)=>{const{control:l,hasConsumerStoppedPropagationRef:i,checked:o,defaultChecked:h,required:c,disabled:j,name:P,value:v,form:x,bubbleInput:S,setBubbleInput:E}=na(Lr,s),V=xs(a,E),_=er(o),b=yl(l);n.useEffect(()=>{const y=S;if(!y)return;const A=window.HTMLInputElement.prototype,$=Object.getOwnPropertyDescriptor(A,"checked").set,z=!i.current;if(_!==o&&$){const re=new Event("click",{bubbles:z});y.indeterminate=Is(o),$.call(y,Is(o)?!1:o),y.dispatchEvent(re)}},[S,_,o,i]);const N=n.useRef(Is(o)?!1:o);return e.jsx(qe.input,{type:"checkbox","aria-hidden":!0,defaultChecked:h??N.current,required:c,disabled:j,name:P,value:v,form:x,...t,tabIndex:-1,ref:V,style:{...t.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Or.displayName=Lr;function Zi(s){return typeof s=="function"}function Is(s){return s==="indeterminate"}function $r(s){return Is(s)?"indeterminate":s?"checked":"unchecked"}function Ht({className:s,...t}){return e.jsx(Mr,{"data-slot":"checkbox",className:Le("peer border bg-input-background dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Fr,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(Ua,{className:"size-3.5"})})})}var ia="Progress",ca=100,[Xi,Oc]=Kt(ia),[Qi,ec]=Xi(ia),Vr=n.forwardRef((s,t)=>{const{__scopeProgress:a,value:l=null,max:i,getValueLabel:o=sc,...h}=s;(i||i===0)&&!Ma(i)&&console.error(tc(`${i}`,"Progress"));const c=Ma(i)?i:ca;l!==null&&!Ia(l,c)&&console.error(ac(`${l}`,"Progress"));const j=Ia(l,c)?l:null,P=bt(j)?o(j,c):void 0;return e.jsx(Qi,{scope:a,value:j,max:c,children:e.jsx(qe.div,{"aria-valuemax":c,"aria-valuemin":0,"aria-valuenow":bt(j)?j:void 0,"aria-valuetext":P,role:"progressbar","data-state":zr(j,c),"data-value":j??void 0,"data-max":c,...h,ref:t})})});Vr.displayName=ia;var Ur="ProgressIndicator",Br=n.forwardRef((s,t)=>{const{__scopeProgress:a,...l}=s,i=ec(Ur,a);return e.jsx(qe.div,{"data-state":zr(i.value,i.max),"data-value":i.value??void 0,"data-max":i.max,...l,ref:t})});Br.displayName=Ur;function sc(s,t){return`${Math.round(s/t*100)}%`}function zr(s,t){return s==null?"indeterminate":s===t?"complete":"loading"}function bt(s){return typeof s=="number"}function Ma(s){return bt(s)&&!isNaN(s)&&s>0}function Ia(s,t){return bt(s)&&!isNaN(s)&&s<=t&&s>=0}function tc(s,t){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${ca}\`.`}function ac(s,t){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${ca} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var rc=Vr,lc=Br;function _r({className:s,value:t,...a}){return e.jsx(rc,{"data-slot":"progress",className:Le("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",s),...a,children:e.jsx(lc,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})})}function Hr(s,t){if(t==null)return s;if(Array.isArray(s))return Array.isArray(t)&&t.length>0?t:s;if(typeof s=="object"){const a={...s};for(const l of Object.keys(t)){const i=t[l],o=s[l];i!==void 0&&(o&&typeof o=="object"&&!Array.isArray(o)&&i&&typeof i=="object"&&!Array.isArray(i)?a[l]=Hr(o,i):a[l]=i)}return a}return t??s}function Kr({onSubmit:s,initialData:t,onClose:a,readonly:l=!1}){var p,M;const[i,o]=n.useState(1);n.useState([]);const h={reportNumber:`ASCOMP-${Date.now()}`,reportTitle:"Projector Service Report",reportType:"First",date:new Date().toISOString().split("T")[0],companyName:"ASCOMP INC.",companyAddress:"9, Community Centre, 2nd Floor, Phase I, Mayapuri, New Delhi, 110064",companyContact:{desk:"011-45501226",mobile:"8882475207",email:"helpdesk@ascompinc.in",website:"WWW.ASCOMPINC.IN"},siteName:"Default Site",siteIncharge:{name:"Default In-charge",contact:"Default Contact"},projectorModel:"Default Model",projectorSerial:"Default Serial",brand:"Default Brand",softwareVersion:"",projectorRunningHours:"",lampModel:"",lampRunningHours:"",currentLampHours:"",replacementRequired:!1,engineer:{name:"",phone:"",email:""},sections:{opticals:[{description:"Reflector",status:"-",result:"OK"},{description:"UV filter",status:"-",result:"OK"},{description:"Integrator Rod",status:"-",result:"OK"},{description:"Cold Mirror",status:"-",result:"OK"},{description:"Fold Mirror",status:"-",result:"OK"}],electronics:[{description:"Touch Panel",status:"-",result:"OK"},{description:"EVB Board",status:"-",result:"OK"},{description:"IMCB Board/s",status:"-",result:"OK"},{description:"PIB Board",status:"-",result:"OK"},{description:"ICP Board",status:"-",result:"OK"},{description:"IMB/S Board",status:"-",result:"OK"}],serialNumberVerified:{description:"Chassis label vs Touch Panel",status:"-",result:"OK"},disposableConsumables:[{description:"Air Intake, LAD and RAD",status:"Replaced",result:"OK"}],coolant:{description:"Level and Color",status:"-",result:"OK"},lightEngineTestPatterns:[{color:"White",status:"-",result:"OK"},{color:"Red",status:"-",result:"OK"},{color:"Green",status:"-",result:"OK"},{color:"Blue",status:"-",result:"OK"},{color:"Black",status:"-",result:"OK"}],mechanical:[{description:"AC blower and Vane Switch",status:"-",result:"OK"},{description:"Extractor Vane Switch",status:"-",result:"OK"},{description:"Exhaust CFM",status:"7.5 M/S",result:"OK"},{description:"Light Engine 4 fans with LAD fan",status:"-",result:"OK"},{description:"Card Cage Top and Bottom fans",status:"-",result:"OK"},{description:"Radiator fan and Pump",status:"-",result:"OK"},{description:"Connector and hose for the Pump",status:"-",result:"OK"},{description:"Security and lamp house lock switch",status:"-",result:"OK"},{description:"Lamp LOC Mechanism X, Y and Z movement",status:"-",result:"OK"}]},imageEvaluation:{focusBoresight:"Yes",integratorPosition:"Yes",spotOnScreen:"No",screenCropping:"Yes",convergenceChecked:"Yes",channelsChecked:"Yes",pixelDefects:"No",imageVibration:"No",liteLoc:"No"},recommendedParts:[],measuredColorCoordinates:[{testPattern:"White 2K",fl:"",x:"",y:""},{testPattern:"White 4K",fl:"",x:"",y:""},{testPattern:"Red 2K",fl:"",x:"",y:""},{testPattern:"Red 4K",fl:"",x:"",y:""},{testPattern:"Green 2K",fl:"",x:"",y:""},{testPattern:"Green 4K",fl:"",x:"",y:""},{testPattern:"Blue 2K",fl:"",x:"",y:""},{testPattern:"Blue 4K",fl:"",x:"",y:""}],cieColorAccuracy:[{testPattern:"BW Step-10 2K",fl:"",x:"",y:""},{testPattern:"BW Step-10 4K",fl:"",x:"",y:""}],screenInfo:{scope:{height:"",width:"",gain:""},flat:{height:"",width:"",gain:""},screenMake:"",throwDistance:""},voltageParameters:{pVsN:"",pVsE:"",nVsE:""},contentPlayingServer:"",lampPowerMeasurements:{flBeforePM:"",flAfterPM:""},environmentStatus:{projectorPlacement:"ok",room:"ok",environment:"ok"},observations:[{number:1,description:""},{number:2,description:""},{number:3,description:""},{number:4,description:""},{number:5,description:""},{number:6,description:""}],airPollutionLevel:{hcho:"",tvoc:"",pm1:"",pm25:"",pm10:"",overall:""},environmentalConditions:{temperature:"",humidity:""},systemStatus:{leStatus:"",acStatus:""},photos:[],notes:""},[c,j]=n.useState(()=>Hr(h,t)),[P,v]=n.useState(!1),[x,S]=n.useState(!1),[E,V]=n.useState(null),[_,b]=n.useState(!1),[N,y]=n.useState([]),[A,u]=n.useState(!1),$=12;n.useEffect(()=>{re()},[]);const z=(m,d)=>{if(m.includes(".")){const[X,ee]=m.split(".");j(B=>({...B,[X]:{...B[X]||{},[ee]:d}}))}else j(X=>({...X,[m]:d}))},re=async()=>{try{u(!0);const d=(await ie.getAllSpareParts()).filter(X=>X.category!=="RMA");y(d)}catch(m){console.error("Error loading spare parts:",m)}finally{u(!1)}},K=m=>m?N.filter(d=>d.projectorModel===m):N,ne=m=>{const d=[...c.recommendedParts,{partName:m.partName,partNumber:m.partNumber,quantity:1,notes:""}];j(X=>({...X,recommendedParts:d}))},Y=(m,d,X,ee)=>{const B={...c.sections};Array.isArray(B[m])?B[m][d]={...B[m][d],[X]:ee}:B[m]={...B[m],[X]:ee},j(ce=>({...ce,sections:B}))},O=(m,d,X,ee)=>{const ce=[...[...c[m]]];ce[d]={...ce[d],[X]:ee},j(me=>({...me,[m]:ce}))},R=()=>{i<$&&o(i+1)},F=()=>{i>1&&o(i-1)},J=()=>{var m,d;v(!0);try{s(c),S(!0),V(c),b(!0),(m=window.showToast)==null||m.call(window,{type:"success",title:"Report Submitted Successfully!",message:"Your service report has been completed and saved."})}catch(X){console.error("Error submitting report:",X),(d=window.showToast)==null||d.call(window,{type:"error",title:"Submission Failed",message:"There was an error submitting your report. Please try again."})}finally{v(!1)}},T=()=>{var m;E&&(lt(E),b(!1),(m=window.showToast)==null||m.call(window,{type:"success",title:"Report Downloaded",message:"Your service report has been downloaded as PDF."}))},w=m=>({1:"Report Header",2:"Site & Projector Info",3:"Opticals & Electronics",4:"Mechanical & Consumables",5:"Image Evaluation",6:"Color Measurements",7:"Screen & Voltage",8:"Environment & System",9:"Observations & Air Quality",10:"Photos & Documentation",11:"Review & Submit"})[m]||`Step ${m}`,g=()=>{j(m=>({...m,sections:{opticals:[{description:"Reflector",status:"-",result:"OK"},{description:"UV filter",status:"-",result:"OK"},{description:"Integrator Rod",status:"-",result:"OK"},{description:"Cold Mirror",status:"-",result:"OK"},{description:"Fold Mirror",status:"-",result:"OK"}],electronics:[{description:"Touch Panel",status:"-",result:"OK"},{description:"EVB Board",status:"-",result:"OK"},{description:"IMCB Board/s",status:"-",result:"OK"},{description:"PIB Board",status:"-",result:"OK"},{description:"ICP Board",status:"-",result:"OK"},{description:"IMB/S Board",status:"-",result:"OK"}],mechanical:[{description:"AC blower and Vane Switch",status:"-",result:"OK"},{description:"Extractor Vane Switch",status:"-",result:"OK"},{description:"Exhaust CFM",status:"7.5 M/S",result:"OK"},{description:"Light Engine 4 fans with LAD fan",status:"-",result:"OK"},{description:"Card Cage Top and Bottom fans",status:"-",result:"OK"},{description:"Radiator fan and Pump",status:"-",result:"OK"},{description:"Connector and hose for the Pump",status:"-",result:"OK"},{description:"Security and lamp house lock switch",status:"-",result:"OK"},{description:"Lamp LOC Mechanism X, Y and Z movement",status:"-",result:"OK"}],disposableConsumables:[{description:"Air Intake, LAD and RAD",status:"Replaced",result:"OK"}],coolant:{description:"Level and Color",status:"-",result:"OK"},lightEngineTestPatterns:[{color:"White",status:"-",result:"OK"},{color:"Red",status:"-",result:"OK"},{color:"Green",status:"-",result:"OK"},{color:"Blue",status:"-",result:"OK"},{color:"Black",status:"-",result:"OK"}],serialNumberVerified:{description:"Chassis label vs Touch Panel",status:"-",result:"OK"}}}))};return e.jsxs("div",{className:"min-h-screen bg-gray-50 py-8",children:[e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs("svg",{width:"200",height:"60",viewBox:"0 0 200 60",xmlns:"http://www.w3.org/2000/svg",className:"w-48 h-14",children:[e.jsx("defs",{children:e.jsx("filter",{id:"shadow",x:"-20%",y:"-20%",width:"140%",height:"140%",children:e.jsx("feDropShadow",{dx:"2",dy:"2",stdDeviation:"2","flood-color":"rgba(0,0,0,0.3)"})})}),e.jsx("text",{x:"100",y:"40","font-family":"Arial, sans-serif","font-size":"24","font-weight":"bold","font-style":"italic","text-anchor":"middle",fill:"black",filter:"url(#shadow)",children:"CHRISTIE"}),e.jsxs("g",{transform:"translate(155, 15)",children:[e.jsx("path",{d:"M 0 0 L 8 0 L 6 8 L 2 8 Z",fill:"black"}),e.jsx("path",{d:"M 0 20 L 8 20 L 6 12 L 2 12 Z",fill:"black"}),e.jsx("rect",{x:"2",y:"8",width:"4",height:"4",fill:"white"})]}),e.jsx("circle",{cx:"185",cy:"8",r:"6",fill:"black"}),e.jsx("text",{x:"185",y:"12","font-family":"Arial, sans-serif","font-size":"8","text-anchor":"middle",fill:"white","font-weight":"bold",children:"®"})]})}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ASCOMP Service Report"}),e.jsx("p",{className:"text-gray-600",children:"Professional Projector Service Report Form"})]}),a&&e.jsx(q,{variant:"outline",onClick:a,children:e.jsx(Ke,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 mb-2",children:[e.jsxs("span",{children:["Step ",i," of ",$]}),e.jsx("span",{children:w(i)})]}),e.jsx(_r,{value:i/$*100,className:"h-2"})]})]}),e.jsxs("div",{className:"space-y-6",children:[i===1&&e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5"}),"Report Header Information"]})}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"reportNumber",children:"Report Number"}),e.jsx(k,{id:"reportNumber",value:c.reportNumber,onChange:m=>z("reportNumber",m.target.value),placeholder:"Auto-generated"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"reportType",children:"Report Type"}),e.jsxs(ye,{value:c.reportType,onValueChange:m=>z("reportType",m),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"First",children:"First"}),e.jsx(I,{value:"Second",children:"Second"}),e.jsx(I,{value:"Third",children:"Third"}),e.jsx(I,{value:"Fourth",children:"Fourth"}),e.jsx(I,{value:"Emergency",children:"Emergency"}),e.jsx(I,{value:"Installation",children:"Installation"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"date",children:"Report Date"}),e.jsx(k,{id:"date",type:"date",value:c.date,onChange:m=>z("date",m.target.value)})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Company Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Company:"}),e.jsx("p",{className:"text-gray-900",children:c.companyName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Address:"}),e.jsx("p",{className:"text-gray-900",children:c.companyAddress})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Desk:"}),e.jsx("p",{className:"text-gray-900",children:((p=c.companyContact)==null?void 0:p.desk)||""})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Mobile:"}),e.jsx("p",{className:"text-gray-900",children:((M=c.companyContact)==null?void 0:M.mobile)||""})]})]})]})]})]}),i===2&&e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(As,{className:"h-5 w-5"}),"Site & Projector Information"]})}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"siteName",children:"Site Name"}),e.jsx(k,{id:"siteName",value:c.siteName,onChange:m=>z("siteName",m.target.value),placeholder:"e.g., PVR INOX Cinema City Mall Yamuna Nagar - Auditorium 1"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"siteInchargeName",children:"Site In-charge Name"}),e.jsx(k,{id:"siteInchargeName",value:c.siteIncharge.name,onChange:m=>z("siteIncharge.name",m.target.value),placeholder:"e.g., Mr. Sanjeev Kumar"})]})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"siteInchargeContact",children:"Site In-charge Contact"}),e.jsx(k,{id:"siteInchargeContact",value:c.siteIncharge.contact,onChange:m=>z("siteIncharge.contact",m.target.value),placeholder:"e.g., 8398986112"})]}),e.jsx(Ge,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"projectorModel",children:"Projector Model"}),e.jsx(k,{id:"projectorModel",value:c.projectorModel,onChange:m=>z("projectorModel",m.target.value),placeholder:"e.g., CP2220"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"projectorSerial",children:"Serial Number"}),e.jsx(k,{id:"projectorSerial",value:c.projectorSerial,onChange:m=>z("projectorSerial",m.target.value),placeholder:"e.g., 265533001"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"brand",children:"Brand"}),e.jsx(k,{id:"brand",value:c.brand,onChange:m=>z("brand",m.target.value),placeholder:"e.g., Christie"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"softwareVersion",children:"Software Version"}),e.jsx(k,{id:"softwareVersion",value:c.softwareVersion,onChange:m=>z("softwareVersion",m.target.value),placeholder:"e.g., 4.3.1"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"projectorRunningHours",children:"Projector Running Hours"}),e.jsx(k,{id:"projectorRunningHours",value:c.projectorRunningHours,onChange:m=>z("projectorRunningHours",m.target.value),placeholder:"e.g., 71027"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"lampModel",children:"Lamp Model"}),e.jsx(k,{id:"lampModel",value:c.lampModel,onChange:m=>z("lampModel",m.target.value),placeholder:"e.g., OSRAM - 3KW DTS"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"lampRunningHours",children:"Lamp Running Hours"}),e.jsx(k,{id:"lampRunningHours",value:c.lampRunningHours,onChange:m=>z("lampRunningHours",m.target.value),placeholder:"e.g., 57629"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"currentLampHours",children:"Current Lamp Hours"}),e.jsx(k,{id:"currentLampHours",value:c.currentLampHours,onChange:m=>z("currentLampHours",m.target.value),placeholder:"e.g., 322"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ht,{id:"replacementRequired",checked:c.replacementRequired,onCheckedChange:m=>z("replacementRequired",m)}),e.jsx(le,{htmlFor:"replacementRequired",children:"Lamp Replacement Required"})]}),e.jsx(Ge,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"engineerName",children:"Engineer Name"}),e.jsx(k,{id:"engineerName",value:c.engineer.name,onChange:m=>z("engineer.name",m.target.value),placeholder:"e.g., Pramod Kumar"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"engineerPhone",children:"Engineer Phone"}),e.jsx(k,{id:"engineerPhone",value:c.engineer.phone,onChange:m=>z("engineer.phone",m.target.value),placeholder:"Engineer contact number"})]})]})]})]}),i===3&&e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(es,{className:"h-5 w-5"}),"Opticals & Electronics Checklist"]})}),e.jsxs(se,{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(q,{variant:"outline",onClick:g,children:"Load standard checklist items"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"OPTICALS Section"}),e.jsx("div",{className:"space-y-3",children:c.sections.opticals.map((m,d)=>e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center",children:[e.jsx("div",{children:e.jsx(le,{className:"text-sm font-medium text-gray-700",children:m.description})}),e.jsx("div",{children:e.jsx(k,{value:m.status,onChange:X=>Y("opticals",d,"status",X.target.value),placeholder:"Status",className:"text-center"})}),e.jsx("div",{children:e.jsxs(ye,{value:m.result,onValueChange:X=>Y("opticals",d,"result",X),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"OK",children:"OK"}),e.jsx(I,{value:"Not OK",children:"Not OK"}),e.jsx(I,{value:"Replaced",children:"Replaced"})]})]})})]},d))})]}),e.jsx(Ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"ELECTRONICS Section"}),e.jsx("div",{className:"space-y-3",children:c.sections.electronics.map((m,d)=>e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center",children:[e.jsx("div",{children:e.jsx(le,{className:"text-sm font-medium text-gray-700",children:m.description})}),e.jsx("div",{children:e.jsx(k,{value:m.status,onChange:X=>Y("electronics",d,"status",X.target.value),placeholder:"Status",className:"text-center"})}),e.jsx("div",{children:e.jsxs(ye,{value:m.result,onValueChange:X=>Y("electronics",d,"result",X),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"OK",children:"OK"}),e.jsx(I,{value:"Not OK",children:"Not OK"}),e.jsx(I,{value:"Replaced",children:"Replaced"})]})]})})]},d))})]}),e.jsx(Ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Serial Number Verification"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center",children:[e.jsx("div",{children:e.jsx(le,{className:"text-sm font-medium text-gray-700",children:c.sections.serialNumberVerified.description})}),e.jsx("div",{children:e.jsx(k,{value:c.sections.serialNumberVerified.status,onChange:m=>z("sections.serialNumberVerified.status",m.target.value),placeholder:"Status",className:"text-center"})}),e.jsx("div",{children:e.jsxs(ye,{value:c.sections.serialNumberVerified.result,onValueChange:m=>z("sections.serialNumberVerified.result",m),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"OK",children:"OK"}),e.jsx(I,{value:"Not OK",children:"Not OK"})]})]})})]})]})]})]}),i===4&&e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"h-5 w-5"}),"Mechanical & Consumables Checklist"]})}),e.jsxs(se,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"MECHANICAL Section"}),e.jsx("div",{className:"space-y-3",children:c.sections.mechanical.map((m,d)=>e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center",children:[e.jsx("div",{children:e.jsx(le,{className:"text-sm font-medium text-gray-700",children:m.description})}),e.jsx("div",{children:e.jsx(k,{value:m.status,onChange:X=>Y("mechanical",d,"status",X.target.value),placeholder:"Status",className:"text-center"})}),e.jsx("div",{children:e.jsxs(ye,{value:m.result,onValueChange:X=>Y("mechanical",d,"result",X),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"OK",children:"OK"}),e.jsx(I,{value:"Not OK",children:"Not OK"}),e.jsx(I,{value:"Replaced",children:"Replaced"})]})]})})]},d))})]}),e.jsx(Ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Disposable Consumables"}),e.jsx("div",{className:"space-y-3",children:c.sections.disposableConsumables.map((m,d)=>e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center",children:[e.jsx("div",{children:e.jsx(le,{className:"text-sm font-medium text-gray-700",children:m.description})}),e.jsx("div",{children:e.jsx(k,{value:m.status,onChange:X=>Y("disposableConsumables",d,"status",X.target.value),placeholder:"Status",className:"text-center"})}),e.jsx("div",{children:e.jsxs(ye,{value:m.result,onValueChange:X=>Y("disposableConsumables",d,"result",X),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"OK",children:"OK"}),e.jsx(I,{value:"Not OK",children:"Not OK"}),e.jsx(I,{value:"Replaced",children:"Replaced"})]})]})})]},d))})]}),e.jsx(Ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Coolant"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center",children:[e.jsx("div",{children:e.jsx(le,{className:"text-sm font-medium text-gray-700",children:c.sections.coolant.description})}),e.jsx("div",{children:e.jsx(k,{value:c.sections.coolant.status,onChange:m=>z("sections.coolant.status",m.target.value),placeholder:"Status",className:"text-center"})}),e.jsx("div",{children:e.jsxs(ye,{value:c.sections.coolant.result,onValueChange:m=>z("sections.coolant.result",m),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"OK",children:"OK"}),e.jsx(I,{value:"Not OK",children:"Not OK"}),e.jsx(I,{value:"Replaced",children:"Replaced"})]})]})})]})]}),e.jsx(Ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Light Engine Test Patterns"}),e.jsx("div",{className:"space-y-3",children:c.sections.lightEngineTestPatterns.map((m,d)=>e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center",children:[e.jsx("div",{children:e.jsx(le,{className:"text-sm font-medium text-gray-700",children:m.color})}),e.jsx("div",{children:e.jsx(k,{value:m.status,onChange:X=>Y("lightEngineTestPatterns",d,"status",X.target.value),placeholder:"Status",className:"text-center"})}),e.jsx("div",{children:e.jsxs(ye,{value:m.result,onValueChange:X=>Y("lightEngineTestPatterns",d,"result",X),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"OK",children:"OK"}),e.jsx(I,{value:"Not OK",children:"Not OK"})]})]})})]},d))})]})]})]}),i===5&&e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(Lt,{className:"h-5 w-5"}),"Image Evaluation"]})}),e.jsx(se,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"focusBoresight",children:"Focus/boresight"}),e.jsxs(ye,{value:c.imageEvaluation.focusBoresight,onValueChange:m=>z("imageEvaluation.focusBoresight",m),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Yes",children:"Yes"}),e.jsx(I,{value:"No",children:"No"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"integratorPosition",children:"Integrator Position"}),e.jsxs(ye,{value:c.imageEvaluation.integratorPosition,onValueChange:m=>z("imageEvaluation.integratorPosition",m),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Yes",children:"Yes"}),e.jsx(I,{value:"No",children:"No"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"spotOnScreen",children:"Any Spot on the Screen after PPM"}),e.jsxs(ye,{value:c.imageEvaluation.spotOnScreen,onValueChange:m=>z("imageEvaluation.spotOnScreen",m),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Yes",children:"Yes"}),e.jsx(I,{value:"No",children:"No"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"screenCropping",children:"Check Screen Cropping - FLAT and SCOPE"}),e.jsxs(ye,{value:c.imageEvaluation.screenCropping,onValueChange:m=>z("imageEvaluation.screenCropping",m),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Yes",children:"Yes"}),e.jsx(I,{value:"No",children:"No"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"convergenceChecked",children:"Convergence Checked"}),e.jsxs(ye,{value:c.imageEvaluation.convergenceChecked,onValueChange:m=>z("imageEvaluation.convergenceChecked",m),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Yes",children:"Yes"}),e.jsx(I,{value:"No",children:"No"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"channelsChecked",children:"Channels Checked - Scope, Flat, Alternative"}),e.jsxs(ye,{value:c.imageEvaluation.channelsChecked,onValueChange:m=>z("imageEvaluation.channelsChecked",m),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Yes",children:"Yes"}),e.jsx(I,{value:"No",children:"No"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"pixelDefects",children:"Pixel defects"}),e.jsxs(ye,{value:c.imageEvaluation.pixelDefects,onValueChange:m=>z("imageEvaluation.pixelDefects",m),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Yes",children:"Yes"}),e.jsx(I,{value:"No",children:"No"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"imageVibration",children:"Excessive image vibration"}),e.jsxs(ye,{value:c.imageEvaluation.imageVibration,onValueChange:m=>z("imageEvaluation.imageVibration",m),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Yes",children:"Yes"}),e.jsx(I,{value:"No",children:"No"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"liteLoc",children:"LiteLOC"}),e.jsxs(ye,{value:c.imageEvaluation.liteLoc,onValueChange:m=>z("imageEvaluation.liteLoc",m),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Yes",children:"Yes"}),e.jsx(I,{value:"No",children:"No"})]})]})]})]})]})})]}),i===6&&e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(Hl,{className:"h-5 w-5"}),"Color Measurements"]})}),e.jsxs(se,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Measured Color Coordinates (MCGD)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left",children:"Test Pattern"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2 text-center",children:"fL"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2 text-center",children:"x"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2 text-center",children:"y"})]})}),e.jsx("tbody",{children:c.measuredColorCoordinates.map((m,d)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-3 py-2 font-medium",children:m.testPattern}),e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:e.jsx(k,{value:m.fl,onChange:X=>O("measuredColorCoordinates",d,"fl",X.target.value),placeholder:"fL",className:"text-center border-0"})}),e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:e.jsx(k,{value:m.x,onChange:X=>O("measuredColorCoordinates",d,"x",X.target.value),placeholder:"x",className:"text-center border-0"})}),e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:e.jsx(k,{value:m.y,onChange:X=>O("measuredColorCoordinates",d,"y",X.target.value),placeholder:"y",className:"text-center border-0"})})]},d))})]})})]}),e.jsx(Ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"CIE XYZ Color Accuracy"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left",children:"Test Pattern"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2 text-center",children:"x"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2 text-center",children:"y"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2 text-center",children:"fL"})]})}),e.jsx("tbody",{children:c.cieColorAccuracy.map((m,d)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-3 py-2 font-medium",children:m.testPattern}),e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:e.jsx(k,{value:m.x,onChange:X=>O("cieColorAccuracy",d,"x",X.target.value),placeholder:"x",className:"text-center border-0"})}),e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:e.jsx(k,{value:m.y,onChange:X=>O("cieColorAccuracy",d,"y",X.target.value),placeholder:"y",className:"text-center border-0"})}),e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:e.jsx(k,{value:m.fl,onChange:X=>O("cieColorAccuracy",d,"fl",X.target.value),placeholder:"fL",className:"text-center border-0"})})]},d))})]})})]})]})]}),i===7&&e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(ql,{className:"h-5 w-5"}),"Screen Information & Voltage Parameters"]})}),e.jsxs(se,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Screen Information in metres"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-3",children:"SCOPE"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"scopeHeight",children:"Height"}),e.jsx(k,{id:"scopeHeight",value:c.screenInfo.scope.height,onChange:m=>z("screenInfo.scope.height",m.target.value),placeholder:"e.g., 5.53"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"scopeWidth",children:"Width"}),e.jsx(k,{id:"scopeWidth",value:c.screenInfo.scope.width,onChange:m=>z("screenInfo.scope.width",m.target.value),placeholder:"e.g., 13.21"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"scopeGain",children:"Gain"}),e.jsx(k,{id:"scopeGain",value:c.screenInfo.scope.gain,onChange:m=>z("screenInfo.scope.gain",m.target.value),placeholder:"Gain value"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-3",children:"FLAT"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"flatHeight",children:"Height"}),e.jsx(k,{id:"flatHeight",value:c.screenInfo.flat.height,onChange:m=>z("screenInfo.flat.height",m.target.value),placeholder:"Height value"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"flatWidth",children:"Width"}),e.jsx(k,{id:"flatWidth",value:c.screenInfo.flat.width,onChange:m=>z("screenInfo.flat.width",m.target.value),placeholder:"Width value"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"flatGain",children:"Gain"}),e.jsx(k,{id:"flatGain",value:c.screenInfo.flat.gain,onChange:m=>z("screenInfo.flat.gain",m.target.value),placeholder:"Gain value"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"screenMake",children:"Screen Make"}),e.jsx(k,{id:"screenMake",value:c.screenInfo.screenMake,onChange:m=>z("screenInfo.screenMake",m.target.value),placeholder:"Screen manufacturer"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"throwDistance",children:"Throw Distance"}),e.jsx(k,{id:"throwDistance",value:c.screenInfo.throwDistance,onChange:m=>z("screenInfo.throwDistance",m.target.value),placeholder:"e.g., 19.9"})]})]})]}),e.jsx(Ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Voltage Parameters"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"pVsN",children:"P vs N"}),e.jsx(k,{id:"pVsN",value:c.voltageParameters.pVsN,onChange:m=>z("voltageParameters.pVsN",m.target.value),placeholder:"e.g., 228"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"pVsE",children:"P vs E"}),e.jsx(k,{id:"pVsE",value:c.voltageParameters.pVsE,onChange:m=>z("voltageParameters.pVsE",m.target.value),placeholder:"e.g., 230"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"nVsE",children:"N vs E"}),e.jsx(k,{id:"nVsE",value:c.voltageParameters.nVsE,onChange:m=>z("voltageParameters.nVsE",m.target.value),placeholder:"e.g., 2"})]})]})]}),e.jsx(Ge,{}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"contentPlayingServer",children:"Content Playing Server"}),e.jsx(k,{id:"contentPlayingServer",value:c.contentPlayingServer,onChange:m=>z("contentPlayingServer",m.target.value),placeholder:"e.g., Dolby IMS3000"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Lamp Power Measurements"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"flBeforePM",children:"fL on 100% lamp power before PM"}),e.jsx(k,{id:"flBeforePM",value:c.lampPowerMeasurements.flBeforePM,onChange:m=>z("lampPowerMeasurements.flBeforePM",m.target.value),placeholder:"e.g., 10.3"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"flAfterPM",children:"fL on 100% lamp power after PM"}),e.jsx(k,{id:"flAfterPM",value:c.lampPowerMeasurements.flAfterPM,onChange:m=>z("lampPowerMeasurements.flAfterPM",m.target.value),placeholder:"e.g., 13.4"})]})]})]})]})]}),i===8&&e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(Jl,{className:"h-5 w-5"}),"Environment & System Status"]})}),e.jsxs(se,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Environment Status"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"projectorPlacement",children:"Projector placement"}),e.jsxs(ye,{value:c.environmentStatus.projectorPlacement,onValueChange:m=>z("environmentStatus.projectorPlacement",m),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"ok",children:"OK"}),e.jsx(I,{value:"not ok",children:"Not OK"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"room",children:"Room"}),e.jsxs(ye,{value:c.environmentStatus.room,onValueChange:m=>z("environmentStatus.room",m),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"ok",children:"OK"}),e.jsx(I,{value:"not ok",children:"Not OK"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"environment",children:"Environment"}),e.jsxs(ye,{value:c.environmentStatus.environment,onValueChange:m=>z("environmentStatus.environment",m),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"ok",children:"OK"}),e.jsx(I,{value:"not ok",children:"Not OK"})]})]})]})]})]}),e.jsx(Ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"System Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"leStatus",children:"LE Status During PM"}),e.jsx(k,{id:"leStatus",value:c.systemStatus.leStatus,onChange:m=>z("systemStatus.leStatus",m.target.value),placeholder:"e.g., Removed"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"acStatus",children:"AC Status"}),e.jsx(k,{id:"acStatus",value:c.systemStatus.acStatus,onChange:m=>z("systemStatus.acStatus",m.target.value),placeholder:"e.g., Working"})]})]})]}),e.jsx(Ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Environmental Conditions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"temperature",children:"Temperature"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{id:"temperature",value:c.environmentalConditions.temperature,onChange:m=>z("environmentalConditions.temperature",m.target.value),placeholder:"e.g., 25"}),e.jsx("span",{className:"text-gray-500",children:"°C"})]})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"humidity",children:"Humidity"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{id:"humidity",value:c.environmentalConditions.humidity,onChange:m=>z("environmentalConditions.humidity",m.target.value),placeholder:"e.g., 32"}),e.jsx("span",{className:"text-gray-500",children:"%"})]})]})]})]})]})]}),i===9&&e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx($a,{className:"h-5 w-5"}),"Observations & Air Quality"]})}),e.jsxs(se,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Observations and Remarks"}),e.jsx("div",{className:"space-y-3",children:c.observations.map((m,d)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm font-medium text-gray-600",children:m.number}),e.jsx("div",{className:"flex-1",children:e.jsx(os,{value:m.description,onChange:X=>{const ee=[...c.observations];ee[d].description=X.target.value,j(B=>({...B,observations:ee}))},placeholder:"Enter observation details...",className:"min-h-[60px]"})})]},d))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Spare Parts Recommendations"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Select from available spare parts for ",c.projectorModel||"the selected projector",". These recommendations will be visible in the Service Recommendations panel and included in the PDF export"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ye,{onValueChange:m=>{const d=N.find(X=>X._id===m);d&&ne(d)},children:[e.jsx(ke,{className:"w-48",children:e.jsx(Ne,{placeholder:"Select spare part"})}),e.jsx(we,{children:A?e.jsxs(I,{value:"loading",disabled:!0,children:[e.jsx(Ie,{className:"h-4 w-4 animate-spin mr-2"}),"Loading..."]}):K(c.projectorModel).length===0?e.jsx(I,{value:"none",disabled:!0,children:c.projectorModel?`No parts for ${c.projectorModel}`:"No spare parts available"}):K(c.projectorModel).map(m=>e.jsxs(I,{value:m._id,children:[m.partName," (",m.partNumber,")"]},m._id))})]}),e.jsxs(q,{type:"button",variant:"outline",size:"sm",onClick:()=>{const m=[...c.recommendedParts,{partName:"",partNumber:"",quantity:1,notes:""}];j(d=>({...d,recommendedParts:m}))},className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-4 w-4"}),"Add Custom"]})]})]}),c.recommendedParts.length===0?e.jsxs("div",{className:"text-center py-6 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx(Je,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No spare parts recommended yet"}),e.jsx("p",{className:"text-gray-400 text-xs",children:'Click "Add Part" to add recommendations'})]}):e.jsx("div",{className:"space-y-3",children:c.recommendedParts.map((m,d)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:`partName-${d}`,children:"Part Name *"}),e.jsx(k,{id:`partName-${d}`,value:m.partName,onChange:X=>{const ee=[...c.recommendedParts];ee[d].partName=X.target.value,j(B=>({...B,recommendedParts:ee}))},placeholder:"e.g., Lamp Module, Filter, Lens",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:`partNumber-${d}`,children:"Part Number"}),e.jsx(k,{id:`partNumber-${d}`,value:m.partNumber,onChange:X=>{const ee=[...c.recommendedParts];ee[d].partNumber=X.target.value,j(B=>({...B,recommendedParts:ee}))},placeholder:"e.g., LMP-001, FLT-002",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:`quantity-${d}`,children:"Quantity"}),e.jsx(k,{id:`quantity-${d}`,type:"number",min:"1",value:m.quantity||1,onChange:X=>{const ee=[...c.recommendedParts];ee[d].quantity=parseInt(X.target.value)||1,j(B=>({...B,recommendedParts:ee}))},className:"w-full"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:`notes-${d}`,children:"Notes"}),e.jsx(k,{id:`partNotes-${d}`,value:m.notes||"",onChange:X=>{const ee=[...c.recommendedParts];ee[d].notes=X.target.value,j(B=>({...B,recommendedParts:ee}))},placeholder:"e.g., Urgent, Optional, Next service",className:"w-full"})]})]}),e.jsx("div",{className:"flex justify-end mt-3",children:e.jsxs(q,{type:"button",variant:"outline",size:"sm",onClick:()=>{const X=c.recommendedParts.filter((ee,B)=>B!==d);j(ee=>({...ee,recommendedParts:X}))},className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(Vs,{className:"h-4 w-4 mr-1"}),"Remove"]})})]},d))})]}),e.jsx(Ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Air Pollution Level"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"hcho",children:"HCHO"}),e.jsx(k,{id:"hcho",value:c.airPollutionLevel.hcho,onChange:m=>z("airPollutionLevel.hcho",m.target.value),placeholder:"e.g., 0.108"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"tvoc",children:"TVOC"}),e.jsx(k,{id:"tvoc",value:c.airPollutionLevel.tvoc,onChange:m=>z("airPollutionLevel.tvoc",m.target.value),placeholder:"e.g., 0.456"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"pm1",children:"PM 1.0"}),e.jsx(k,{id:"pm1",value:c.airPollutionLevel.pm1,onChange:m=>z("airPollutionLevel.pm1",m.target.value),placeholder:"e.g., 9"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"pm25",children:"PM 2.5"}),e.jsx(k,{id:"pm25",value:c.airPollutionLevel.pm25,onChange:m=>z("airPollutionLevel.pm25",m.target.value),placeholder:"e.g., 12"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"pm10",children:"PM 10"}),e.jsx(k,{id:"pm10",value:c.airPollutionLevel.pm10,onChange:m=>z("airPollutionLevel.pm10",m.target.value),placeholder:"e.g., 13"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"overall",children:"Overall Air Pollution Level"}),e.jsx(k,{id:"overall",value:c.airPollutionLevel.overall,onChange:m=>z("airPollutionLevel.overall",m.target.value),placeholder:"e.g., 30"})]})]})]})]})]}),i===10&&e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(Et,{className:"h-5 w-5"}),"Photos & Documentation"]})}),e.jsxs(se,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Photo Documentation"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(Et,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:[e.jsx("p",{className:"font-medium",children:"Upload Photos"}),e.jsx("p",{children:"Drag and drop photos here, or click to browse"})]}),e.jsxs(q,{variant:"outline",children:[e.jsx(Ns,{className:"h-4 w-4 mr-2"}),"Choose Files"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Note: The ODD file number is BEFORE and EVEN file number is AFTER, PM"})]})]}),e.jsx(Ge,{}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"reviewPhotos",children:"Review Photos"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{id:"reviewPhotos",value:"Click Here",readOnly:!0,className:"bg-blue-50 text-blue-600 cursor-pointer hover:bg-blue-100"}),e.jsxs(q,{variant:"outline",size:"sm",children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),"View"]})]})]}),e.jsx(Ge,{}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"notes",children:"Additional Notes"}),e.jsx(os,{id:"notes",value:c.notes,onChange:m=>z("notes",m.target.value),placeholder:"Enter any additional notes or comments...",className:"min-h-[100px]"})]})]})]}),i===11&&e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5"}),"Review & Submit Report"]})}),e.jsxs(se,{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Report Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Report Number:"}),e.jsx("p",{className:"text-gray-900",children:c.reportNumber})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Report Type:"}),e.jsx("p",{className:"text-gray-900",children:c.reportType})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Site:"}),e.jsx("p",{className:"text-gray-900",children:c.siteName||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Projector:"}),e.jsxs("p",{className:"text-gray-900",children:[c.projectorModel," - ",c.projectorSerial]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Engineer:"}),e.jsx("p",{className:"text-gray-900",children:c.engineer.name||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Date:"}),e.jsx("p",{className:"text-gray-900",children:c.date})]})]})]}),e.jsx(Ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Checklist Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Opticals"}),e.jsx("div",{className:"space-y-1 text-sm",children:c.sections.opticals.map((m,d)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:`h-4 w-4 ${m.result==="OK"?"text-green-500":"text-red-500"}`}),e.jsxs("span",{children:[m.description,": ",m.result]})]},d))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Electronics"}),e.jsx("div",{className:"space-y-1 text-sm",children:c.sections.electronics.map((m,d)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:`h-4 w-4 ${m.result==="OK"?"text-green-500":"text-red-500"}`}),e.jsxs("span",{children:[m.description,": ",m.result]})]},d))})]})]})]}),e.jsx(Ge,{}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Te,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"Ready to Submit"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Please review all information above. Once submitted, this report will be saved and cannot be edited."})]})]})})]})]}),i===12&&e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(Na,{className:"h-5 w-5"}),"Submit Service Report"]})}),e.jsx(se,{className:"space-y-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Be,{className:"mx-auto h-16 w-16 text-green-500 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Report Ready for Submission"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Your ASCOMP Service Report has been completed and is ready to be submitted."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(q,{onClick:J,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(Na,{className:"h-4 w-4 mr-2"}),"Submit Report"]}),e.jsxs(q,{variant:"outline",onClick:()=>o(11),children:[e.jsx(ua,{className:"h-4 w-4 mr-2"}),"Review Again"]})]})]})})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t p-4",children:e.jsxs("div",{className:"flex justify-between items-center max-w-4xl mx-auto",children:[e.jsxs(q,{variant:"outline",onClick:F,disabled:i===1,className:"flex-1 mr-2",children:[e.jsx(ua,{className:"h-4 w-4 mr-2"}),"Previous"]}),i<$?e.jsxs(q,{onClick:R,className:"flex-1 ml-2",children:["Next",e.jsx(El,{className:"h-4 w-4 ml-2"})]}):e.jsxs(q,{onClick:J,className:"flex-1 ml-2",children:["Submit Report",e.jsx(Be,{className:"h-4 w-4 ml-2"})]})]})})]}),_&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-8 max-w-md w-full mx-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Be,{className:"mx-auto h-16 w-16 text-green-500 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Report Completed Successfully!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Your ASCOMP Service Report has been submitted and saved. You can now download a PDF copy of the report."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(q,{onClick:T,className:"bg-blue-600 hover:bg-blue-700",disabled:P,children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"Download PDF Report"]}),e.jsx(q,{variant:"outline",onClick:()=>{b(!1),a&&a()},children:"Close"})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:[e.jsx("p",{children:"• The report has been saved to the system"}),e.jsx("p",{children:"• You can access it later from the reports section"}),e.jsx("p",{children:"• The PDF includes all service details and photos"})]})]})})})]})}function Pt(s){let t=s.message;return s.suggestedValue!==void 0&&(t+=` (Suggested: ${s.suggestedValue})`),t}function nc({validationErrors:s,className:t=""}){const a=s.filter(o=>o.severity==="error"),l=s.filter(o=>o.severity==="warning"),i=s.filter(o=>o.severity==="info");return s.length===0?null:e.jsxs("div",{className:`bg-gray-50 border border-gray-200 rounded-lg p-4 space-y-3 ${t}`,children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Validation Summary"}),a.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h5",{className:"text-sm font-medium text-red-700",children:["Errors (",a.length,")"]}),a.map((o,h)=>e.jsxs("div",{className:"text-sm text-red-600 flex items-start space-x-1",children:[e.jsx("span",{className:"mt-0.5",children:"❌"}),e.jsx("span",{children:Pt(o)})]},h))]}),l.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h5",{className:"text-sm font-medium text-yellow-700",children:["Warnings (",l.length,")"]}),l.map((o,h)=>e.jsxs("div",{className:"text-sm text-yellow-600 flex items-start space-x-1",children:[e.jsx("span",{className:"mt-0.5",children:"⚠️"}),e.jsx("span",{children:Pt(o)})]},h))]}),i.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h5",{className:"text-sm font-medium text-blue-700",children:["Suggestions (",i.length,")"]}),i.map((o,h)=>e.jsxs("div",{className:"text-sm text-blue-600 flex items-start space-x-1",children:[e.jsx("span",{className:"mt-0.5",children:"ℹ️"}),e.jsx("span",{children:Pt(o)})]},h))]})]})}function ic(s,t=600){const a=n.useRef(void 0);return n.useCallback((...l)=>{a.current&&window.clearTimeout(a.current),a.current=window.setTimeout(()=>s(...l),t)},[s,t])}function Wr({reportId:s}){const[t,a]=n.useState(null),[l,i]=n.useState(!0),[o,h]=n.useState(!1),[c,j]=n.useState("idle"),[P,v]=n.useState(null),[x,S]=n.useState(!1),[E,V]=n.useState([]),_=n.useCallback(async()=>{try{i(!0);const y=await ie.getServiceReport(s);y.sections=y.sections||{},y.sections.observations=y.sections.observations||["","","","","",""],y.sections.recommendedParts=y.sections.recommendedParts||[],y.sections.opticals=y.sections.opticals||[],y.sections.electronics=y.sections.electronics||[],y.sections.mechanical=y.sections.mechanical||[],a(y)}catch(y){v(y.message||"Failed to load report")}finally{i(!1)}},[s]);n.useEffect(()=>{const y=window.location.hash||"",A=/readonly=1|\/readonly/.test(y);S(A),_()},[_]),ic(async y=>{if(!x)try{h(!0),j("saving");const A=await ie.updateServiceReport(s,y);a(A),j("saved"),setTimeout(()=>j("idle"),1200)}catch(A){console.error(A),j("error")}finally{h(!1)}},800);const b=n.useMemo(()=>{var y;return e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-dark-primary",children:"Service Report"}),e.jsxs("p",{className:"text-sm text-dark-secondary mt-1",children:["Visit: ",e.jsx(ge,{children:t==null?void 0:t.visitId})," • Projector: ",e.jsx(ge,{children:t==null?void 0:t.projectorSerial})," • Site: ",t==null?void 0:t.siteName]}),((y=t==null?void 0:t.engineer)==null?void 0:y.name)&&e.jsxs("p",{className:"text-xs text-dark-secondary mt-1",children:["Engineer: ",t.engineer.name]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c==="saving"&&e.jsxs("span",{className:"text-xs text-dark-secondary flex items-center gap-1",children:[e.jsx(Ie,{className:"w-3 h-3 animate-spin"})," Saving…"]}),c==="saved"&&e.jsxs("span",{className:"text-xs text-green-400 flex items-center gap-1",children:[e.jsx(Be,{className:"w-3 h-3"})," Saved"]}),c==="error"&&e.jsxs("span",{className:"text-xs text-red-400 flex items-center gap-1",children:[e.jsx(Te,{className:"w-3 h-3"})," Save failed"]}),e.jsxs(q,{onClick:()=>window.history.back(),className:"gap-2",children:[e.jsx(Cl,{className:"w-4 h-4"}),"Back"]})]})]})},[t,c]);if(l)return e.jsxs("div",{className:"p-8 bg-dark-bg min-h-screen text-dark-secondary flex items-center justify-center",children:[e.jsx(Ie,{className:"w-6 h-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading report…"})]});if(P)return e.jsx("div",{className:"p-8 bg-dark-bg min-h-screen text-red-400",children:e.jsxs("p",{children:["Error: ",P]})});const N=async y=>{var A,u;if(t)try{h(!0),j("saving");const $={...t,...y},z=await ie.updateServiceReport(s,$);a(z),j("saved"),setTimeout(()=>j("idle"),1200),(A=window.showToast)==null||A.call(window,{type:"success",title:"Report",message:"Report saved"})}catch{j("error"),(u=window.showToast)==null||u.call(window,{type:"error",title:"Report",message:"Save failed"})}finally{h(!1)}};return e.jsx("div",{className:"min-h-screen bg-dark-bg text-dark-primary p-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-8",children:[b,E.length>0&&e.jsx("div",{className:"rounded-lg p-4 bg-white text-gray-900",children:e.jsx(nc,{validationErrors:E})}),e.jsx("div",{className:"rounded-lg p-4 bg-white text-gray-900 [--background:#ffffff] [--foreground:#111827] [--card:#ffffff] [--card-foreground:#111827] [--muted:#f3f4f6] [--muted-foreground:#374151] [--input:#ffffff] [--border:#e5e7eb] [--popover:#ffffff] [--popover-foreground:#111827]",children:e.jsx(Kr,{initialData:t,onSubmit:N,onClose:()=>window.history.back()})})]})})}function cc(){var xe,Se,ze,cs,fs,is;const{token:s,isAuthenticated:t,user:a}=ws(),[l,i]=n.useState([]),[o,h]=n.useState(!1),[c,j]=n.useState(!1),[P,v]=n.useState(!1),[x,S]=n.useState(!1),[E,V]=n.useState(null),[_,b]=n.useState(null),[N,y]=n.useState(1),[A,u]=n.useState(1),[$,z]=n.useState(""),[re,K]=n.useState("all"),[ne,Y]=n.useState("all"),[O,R]=n.useState(""),[F,J]=n.useState(""),[T,w]=n.useState(""),[g,p]=n.useState(""),[M,m]=n.useState("all"),[d,X]=n.useState("all"),[ee,B]=n.useState({serialNumber:"",complaintDescription:"",openedBy:{name:"",designation:"",contact:""},priority:"Medium",assignedTo:"",estimatedResolutionTime:"",notes:"",errorDate:new Date().toISOString().split("T")[0],unitModel:"",problemName:"",actionTaken:"",remarks:"",callStatus:"Open",caseSeverity:"Medium"}),[ce,me]=n.useState({status:"",closedReason:"",closedBy:{name:"",designation:"",contact:""},assignedTo:"",priority:"",estimatedResolutionTime:"",actualResolutionTime:"",notes:"",callStatus:"",caseSeverity:"",actionTaken:"",remarks:""}),[L,Q]=n.useState(null),[D,r]=n.useState(!1),[H,ae]=n.useState(null),[be,Z]=n.useState(!1);n.useEffect(()=>{console.log("DTR Page useEffect triggered with:",{currentPage:N,statusFilter:re,priorityFilter:ne,siteFilter:O,serialFilter:F,startDate:T,endDate:g,callStatusFilter:M,caseSeverityFilter:d}),C(),f()},[N,re,ne,O,F,T,g,M,d]),n.useEffect(()=>{console.log("API Client base URL:",ie.getBaseUrl()),s?(console.log("Setting auth token:",s.substring(0,20)+"..."),ie.setAuthToken(s),console.log("Auth token set in API client")):console.log("No auth token available")},[s]),n.useEffect(()=>{c&&(console.log("Create DTR dialog opened, resetting form..."),Ce())},[c]);const C=async()=>{var G,Ee;if(console.log("loadDTRs called with:",{isAuthenticated:t,hasToken:!!s}),!t||!s){ae("Please log in to view DTRs");return}try{h(!0),ae(null);const Me=new URLSearchParams({page:N.toString(),limit:"10"});re&&re!=="all"&&Me.append("status",re),ne&&ne!=="all"&&Me.append("priority",ne),O&&Me.append("siteName",O),F&&Me.append("serialNumber",F),T&&Me.append("startDate",T),g&&Me.append("endDate",g),M&&M!=="all"&&Me.append("callStatus",M),d&&d!=="all"&&Me.append("caseSeverity",d);const hs=`/dtr?${Me.toString()}`;console.log("Making API request to:",hs);const ls=await ie.get(hs);console.log("DTR API Response:",ls),ls&&ls.dtrs?(i(ls.dtrs),u(ls.totalPages||1)):(console.warn("Unexpected API response structure:",ls),i([]),u(1))}catch(Me){console.error("Error loading DTRs:",Me),((G=Me.response)==null?void 0:G.status)===401?ae("Authentication failed. Please log in again."):((Ee=Me.response)==null?void 0:Ee.status)===500?ae("Server error. Please try again later."):ae(`Failed to load DTRs: ${Me.message||"Unknown error"}`)}finally{h(!1)}},f=async()=>{if(!(!t||!s))try{const G=await ie.get("/dtr/stats/overview");console.log("Stats API Response:",G),b(G)}catch(G){console.error("Error loading stats:",G),b({total:0,open:0,inProgress:0,closed:0,shiftedToRMA:0,priorityBreakdown:[],monthlyTrend:[]})}},he=async G=>{if(!t||!s){ae("Please log in to lookup projector information");return}if(!G.trim()){Q(null);return}try{r(!0);const Ee=await ie.get(`/dtr/lookup/projector/${G}`);console.log("Projector lookup response:",Ee),Q(Ee)}catch(Ee){console.error("Error looking up projector:",Ee),Q(null)}finally{r(!1)}},pe=()=>{var G,Ee,Me,hs,ls,oa;return console.log("Validating form with data:",ee),console.log("Serial number:",ee.serialNumber,"trimmed:",(G=ee.serialNumber)==null?void 0:G.trim()),console.log("Complaint description:",ee.complaintDescription,"trimmed:",(Ee=ee.complaintDescription)==null?void 0:Ee.trim()),console.log("Opened by name:",ee.openedBy.name,"trimmed:",(Me=ee.openedBy.name)==null?void 0:Me.trim()),(hs=ee.serialNumber)!=null&&hs.trim()?(ls=ee.complaintDescription)!=null&&ls.trim()?(oa=ee.openedBy.name)!=null&&oa.trim()?(console.log("Form validation passed"),null):"Opened by name is required":"Complaint description is required":"Serial number is required"},Pe=async()=>{if(console.log("handleCreateDTR called with formData:",ee),console.log("Authentication status:",{isAuthenticated:t,hasToken:!!s}),!t||!s){ae("Please log in to create DTRs");return}const G=pe();if(G){console.log("Validation error:",G),ae(G);return}console.log("Form validation passed, submitting..."),Z(!0),ae(null);try{console.log("Making API request to /dtr with data:",ee);const Ee=await ie.post("/dtr",ee);console.log("Create DTR response:",Ee),i([Ee,...l]),j(!1),Ce(),f()}catch(Ee){console.error("Error creating DTR:",Ee),ae(Ee.message||"Failed to create DTR. Please try again.")}finally{Z(!1)}},W=async()=>{var G,Ee;if(console.log("handleUpdateDTR called with:",{selectedDTR:E,editFormData:ce}),console.log("Authentication status:",{isAuthenticated:t,hasToken:!!s}),!t||!s){ae("Please log in to update DTRs");return}if(!E){console.error("No selected DTR to update"),ae("No DTR selected for update");return}console.log("Starting DTR update..."),Z(!0),ae(null);try{const Me={...ce};Me.status==="Shifted to RMA"?Me.closedReason="Shifted to RMA":Me.status==="Closed"&&!Me.closedReason&&(Me.closedReason="Resolved"),console.log("Making API request to update DTR:",E._id),console.log("Update data:",Me);const hs=await ie.put(`/dtr/${E._id}`,Me);console.log("Update DTR response:",hs),i(l.map(ls=>ls._id===E._id?hs:ls)),v(!1),V(null),f(),console.log("DTR updated successfully")}catch(Me){console.error("Error updating DTR:",Me),console.error("Error details:",{message:Me.message,response:(G=Me.response)==null?void 0:G.data,status:(Ee=Me.response)==null?void 0:Ee.status}),ae(Me.message||"Failed to update DTR. Please try again.")}finally{Z(!1)}},ve=async G=>{if(!t||!s){ae("Please log in to delete DTRs");return}if(confirm("Are you sure you want to delete this DTR?"))try{await ie.delete(`/dtr/${G}`),i(l.filter(Ee=>Ee._id!==G)),f()}catch(Ee){console.error("Error deleting DTR:",Ee)}},Ce=()=>{B({serialNumber:"",complaintDescription:"",openedBy:{name:"",designation:"",contact:""},priority:"Medium",assignedTo:"",estimatedResolutionTime:"",notes:"",errorDate:new Date().toISOString().split("T")[0],unitModel:"",problemName:"",actionTaken:"",remarks:"",callStatus:"Open",caseSeverity:"Medium"}),Q(null)},Ae=G=>{V(G),me({status:G.status||"Open",closedReason:G.closedReason||"",closedBy:G.closedBy||{name:"",designation:"",contact:""},assignedTo:G.assignedTo||"",priority:G.priority||"Medium",estimatedResolutionTime:G.estimatedResolutionTime||"",actualResolutionTime:G.actualResolutionTime||"",notes:G.notes||"",callStatus:G.callStatus||"Open",caseSeverity:G.caseSeverity||"Medium",actionTaken:G.actionTaken||"",remarks:G.remarks||""}),v(!0)},Ue=G=>{V(G),S(!0)},Fe=G=>{if(!G)return"bg-gray-100 text-gray-800";switch(G){case"Open":return"bg-red-100 text-red-800";case"In Progress":return"bg-yellow-100 text-yellow-800";case"Closed":return"bg-green-100 text-green-800";case"Shifted to RMA":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},$e=G=>{if(!G)return"bg-gray-100 text-gray-800";switch(G){case"Critical":return"bg-red-100 text-red-800";case"High":return"bg-orange-100 text-orange-800";case"Medium":return"bg-yellow-100 text-yellow-800";case"Low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},Ve=G=>{if(!G)return"N/A";try{return new Date(G).toLocaleDateString()}catch{return"Invalid Date"}},U=G=>{if(!G)return"N/A";try{return new Date(G).toLocaleString()}catch{return"Invalid Date"}};return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Daily Trouble Reports"}),e.jsx("p",{className:"text-gray-600",children:"Manage and track daily trouble reports from sites"})]}),e.jsxs(q,{onClick:()=>j(!0),className:"bg-blue-600 hover:bg-blue-700",disabled:!t,children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"New DTR"]})]}),!t&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"text-yellow-800 font-medium",children:"Please log in to access DTR functionality"})]})}),t&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{className:"text-blue-800",children:["Authenticated as: ",(a==null?void 0:a.username)||((xe=a==null?void 0:a.profile)==null?void 0:xe.firstName)||"Unknown","(Role: ",(a==null?void 0:a.role)||"Unknown",")"]})]})}),H&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-red-800 font-medium",children:H}),e.jsxs("div",{className:"ml-auto flex gap-2",children:[e.jsxs(q,{variant:"outline",size:"sm",onClick:()=>{ae(null),C()},className:"text-red-600 hover:text-red-700 border-red-300",children:[e.jsx(Qe,{className:"w-4 h-4 mr-1"}),"Retry"]}),e.jsx(q,{variant:"ghost",size:"sm",onClick:()=>ae(null),className:"text-red-600 hover:text-red-800",children:e.jsx(Ke,{className:"w-4 h-4"})})]})]})}),_&&t&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs(te,{children:[e.jsx(oe,{className:"pb-2",children:e.jsx(de,{className:"text-sm font-medium text-gray-600",children:"Total DTRs"})}),e.jsx(se,{children:e.jsx("div",{className:"text-2xl font-bold",children:_.total})})]}),e.jsxs(te,{children:[e.jsx(oe,{className:"pb-2",children:e.jsx(de,{className:"text-sm font-medium text-gray-600",children:"Open"})}),e.jsx(se,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:_.open})})]}),e.jsxs(te,{children:[e.jsx(oe,{className:"pb-2",children:e.jsx(de,{className:"text-sm font-medium text-gray-600",children:"In Progress"})}),e.jsx(se,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:_.inProgress})})]}),e.jsxs(te,{children:[e.jsx(oe,{className:"pb-2",children:e.jsx(de,{className:"text-sm font-medium text-gray-600",children:"Closed"})}),e.jsx(se,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:_.closed})})]}),e.jsxs(te,{children:[e.jsx(oe,{className:"pb-2",children:e.jsx(de,{className:"text-sm font-medium text-gray-600",children:"Shifted to RMA"})}),e.jsx(se,{children:e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:_.shiftedToRMA})})]})]}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(vt,{className:"w-5 h-5"}),"Filters"]})}),e.jsx(se,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{children:"Search"}),e.jsx(k,{placeholder:"Search DTRs...",value:$,onChange:G=>z(G.target.value),disabled:!t})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Status"}),e.jsxs(ye,{value:re,onValueChange:K,disabled:!t,children:[e.jsx(ke,{children:e.jsx(Ne,{placeholder:"All Status"})}),e.jsxs(we,{children:[e.jsx(I,{value:"all",children:"All Status"}),e.jsx(I,{value:"Open",children:"Open"}),e.jsx(I,{value:"In Progress",children:"In Progress"}),e.jsx(I,{value:"Resolved",children:"Resolved"}),e.jsx(I,{value:"Closed",children:"Closed"}),e.jsx(I,{value:"Escalated",children:"Escalated"}),e.jsx(I,{value:"Shifted to RMA",children:"Shifted to RMA"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Priority"}),e.jsxs(ye,{value:ne,onValueChange:Y,disabled:!t,children:[e.jsx(ke,{children:e.jsx(Ne,{placeholder:"All Priority"})}),e.jsxs(we,{children:[e.jsx(I,{value:"all",children:"All Priority"}),e.jsx(I,{value:"Low",children:"Low"}),e.jsx(I,{value:"Medium",children:"Medium"}),e.jsx(I,{value:"High",children:"High"}),e.jsx(I,{value:"Critical",children:"Critical"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Call Status"}),e.jsxs(ye,{value:M,onValueChange:m,disabled:!t,children:[e.jsx(ke,{children:e.jsx(Ne,{placeholder:"All Status"})}),e.jsxs(we,{children:[e.jsx(I,{value:"all",children:"All Status"}),e.jsx(I,{value:"Open",children:"Open"}),e.jsx(I,{value:"In Progress",children:"In Progress"}),e.jsx(I,{value:"Resolved",children:"Resolved"}),e.jsx(I,{value:"Closed",children:"Closed"}),e.jsx(I,{value:"Escalated",children:"Escalated"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Case Severity"}),e.jsxs(ye,{value:d,onValueChange:X,disabled:!t,children:[e.jsx(ke,{children:e.jsx(Ne,{placeholder:"All Severity"})}),e.jsxs(we,{children:[e.jsx(I,{value:"all",children:"All Severity"}),e.jsx(I,{value:"Low",children:"Low"}),e.jsx(I,{value:"Medium",children:"Medium"}),e.jsx(I,{value:"High",children:"High"}),e.jsx(I,{value:"Critical",children:"Critical"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Site"}),e.jsx(k,{placeholder:"Site name...",value:O,onChange:G=>R(G.target.value),disabled:!t})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Serial Number"}),e.jsx(k,{placeholder:"Serial number...",value:F,onChange:G=>J(G.target.value),disabled:!t})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Start Date"}),e.jsx(k,{type:"date",value:T,onChange:G=>w(G.target.value),disabled:!t})]}),e.jsxs("div",{children:[e.jsx(le,{children:"End Date"}),e.jsx(k,{type:"date",value:g,onChange:G=>p(G.target.value),disabled:!t})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(q,{onClick:()=>{z(""),K("all"),Y("all"),R(""),J(""),w(""),p(""),m("all"),X("all")},variant:"outline",disabled:!t,children:"Clear Filters"})})]})})]}),e.jsxs(te,{children:[e.jsxs(oe,{children:[e.jsx(de,{children:"Daily Trouble Reports"}),e.jsxs(Re,{children:["Showing ",l.length," DTRs (Page ",N," of ",A,")"]})]}),e.jsxs(se,{children:[t?o?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Loading DTRs..."})]}):l.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Oe,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No DTRs found"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your filters or create a new DTR"})]}):e.jsx("div",{className:"space-y-4",children:l.map(G=>{var Ee;return e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ge,{className:Fe(G.status||"Open"),children:G.status||"Open"}),e.jsx(ge,{className:$e(G.priority||"Medium"),children:G.priority||"Medium"}),e.jsx("span",{className:"text-sm text-gray-600 font-mono",children:G.caseId||"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Serial Number:"}),e.jsx("div",{className:"font-medium",children:G.serialNumber||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Site:"}),e.jsx("div",{className:"font-medium",children:G.siteName||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Region:"}),e.jsx("div",{className:"font-medium",children:G.region||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Date:"}),e.jsx("div",{className:"font-medium",children:G.complaintDate?Ve(G.complaintDate):"N/A"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Unit Model:"}),e.jsx("div",{className:"font-medium",children:G.unitModel||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Problem:"}),e.jsx("div",{className:"font-medium",children:G.problemName||G.complaintDescription||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Call Status:"}),e.jsx(ge,{className:Fe(G.callStatus||G.status||"Open"),children:G.callStatus||G.status||"Open"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Case Severity:"}),e.jsx(ge,{className:$e(G.caseSeverity||G.priority||"Medium"),children:G.caseSeverity||G.priority||"Medium"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Complaint:"}),e.jsx("div",{className:"font-medium",children:G.complaintDescription||"N/A"})]}),G.actionTaken&&e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Action Taken:"}),e.jsx("div",{className:"font-medium",children:G.actionTaken})]}),G.remarks&&e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Remarks:"}),e.jsx("div",{className:"font-medium",children:G.remarks})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Opened By:"}),e.jsx("div",{className:"font-medium",children:((Ee=G.openedBy)==null?void 0:Ee.name)||"N/A"})]}),G.assignedTo&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Assigned To:"}),e.jsx("div",{className:"font-medium",children:G.assignedTo})]}),G.rmaCaseNumber&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"RMA Case:"}),e.jsxs("div",{className:"font-medium text-purple-600 flex items-center gap-1",children:[G.rmaCaseNumber,e.jsx(pa,{className:"w-3 h-3"})]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{variant:"outline",size:"sm",onClick:()=>Ue(G),children:e.jsx(es,{className:"w-4 h-4"})}),e.jsx(q,{variant:"outline",size:"sm",onClick:()=>Ae(G),children:e.jsx(ks,{className:"w-4 h-4"})}),e.jsx(q,{variant:"outline",size:"sm",onClick:()=>ve(G._id),className:"text-red-600 hover:text-red-700",children:e.jsx(Vs,{className:"w-4 h-4"})})]})]})},G._id)})}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Please log in to view DTRs"}),A>1&&t&&e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-6",children:[e.jsx(q,{variant:"outline",onClick:()=>y(Math.max(1,N-1)),disabled:N===1,children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",N," of ",A]}),e.jsx(q,{variant:"outline",onClick:()=>y(Math.min(A,N+1)),disabled:N===A,children:"Next"})]})]})]}),e.jsx(ps,{open:c,onOpenChange:j,children:e.jsxs(gs,{className:"max-w-2xl max-h-[90vh] overflow-y-auto bg-white",children:[e.jsxs(js,{className:"border-b border-gray-200 pb-4",children:[e.jsx(bs,{className:"text-2xl font-bold text-gray-900",children:"Create New DTR"}),e.jsx(Ys,{className:"text-gray-600 mt-2",children:"Register a new daily trouble report from a site"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Serial Number *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{placeholder:"Enter projector serial number",value:ee.serialNumber,onChange:G=>{B({...ee,serialNumber:G.target.value}),he(G.target.value)},className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500"}),e.jsx(q,{variant:"outline",onClick:()=>he(ee.serialNumber),disabled:D,className:"border-gray-300 text-gray-700 hover:bg-gray-50",children:D?"...":"Lookup"})]})]}),L&&e.jsxs(te,{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-blue-300 shadow-sm",children:[e.jsx(oe,{className:"pb-3",children:e.jsxs(de,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx(ss,{className:"w-5 h-5"}),"Projector Information"]})}),e.jsx(se,{className:"text-sm text-blue-800",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white/50 p-2 rounded",children:[e.jsx("strong",{children:"Model:"})," ",L.model]}),e.jsxs("div",{className:"bg-white/50 p-2 rounded",children:[e.jsx("strong",{children:"Brand:"})," ",L.brand]}),e.jsxs("div",{className:"bg-white/50 p-2 rounded",children:[e.jsx("strong",{children:"Site:"})," ",L.site.name]}),e.jsxs("div",{className:"bg-white/50 p-2 rounded",children:[e.jsx("strong",{children:"Region:"})," ",L.site.region]}),e.jsxs("div",{className:"bg-white/50 p-2 rounded",children:[e.jsx("strong",{children:"Install Date:"})," ",Ve(L.installDate)]}),e.jsxs("div",{className:"bg-white/50 p-2 rounded",children:[e.jsx("strong",{children:"Warranty End:"})," ",Ve(L.warrantyEnd)]})]})})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5 text-orange-600"}),"Complaint Details"]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Complaint Description *"}),e.jsx(os,{placeholder:"Describe the complaint or issue...",value:ee.complaintDescription,onChange:G=>B({...ee,complaintDescription:G.target.value}),rows:3,className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500 resize-none"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(as,{className:"w-5 h-5 text-blue-600"}),"Personnel Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Opened By Name *"}),e.jsx(k,{placeholder:"Name of person opening the DTR",value:ee.openedBy.name,onChange:G=>B({...ee,openedBy:{...ee.openedBy,name:G.target.value}}),className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Designation"}),e.jsx(k,{placeholder:"Designation",value:ee.openedBy.designation,onChange:G=>B({...ee,openedBy:{...ee.openedBy,designation:G.target.value}}),className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Contact"}),e.jsx(k,{placeholder:"Phone or email",value:ee.openedBy.contact,onChange:G=>B({...ee,openedBy:{...ee.openedBy,contact:G.target.value}}),className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(rs,{className:"w-5 h-5 text-green-600"}),"Assignment & Resolution"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Priority"}),e.jsxs(ye,{value:ee.priority,onValueChange:G=>B({...ee,priority:G}),children:[e.jsx(ke,{className:"border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-blue-500",children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Low",children:"Low"}),e.jsx(I,{value:"Medium",children:"Medium"}),e.jsx(I,{value:"High",children:"High"}),e.jsx(I,{value:"Critical",children:"Critical"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Assigned To"}),e.jsx(k,{placeholder:"Technician name",value:ee.assignedTo,onChange:G=>B({...ee,assignedTo:G.target.value}),className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Estimated Resolution Time"}),e.jsx(k,{placeholder:"e.g., 2 hours, 1 day",value:ee.estimatedResolutionTime,onChange:G=>B({...ee,estimatedResolutionTime:G.target.value}),className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Notes"}),e.jsx(os,{placeholder:"Additional notes...",value:ee.notes,onChange:G=>B({...ee,notes:G.target.value}),rows:2,className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500 resize-none"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5 text-purple-600"}),"Additional Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Error Date *"}),e.jsx(k,{type:"date",value:ee.errorDate,onChange:G=>B({...ee,errorDate:G.target.value}),required:!0,className:"border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Unit Model"}),e.jsx(k,{placeholder:"Projector model",value:ee.unitModel,onChange:G=>B({...ee,unitModel:G.target.value}),className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Name of Problem / Request *"}),e.jsx(k,{placeholder:"Describe the problem or request",value:ee.problemName,onChange:G=>B({...ee,problemName:G.target.value}),required:!0,className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Action Taken"}),e.jsx(os,{placeholder:"Describe what action was taken...",value:ee.actionTaken,onChange:G=>B({...ee,actionTaken:G.target.value}),rows:2,className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500 resize-none"})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Remarks"}),e.jsx(os,{placeholder:"Additional remarks...",value:ee.remarks,onChange:G=>B({...ee,remarks:G.target.value}),rows:2,className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500 resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Call Status"}),e.jsxs(ye,{value:ee.callStatus,onValueChange:G=>B({...ee,callStatus:G}),children:[e.jsx(ke,{className:"border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-blue-500",children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Open",children:"Open"}),e.jsx(I,{value:"In Progress",children:"In Progress"}),e.jsx(I,{value:"Resolved",children:"Resolved"}),e.jsx(I,{value:"Closed",children:"Closed"}),e.jsx(I,{value:"Escalated",children:"Escalated"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Case Severity"}),e.jsxs(ye,{value:ee.caseSeverity,onValueChange:G=>B({...ee,caseSeverity:G}),children:[e.jsx(ke,{className:"border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-blue-500",children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Low",children:"Low"}),e.jsx(I,{value:"Medium",children:"Medium"}),e.jsx(I,{value:"High",children:"High"}),e.jsx(I,{value:"Critical",children:"Critical"})]})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(q,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(q,{onClick:()=>{console.log("Create DTR button clicked!"),console.log("Current form data:",ee),console.log("Button disabled state:",!ee.serialNumber||!ee.complaintDescription||!ee.openedBy.name||be),Pe()},disabled:!ee.serialNumber||!ee.complaintDescription||!ee.openedBy.name||be,children:be?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Creating..."]}):"Create DTR"})]})]})}),e.jsx(ps,{open:P,onOpenChange:v,children:e.jsxs(gs,{className:"max-w-2xl max-h-[90vh] overflow-y-auto bg-white",children:[e.jsxs(js,{className:"border-b border-gray-200 pb-4",children:[e.jsxs(bs,{className:"text-2xl font-bold text-gray-900",children:["Edit DTR - ",E==null?void 0:E.caseId]}),e.jsx(Ys,{className:"text-gray-600 mt-2",children:"Update the DTR status and details"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Status"}),e.jsxs(ye,{value:ce.status,onValueChange:G=>{const Ee={...ce,status:G};G==="Shifted to RMA"?Ee.closedReason="Shifted to RMA":G==="Closed"&&!Ee.closedReason&&(Ee.closedReason="Resolved"),me(Ee)},children:[e.jsx(ke,{className:"border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-blue-500",children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Open",children:"Open"}),e.jsx(I,{value:"In Progress",children:"In Progress"}),e.jsx(I,{value:"Closed",children:"Closed"}),e.jsx(I,{value:"Shifted to RMA",children:"Shifted to RMA"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Priority"}),e.jsxs(ye,{value:ce.priority,onValueChange:G=>me({...ce,priority:G}),children:[e.jsx(ke,{className:"border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-blue-500",children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Low",children:"Low"}),e.jsx(I,{value:"Medium",children:"Medium"}),e.jsx(I,{value:"High",children:"High"}),e.jsx(I,{value:"Critical",children:"Critical"})]})]})]})]}),ce.status==="Closed"&&e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Closed Reason"}),e.jsxs(ye,{value:ce.closedReason,onValueChange:G=>me({...ce,closedReason:G}),children:[e.jsx(ke,{className:"border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-blue-500",children:e.jsx(Ne,{placeholder:"Select reason"})}),e.jsxs(we,{children:[e.jsx(I,{value:"Resolved",children:"Resolved"}),e.jsx(I,{value:"No Action Required",children:"No Action Required"}),e.jsx(I,{value:"Other",children:"Other"})]})]})]}),ce.status==="Shifted to RMA"&&e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Closed Reason"}),e.jsxs(ye,{value:ce.closedReason,onValueChange:G=>me({...ce,closedReason:G}),children:[e.jsx(ke,{className:"border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-blue-500",children:e.jsx(Ne,{})}),e.jsx(we,{children:e.jsx(I,{value:"Shifted to RMA",children:"Shifted to RMA"})})]})]}),(ce.status==="Closed"||ce.status==="Shifted to RMA")&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Closed By Name"}),e.jsx(k,{placeholder:"Name of person closing the DTR",value:((Se=ce.closedBy)==null?void 0:Se.name)||"",onChange:G=>me({...ce,closedBy:{...ce.closedBy,name:G.target.value}}),className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Designation"}),e.jsx(k,{placeholder:"Designation",value:((ze=ce.closedBy)==null?void 0:ze.designation)||"",onChange:G=>me({...ce,closedBy:{...ce.closedBy,designation:G.target.value}}),className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Assigned To"}),e.jsx(k,{placeholder:"Technician name",value:ce.assignedTo,onChange:G=>me({...ce,assignedTo:G.target.value}),className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Estimated Resolution Time"}),e.jsx(k,{placeholder:"e.g., 2 hours, 1 day",value:ce.estimatedResolutionTime,onChange:G=>me({...ce,estimatedResolutionTime:G.target.value}),className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500"})]})]}),ce.status==="Closed"&&e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Actual Resolution Time"}),e.jsx(k,{placeholder:"e.g., 2 hours, 1 day",value:ce.actualResolutionTime,onChange:G=>me({...ce,actualResolutionTime:G.target.value}),className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Notes"}),e.jsx(os,{placeholder:"Additional notes...",value:ce.notes,onChange:G=>me({...ce,notes:G.target.value}),rows:3,className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500 resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Call Status"}),e.jsxs(ye,{value:ce.callStatus,onValueChange:G=>me({...ce,callStatus:G}),children:[e.jsx(ke,{className:"border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-blue-500",children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Open",children:"Open"}),e.jsx(I,{value:"In Progress",children:"In Progress"}),e.jsx(I,{value:"Resolved",children:"Resolved"}),e.jsx(I,{value:"Closed",children:"Closed"}),e.jsx(I,{value:"Escalated",children:"Escalated"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Case Severity"}),e.jsxs(ye,{value:ce.caseSeverity,onValueChange:G=>me({...ce,caseSeverity:G}),children:[e.jsx(ke,{className:"border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-blue-500",children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Low",children:"Low"}),e.jsx(I,{value:"Medium",children:"Medium"}),e.jsx(I,{value:"High",children:"High"}),e.jsx(I,{value:"Critical",children:"Critical"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Action Taken"}),e.jsx(os,{placeholder:"Describe what action was taken...",value:ce.actionTaken,onChange:G=>me({...ce,actionTaken:G.target.value}),rows:2,className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500 resize-none"})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-gray-700 font-medium mb-2 block",children:"Remarks"}),e.jsx(os,{placeholder:"Additional remarks...",value:ce.remarks,onChange:G=>me({...ce,remarks:G.target.value}),rows:2,className:"border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500 resize-none"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(q,{variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(q,{onClick:()=>{console.log("Update DTR button clicked!"),console.log("Current edit form data:",ce),console.log("Selected DTR:",E),console.log("Form data validation:",{hasStatus:!!ce.status,hasPriority:!!ce.priority,hasAssignedTo:!!ce.assignedTo,hasNotes:!!ce.notes}),W()},disabled:be,children:be?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Updating..."]}):"Update DTR"})]})]})}),e.jsx(ps,{open:x,onOpenChange:S,children:e.jsxs(gs,{className:"max-w-4xl max-h-[90vh] overflow-y-auto bg-white",children:[e.jsxs(js,{className:"border-b border-gray-200 pb-4",children:[e.jsxs(bs,{className:"text-2xl font-bold text-gray-900",children:["DTR Details - ",E==null?void 0:E.caseId]}),e.jsx(Ys,{className:"text-gray-600 mt-2",children:"View complete DTR information"})]}),E&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{className:"text-lg",children:"Basic Information"})}),e.jsx(se,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Case ID:"}),e.jsx("div",{className:"font-mono font-medium",children:E.caseId||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Status:"}),e.jsx(ge,{className:Fe(E.status||"Open"),children:E.status||"Open"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Priority:"}),e.jsx(ge,{className:$e(E.priority||"Medium"),children:E.priority||"Medium"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Complaint Date:"}),e.jsx("div",{className:"font-medium",children:E.complaintDate?U(E.complaintDate):"N/A"})]})]})})]}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{className:"text-lg",children:"Projector & Site Information"})}),e.jsxs(se,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Serial Number:"}),e.jsx("div",{className:"font-medium",children:E.serialNumber||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Site Name:"}),e.jsx("div",{className:"font-medium",children:E.siteName||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Site Code:"}),e.jsx("div",{className:"font-medium",children:E.siteCode||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Region:"}),e.jsx("div",{className:"font-medium",children:E.region||"N/A"})]})]}),E.projectorDetails&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Projector Details:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Model:"})," ",E.projectorDetails.model||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Brand:"})," ",E.projectorDetails.brand||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Install Date:"})," ",E.projectorDetails.installDate?Ve(E.projectorDetails.installDate):"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Warranty End:"})," ",E.projectorDetails.warrantyEnd?Ve(E.projectorDetails.warrantyEnd):"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Last Service:"})," ",E.projectorDetails.lastService?Ve(E.projectorDetails.lastService):"N/A"]})]})]})]})]}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{className:"text-lg",children:"Complaint Details"})}),e.jsxs(se,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Description:"}),e.jsx("div",{className:"font-medium mt-1",children:E.complaintDescription||"N/A"})]}),E.problemName&&e.jsxs("div",{className:"mt-4",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Problem Name:"}),e.jsx("div",{className:"font-medium mt-1",children:E.problemName})]}),E.actionTaken&&e.jsxs("div",{className:"mt-4",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Action Taken:"}),e.jsx("div",{className:"font-medium mt-1",children:E.actionTaken})]}),E.remarks&&e.jsxs("div",{className:"mt-4",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Remarks:"}),e.jsx("div",{className:"font-medium mt-1",children:E.remarks})]}),E.notes&&e.jsxs("div",{className:"mt-4",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Notes:"}),e.jsx("div",{className:"font-medium mt-1",children:E.notes})]})]})]}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{className:"text-lg",children:"Additional Information"})}),e.jsx(se,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Error Date:"}),e.jsx("div",{className:"font-medium",children:E.errorDate?Ve(E.errorDate):"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Unit Model:"}),e.jsx("div",{className:"font-medium",children:E.unitModel||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Call Status:"}),e.jsx(ge,{className:Fe(E.callStatus||E.status||"Open"),children:E.callStatus||E.status||"Open"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Case Severity:"}),e.jsx(ge,{className:$e(E.caseSeverity||E.priority||"Medium"),children:E.caseSeverity||E.priority||"Medium"})]})]})})]}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{className:"text-lg",children:"Personnel Information"})}),e.jsxs(se,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Opened By:"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",((cs=E.openedBy)==null?void 0:cs.name)||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Designation:"})," ",((fs=E.openedBy)==null?void 0:fs.designation)||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Contact:"})," ",((is=E.openedBy)==null?void 0:is.contact)||"N/A"]})]})]}),E.closedBy&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Closed By:"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",E.closedBy.name||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Designation:"})," ",E.closedBy.designation||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Contact:"})," ",E.closedBy.contact||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Closed Date:"})," ",E.closedBy.closedDate?U(E.closedBy.closedDate):"N/A"]})]})]})]}),E.assignedTo&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Assigned To:"}),e.jsx("div",{className:"font-medium",children:E.assignedTo})]})]})]}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{className:"text-lg",children:"Resolution Information"})}),e.jsxs(se,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[E.estimatedResolutionTime&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Estimated Resolution Time:"}),e.jsx("div",{className:"font-medium",children:E.estimatedResolutionTime})]}),E.actualResolutionTime&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Actual Resolution Time:"}),e.jsx("div",{className:"font-medium",children:E.actualResolutionTime})]}),E.closedReason&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Closed Reason:"}),e.jsx("div",{className:"font-medium",children:E.closedReason})]})]}),E.rmaCaseNumber&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"RMA Case Number:"}),e.jsxs("div",{className:"font-medium text-purple-600 flex items-center gap-2",children:[E.rmaCaseNumber,e.jsx(pa,{className:"w-4 h-4"})]})]})]})]}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{className:"text-lg",children:"Timestamps"})}),e.jsx(se,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Created:"}),e.jsx("div",{className:"font-medium",children:U(E.createdAt)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Last Updated:"}),e.jsx("div",{className:"font-medium",children:U(E.updatedAt)})]})]})})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(q,{variant:"outline",onClick:()=>S(!1),children:"Close"})})]})})]})}function oc(){const[s,t]=n.useState([]),[a,l]=n.useState([]),[i,o]=n.useState(null),[h,c]=n.useState(!0),[j,P]=n.useState(""),[v,x]=n.useState("all"),[S,E]=n.useState(null),[V,_]=n.useState(!1),[b,N]=n.useState([]),[y,A]=n.useState([]),[u,$]=n.useState([]),[z,re]=n.useState(!1),[K,ne]=n.useState({siteId:"",auditoriumId:"",projectorId:"",contractManager:"",contractStartDate:"",contractEndDate:"",contractDuration:12,contractValue:0,paymentStatus:"Pending",fseId:""}),[Y,O]=n.useState(new Set),[R,F]=n.useState(!1),[J,T]=n.useState(!1),[w,g]=n.useState(!1),[p,M]=n.useState(""),[m,d]=n.useState(""),[X,ee]=n.useState(12),[B,ce]=n.useState(!1),me=K.siteId?y.filter(W=>W.siteId===K.siteId):[];n.useEffect(()=>{L(),Q()},[]),n.useEffect(()=>{D()},[s,j,v]),n.useEffect(()=>{V&&(async()=>{try{const[ve,Ce,Ae]=await Promise.all([ie.get("/sites"),ie.get("/projectors"),ie.get("/fse")]);N(ve),A(Ce),$(Ae)}catch(ve){console.error("Failed loading masters",ve)}})()},[V]),n.useEffect(()=>{if(!K.contractStartDate||!K.contractDuration)return;const W=new Date(K.contractStartDate),ve=new Date(W);ve.setMonth(ve.getMonth()+Number(K.contractDuration));const Ce=ve.getFullYear(),Ae=String(ve.getMonth()+1).padStart(2,"0"),Ue=String(ve.getDate()).padStart(2,"0");ne(Fe=>({...Fe,contractEndDate:`${Ce}-${Ae}-${Ue}`}))},[K.contractStartDate,K.contractDuration]);const L=async()=>{try{c(!0);const W=await ie.get("/amc-contracts");t(W)}catch(W){console.error("Error loading contracts:",W)}finally{c(!1)}},Q=async()=>{try{const W=await ie.get("/amc-contracts/stats/dashboard");o(W)}catch(W){console.error("Error loading stats:",W)}},D=()=>{let W=s;j&&(W=W.filter(ve=>ve.contractNumber.toLowerCase().includes(j.toLowerCase())||ve.siteName.toLowerCase().includes(j.toLowerCase())||ve.auditoriumName.toLowerCase().includes(j.toLowerCase())||ve.projectorSerial.toLowerCase().includes(j.toLowerCase()))),v!=="all"&&(W=W.filter(ve=>ve.status===v)),l(W)},r=W=>{const ve={Active:{color:"bg-green-100 text-green-800",icon:Be},Expired:{color:"bg-red-100 text-red-800",icon:Te},Suspended:{color:"bg-yellow-100 text-yellow-800",icon:ts},Terminated:{color:"bg-gray-100 text-gray-800",icon:Oe}},Ce=ve[W]||ve.Active,Ae=Ce.icon;return e.jsxs(ge,{className:Ce.color,children:[e.jsx(Ae,{className:"w-3 h-3 mr-1"}),W]})},H=W=>{const ve={Scheduled:{color:"bg-blue-100 text-blue-800"},"In Progress":{color:"bg-yellow-100 text-yellow-800"},Completed:{color:"bg-green-100 text-green-800"},Overdue:{color:"bg-red-100 text-red-800"}},Ce=ve[W]||ve.Scheduled;return e.jsx(ge,{className:Ce.color,children:W})},ae=W=>new Date(W).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),be=W=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(W),Z=W=>{O(W?new Set(a.map(ve=>ve._id)):new Set)},C=(W,ve)=>{const Ce=new Set(Y);ve?Ce.add(W):Ce.delete(W),O(Ce)},f=async()=>{if(Y.size!==0)try{ce(!0);const W=Array.from(Y);for(const ve of W)await ie.put(`/amc-contracts/${ve}`,{contractStartDate:p,contractEndDate:m});await L(),O(new Set),F(!1),M(""),d(""),alert(`Successfully updated ${W.length} contracts`)}catch(W){console.error("Error updating bulk dates:",W),alert("Error updating contracts. Please try again.")}finally{ce(!1)}},he=async()=>{if(Y.size!==0)try{ce(!0);const W=Array.from(Y);for(const ve of W){const Ce=s.find(Ae=>Ae._id===ve);if(Ce){const Ae=new Date(Ce.contractStartDate),Ue=new Date(Ae);Ue.setMonth(Ae.getMonth()+6);const Fe=new Date(Ae);Fe.setMonth(Ae.getMonth()+12),await ie.put(`/amc-contracts/${ve}`,{"serviceSchedule.firstService.scheduledDate":Ue.toISOString(),"serviceSchedule.secondService.scheduledDate":Fe.toISOString()})}}await L(),O(new Set),T(!1),alert(`Successfully scheduled services for ${W.length} contracts`)}catch(W){console.error("Error scheduling bulk services:",W),alert("Error scheduling services. Please try again.")}finally{ce(!1)}},pe=async()=>{if(Y.size!==0)try{ce(!0);const W=Array.from(Y);for(const ve of W)await ie.post(`/amc-contracts/${ve}/renew`,{renewalPeriod:X});await L(),O(new Set),g(!1),ee(12),alert(`Successfully renewed ${W.length} contracts`)}catch(W){console.error("Error renewing bulk contracts:",W),alert("Error renewing contracts. Please try again.")}finally{ce(!1)}},Pe=async()=>{var W,ve;if(!K.customerName||!K.siteId||!K.projectorId||!K.contractManager||!K.contractStartDate||!K.contractEndDate){alert("Please fill all required fields");return}try{re(!0);const Ce={customerName:K.customerName,customerSite:((W=b.find(Ae=>Ae._id===K.siteId))==null?void 0:W.name)||"",projector:K.projectorId,site:K.siteId,contractManager:K.contractManager,contractStartDate:K.contractStartDate,contractEndDate:K.contractEndDate,contractDuration:Number(K.contractDuration),contractValue:Number(K.contractValue),paymentStatus:K.paymentStatus,assignedFSE:K.fseId?{fseId:K.fseId,fseName:((ve=u.find(Ae=>Ae._id===K.fseId))==null?void 0:ve.fseName)||""}:void 0};await ie.post("/amc-contracts",Ce),_(!1),ne({customerName:"",siteId:"",projectorId:"",contractManager:"",contractStartDate:"",contractEndDate:"",contractDuration:12,contractValue:0,paymentStatus:"Pending",fseId:""}),await L()}catch(Ce){console.error("Create AMC failed",Ce),alert("Failed to create AMC contract")}finally{re(!1)}};return h?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Qe,{className:"w-8 h-8 animate-spin text-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"AMC Contracts"}),e.jsx("p",{className:"text-gray-600",children:"Manage Annual Maintenance Contracts and 6-month service schedules"})]}),e.jsxs(q,{onClick:()=>_(!0),children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"New Contract"]})]}),i&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(te,{children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium",children:"Total Contracts"}),e.jsx(Oe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i.totalContracts}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.activeContracts," active, ",i.expiredContracts," expired"]})]})]}),e.jsxs(te,{children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium",children:"Active Contracts"}),e.jsx(Be,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:i.activeContracts}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.expiringSoon," expiring soon"]})]})]}),e.jsxs(te,{children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium",children:"Service Status"}),e.jsx(Ye,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:i.upcomingServices}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.overdueServices," overdue services"]})]})]}),e.jsxs(te,{children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(de,{className:"text-sm font-medium",children:"Contract Value"}),e.jsx(Fl,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:be(i.revenue.totalValue)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[be(i.revenue.pendingValue)," pending"]})]})]})]}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{children:"Filters"})}),e.jsx(se,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(vs,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(k,{placeholder:"Search contracts, customers, or projectors...",value:j,onChange:W=>P(W.target.value),className:"pl-10"})]})}),e.jsxs(ye,{value:v,onValueChange:x,children:[e.jsx(ke,{className:"w-full sm:w-48",children:e.jsx(Ne,{placeholder:"Filter by status"})}),e.jsxs(we,{children:[e.jsx(I,{value:"all",children:"All Statuses"}),e.jsx(I,{value:"Active",children:"Active"}),e.jsx(I,{value:"Expired",children:"Expired"}),e.jsx(I,{value:"Suspended",children:"Suspended"}),e.jsx(I,{value:"Terminated",children:"Terminated"})]})]})]})})]}),Y.size>0&&e.jsxs(te,{className:"border-blue-200 bg-blue-50",children:[e.jsx(oe,{children:e.jsxs(de,{className:"text-blue-900 flex items-center gap-2",children:[e.jsx(mt,{className:"w-5 h-5"}),"Bulk Operations (",Y.size," contracts selected)"]})}),e.jsx(se,{children:e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(q,{variant:"outline",size:"sm",onClick:()=>F(!0),className:"border-blue-300 text-blue-700 hover:bg-blue-100",children:[e.jsx(Rl,{className:"w-4 h-4 mr-2"}),"Update Dates"]}),e.jsxs(q,{variant:"outline",size:"sm",onClick:()=>T(!0),className:"border-green-300 text-green-700 hover:bg-green-100",children:[e.jsx(Ml,{className:"w-4 h-4 mr-2"}),"Schedule Services"]}),e.jsxs(q,{variant:"outline",size:"sm",onClick:()=>g(!0),className:"border-purple-300 text-purple-700 hover:bg-purple-100",children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Renew Contracts"]}),e.jsx(q,{variant:"ghost",size:"sm",onClick:()=>O(new Set),className:"text-gray-600 hover:text-gray-800",children:"Clear Selection"})]})})]}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(de,{children:["Contracts (",a.length,")"]}),Y.size>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-700",children:[e.jsxs("span",{children:[Y.size," selected"]}),e.jsx("div",{className:"h-4 w-px bg-blue-300"}),e.jsx(q,{variant:"ghost",size:"sm",onClick:()=>O(new Set),className:"text-blue-700 hover:text-blue-800 p-1 h-6",children:"Clear"})]})]})}),e.jsx(se,{children:e.jsxs(Ds,{children:[e.jsx(Rs,{children:e.jsxs(He,{children:[e.jsx(fe,{className:"w-12",children:e.jsx(Ht,{checked:Y.size===a.length&&a.length>0,onCheckedChange:Z})}),e.jsx(fe,{children:"Contract"}),e.jsx(fe,{children:"Customer"}),e.jsx(fe,{children:"Projector"}),e.jsx(fe,{children:"Period"}),e.jsx(fe,{children:"First Service"}),e.jsx(fe,{children:"Second Service"}),e.jsx(fe,{children:"Status"}),e.jsx(fe,{children:"Value"}),e.jsx(fe,{children:"Actions"})]})}),e.jsx(Es,{children:a.map(W=>e.jsxs(He,{children:[e.jsx(je,{children:e.jsx(Ht,{checked:Y.has(W._id),onCheckedChange:ve=>C(W._id,ve)})}),e.jsx(je,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:W.contractNumber}),e.jsxs("div",{className:"text-sm text-gray-500",children:[ae(W.contractStartDate)," - ",ae(W.contractEndDate)]})]})}),e.jsx(je,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:W.customerName}),e.jsx("div",{className:"text-sm text-gray-500",children:W.customerSite})]})}),e.jsx(je,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:W.projectorSerial}),e.jsxs("div",{className:"text-sm text-gray-500",children:[W.projectorBrand," ",W.projectorModel]})]})}),e.jsx(je,{children:e.jsxs("div",{className:"text-sm",children:[W.contractDuration," months"]})}),e.jsx(je,{children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",children:ae(W.serviceSchedule.firstService.scheduledDate)}),H(W.serviceSchedule.firstService.status)]})}),e.jsx(je,{children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",children:ae(W.serviceSchedule.secondService.scheduledDate)}),H(W.serviceSchedule.secondService.status)]})}),e.jsx(je,{children:r(W.status)}),e.jsxs(je,{children:[e.jsx("div",{className:"font-medium",children:be(W.contractValue)}),e.jsx("div",{className:"text-sm text-gray-500",children:W.paymentStatus})]}),e.jsx(je,{children:e.jsx(q,{variant:"outline",size:"sm",onClick:()=>E(W),children:"View"})})]},W._id))})]})})]}),e.jsx(ps,{open:!!S,onOpenChange:()=>E(null),children:e.jsxs(gs,{className:"max-w-4xl",children:[e.jsx(js,{children:e.jsxs(bs,{children:["Contract Details - ",S==null?void 0:S.contractNumber]})}),S&&e.jsxs(Dr,{defaultValue:"overview",className:"w-full",children:[e.jsxs(Rr,{children:[e.jsx(Ws,{value:"overview",children:"Overview"}),e.jsx(Ws,{value:"services",children:"Services"}),e.jsx(Ws,{value:"financial",children:"Financial"}),e.jsx(Ws,{value:"history",children:"History"})]}),e.jsx(qs,{value:"overview",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Customer Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",S.customerName]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Site:"})," ",S.customerSite]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Projector Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Serial:"})," ",S.projectorSerial]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Model:"})," ",S.projectorBrand," ",S.projectorModel]})]})]})]})}),e.jsxs(qs,{value:"services",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{className:"text-lg",children:"First Service (6 months)"})}),e.jsx(se,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Scheduled:"})," ",ae(S.serviceSchedule.firstService.scheduledDate)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",H(S.serviceSchedule.firstService.status)]}),S.serviceSchedule.firstService.actualDate&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Completed:"})," ",ae(S.serviceSchedule.firstService.actualDate)]})]})})]}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{className:"text-lg",children:"Second Service (12 months)"})}),e.jsx(se,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Scheduled:"})," ",ae(S.serviceSchedule.secondService.scheduledDate)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",H(S.serviceSchedule.secondService.status)]}),S.serviceSchedule.secondService.actualDate&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Completed:"})," ",ae(S.serviceSchedule.secondService.actualDate)]})]})})]})]}),S.nextServiceDue&&e.jsx(te,{className:"bg-blue-50",children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ye,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-blue-900",children:"Next Service Due"}),e.jsxs("div",{className:"text-sm text-blue-700",children:[S.nextServiceDue.service," - ",ae(S.nextServiceDue.date),S.nextServiceDue.daysUntil>0&&e.jsxs("span",{children:[" (in ",S.nextServiceDue.daysUntil," days)"]})]})]})]})})}),S.overdueServices.length>0&&e.jsx(te,{className:"bg-red-50",children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-red-900",children:"Overdue Services"}),S.overdueServices.map((W,ve)=>e.jsxs("div",{className:"text-sm text-red-700",children:[W.service," - ",ae(W.scheduledDate)," (",W.daysOverdue," days overdue)"]},ve))]})]})})})]}),e.jsx(qs,{value:"financial",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{className:"text-lg",children:"Contract Value"})}),e.jsxs(se,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:be(S.contractValue)}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Duration: ",S.contractDuration," months"]})]})]}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{className:"text-lg",children:"Payment Status"})}),e.jsx(se,{children:e.jsx(ge,{className:S.paymentStatus==="Paid"?"bg-green-100 text-green-800":S.paymentStatus==="Partial"||S.paymentStatus==="Pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800",children:S.paymentStatus})})]})]})}),e.jsx(qs,{value:"history",className:"space-y-4",children:e.jsx("div",{className:"text-sm text-gray-600",children:"Contract history will be displayed here when implemented."})})]})]})}),e.jsx(ps,{open:V,onOpenChange:_,children:e.jsxs(gs,{className:"max-w-2xl",children:[e.jsx(js,{children:e.jsx(bs,{children:"Create New AMC Contract"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{children:"Customer Name"}),e.jsx(k,{value:K.customerName,onChange:W=>ne({...K,customerName:W.target.value}),placeholder:"Customer name"})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Contract Manager"}),e.jsx(k,{value:K.contractManager,onChange:W=>ne({...K,contractManager:W.target.value}),placeholder:"Manager name"})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Site"}),e.jsxs(ye,{value:K.siteId,onValueChange:W=>ne({...K,siteId:W,projectorId:""}),children:[e.jsx(ke,{children:e.jsx(Ne,{placeholder:"Select site"})}),e.jsx(we,{children:b.map(W=>e.jsx(I,{value:W._id,children:W.name},W._id))})]})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Projector"}),e.jsxs(ye,{value:K.projectorId,onValueChange:W=>ne({...K,projectorId:W}),children:[e.jsx(ke,{disabled:!K.siteId,children:e.jsx(Ne,{placeholder:K.siteId?"Select projector":"Select site first"})}),e.jsx(we,{children:me.map(W=>e.jsxs(I,{value:W._id,children:[W.serialNumber," ",W.brand?`- ${W.brand}`:""," ",W.model?W.model:""]},W._id))})]}),!K.siteId&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Select a site to see its projectors."})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Assigned FSE (optional)"}),e.jsxs(ye,{value:K.fseId,onValueChange:W=>ne({...K,fseId:W}),children:[e.jsx(ke,{children:e.jsx(Ne,{placeholder:"Select FSE"})}),e.jsx(we,{children:u.map(W=>e.jsx(I,{value:W._id,children:W.fseName},W._id))})]})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Contract Value"}),e.jsx(k,{type:"number",min:0,value:K.contractValue,onChange:W=>ne({...K,contractValue:Number(W.target.value)})})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Payment Status"}),e.jsxs(ye,{value:K.paymentStatus,onValueChange:W=>ne({...K,paymentStatus:W}),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"Paid",children:"Paid"}),e.jsx(I,{value:"Partial",children:"Partial"}),e.jsx(I,{value:"Pending",children:"Pending"}),e.jsx(I,{value:"Overdue",children:"Overdue"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Start Date"}),e.jsx(k,{type:"date",value:K.contractStartDate,onChange:W=>ne({...K,contractStartDate:W.target.value})})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Duration (months)"}),e.jsxs(ye,{value:String(K.contractDuration),onValueChange:W=>ne({...K,contractDuration:Number(W)}),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"6",children:"6"}),e.jsx(I,{value:"12",children:"12"}),e.jsx(I,{value:"18",children:"18"}),e.jsx(I,{value:"24",children:"24"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{children:"End Date"}),e.jsx(k,{type:"date",value:K.contractEndDate,onChange:W=>ne({...K,contractEndDate:W.target.value})}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Auto-calculated from start date and duration. You can override if needed."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(q,{variant:"outline",onClick:()=>_(!1),children:"Cancel"}),e.jsx(q,{onClick:Pe,disabled:z,className:"bg-blue-600 hover:bg-blue-700",children:z?"Creating...":"Create Contract"})]})]})}),e.jsx(ps,{open:R,onOpenChange:F,children:e.jsxs(gs,{className:"max-w-md",children:[e.jsx(js,{children:e.jsx(bs,{children:"Bulk Update Contract Dates"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"bulkStartDate",children:"Contract Start Date"}),e.jsx(k,{id:"bulkStartDate",type:"date",value:p,onChange:W=>M(W.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"bulkEndDate",children:"Contract End Date"}),e.jsx(k,{id:"bulkEndDate",type:"date",value:m,onChange:W=>d(W.target.value),required:!0})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["This will update ",Y.size," selected contracts with the new start and end dates."]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(q,{variant:"outline",onClick:()=>F(!1),disabled:B,children:"Cancel"}),e.jsx(q,{onClick:f,disabled:!p||!m||B,className:"bg-blue-600 hover:bg-blue-700",children:B?"Updating...":"Update Dates"})]})]})]})}),e.jsx(ps,{open:J,onOpenChange:T,children:e.jsxs(gs,{className:"max-w-md",children:[e.jsx(js,{children:e.jsx(bs,{children:"Bulk Schedule Services"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["This will automatically schedule the first service at 6 months and second service at 12 months from each contract's start date for ",Y.size," selected contracts."]}),e.jsx("div",{className:"bg-blue-50 p-3 rounded-md",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("div",{children:"• First Service: 6 months from contract start"}),e.jsx("div",{children:"• Second Service: 12 months from contract start"}),e.jsx("div",{children:"• Service dates will be automatically calculated"})]})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(q,{variant:"outline",onClick:()=>T(!1),disabled:B,children:"Cancel"}),e.jsx(q,{onClick:he,disabled:B,className:"bg-green-600 hover:bg-green-700",children:B?"Scheduling...":"Schedule Services"})]})]})]})}),e.jsx(ps,{open:w,onOpenChange:g,children:e.jsxs(gs,{className:"max-w-md",children:[e.jsx(js,{children:e.jsx(bs,{children:"Bulk Renew Contracts"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"bulkRenewalPeriod",children:"Renewal Period (months)"}),e.jsxs(ye,{value:X.toString(),onValueChange:W=>ee(parseInt(W)),children:[e.jsx(ke,{children:e.jsx(Ne,{})}),e.jsxs(we,{children:[e.jsx(I,{value:"6",children:"6 months"}),e.jsx(I,{value:"12",children:"12 months"}),e.jsx(I,{value:"18",children:"18 months"}),e.jsx(I,{value:"24",children:"24 months"})]})]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["This will renew ",Y.size," selected contracts for the specified period. New contracts will be created with updated dates and service schedules."]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(q,{variant:"outline",onClick:()=>g(!1),disabled:B,children:"Cancel"}),e.jsx(q,{onClick:pe,disabled:B,className:"bg-purple-600 hover:bg-purple-700",children:B?"Renewing...":"Renew Contracts"})]})]})]})})]})}function dc(){const{user:s,token:t,logout:a}=ws(),[l,i]=n.useState(null),[o,h]=n.useState([]),[c,j]=n.useState(!0),[P,v]=n.useState(null);n.useEffect(()=>{if(!t){v("Authentication required. Please log in again."),j(!1);return}ie.setAuthToken(t),x()},[t]);const x=async()=>{var b,N;try{if(j(!0),v(null),!t){v("Authentication required. Please log in again.");return}ie.setAuthToken(t);const[y,A]=await Promise.all([ie.getFSEAnalytics(),ie.getDetailedServiceReports(50,0)]);i(y.data),h(A.data||[])}catch(y){console.error("Error loading analytics data:",y),(b=y.message)!=null&&b.includes("Access token required")||(N=y.message)!=null&&N.includes("Unauthorized")?(v("Your session has expired. Please log in again."),a()):v(y.message||"Failed to load analytics data")}finally{j(!1)}},S=(l==null?void 0:l.fsePerformance.reduce((b,N)=>b+N.totalReports,0))||0,E=l!=null&&l.fsePerformance.length?Math.round(l.fsePerformance.reduce((b,N)=>b+N.avgCompletionTime,0)/l.fsePerformance.length*10)/10:0,V=l!=null&&l.fsePerformance.length?Math.round(l.fsePerformance.reduce((b,N)=>b+N.avgSatisfaction,0)/l.fsePerformance.length*10)/10:0,_=(l==null?void 0:l.fsePerformance.reduce((b,N)=>b+N.totalIssues,0))||0;return c?e.jsx("div",{className:"flex-1 overflow-auto p-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ft,{})})}):P?e.jsx("div",{className:"flex-1 overflow-auto p-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Te,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Data"}),e.jsx("p",{className:"text-gray-600 mb-4",children:P}),e.jsx(q,{onClick:x,variant:"outline",children:"Try Again"})]})})}):e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"FSE Service Report Analytics"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Comprehensive analysis of Field Service Engineer performance and service reports"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(q,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(vt,{className:"w-4 h-4"}),"Filters"]}),e.jsxs(q,{size:"sm",className:"gap-2 bg-mint-600 hover:bg-mint-700",onClick:()=>{var N;const b=Ss(o);Cs(b,`fse_service_report_analytics_${new Date().toISOString().split("T")[0]}.csv`),(N=window.showToast)==null||N.call(window,{type:"success",title:"Export Successful",message:"FSE service report analytics exported to CSV file"})},children:[e.jsx(We,{className:"w-4 h-4"}),"Export Report"]})]})]})}),e.jsxs("main",{className:"flex-1 overflow-auto p-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(te,{className:"rounded-xl border-0 shadow-sm bg-white",children:e.jsxs(se,{className:"p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900 mb-1",children:(l==null?void 0:l.fsePerformance.length)||0}),e.jsx("div",{className:"text-sm text-gray-500",children:"Active FSEs"})]})}),e.jsx(te,{className:"rounded-xl border-0 shadow-sm bg-white",children:e.jsxs(se,{className:"p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-mint-600 mb-1",children:S}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Service Reports"})]})}),e.jsx(te,{className:"rounded-xl border-0 shadow-sm bg-white",children:e.jsxs(se,{className:"p-6 text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-blue-600 mb-1",children:[E,"h"]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Avg Completion Time"})]})}),e.jsx(te,{className:"rounded-xl border-0 shadow-sm bg-white",children:e.jsxs(se,{className:"p-6 text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-purple-600 mb-1",children:[V,"/5"]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Avg Customer Satisfaction"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[e.jsxs(te,{className:"rounded-xl border-0 shadow-sm bg-white",children:[e.jsxs(oe,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"w-5 h-5 text-blue-600"}),"Daily Service Trends"]}),e.jsx(Re,{children:"Service reports and completion time trends over time"})]}),e.jsx(se,{children:e.jsx("div",{className:"h-80",children:e.jsx(Ls,{width:"100%",height:"100%",children:e.jsxs(Nl,{data:(l==null?void 0:l.dailyTrends)||[],margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(nt,{strokeDasharray:"3 3",stroke:"#f1f5f9"}),e.jsx(it,{dataKey:"date",stroke:"#64748b",fontSize:12,tickLine:!1,axisLine:!1}),e.jsx(ct,{stroke:"#64748b",fontSize:12,tickLine:!1,axisLine:!1}),e.jsx(Os,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"12px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)"}}),e.jsx(Dt,{}),e.jsx(da,{type:"monotone",dataKey:"reports",stroke:"#3b82f6",strokeWidth:3,dot:{fill:"#3b82f6",strokeWidth:2,r:4},name:"Service Reports"}),e.jsx(da,{type:"monotone",dataKey:"avgTime",stroke:"#10b981",strokeWidth:3,dot:{fill:"#10b981",strokeWidth:2,r:4},name:"Avg Time (hours)"})]})})})})]}),e.jsxs(te,{className:"rounded-xl border-0 shadow-sm bg-white",children:[e.jsxs(oe,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx($s,{className:"w-5 h-5 text-green-600"}),"Service Type Distribution"]}),e.jsx(Re,{children:"Breakdown of different types of service reports"})]}),e.jsx(se,{children:e.jsx("div",{className:"h-80",children:e.jsx(Ls,{width:"100%",height:"100%",children:e.jsxs(Jt,{children:[e.jsx(Zt,{data:(l==null?void 0:l.serviceTypeDistribution)||[],cx:"50%",cy:"50%",labelLine:!1,label:({type:b,percent:N})=>`${b} ${(N*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"count",children:((l==null?void 0:l.serviceTypeDistribution)||[]).map((b,N)=>e.jsx(Xt,{fill:mc(b.type)},`cell-${N}`))}),e.jsx(Os,{})]})})})})]})]}),e.jsxs(te,{className:"rounded-xl border-0 shadow-sm bg-white mb-8",children:[e.jsxs(oe,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(as,{className:"w-5 h-5 text-blue-600"}),"FSE Performance Analysis"]}),e.jsx(Re,{children:"Detailed performance metrics for each Field Service Engineer"})]}),e.jsx(se,{children:e.jsxs(Ds,{children:[e.jsx(Rs,{children:e.jsxs(He,{className:"border-gray-200",children:[e.jsx(fe,{className:"font-semibold text-gray-700",children:"FSE Name"}),e.jsx(fe,{className:"font-semibold text-gray-700 text-right",children:"Total Reports"}),e.jsx(fe,{className:"font-semibold text-gray-700 text-right",children:"Avg Time (hrs)"}),e.jsx(fe,{className:"font-semibold text-gray-700 text-right",children:"Satisfaction"}),e.jsx(fe,{className:"font-semibold text-gray-700 text-right",children:"Efficiency %"}),e.jsx(fe,{className:"font-semibold text-gray-700 text-right",children:"Action"})]})}),e.jsx(Es,{children:l==null?void 0:l.fsePerformance.map((b,N)=>e.jsxs(He,{className:"border-gray-100 hover:bg-gray-50/50 transition-colors",children:[e.jsx(je,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(as,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:b.fseName})]})}),e.jsx(je,{className:"text-right",children:e.jsx(ge,{variant:"secondary",className:"font-medium bg-blue-100 text-blue-700",children:b.totalReports})}),e.jsx(je,{className:"text-right",children:e.jsx("span",{className:"font-medium text-gray-900",children:b.avgCompletionTime})}),e.jsx(je,{className:"text-right",children:e.jsxs("span",{className:"font-medium text-green-600",children:[b.avgSatisfaction,"/5"]})}),e.jsx(je,{className:"text-right",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_r,{value:b.efficiency,className:"w-16 h-2"}),e.jsxs("span",{className:"font-medium text-purple-600",children:[b.efficiency,"%"]})]})}),e.jsx(je,{className:"text-right",children:e.jsxs(q,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(es,{className:"w-4 h-4"}),"View Details"]})})]},N))})]})})]}),e.jsxs(te,{className:"rounded-xl border-0 shadow-sm bg-white mb-8",children:[e.jsxs(oe,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"w-5 h-5 text-blue-600"}),"Detailed Service Reports Analysis"]}),e.jsx(Re,{children:"Comprehensive breakdown of daily service reports and performance metrics"})]}),e.jsx(se,{children:e.jsxs(Ds,{children:[e.jsx(Rs,{children:e.jsxs(He,{className:"border-gray-200",children:[e.jsx(fe,{className:"font-semibold text-gray-700",children:"Date"}),e.jsx(fe,{className:"font-semibold text-gray-700",children:"FSE Name"}),e.jsx(fe,{className:"font-semibold text-gray-700",children:"Site"}),e.jsx(fe,{className:"font-semibold text-gray-700",children:"Service Type"}),e.jsx(fe,{className:"font-semibold text-gray-700",children:"Status"}),e.jsx(fe,{className:"font-semibold text-gray-700",children:"Completion Time"}),e.jsx(fe,{className:"font-semibold text-gray-700",children:"Satisfaction"}),e.jsx(fe,{className:"font-semibold text-gray-700",children:"Issues Found"}),e.jsx(fe,{className:"font-semibold text-gray-700",children:"Action"})]})}),e.jsx(Es,{children:o.map((b,N)=>e.jsxs(He,{className:"border-gray-100 hover:bg-gray-50/50 transition-colors",children:[e.jsx(je,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:new Date(b.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]})}),e.jsx(je,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(as,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"font-medium",children:b.fseName})]})}),e.jsx(je,{children:e.jsx("span",{className:"font-medium text-gray-700",children:b.siteName})}),e.jsx(je,{children:e.jsx(ge,{variant:"secondary",className:`font-medium ${b.reportType==="Emergency"?"bg-red-100 text-red-700":b.reportType==="First"?"bg-blue-100 text-blue-700":b.reportType==="Second"?"bg-green-100 text-green-700":"bg-orange-100 text-orange-700"}`,children:b.reportType})}),e.jsx(je,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Be,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 font-medium",children:b.serviceStatus})]})}),e.jsx(je,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ts,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"font-medium",children:[b.completionTime,"h"]})]})}),e.jsx(je,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(y=>e.jsx("span",{className:`text-sm ${y<=b.customerSatisfaction?"text-yellow-400":"text-gray-300"}`,children:"★"},y))}),e.jsx("span",{className:"font-medium text-gray-700",children:b.customerSatisfaction})]})}),e.jsx(je,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{className:"w-4 h-4 text-orange-500"}),e.jsx(ge,{variant:"secondary",className:"font-medium bg-orange-100 text-orange-700",children:b.issuesFound})]})}),e.jsx(je,{children:e.jsxs(q,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(es,{className:"w-4 h-4"}),"View"]})})]},N))})]})})]}),e.jsx(te,{className:"rounded-xl border-0 shadow-sm bg-gradient-to-r from-mint-50 to-mint-100",children:e.jsx(se,{className:"p-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-mint-100 flex items-center justify-center",children:e.jsx(ns,{className:"w-6 h-6 text-mint-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-mint-900 mb-1",children:"FSE Performance Insights"}),e.jsxs("p",{className:"text-sm text-mint-700",children:["Your FSE team completed ",S," service reports with an average completion time of ",E," hours and customer satisfaction of ",V,"/5"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-mint-900",children:_}),e.jsx("div",{className:"text-sm text-mint-700",children:"Total Issues Found"})]})]})})})]})]})}const mc=s=>{switch(s){case"First":return"#3b82f6";case"Second":return"#10b981";case"Third":return"#f59e0b";case"Emergency":return"#ef4444";case"Installation":return"#8b5cf6";default:return"#6b7280"}};function xc(){const{user:s,token:t,logout:a}=ws(),[l,i]=n.useState([]),[o,h]=n.useState(!0),[c,j]=n.useState(""),[P,v]=n.useState("all"),[x,S]=n.useState("all"),[E,V]=n.useState("all");n.useState("all");const[_,b]=n.useState("table"),[N,y]=n.useState(new Set),[A,u]=n.useState(new Set),[$,z]=n.useState({totalReports:0,todayReports:0,monthlyReports:0,reportTypes:[]});n.useEffect(()=>{if(!t){console.error("No authentication token found");return}ie.setAuthToken(t),re(),K()},[t]);const re=async()=>{var p;try{h(!0),console.log("=== LOADING SERVICE REPORTS ==="),console.log("Loading service reports..."),console.log("Testing direct fetch...");try{const m=await fetch("http://localhost:4000/api/service-reports");console.log("Direct fetch status:",m.status);const d=await m.json();console.log("Direct fetch data:",d),console.log("Direct fetch data length:",d==null?void 0:d.length)}catch(m){console.error("Direct fetch error:",m)}const M=await ie.getAllServiceReports();console.log("Service reports response:",M),console.log("Response type:",typeof M),console.log("Response keys:",Object.keys(M||{})),console.log("Reports data:",M.data),console.log("Reports data type:",typeof M.data),console.log("Number of reports:",((p=M.data)==null?void 0:p.length)||0),M&&M.data?(console.log("Setting reports:",M.data),i(M.data)):Array.isArray(M)?(console.log("Response is array, setting directly:",M),i(M)):(console.log("No valid data found in response"),i([]))}catch(M){console.error("Error loading reports:",M),console.error("Error details:",{message:M==null?void 0:M.message,stack:M==null?void 0:M.stack,name:M==null?void 0:M.name})}finally{h(!1)}},K=async()=>{try{console.log("=== LOADING DASHBOARD STATS ==="),console.log("Testing direct fetch for stats...");try{const M=await fetch("http://localhost:4000/api/service-reports/stats/dashboard");console.log("Direct fetch stats status:",M.status);const m=await M.json();console.log("Direct fetch stats data:",m)}catch(M){console.error("Direct fetch stats error:",M)}const p=await ie.getServiceReportDashboardStats();console.log("Dashboard stats response:",p),console.log("Stats data:",p.data),z(p.data||{})}catch(p){console.error("Error loading stats:",p),console.error("Stats error details:",{message:p==null?void 0:p.message,stack:p==null?void 0:p.stack,name:p==null?void 0:p.name})}},ne=l.filter(p=>{const M=p.reportNumber.toLowerCase().includes(c.toLowerCase())||p.siteName.toLowerCase().includes(c.toLowerCase())||p.projectorSerial.toLowerCase().includes(c.toLowerCase())||p.engineer.name.toLowerCase().includes(c.toLowerCase()),m=P==="all"||p.reportType===P,d=x==="all"||p.siteName===x,X=E==="all"||p.engineer.name===E;return M&&m&&d&&X}),Y=p=>({First:"bg-blue-100 text-blue-800",Second:"bg-green-100 text-green-800",Third:"bg-yellow-100 text-yellow-800",Fourth:"bg-purple-100 text-purple-800",Emergency:"bg-red-100 text-red-800",Installation:"bg-indigo-100 text-indigo-800"})[p]||"bg-gray-100 text-gray-800",O=p=>{switch(p){case"OK":return"text-green-600";case"FAIL":return"text-red-600";case"REPLACE":return"text-orange-600";default:return"text-gray-600"}},R=p=>{const M=new Set(N);M.has(p)?M.delete(p):M.add(p),y(M)},F=p=>{const M=new Set(A);M.has(p)?M.delete(p):M.add(p),u(M)},J=()=>{A.size===ne.length?u(new Set):u(new Set(ne.map(p=>p._id)))},T=async()=>{for(const p of A)try{const M=await ie.getServiceReport(p);lt(M)}catch(M){console.error(`Error exporting report ${p}:`,M)}},w=p=>{var d,X,ee,B,ce;const M=N.has(p._id),m=A.has(p._id);return e.jsxs(Gt.Fragment,{children:[e.jsxs(He,{className:`hover:bg-gray-50 ${m?"bg-blue-50":""}`,children:[e.jsx(je,{children:e.jsx("input",{type:"checkbox",checked:m,onChange:()=>F(p._id),className:"rounded border-gray-300"})}),e.jsx(je,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{variant:"ghost",size:"sm",onClick:()=>R(p._id),className:"h-6 w-6 p-0",children:M?e.jsx(Ba,{className:"h-4 w-4"}):e.jsx(ea,{className:"h-4 w-4"})}),p.reportNumber]})}),e.jsx(je,{children:e.jsx(ge,{className:Y(p.reportType),children:p.reportType})}),e.jsx(je,{children:p.siteName}),e.jsx(je,{children:p.projectorModel}),e.jsx(je,{children:p.projectorSerial}),e.jsx(je,{children:p.engineer.name}),e.jsx(je,{children:new Date(p.date).toLocaleDateString()}),e.jsx(je,{children:e.jsx("div",{className:"flex gap-1",children:e.jsxs("span",{className:`px-2 py-1 rounded text-xs ${O(p.sections.opticals.filter(me=>me.result==="OK").length===p.sections.opticals.length?"OK":"FAIL")}`,children:[p.sections.opticals.filter(me=>me.result==="OK").length,"/",p.sections.opticals.length]})})}),e.jsx(je,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{variant:"outline",size:"sm",onClick:()=>window.location.hash=`#/service-reports/${p._id}?readonly=1`,children:e.jsx(es,{className:"h-4 w-4"})}),e.jsx(q,{variant:"outline",size:"sm",onClick:async()=>{var me;try{const L=await ie.getServiceReport(p._id);lt(L)}catch(L){console.error("Export failed",L),(me=window.showToast)==null||me.call(window,{type:"error",title:"Export",message:"Could not export report"})}},children:e.jsx(We,{className:"h-4 w-4"})})]})})]}),M&&e.jsx(He,{children:e.jsx(je,{colSpan:10,className:"bg-gray-50 p-0",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Projector Details"}),e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Model:"})," ",p.projectorModel]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Serial:"})," ",p.projectorSerial]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Software:"})," ",p.softwareVersion||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Hours:"})," ",p.projectorRunningHours||"N/A"]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Lamp Information"}),e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Model:"})," ",p.lampModel||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Hours:"})," ",p.lampRunningHours||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Current:"})," ",p.currentLampHours||"N/A"]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Voltage Parameters"}),e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"P vs N:"})," ",((d=p.voltageParameters)==null?void 0:d.pVsN)||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"P vs E:"})," ",((X=p.voltageParameters)==null?void 0:X.pVsE)||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"N vs E:"})," ",((ee=p.voltageParameters)==null?void 0:ee.nVsE)||"N/A"]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Lamp Power"}),e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Before PM:"})," ",((B=p.lampPowerMeasurements)==null?void 0:B.flBeforePM)||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"After PM:"})," ",((ce=p.lampPowerMeasurements)==null?void 0:ce.flAfterPM)||"N/A"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Opticals Check"}),e.jsx("div",{className:"space-y-2",children:p.sections.opticals.map((me,L)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:me.description}),e.jsx("span",{className:`font-medium ${O(me.result)}`,children:me.result||"N/A"})]},L))})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Electronics Check"}),e.jsx("div",{className:"space-y-2",children:p.sections.electronics.map((me,L)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:me.description}),e.jsx("span",{className:`font-medium ${O(me.result)}`,children:me.result||"N/A"})]},L))})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Mechanical Check"}),e.jsx("div",{className:"space-y-2",children:p.sections.mechanical.map((me,L)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:me.description}),e.jsx("span",{className:`font-medium ${O(me.result)}`,children:me.result||"N/A"})]},L))})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Image Evaluation"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm",children:p.imageEvaluation&&Object.entries(p.imageEvaluation).map(([me,L])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"capitalize",children:[me.replace(/([A-Z])/g," $1").trim(),":"]}),e.jsx("span",{className:`font-medium ${O(L)}`,children:L||"N/A"})]},me))})]}),(p.airPollutionLevel||p.environmentalConditions)&&e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Environmental Conditions"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[p.airPollutionLevel&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Air Quality:"})," ",p.airPollutionLevel.overall||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"HCHO:"})," ",p.airPollutionLevel.hcho||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"TVOC:"})," ",p.airPollutionLevel.tvoc||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"PM2.5:"})," ",p.airPollutionLevel.pm25||"N/A"]})]}),p.environmentalConditions&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Temperature:"})," ",p.environmentalConditions.temperature||"N/A","°C"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Humidity:"})," ",p.environmentalConditions.humidity||"N/A","%"]})]})]})]}),p.observations&&p.observations.length>0&&e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Observations"}),e.jsx("div",{className:"space-y-2 text-sm",children:p.observations.map((me,L)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-medium",children:[me.number||L+1,"."]}),e.jsx("span",{children:typeof me=="string"?me:me.description||""})]},L))})]})]})})})]},p._id)},g=()=>{const p=$.reportTypes||[],M=Array.from(new Set(l.map(m=>m.siteName))).map(m=>({site:m,count:l.filter(d=>d.siteName===m).length}));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(te,{children:e.jsx(se,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Oe,{className:"h-8 w-8 text-blue-600 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Reports"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:$.totalReports})]})]})})}),e.jsx(te,{children:e.jsx(se,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ye,{className:"h-8 w-8 text-green-600 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Today's Reports"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:$.todayReports})]})]})})}),e.jsx(te,{children:e.jsx(se,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ts,{className:"h-8 w-8 text-purple-600 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"This Month"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:$.monthlyReports})]})]})})}),e.jsx(te,{children:e.jsx(se,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(As,{className:"h-8 w-8 text-orange-600 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Sites"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:M.length})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(Kl,{className:"h-5 w-5"}),"Report Types Distribution"]})}),e.jsx(se,{children:e.jsx("div",{className:"space-y-3",children:p.map(m=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:m._id}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-32 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${m.count/$.totalReports*100}%`}})}),e.jsx("span",{className:"text-sm text-gray-600",children:m.count})]})]},m._id))})})]}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx($s,{className:"h-5 w-5"}),"Reports by Site"]})}),e.jsx(se,{children:e.jsx("div",{className:"space-y-3",children:M.slice(0,5).map(m=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:m.site}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-32 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${m.count/Math.max(...M.map(d=>d.count))*100}%`}})}),e.jsx("span",{className:"text-sm text-gray-600",children:m.count})]})]},m.site))})})]})]})]})};return o?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading service reports..."})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Service Reports Analysis"}),e.jsx("p",{className:"text-gray-600",children:"Comprehensive analysis and management of FSE service reports"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Total Reports: ",$.totalReports," | Today: ",$.todayReports," | This Month: ",$.monthlyReports]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(q,{variant:"outline",onClick:()=>{console.log("Manual refresh triggered"),re(),K()},className:"gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),"Refresh Data"]}),A.size>0&&e.jsxs(q,{onClick:T,className:"gap-2",children:[e.jsx(We,{className:"h-4 w-4"}),"Export Selected (",A.size,")"]})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex border rounded-md",children:[e.jsxs(q,{variant:_==="table"?"default":"ghost",size:"sm",onClick:()=>b("table"),className:"rounded-r-none",children:[e.jsx(Yl,{className:"h-4 w-4 mr-2"}),"Table View"]}),e.jsxs(q,{variant:_==="cards"?"default":"ghost",size:"sm",onClick:()=>b("cards"),className:"rounded-l-none rounded-r-none",children:[e.jsx(Ol,{className:"h-4 w-4 mr-2"}),"Cards View"]}),e.jsxs(q,{variant:_==="analytics"?"default":"ghost",size:"sm",onClick:()=>b("analytics"),className:"rounded-l-none",children:[e.jsx($s,{className:"h-4 w-4 mr-2"}),"Analytics"]})]})})]}),_!=="analytics"&&e.jsx(te,{className:"mb-6",children:e.jsx(se,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(k,{placeholder:" reports by number, site, projector, or engineer...",value:c,onChange:p=>j(p.target.value),className:"w-full"})}),e.jsxs(ye,{value:P,onValueChange:v,children:[e.jsx(ke,{className:"w-48",children:e.jsx(Ne,{placeholder:"Report Type"})}),e.jsxs(we,{children:[e.jsx(I,{value:"all",children:"All Types"}),e.jsx(I,{value:"First",children:"First"}),e.jsx(I,{value:"Second",children:"Second"}),e.jsx(I,{value:"Third",children:"Third"}),e.jsx(I,{value:"Fourth",children:"Fourth"}),e.jsx(I,{value:"Emergency",children:"Emergency"}),e.jsx(I,{value:"Installation",children:"Installation"})]})]}),e.jsxs(ye,{value:x,onValueChange:S,children:[e.jsx(ke,{className:"w-48",children:e.jsx(Ne,{placeholder:"Site"})}),e.jsxs(we,{children:[e.jsx(I,{value:"all",children:"All Sites"}),Array.from(new Set(l.map(p=>p.siteName))).map(p=>e.jsx(I,{value:p,children:p},p))]})]}),e.jsxs(ye,{value:E,onValueChange:V,children:[e.jsx(ke,{className:"w-48",children:e.jsx(Ne,{placeholder:"Engineer"})}),e.jsxs(we,{children:[e.jsx(I,{value:"all",children:"All Engineers"}),Array.from(new Set(l.map(p=>p.engineer.name))).map(p=>e.jsx(I,{value:p,children:p},p))]})]})]})})}),!o&&l.length===0&&e.jsx(te,{className:"mb-6 border-orange-200 bg-orange-50",children:e.jsx(se,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Te,{className:"mx-auto h-12 w-12 text-orange-500 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-orange-900 mb-2",children:"No Service Reports Found"}),e.jsx("p",{className:"text-orange-700 mb-4",children:"No service reports are currently available. This could be due to:"}),e.jsxs("ul",{className:"text-sm text-orange-600 text-left max-w-md mx-auto space-y-1",children:[e.jsx("li",{children:"• No reports have been created yet"}),e.jsx("li",{children:"• Authentication issues preventing data access"}),e.jsx("li",{children:"• Database connection problems"}),e.jsx("li",{children:"• Reports are being filtered out"})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(q,{onClick:()=>{console.log("Debug: Reloading reports..."),re(),K()},variant:"outline",className:"gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),"Try Again"]})})]})})}),_==="analytics"?g():_==="table"?e.jsx(te,{children:e.jsxs(se,{className:"p-0",children:[e.jsx("div",{className:"p-4 border-b bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"checkbox",checked:A.size===ne.length&&ne.length>0,onChange:J,className:"rounded border-gray-300"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[A.size," of ",ne.length," reports selected"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",ne.length," reports"]})]})}),e.jsxs(Ds,{children:[e.jsx(Rs,{children:e.jsxs(He,{children:[e.jsx(fe,{className:"w-12",children:"Select"}),e.jsx(fe,{children:"Report #"}),e.jsx(fe,{children:"Type"}),e.jsx(fe,{children:"Site"}),e.jsx(fe,{children:"Projector Model"}),e.jsx(fe,{children:"Serial #"}),e.jsx(fe,{children:"Engineer"}),e.jsx(fe,{children:"Date"}),e.jsx(fe,{children:"Status"}),e.jsx(fe,{children:"Actions"})]})}),e.jsx(Es,{children:ne.map(p=>w(p))})]})]})}):e.jsx("div",{className:"space-y-4",children:ne.map(p=>e.jsx(te,{className:"hover:shadow-md transition-shadow",children:e.jsx(se,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:p.reportNumber}),e.jsx(ge,{className:Y(p.reportType),children:p.reportType}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(p.date).toLocaleDateString()})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(As,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:p.siteName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[p.projectorModel," - ",p.projectorSerial]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:p.engineer.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[p.sections.opticals.filter(M=>M.result==="OK").length,"/",p.sections.opticals.length," Opticals OK"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Opticals:"}),e.jsx("div",{className:"flex gap-1 mt-1",children:p.sections.opticals.map((M,m)=>e.jsx(Be,{className:`h-4 w-4 ${O(M.result)}`},m))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Electronics:"}),e.jsx("div",{className:"flex gap-1 mt-1",children:p.sections.electronics.map((M,m)=>e.jsx(Be,{className:`h-4 w-4 ${O(M.result)}`},m))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Mechanical:"}),e.jsx("div",{className:"flex gap-1 mt-1",children:p.sections.mechanical.map((M,m)=>e.jsx(Be,{className:`h-4 w-4 ${O(M.result)}`},m))})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsxs(q,{variant:"outline",size:"sm",onClick:()=>window.location.hash=`#/service-reports/${p._id}?readonly=1`,children:[e.jsx(es,{className:"h-4 w-4 mr-1"}),"View"]}),e.jsxs(q,{variant:"outline",size:"sm",onClick:async()=>{var M;try{const m=await ie.getServiceReport(p._id);lt(m)}catch(m){console.error("Export failed",m),(M=window.showToast)==null||M.call(window,{type:"error",title:"Export",message:"Could not export report"})}},children:[e.jsx(We,{className:"h-4 w-4 mr-1"}),"Export"]})]})]})})},p._id))}),ne.length===0&&e.jsx(te,{children:e.jsxs(se,{className:"p-12 text-center",children:[e.jsx(Oe,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No reports found"}),e.jsx("p",{className:"text-gray-600",children:c||P!=="all"||x!=="all"?"Try adjusting your search or filters":"No service reports available"})]})})]})})}function hc(){const[s,t]=n.useState(null),[a,l]=n.useState(!0),[i,o]=n.useState(null);n.useEffect(()=>{h()},[]);const h=async()=>{try{l(!0),o(null);const x=await ie.getFSEAnalytics();t(x.data)}catch(x){console.error("Error loading FSE analytics data:",x),o(x.message||"Failed to load FSE analytics data")}finally{l(!1)}},c=(s==null?void 0:s.dailyTrends.reduce((x,S)=>x+S.reports,0))||0,j=s!=null&&s.dailyTrends.length?Math.round(s.dailyTrends.reduce((x,S)=>x+S.avgTime,0)/s.dailyTrends.length*10)/10:0,P=s!=null&&s.dailyTrends.length?Math.round(s.dailyTrends.reduce((x,S)=>x+S.satisfaction,0)/s.dailyTrends.length*10)/10:0,v=(s==null?void 0:s.dailyTrends.reduce((x,S)=>x+S.issues,0))||0;return a?e.jsx("div",{className:"flex-1 overflow-auto p-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ft,{})})}):i?e.jsx("div",{className:"flex-1 overflow-auto p-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Te,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Data"}),e.jsx("p",{className:"text-gray-600 mb-4",children:i}),e.jsx(q,{onClick:h,variant:"outline",children:"Try Again"})]})})}):e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"FSE Service Analytics"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Comprehensive analysis of Field Service Engineer performance and service delivery"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(q,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(vt,{className:"w-4 h-4"}),"Filters"]}),e.jsxs(q,{size:"sm",className:"gap-2 bg-mint-600 hover:bg-mint-700",onClick:()=>{var S;const x=Ss((s==null?void 0:s.dailyTrends)||[]);Cs(x,`fse_service_analytics_${new Date().toISOString().split("T")[0]}.csv`),(S=window.showToast)==null||S.call(window,{type:"success",title:"Export Successful",message:"FSE service analytics exported to CSV file"})},children:[e.jsx(We,{className:"w-4 h-4"}),"Export Report"]})]})]})}),e.jsxs("main",{className:"flex-1 overflow-auto p-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(te,{className:"rounded-xl border-0 shadow-sm bg-white",children:e.jsxs(se,{className:"p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900 mb-1",children:(s==null?void 0:s.dailyTrends.length)||0}),e.jsx("div",{className:"text-sm text-gray-500",children:"Days Analyzed"})]})}),e.jsx(te,{className:"rounded-xl border-0 shadow-sm bg-white",children:e.jsxs(se,{className:"p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-mint-600 mb-1",children:c}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Services"})]})}),e.jsx(te,{className:"rounded-xl border-0 shadow-sm bg-white",children:e.jsxs(se,{className:"p-6 text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-blue-600 mb-1",children:[j,"h"]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Avg Service Time"})]})}),e.jsx(te,{className:"rounded-xl border-0 shadow-sm bg-white",children:e.jsxs(se,{className:"p-6 text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-purple-600 mb-1",children:[P,"/5"]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Avg Satisfaction"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[e.jsxs(te,{className:"rounded-xl border-0 shadow-sm bg-white",children:[e.jsxs(oe,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"w-5 h-5 text-blue-600"}),"Service Delivery Trends"]}),e.jsx(Re,{children:"Daily service completion and performance trends"})]}),e.jsx(se,{children:e.jsx("div",{className:"h-80",children:e.jsx(Ls,{width:"100%",height:"100%",children:e.jsxs(kl,{data:(s==null?void 0:s.dailyTrends)||[],margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(nt,{strokeDasharray:"3 3",stroke:"#f1f5f9"}),e.jsx(it,{dataKey:"date",stroke:"#64748b",fontSize:12,tickLine:!1,axisLine:!1}),e.jsx(ct,{stroke:"#64748b",fontSize:12,tickLine:!1,axisLine:!1}),e.jsx(Os,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"12px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)"}}),e.jsx(Dt,{}),e.jsx(ma,{type:"monotone",dataKey:"reports",stackId:"1",stroke:"#10b981",fill:"#10b981",fillOpacity:.8,name:"Services Completed"}),e.jsx(ma,{type:"monotone",dataKey:"issues",stackId:"1",stroke:"#f59e0b",fill:"#f59e0b",fillOpacity:.8,name:"Issues Found"})]})})})})]}),e.jsxs(te,{className:"rounded-xl border-0 shadow-sm bg-white",children:[e.jsxs(oe,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx($s,{className:"w-5 h-5 text-green-600"}),"Service Type Performance"]}),e.jsx(Re,{children:"Performance metrics by service type"})]}),e.jsx(se,{children:e.jsx("div",{className:"h-80",children:e.jsx(Ls,{width:"100%",height:"100%",children:e.jsxs(Yt,{data:(s==null?void 0:s.serviceTypeDistribution)||[],margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(nt,{strokeDasharray:"3 3",stroke:"#f1f5f9"}),e.jsx(it,{dataKey:"type",stroke:"#64748b",fontSize:10,tickLine:!1,axisLine:!1,angle:-45,textAnchor:"end"}),e.jsx(ct,{stroke:"#64748b",fontSize:12,tickLine:!1,axisLine:!1}),e.jsx(Os,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"12px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)"}}),e.jsx(Dt,{}),e.jsx(Js,{dataKey:"count",fill:"#3b82f6",name:"Service Count"}),e.jsx(Js,{dataKey:"avgTime",fill:"#10b981",name:"Avg Time (hrs)"})]})})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[e.jsxs(te,{className:"rounded-xl border-0 shadow-sm bg-white",children:[e.jsxs(oe,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(as,{className:"w-5 h-5 text-blue-600"}),"FSE Performance Overview"]}),e.jsx(Re,{children:"Field Service Engineer performance metrics"})]}),e.jsx(se,{children:e.jsxs(Ds,{children:[e.jsx(Rs,{children:e.jsxs(He,{className:"border-gray-200",children:[e.jsx(fe,{className:"font-semibold text-gray-700",children:"FSE Name"}),e.jsx(fe,{className:"font-semibold text-gray-700 text-right",children:"Services"}),e.jsx(fe,{className:"font-semibold text-gray-700 text-right",children:"Efficiency"}),e.jsx(fe,{className:"font-semibold text-gray-700 text-right",children:"Satisfaction"})]})}),e.jsx(Es,{children:s==null?void 0:s.fsePerformance.map((x,S)=>e.jsxs(He,{className:"border-gray-100 hover:bg-gray-50/50",children:[e.jsx(je,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(as,{className:"w-4 h-4 text-blue-500"}),e.jsx("div",{children:e.jsx("div",{className:"font-medium",children:x.fseName})})]})}),e.jsx(je,{className:"text-right",children:e.jsx(ge,{variant:"secondary",className:"font-medium bg-blue-100 text-blue-700",children:x.totalReports})}),e.jsx(je,{className:"text-right",children:e.jsxs(ge,{className:`font-medium ${uc(x.efficiency)}`,children:[x.efficiency,"%"]})}),e.jsx(je,{className:"text-right",children:e.jsxs("span",{className:"font-medium text-green-600",children:[x.avgSatisfaction,"/5"]})})]},S))})]})})]}),e.jsxs(te,{className:"rounded-xl border-0 shadow-sm bg-white",children:[e.jsxs(oe,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"w-5 h-5 text-green-600"}),"Top Performing Sites"]}),e.jsx(Re,{children:"Sites with highest service volume and satisfaction"})]}),e.jsx(se,{children:e.jsxs(Ds,{children:[e.jsx(Rs,{children:e.jsxs(He,{className:"border-gray-200",children:[e.jsx(fe,{className:"font-semibold text-gray-700",children:"Site Name"}),e.jsx(fe,{className:"font-semibold text-gray-700 text-right",children:"Services"}),e.jsx(fe,{className:"font-semibold text-gray-700 text-right",children:"Satisfaction"}),e.jsx(fe,{className:"font-semibold text-gray-700 text-right",children:"Last Visit"})]})}),e.jsx(Es,{children:s==null?void 0:s.topSites.map((x,S)=>e.jsxs(He,{className:"border-gray-100 hover:bg-gray-50/50",children:[e.jsx(je,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ds,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"font-medium",children:x.siteName})]})}),e.jsx(je,{className:"text-right",children:e.jsx(ge,{variant:"secondary",className:"font-medium",children:x.services})}),e.jsx(je,{className:"text-right",children:e.jsxs("span",{className:"font-medium text-green-600",children:[x.avgSatisfaction,"/5"]})}),e.jsx(je,{className:"text-right",children:e.jsx("span",{className:"text-sm text-gray-500",children:new Date(x.lastVisit).toLocaleDateString("en-US",{month:"short",day:"numeric"})})})]},S))})]})})]})]}),e.jsx(te,{className:"rounded-xl border-0 shadow-sm bg-gradient-to-r from-mint-50 to-mint-100",children:e.jsx(se,{className:"p-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-mint-100 flex items-center justify-center",children:e.jsx(ns,{className:"w-6 h-6 text-mint-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-mint-900 mb-1",children:"FSE Service Performance Insights"}),e.jsxs("p",{className:"text-sm text-mint-700",children:["Your FSE team completed ",c," services with an average completion time of ",j," hours and customer satisfaction of ",P,"/5"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-mint-900",children:v}),e.jsx("div",{className:"text-sm text-mint-700",children:"Total Issues Resolved"})]})]})})})]})]})}const uc=s=>s>=90?"bg-green-100 text-green-700":s>=80?"bg-blue-100 text-blue-700":s>=70?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700",pc=[{icon:$s,label:"Dashboard",active:!0},{icon:ds,label:"Sites"},{icon:ss,label:"Projectors"},{icon:Oe,label:"Purchase Orders"},{icon:Ns,label:"Bulk Upload"}],gc=[{icon:Ye,label:"Service Management"},{icon:rs,label:"Service Recommendations"},{icon:ot,label:"FSE Management"},{icon:Je,label:"Spare Parts"},{icon:ms,label:"RMA Management"},{icon:Te,label:"Daily Trouble Reports"},{icon:Tl,label:"Work Orders"},{icon:Oe,label:"AMC Contracts"}],jc=[{icon:ns,label:"Analytics"},{icon:Te,label:"Warranty Alerts"},{icon:Oe,label:"Reports"},{icon:Oe,label:"Service Reports Analysis"},{icon:$s,label:"FSE Analytics"}],bc=[{icon:ot,label:"User Management"},{icon:Tt,label:"Cloud Storage"},{icon:mt,label:"Settings"},{icon:as,label:"Profile"}];function vc(){var b;const[s,t]=n.useState("Dashboard"),[a,l]=n.useState(new Set),[i,o]=n.useState(null),{dashboardData:h}=Us(),{user:c,token:j,logout:P}=ws(),v=h.warrantyAlerts;n.useEffect(()=>{j&&ie.setAuthToken(j)},[j]),n.useEffect(()=>{const N=()=>{const y=window.location.hash.match(/#\/service-reports\/([^/?]+)/);o(y?y[1]:null)};return N(),window.addEventListener("hashchange",N),()=>window.removeEventListener("hashchange",N)},[]);const x=bc.filter(N=>!(N.label==="User Management"&&(c==null?void 0:c.role)!=="admin")),S=N=>{l(y=>new Set([...y,N]))},E=()=>{const N=v.map(y=>y.id);l(y=>new Set([...y,...N]))},V=(N,y)=>{const A=N.icon;return e.jsxs("button",{onClick:()=>t(N.label),className:`dark-nav-item w-full text-left ${y?"dark-nav-item-active":""}`,children:[e.jsx(A,{className:`w-5 h-5 ${y?"text-dark-primary":"text-dark-secondary"}`}),e.jsx("span",{children:N.label})]},N.label)},_=()=>{if(i)return e.jsx(Wr,{reportId:i});switch(s){case"Dashboard":return e.jsx(Ra,{});case"Sites":return e.jsx(Ri,{});case"Projectors":return e.jsx(Ei,{});case"Purchase Orders":return e.jsx(Ii,{});case"Bulk Upload":return e.jsx(qi,{});case"Service Management":return e.jsx(Oi,{});case"Service Recommendations":return e.jsx($i,{});case"FSE Management":return e.jsx(Ui,{});case"Spare Parts":return e.jsx(Bi,{});case"RMA Management":return e.jsx(zi,{});case"Daily Trouble Reports":return e.jsx(cc,{});case"AMC Contracts":return e.jsx(oc,{});case"Analytics":return e.jsx(_i,{});case"Reports":return e.jsx(dc,{});case"Service Reports Analysis":return e.jsx(xc,{});case"FSE Analytics":return e.jsx(hc,{});case"User Management":return e.jsx(Ki,{});case"Cloud Storage":return e.jsx(Wi,{});case"Settings":return e.jsx(Hi,{});default:return e.jsx(Ra,{})}};return e.jsxs("div",{className:"flex h-screen bg-dark-bg",style:{fontFamily:"Inter, system-ui, sans-serif"},children:[e.jsxs("div",{className:"w-72 bg-dark-bg border-r border-dark-color flex flex-col",children:[e.jsxs("div",{className:"p-8 border-b border-dark-color",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-600 to-blue-500 rounded-2xl flex items-center justify-center dark-shadow-lg relative overflow-hidden",children:e.jsx(ss,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-dark-primary",children:"ProjectorCare"}),e.jsx("p",{className:"text-xs text-dark-secondary font-medium",children:"Warranty Management System"})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-dark-color",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(as,{className:"w-4 h-4 text-dark-secondary"}),e.jsx("span",{className:"text-sm text-dark-secondary",children:((b=c==null?void 0:c.profile)==null?void 0:b.firstName)||(c==null?void 0:c.username)})]}),e.jsx(q,{onClick:P,variant:"ghost",size:"sm",className:"text-dark-secondary hover:text-dark-primary",children:e.jsx(za,{className:"w-4 h-4"})})]})})]}),e.jsxs("nav",{className:"flex-1 p-6 space-y-8 overflow-y-auto",children:[e.jsx("div",{className:"space-y-2",children:pc.map(N=>V(N,s===N.label))}),e.jsx(Ge,{style:{backgroundColor:"#374151"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"px-4",children:e.jsx("h3",{className:"text-xs font-bold text-dark-secondary uppercase tracking-widest",children:"Operations"})}),e.jsx("div",{className:"space-y-2",children:gc.map(N=>V(N,s===N.label))})]}),e.jsx(Ge,{style:{backgroundColor:"#374151"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"px-4",children:e.jsx("h3",{className:"text-xs font-bold text-dark-secondary uppercase tracking-widest",children:"Analytics"})}),e.jsx("div",{className:"space-y-2",children:jc.map(N=>V(N,s===N.label))})]}),e.jsx(Ge,{style:{backgroundColor:"#374151"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"px-4",children:e.jsx("h3",{className:"text-xs font-bold text-dark-secondary uppercase tracking-widest",children:"Other"})}),e.jsx("div",{className:"space-y-2",children:x.map(N=>V(N,s===N.label))})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col relative",children:[e.jsx(Fn,{notifications:v.filter(N=>!a.has(N.id)),onDismiss:S,onDismissAll:E}),e.jsx("div",{className:"flex-1 overflow-y-auto",style:{paddingTop:v.filter(N=>!a.has(N.id)).length>0?"60px":"0"},children:_()})]})]})}function fc({toast:s,onRemove:t}){const[a,l]=n.useState(!1);n.useEffect(()=>{l(!0);const h=setTimeout(()=>{l(!1),setTimeout(()=>t(s.id),300)},s.duration||5e3);return()=>clearTimeout(h)},[s.id,s.duration,t]);const i=h=>{switch(h){case"success":return"border-green-500 bg-green-900/20";case"error":return"border-red-500 bg-red-900/20";case"warning":return"border-yellow-500 bg-yellow-900/20";case"info":return"border-blue-500 bg-blue-900/20";default:return"border-gray-500 bg-gray-900/20"}},o=h=>{switch(h){case"success":return e.jsx(Be,{className:"w-5 h-5 text-green-400"});case"error":return e.jsx(dt,{className:"w-5 h-5 text-red-400"});case"warning":return e.jsx(Te,{className:"w-5 h-5 text-yellow-400"});case"info":return e.jsx(fa,{className:"w-5 h-5 text-blue-400"});default:return e.jsx(fa,{className:"w-5 h-5 text-gray-400"})}};return e.jsx("div",{className:`fixed top-4 right-4 z-50 transform transition-all duration-300 ${a?"translate-x-0 opacity-100":"translate-x-full opacity-0"}`,children:e.jsx("div",{className:`border rounded-lg p-4 shadow-lg backdrop-blur-sm ${i(s.type)}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[o(s.type),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium text-dark-primary",children:s.title}),s.message&&e.jsx("p",{className:"text-sm text-dark-secondary mt-1",children:s.message})]}),e.jsx("button",{onClick:()=>{l(!1),setTimeout(()=>t(s.id),300)},className:"text-dark-secondary hover:text-dark-primary transition-colors",children:e.jsx(Ke,{className:"w-4 h-4"})})]})})})}function ut(){const[s,t]=n.useState([]),a=i=>{const o=Math.random().toString(36).substr(2,9);t(h=>[...h,{...i,id:o}])},l=i=>{t(o=>o.filter(h=>h.id!==i))};return window.showToast=a,e.jsx(e.Fragment,{children:s.map(i=>e.jsx(fc,{toast:i,onRemove:l},i.id))})}const yc=ra("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function Nc({className:s,variant:t,...a}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:Le(yc({variant:t}),s),...a})}function kc({className:s,...t}){return e.jsx("div",{"data-slot":"alert-description",className:Le("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...t})}function wc(){const[s,t]=n.useState(""),[a,l]=n.useState(""),[i,o]=n.useState(!1),{login:h,isLoading:c,error:j}=ws(),P=async v=>{v.preventDefault(),!(!s||!a)&&await h(s,a)};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-600 to-blue-500 rounded-2xl mb-4",children:e.jsx(ss,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"ProjectorCare"}),e.jsx("p",{className:"text-slate-300",children:"Warranty Management System"})]}),e.jsxs(te,{className:"bg-white/10 backdrop-blur-sm border-white/20 shadow-2xl",children:[e.jsxs(oe,{className:"text-center",children:[e.jsx(de,{className:"text-2xl font-bold text-white",children:"Welcome Back"}),e.jsx(Re,{className:"text-slate-300",children:"Sign in to your account to continue"})]}),e.jsx(se,{children:e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[j&&e.jsx(Nc,{className:"border-red-500/50 bg-red-500/10",children:e.jsx(kc,{className:"text-red-300",children:j})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"username",className:"text-white",children:"Username or Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(as,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(k,{id:"username",type:"text",value:s,onChange:v=>t(v.target.value),placeholder:"Enter your username or email",className:"pl-10 bg-white/10 border-white/20 text-white placeholder:text-slate-400 focus:border-blue-400 focus:ring-blue-400",disabled:c})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"password",className:"text-white",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(zl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(k,{id:"password",type:i?"text":"password",value:a,onChange:v=>l(v.target.value),placeholder:"Enter your password",className:"pl-10 pr-10 bg-white/10 border-white/20 text-white placeholder:text-slate-400 focus:border-blue-400 focus:ring-blue-400",disabled:c}),e.jsx("button",{type:"button",onClick:()=>o(!i),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-white transition-colors",disabled:c,children:i?e.jsx(Ll,{className:"w-4 h-4"}):e.jsx(es,{className:"w-4 h-4"})})]})]}),e.jsx(q,{type:"submit",className:"w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white font-semibold py-3",disabled:c||!s||!a,children:c?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4 mr-2 animate-spin"}),"Signing In..."]}):"Sign In"})]})})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsx("p",{className:"text-slate-400 text-sm",children:"© 2024 ProjectorCare. All rights reserved."})})]})})}function Sc(){var R,F,J;const{user:s,logout:t}=ws(),[a,l]=n.useState([]),[i,o]=n.useState(!0),[h,c]=n.useState(null),[j,P]=n.useState(null),[v,x]=n.useState(!1),[S,E]=n.useState(!1),[V,_]=n.useState(null),[b,N]=n.useState(null);n.useEffect(()=>{s!=null&&s.fseId&&y()},[s]),n.useEffect(()=>{const T=()=>{const w=window.location.hash.match(/#\/service-reports\/([^/?]+)/);N(w?w[1]:null)};return T(),window.addEventListener("hashchange",T),()=>window.removeEventListener("hashchange",T)},[]);const y=async()=>{try{o(!0),console.log("Loading FSE reports for user:",s),console.log("FSE ID:",s==null?void 0:s.fseId);let T;s!=null&&s.fseId?(console.log("Loading visits for specific FSE:",s.fseId),T=await ie.getServiceVisitsByFSE(s.fseId)):(console.log("No FSE ID found, loading visits for Satish (FSE-005) for demo"),T=await ie.getServiceVisitsByFSE("FSE-005")),console.log("FSE visits response:",T),l(T)}catch(T){console.error("Error loading FSE reports:",T),c(T.message),l([])}finally{o(!1)}},A=async(T,w)=>{try{await ie.updateServiceVisit(T,{status:w}),await y()}catch(g){c(g.message)}},u=async(T,w,g,p)=>{try{E(!0);const M=new FormData;w.forEach(m=>M.append("photos",m)),M.append("description",g),await ie.uploadServiceVisitPhotosAutomated(T,M,p),await y(),x(!1)}catch(M){c(M.message)}finally{E(!1)}},$=T=>{switch(T){case"Completed":return"bg-green-100 text-green-700";case"In Progress":return"bg-blue-100 text-blue-700";case"Scheduled":return"bg-yellow-100 text-yellow-700";case"Cancelled":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}},z=T=>{switch(T){case"Critical":return"bg-red-100 text-red-700";case"High":return"bg-orange-100 text-orange-700";case"Medium":return"bg-yellow-100 text-yellow-700";case"Low":return"bg-green-100 text-green-700";default:return"bg-gray-100 text-gray-700"}},re=T=>new Date(T).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),K=a.length,ne=a.filter(T=>T.status==="Completed").length,Y=a.filter(T=>T.status==="Scheduled").length;a.filter(T=>T.status==="In Progress").length;const O=a.filter(T=>{var w;return(w=T.customerFeedback)==null?void 0:w.rating}).reduce((T,w)=>{var g;return T+(((g=w.customerFeedback)==null?void 0:g.rating)||0)},0)/a.filter(T=>{var w;return(w=T.customerFeedback)==null?void 0:w.rating}).length||0;return b?e.jsx(Wr,{reportId:b}):i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Loading your dashboard..."})]})}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"FSE Dashboard"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Welcome back, ",((R=s==null?void 0:s.profile)==null?void 0:R.firstName)||(s==null?void 0:s.username),"!"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(q,{onClick:()=>{console.log("=== FSE DASHBOARD DEBUG INFO ==="),console.log(":",s),console.log("FSE ID:",s==null?void 0:s.fseId),console.log("Total visits loaded:",a.length),console.log("Visits data:",a);const T=`
FSE Dashboard Debug Info:
- Role: ${s==null?void 0:s.role}
- FSE ID: ${(s==null?void 0:s.fseId)||"Not Set"}
- Total Visits: ${a.length}
- Current Date: ${new Date().toISOString()}

Visits Sample:
${a.slice(0,3).map(w=>`- ${w.visitId}: ${w.siteName} (${w.status}) - ${w.fseName}`).join(`
`)}
              `;alert(T)},variant:"outline",className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4"}),e.jsx("span",{children:"Debug Info"})]}),e.jsxs(q,{onClick:()=>window.location.hash="#mobile-fse",className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center space-x-2",children:[e.jsx(rs,{className:"w-4 h-4"}),e.jsx("span",{children:"Mobile Portal"})]}),e.jsx(ge,{className:"bg-blue-100 text-blue-700",children:((F=s==null?void 0:s.fseDetails)==null?void 0:F.designation)||"Field Service Engineer"}),e.jsx(ge,{className:"bg-green-100 text-green-700",children:((J=s==null?void 0:s.fseDetails)==null?void 0:J.status)||"Active"}),e.jsxs(q,{onClick:t,variant:"outline",className:"flex items-center space-x-2",children:[e.jsx(za,{className:"w-4 h-4"}),e.jsx("span",{children:"Logout"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(te,{children:e.jsx(se,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Visits"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:K})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx("div",{className:"w-6 h-6 text-blue-600"})})]})})}),e.jsx(te,{children:e.jsx(se,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:ne})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:e.jsx("div",{className:"w-6 h-6 text-green-600"})})]})})}),e.jsx(te,{children:e.jsx(se,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:Y})]}),e.jsx("div",{className:"p-3 bg-yellow-100 rounded-full",children:e.jsx(ts,{className:"w-6 h-6 text-yellow-600"})})]})})}),e.jsx(te,{children:e.jsx(se,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Rating"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[O.toFixed(1)," ⭐"]})]}),e.jsx("div",{className:"p-3 bg-purple-100 rounded-full",children:e.jsx(Ft,{className:"w-6 h-6 text-purple-600"})})]})})})]}),e.jsxs(te,{children:[e.jsxs(oe,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5"}),"My Service Visits"]}),e.jsx(Re,{children:"Your assigned and recent service visits"})]}),e.jsx(se,{children:a.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(rs,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No service visits assigned yet."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:s!=null&&s.fseId?`FSE ID: ${s.fseId}`:"Demo Mode: Loading visits for Satish (FSE-005)"})]}):e.jsx("div",{className:"space-y-4",children:a.slice(0,5).map(T=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ge,{className:$(T.status),children:T.status}),e.jsx(ge,{className:z(T.priority),children:T.priority})]}),e.jsx("div",{className:"text-sm text-gray-500",children:re(T.scheduledDate)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(As,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium",children:T.siteName})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ss,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:T.projectorSerial})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rs,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:T.visitType})]})]}),T.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:T.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[T.photos.length>0&&e.jsxs(ge,{variant:"outline",className:"text-xs",children:[T.photos.length," photos"]}),T.issuesFound.length>0&&e.jsxs(ge,{variant:"outline",className:"text-xs",children:[T.issuesFound.length," issues"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[T.status==="Scheduled"&&e.jsxs(q,{size:"sm",onClick:()=>A(T._id,"In Progress"),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(Wl,{className:"w-4 h-4 mr-1"}),"Start"]}),T.status==="In Progress"&&e.jsxs(q,{size:"sm",onClick:()=>A(T._id,"Completed"),className:"bg-green-600 hover:bg-green-700",children:[e.jsx("div",{className:"w-4 h-4 mr-1"}),"Complete"]}),e.jsxs(q,{size:"sm",variant:"outline",onClick:()=>{P(T),x(!0)},children:[e.jsx("div",{className:"w-4 h-4 mr-1"}),"Photos"]}),e.jsxs(q,{size:"sm",className:"bg-indigo-600 hover:bg-indigo-700",disabled:V===T.visitId,onClick:async()=>{var w,g,p,M;try{console.log("Visit object:",T),console.log("object:",s),_(T.visitId),console.log("Checking for existing reports for visitId:",T.visitId);const m=await ie.getServiceReportsByVisit(T.visitId);console.log("Existing reports response:",m);let d=(w=m==null?void 0:m[0])==null?void 0:w._id;if(console.log("Existing report ID:",d),!d){console.log("Creating new service report...");let X="First";try{const L=await ie.getServiceReportsByProjector(T.projectorSerial),Q=Array.isArray(L)?L.length:((g=L==null?void 0:L.data)==null?void 0:g.length)||0;X=Q===0?"First":Q===1?"Second":Q===2?"Third":"Fourth"}catch{console.warn("History check failed, defaulting to First")}let ee="Unknown Model",B="Unknown Brand";try{const Q=(await ie.getAllProjectors()).find(D=>D.serialNumber===T.projectorSerial);Q&&(ee=Q.model||"Unknown Model",B=Q.brand||"Unknown Brand")}catch{console.warn("Failed to fetch projector details, using defaults")}const ce={reportNumber:`REPORT-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,visitId:T.visitId,siteId:T.siteId,siteName:T.siteName,projectorSerial:T.projectorSerial,projectorModel:ee,brand:B,reportType:X,engineer:{name:((p=s==null?void 0:s.profile)==null?void 0:p.firstName)||(s==null?void 0:s.username)},sections:{opticals:[{description:"Reflector",status:"-",result:"OK"},{description:"UV filter",status:"-",result:"OK"},{description:"Integrator Rod",status:"-",result:"OK"},{description:"Cold Mirror",status:"-",result:"OK"},{description:"Fold Mirror",status:"-",result:"OK"}],electronics:[{description:"Touch Panel",status:"-",result:"OK"},{description:"EVB Board",status:"-",result:"OK"},{description:"IMCB Board/s",status:"-",result:"OK"},{description:"PIB Board",status:"-",result:"OK"},{description:"ICP Board",status:"-",result:"OK"},{description:"IMB/S Board",status:"-",result:"OK"}],mechanical:[{description:"AC blower and Vane Switch",status:"-",result:"OK"},{description:"Extractor Vane Switch",status:"-",result:"OK"},{description:"Exhaust CFM",status:"7.5 M/S",result:"OK"},{description:"Light Engine 4 fans with LAD fan",status:"-",result:"OK"},{description:"Card Cage Top and Bottom fans",status:"-",result:"OK"},{description:"Radiator fan and Pump",status:"-",result:"OK"},{description:"Connector and hose for the Pump",status:"-",result:"OK"},{description:"Security and lamp house lock switch",status:"-",result:"OK"},{description:"Lamp LOC Mechanism X, Y and Z movement",status:"-",result:"OK"}],disposableConsumables:[{description:"Air Intake, LAD and RAD",status:"Replaced",result:"OK"}],coolant:{description:"Level and Color",status:"-",result:"OK"},lightEngineTestPatterns:[{color:"White",status:"-",result:"OK"},{color:"Red",status:"-",result:"OK"},{color:"Green",status:"-",result:"OK"},{color:"Blue",status:"-",result:"OK"},{color:"Black",status:"-",result:"OK"}],serialNumberVerified:{description:"Chassis label vs Touch Panel",status:"-",result:"OK"}},imageEvaluation:{focusBoresight:"Yes",integratorPosition:"Yes",spotOnScreen:"No",screenCropping:"Yes",convergenceChecked:"Yes",channelsChecked:"Yes",pixelDefects:"No",imageVibration:"No",liteLoc:"No"},measuredColorCoordinates:[{testPattern:"White 2K",fl:"",x:"",y:""},{testPattern:"White 4K",fl:"",x:"",y:""},{testPattern:"Red 2K",fl:"",x:"",y:""},{testPattern:"Red 4K",fl:"",x:"",y:""},{testPattern:"Green 2K",fl:"",x:"",y:""},{testPattern:"Green 4K",fl:"",x:"",y:""},{testPattern:"Blue 2K",fl:"",x:"",y:""},{testPattern:"Blue 4K",fl:"",x:"",y:""}],cieColorAccuracy:[{testPattern:"BW Step-10 2K",x:"",y:"",fl:""},{testPattern:"BW Step-10 4K",x:"",y:"",fl:""}],screenInfo:{scope:{height:"",width:"",gain:""},flat:{height:"",width:"",gain:""},screenMake:"",throwDistance:""},voltageParameters:{pVsN:"",pVsE:"",nVsE:""},lampPowerMeasurements:{flBeforePM:"",flAfterPM:""},environmentStatus:{projectorPlacement:"ok",room:"ok",environment:"ok"},observations:[{number:1,description:""},{number:2,description:""},{number:3,description:""},{number:4,description:""},{number:5,description:""},{number:6,description:""}]};console.log("Report data being sent:",ce);const me=await ie.createServiceReport(ce);console.log("Created report response:",me),d=me.report._id}console.log("Final report ID:",d),window.location.hash=`#/service-reports/${d}`}catch(m){console.error("Report open/create failed",m),console.error("Error details:",{message:m.message,stack:m.stack,visit:T,user:s}),(M=window.showToast)==null||M.call(window,{type:"error",title:"Report",message:"Could not open report"})}finally{_(null)}},children:[e.jsx(Oe,{className:"w-4 h-4 mr-1"}),V===T.visitId?"Opening…":"Fill Report"]})]})]})]},T._id))})})]}),v&&j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(te,{className:"w-full max-w-md mx-4",children:[e.jsxs(oe,{children:[e.jsx(de,{children:"Service Photos"}),e.jsxs(Re,{children:["Add photos for visit: ",j.visitId]})]}),e.jsx(se,{children:e.jsx(Cc,{visitId:j._id,onUpload:u,onCancel:()=>x(!1),uploading:S})})]})})]})}function Cc({visitId:s,onUpload:t,onCancel:a,uploading:l}){const[i,o]=n.useState([]),[h,c]=n.useState(""),[j,P]=n.useState("During Service"),v=async x=>{x.preventDefault(),i.length&&await t(s,i,h,j)};return e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Photos"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:x=>o(Array.from(x.target.files||[])),className:"w-full p-2 border border-gray-300 rounded-md",required:!0}),i.length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[i.length," file(s) selected"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{value:j,onChange:x=>P(x.target.value),className:"w-full p-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"Before Service",children:"Before Service"}),e.jsx("option",{value:"During Service",children:"During Service"}),e.jsx("option",{value:"After Service",children:"After Service"}),e.jsx("option",{value:"Issue Found",children:"Issue Found"}),e.jsx("option",{value:"Parts Used",children:"Parts Used"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:h,onChange:x=>c(x.target.value),className:"w-full p-2 border border-gray-300 rounded-md",rows:3,placeholder:"Describe what these photos show..."})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(q,{type:"submit",disabled:!i.length||l,className:"flex-1",children:l?"Uploading...":"Photos"}),e.jsx(q,{type:"button",variant:"outline",onClick:a,disabled:l,children:"Cancel"})]})]})}function Pc(){var F,J,T,w;const{user:s}=ws(),{serviceVisits:t}=Us(),[a,l]=n.useState("dashboard"),[i,o]=n.useState(!1),[h,c]=n.useState([]),[j,P]=n.useState(!0),[v,x]=n.useState(null),[S,E]=n.useState(!1),[V,_]=n.useState(null),[b,N]=n.useState(!1);n.useEffect(()=>{y()},[s,t]);const y=async()=>{try{if(P(!0),s!=null&&s.fseId){const g=await ie.getServiceVisitsByFSE(s.fseId);c(g)}else{const g=await ie.getAllServiceVisits();c(g)}}catch(g){console.error("Error loading FSE reports:",g),x(g.message)}finally{P(!1)}},A=async g=>{var p,M;try{N(!0),console.log("ASCOMP Service Report Submitted:",g);const m=await ie.createServiceReport(g);_(m.report||g),E(!0),o(!1),l("dashboard"),await y(),console.log("ASCOMP Service Report created successfully!"),(p=window.showToast)==null||p.call(window,{type:"success",title:"Report Submitted Successfully!",message:"Your service report has been completed and saved."})}catch(m){console.error("Error submitting ASCOMP report:",m),x(m.message),(M=window.showToast)==null||M.call(window,{type:"error",title:"Submission Failed",message:"There was an error submitting your report. Please try again."})}finally{N(!1)}},u=()=>{var g;V&&(lt(V),E(!1),(g=window.showToast)==null||g.call(window,{type:"success",title:"Report Downloaded",message:"Your service report has been downloaded as PDF."}))},$=h.length,z=h.filter(g=>g.status==="Completed").length,re=h.filter(g=>g.status==="Scheduled").length,K=h.filter(g=>g.status==="In Progress").length,ne=h.filter(g=>{var p;return(p=g.customerFeedback)==null?void 0:p.rating}).reduce((g,p)=>{var M;return g+(((M=p.customerFeedback)==null?void 0:M.rating)||0)},0)/h.filter(g=>{var p;return(p=g.customerFeedback)==null?void 0:p.rating}).length||0,Y=new Date().toISOString().split("T")[0],O=h.filter(g=>g.scheduledDate===Y||g.actualDate===Y),R=h.sort((g,p)=>new Date(p.scheduledDate).getTime()-new Date(g.scheduledDate).getTime()).slice(0,5);return j?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading your dashboard..."})]})}):v?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Te,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error Loading Dashboard"}),e.jsx("p",{className:"text-gray-600 mb-4",children:v}),e.jsxs(q,{onClick:y,className:"flex items-center space-x-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),e.jsx("span",{children:"Retry"})]})]})}):i?e.jsx(Kr,{onSubmit:A,initialData:{engineer:{name:((F=s==null?void 0:s.profile)==null?void 0:F.firstName)+" "+((J=s==null?void 0:s.profile)==null?void 0:J.lastName)||(s==null?void 0:s.username),phone:((T=s==null?void 0:s.profile)==null?void 0:T.phone)||"",email:(s==null?void 0:s.email)||""},date:new Date().toISOString().split("T")[0]},onClose:()=>o(!1)}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(rs,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"ProjectorCare FSE"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Welcome, ",((w=s==null?void 0:s.profile)==null?void 0:w.firstName)||(s==null?void 0:s.username)]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{variant:"ghost",size:"sm",onClick:y,children:e.jsx(Qe,{className:"h-4 w-4"})}),e.jsx(q,{variant:"ghost",size:"sm",children:e.jsx(Qt,{className:"h-4 w-4"})}),e.jsx(q,{variant:"ghost",size:"sm",children:e.jsx(mt,{className:"h-4 w-4"})})]})]})}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{className:"text-lg",children:"Quick Actions"})}),e.jsx(se,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(q,{onClick:()=>o(!0),className:"h-20 flex-col space-y-2",children:[e.jsx(Oe,{className:"h-6 w-6"}),e.jsx("span",{children:"New Service Report"})]}),e.jsxs(q,{variant:"outline",className:"h-20 flex-col space-y-2",children:[e.jsx(Et,{className:"h-6 w-6"}),e.jsx("span",{children:"Photo Capture"})]})]})})]}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(de,{className:"text-lg",children:["Today's Schedule (",O.length,")"]})}),e.jsx(se,{children:O.length>0?e.jsx("div",{className:"space-y-3",children:O.map(g=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Site Visit - ",g.siteName]}),e.jsx("p",{className:"text-sm text-gray-600",children:g.visitType})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:g.startTime?g.startTime:"TBD"}),e.jsx(ge,{variant:"outline",className:`text-xs ${g.status==="Completed"?"text-green-600 border-green-200":g.status==="In Progress"?"text-blue-600 border-blue-200":"text-yellow-600 border-yellow-200"}`,children:g.status})]})]},g._id))}):e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(Ye,{className:"h-12 w-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No visits scheduled for today"})]})})]}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(de,{className:"text-lg",children:["Recent Reports (",R.length,")"]})}),e.jsx(se,{children:R.length>0?e.jsx("div",{className:"space-y-3",children:R.map(g=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Oe,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:g.visitId}),e.jsxs("p",{className:"text-sm text-gray-600",children:[g.siteName," - ",g.visitType]})]})]}),e.jsx(ge,{variant:"outline",className:`text-xs ${g.status==="Completed"?"text-green-600 border-green-200":g.status==="In Progress"?"text-blue-600 border-blue-200":"text-yellow-600 border-yellow-200"}`,children:g.status})]},g._id))}):e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(Oe,{className:"h-12 w-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No recent reports"})]})})]}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{className:"text-lg",children:"This Week"})}),e.jsxs(se,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:$}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Visits"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:z}),e.jsx("p",{className:"text-sm text-gray-600",children:"Completed"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:re+K}),e.jsx("p",{className:"text-sm text-gray-600",children:"Pending"})]})]}),ne>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Average Rating"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[ne.toFixed(1)," ⭐"]})]})]})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t",children:e.jsxs("div",{className:"flex justify-around p-2",children:[e.jsxs(q,{variant:a==="dashboard"?"default":"ghost",size:"sm",onClick:()=>l("dashboard"),className:"flex-col h-16",children:[e.jsx(Ul,{className:"h-5 w-5 mb-1"}),e.jsx("span",{className:"text-xs",children:"Dashboard"})]}),e.jsxs(q,{variant:a==="schedule"?"default":"ghost",size:"sm",onClick:()=>l("schedule"),className:"flex-col h-16",children:[e.jsx(Ye,{className:"h-5 w-5 mb-1"}),e.jsx("span",{className:"text-xs",children:"Schedule"})]}),e.jsxs(q,{variant:a==="reports"?"default":"ghost",size:"sm",onClick:()=>l("reports"),className:"flex-col h-16",children:[e.jsx(Bl,{className:"h-5 w-5 mb-1"}),e.jsx("span",{className:"text-xs",children:"Reports"})]}),e.jsxs(q,{variant:a==="profile"?"default":"ghost",size:"sm",onClick:()=>l("profile"),className:"flex-col h-16",children:[e.jsx(as,{className:"h-5 w-5 mb-1"}),e.jsx("span",{className:"text-xs",children:"Profile"})]})]})}),S&&V&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Service Report Ready for Download"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Your service report has been successfully submitted and is ready for download."}),e.jsxs(q,{onClick:u,className:"flex items-center space-x-2",disabled:b,children:[e.jsx(We,{className:"h-4 w-4"}),e.jsx("span",{children:"Download Report"})]}),e.jsx(q,{onClick:()=>E(!1),variant:"outline",className:"mt-2",disabled:b,children:"Cancel"})]})})]})}function Ac(){const[s,t]=n.useState(!1),[a,l]=n.useState(null),i=n.useRef(null),o=n.useRef(null),h=async()=>{try{console.log("Starting camera..."),t(!0);const P=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});i.current&&(i.current.srcObject=P)}catch(P){console.error("Camera error:",P),alert(`Camera error: ${P.message}`),t(!1)}},c=()=>{i.current&&i.current.srcObject&&(i.current.srcObject.getTracks().forEach(v=>v.stop()),i.current.srcObject=null),t(!1)},j=()=>{if(!i.current||!o.current)return;const P=i.current,v=o.current,x=v.getContext("2d");if(x){v.width=P.videoWidth,v.height=P.videoHeight,x.drawImage(P,0,0);const S=v.toDataURL("image/jpeg");l(S),console.log("Photo captured!")}};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Simple Photo Capture"}),e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{children:"Camera Test"})}),e.jsx(se,{className:"space-y-4",children:s?e.jsxs("div",{className:"space-y-4",children:[e.jsx("video",{ref:i,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full rounded-lg"}),e.jsx("canvas",{ref:o,className:"hidden"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{onClick:j,className:"flex-1",children:"Capture Photo"}),e.jsx(q,{onClick:c,variant:"outline",children:"Stop Camera"})]})]}):e.jsx(q,{onClick:h,className:"w-full",children:"Start Camera"})})]}),a&&e.jsxs(te,{children:[e.jsx(oe,{children:e.jsx(de,{children:"Captured Photo"})}),e.jsx(se,{children:e.jsx("img",{src:a,alt:"Captured",className:"w-full rounded-lg"})})]})]})}class pt extends Gt.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Error caught by boundary:",t,a)}render(){var t;return this.state.hasError?e.jsx("div",{style:{padding:"20px",backgroundColor:"#0F172A",color:"white",minHeight:"100vh",fontFamily:"Inter, system-ui, sans-serif"},children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Application Error"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"An unexpected error occurred. Please try refreshing the page or contact support."}),e.jsx("div",{className:"bg-red-900/20 border border-red-500 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400 font-mono text-sm",children:(t=this.state.error)==null?void 0:t.message})}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Reload Application"})]})}):this.props.children}}function Dc(){const{isAuthenticated:s,isLoading:t,user:a}=ws();return n.useState("main"),t?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):s?(a==null?void 0:a.role)==="fse"?(console.log("FSE user detected, pathname:",window.location.pathname,"hash:",window.location.hash),window.location.pathname==="/mobile-fse"||window.location.hash==="#mobile-fse"?(console.log("Showing mobile FSE app"),e.jsxs(pt,{children:[e.jsx(ht,{children:e.jsx(Pc,{})}),e.jsx(ut,{})]})):window.location.hash==="#simple-photo"?(console.log("Showing simple photo capture"),e.jsxs(pt,{children:[e.jsx(ht,{children:e.jsx(Ac,{})}),e.jsx(ut,{})]})):(console.log("Showing FSE dashboard"),e.jsxs(pt,{children:[e.jsx(ht,{children:e.jsx(Sc,{})}),e.jsx(ut,{})]}))):e.jsxs(pt,{children:[e.jsx(ht,{children:e.jsx(vc,{})}),e.jsx(ut,{})]}):e.jsx(wc,{})}function Rc(){return e.jsx(Vn,{children:e.jsx(Dc,{})})}Rt.createRoot(document.getElementById("root")).render(e.jsx(Gt.StrictMode,{children:e.jsx(Rc,{})}));
